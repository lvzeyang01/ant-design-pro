(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{90829:function(At,Q,N){"use strict";var le=N(67294),ye=N(27457),v=N(23185),ve=N(4322),j=N(24770),ce=N(89182),se=function(ae,et){var Le={};for(var it in ae)Object.prototype.hasOwnProperty.call(ae,it)&&et.indexOf(it)<0&&(Le[it]=ae[it]);if(ae!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ht=0,it=Object.getOwnPropertySymbols(ae);Ht<it.length;Ht++)et.indexOf(it[Ht])<0&&Object.prototype.propertyIsEnumerable.call(ae,it[Ht])&&(Le[it[Ht]]=ae[it[Ht]]);return Le},Ne=(0,le.forwardRef)(function(ae,et){var Le=ae.chartRef,it=ae.style,Ht=it===void 0?{height:"inherit"}:it,sr=ae.className,Ct=ae.loading,Jt=ae.loadingTemplate,Mt=ae.errorTemplate,lt=se(ae,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,v.Z)(ye.TZ,lt),er=dt.chart,Y=dt.container;return(0,le.useEffect)(function(){(0,ve.J)(Le,er.current)},[er.current]),(0,le.useImperativeHandle)(et,function(){return{getChart:function(){return er.current}}}),le.createElement(j.Z,{errorTemplate:Mt},Ct&&le.createElement(ce.Z,{loadingTemplate:Jt,theme:ae.theme}),le.createElement("div",{className:sr,style:Ht,ref:Y}))});Q.Z=Ne},93343:function(At,Q,N){"use strict";var le=N(67294),ye=N(27457),v=N(23185),ve=N(4322),j=N(24770),ce=N(89182),se=function(ae,et){var Le={};for(var it in ae)Object.prototype.hasOwnProperty.call(ae,it)&&et.indexOf(it)<0&&(Le[it]=ae[it]);if(ae!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ht=0,it=Object.getOwnPropertySymbols(ae);Ht<it.length;Ht++)et.indexOf(it[Ht])<0&&Object.prototype.propertyIsEnumerable.call(ae,it[Ht])&&(Le[it[Ht]]=ae[it[Ht]]);return Le},Ne=(0,le.forwardRef)(function(ae,et){var Le=ae.chartRef,it=ae.style,Ht=it===void 0?{height:"inherit"}:it,sr=ae.className,Ct=ae.loading,Jt=ae.loadingTemplate,Mt=ae.errorTemplate,lt=se(ae,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,v.Z)(ye.m,lt),er=dt.chart,Y=dt.container;return(0,le.useEffect)(function(){(0,ve.J)(Le,er.current)},[er.current]),(0,le.useImperativeHandle)(et,function(){return{getChart:function(){return er.current}}}),le.createElement(j.Z,{errorTemplate:Mt},Ct&&le.createElement(ce.Z,{loadingTemplate:Jt,theme:ae.theme}),le.createElement("div",{className:sr,style:Ht,ref:Y}))});Q.Z=Ne},64335:function(At,Q,N){"use strict";var le=N(67294),ye=(0,le.createContext)({});Q.Z=ye},21349:function(At,Q,N){"use strict";var le=N(84305),ye=N(75901),v=N(53645),ve=N.n(v),j=N(67294),ce=N(94184),se=N.n(ce),Ne=N(64335),ae=function(Le){var it=(0,j.useContext)(Ne.Z),Ht=Le.children,sr=Le.contentWidth,Ct=Le.className,Jt=Le.style,Mt=(0,j.useContext)(ye.ZP.ConfigContext),lt=Mt.getPrefixCls,dt=Le.prefixCls||lt("pro"),er=sr||it.contentWidth,Y="".concat(dt,"-grid-content");return j.createElement("div",{className:se()(Y,Ct,{wide:er==="Fixed"}),style:Jt},j.createElement("div",{className:"".concat(dt,"-grid-content-children")},Ht))};Q.Z=ae},66213:function(At,Q,N){"use strict";N.d(Q,{Z:function(){return v}});var le=N(77608);function ye(ve,j){for(;!Object.prototype.hasOwnProperty.call(ve,j)&&(ve=(0,le.Z)(ve),ve!==null););return ve}function v(){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(j,ce,se){var Ne=ye(j,ce);if(!!Ne){var ae=Object.getOwnPropertyDescriptor(Ne,ce);return ae.get?ae.get.call(arguments.length<3?j:se):ae.value}},v.apply(this,arguments)}},31795:function(At,Q,N){var le=N(75752);At.exports.geometry=ye,At.exports.ring=ve;function ye(ce){var se=0,Ne;switch(ce.type){case"Polygon":return v(ce.coordinates);case"MultiPolygon":for(Ne=0;Ne<ce.coordinates.length;Ne++)se+=v(ce.coordinates[Ne]);return se;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ne=0;Ne<ce.geometries.length;Ne++)se+=ye(ce.geometries[Ne]);return se}}function v(ce){var se=0;if(ce&&ce.length>0){se+=Math.abs(ve(ce[0]));for(var Ne=1;Ne<ce.length;Ne++)se-=Math.abs(ve(ce[Ne]))}return se}function ve(ce){var se,Ne,ae,et,Le,it,Ht,sr=0,Ct=ce.length;if(Ct>2){for(Ht=0;Ht<Ct;Ht++)Ht===Ct-2?(et=Ct-2,Le=Ct-1,it=0):Ht===Ct-1?(et=Ct-1,Le=0,it=1):(et=Ht,Le=Ht+1,it=Ht+2),se=ce[et],Ne=ce[Le],ae=ce[it],sr+=(j(ae[0])-j(se[0]))*Math.sin(j(Ne[1]));sr=sr*le.RADIUS*le.RADIUS/2}return sr}function j(ce){return ce*Math.PI/180}},38163:function(At,Q,N){var le=N(31795);At.exports=ye;function ye(Ne,ae){switch(Ne&&Ne.type||null){case"FeatureCollection":return Ne.features=Ne.features.map(v(ye,ae)),Ne;case"GeometryCollection":return Ne.geometries=Ne.geometries.map(v(ye,ae)),Ne;case"Feature":return Ne.geometry=ye(Ne.geometry,ae),Ne;case"Polygon":case"MultiPolygon":return ve(Ne,ae);default:return Ne}}function v(Ne,ae){return function(et){return Ne(et,ae)}}function ve(Ne,ae){return Ne.type==="Polygon"?Ne.coordinates=j(Ne.coordinates,ae):Ne.type==="MultiPolygon"&&(Ne.coordinates=Ne.coordinates.map(v(j,ae))),Ne}function j(Ne,ae){ae=!!ae,Ne[0]=ce(Ne[0],ae);for(var et=1;et<Ne.length;et++)Ne[et]=ce(Ne[et],!ae);return Ne}function ce(Ne,ae){return se(Ne)===ae?Ne:Ne.reverse()}function se(Ne){return le.ring(Ne)>=0}},70499:function(At){At.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(At){At.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},94180:function(At,Q,N){"use strict";N.r(Q),N.d(Q,{default:function(){return Q3}});var le={};N.r(le),N.d(le,{add:function(){return Ro},adjoint:function(){return Lr},clone:function(){return br},copy:function(){return Pr},create:function(){return Fr},determinant:function(){return $r},equals:function(){return pn},exactEquals:function(){return bt},frob:function(){return ma},fromQuat:function(){return ns},fromQuat2:function(){return Zi},fromRotation:function(){return ni},fromRotationTranslation:function(){return pi},fromRotationTranslationScale:function(){return os},fromRotationTranslationScaleOrigin:function(){return $a},fromScaling:function(){return xi},fromTranslation:function(){return Kr},fromValues:function(){return st},fromXRotation:function(){return Yr},fromYRotation:function(){return an},fromZRotation:function(){return $n},frustum:function(){return Oo},getRotation:function(){return Ni},getScaling:function(){return ho},getTranslation:function(){return po},identity:function(){return Er},invert:function(){return fr},lookAt:function(){return ss},mul:function(){return ji},multiply:function(){return Tn},multiplyScalar:function(){return Te},multiplyScalarAndAdd:function(){return Zt},ortho:function(){return qo},orthoNO:function(){return _i},orthoZO:function(){return ia},perspective:function(){return zo},perspectiveFromFieldOfView:function(){return xo},perspectiveNO:function(){return Yo},perspectiveZO:function(){return xs},rotate:function(){return En},rotateX:function(){return Vr},rotateY:function(){return Ar},rotateZ:function(){return Wr},scale:function(){return rr},set:function(){return Xt},str:function(){return zi},sub:function(){return Ee},subtract:function(){return al},targetTo:function(){return ti},translate:function(){return Qt},transpose:function(){return Ur}});var ye=N(58024),v=N(39144),ve=N(13062),j=N(71230),ce=N(89032),se=N(15746),Ne=N(95300),ae=N(7277),et=N(21010),Le=N(67294),it=N(27457),Ht=N(23185),sr=N(4322),Ct=N(24770),Jt=N(89182),Mt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},lt=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,m=e.loadingTemplate,g=e.errorTemplate,x=Mt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Ht.Z)(it.aC,x),w=C.chart,R=C.container;return(0,Le.useEffect)(function(){(0,sr.J)(r,w.current)},[w.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return w.current}}}),Le.createElement(Ct.Z,{errorTemplate:g},p&&Le.createElement(Jt.Z,{loadingTemplate:m,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:R}))}),dt=lt,er=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},Y=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,m=e.loadingTemplate,g=e.errorTemplate,x=er(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Ht.Z)(it.kB,x),w=C.chart,R=C.container;return(0,Le.useEffect)(function(){(0,sr.J)(r,w.current)},[w.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return w.current}}}),Le.createElement(Ct.Z,{errorTemplate:g},p&&Le.createElement(Jt.Z,{loadingTemplate:m,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:R}))}),$t=Y,gt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},Qe=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,m=e.loadingTemplate,g=e.errorTemplate,x=gt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Ht.Z)(it.Kj,x),w=C.chart,R=C.container;return(0,Le.useEffect)(function(){(0,sr.J)(r,w.current)},[w.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return w.current}}}),Le.createElement(Ct.Z,{errorTemplate:g},p&&Le.createElement(Jt.Z,{loadingTemplate:m,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:R}))}),xt=Qe,$e=N(90829),Kt=N(21349),Sr=N(92077),kr=N.n(Sr),Qr=N(2824),we=N(3182),Xe=N(69610),De=N(54941),St=N(81306),vt=N(19809),zt=N(94043),qt=N.n(zt),Cr=(0,Le.createContext)({});function Yn(){return(0,Le.useContext)(Cr)}var vn={},Qi={},jn=function(i){return Qi[i]},Xn=function(i,r){Qi[i]=r},gi=function(i){return vn[i]},qn=function(i,r){vn[i]=r},ui={},oa={},Fi=34,Ai=10,Gi=13;function la(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function wi(e,i){var r=la(e);return function(n,a){return i(r(n),a,e)}}function ba(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function Mn(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Si(e){return e<0?"-"+Mn(-e,6):e>9999?"+"+Mn(e,6):Mn(e,4)}function Ui(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Si(e.getUTCFullYear(),4)+"-"+Mn(e.getUTCMonth()+1,2)+"-"+Mn(e.getUTCDate(),2)+(a?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"."+Mn(a,3)+"Z":n?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"Z":r||i?"T"+Mn(i,2)+":"+Mn(r,2)+"Z":"")}function Ji(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(w,R){var D,V,J=a(w,function(te,Se){if(D)return D(te,Se-1);V=te,D=R?wi(te,R):la(te)});return J.columns=V||[],J}function a(w,R){var D=[],V=w.length,J=0,te=0,Se,He=V<=0,tt=!1;w.charCodeAt(V-1)===Ai&&--V,w.charCodeAt(V-1)===Gi&&--V;function at(){if(He)return oa;if(tt)return tt=!1,ui;var kt,nr=J,mr;if(w.charCodeAt(nr)===Fi){for(;J++<V&&w.charCodeAt(J)!==Fi||w.charCodeAt(++J)===Fi;);return(kt=J)>=V?He=!0:(mr=w.charCodeAt(J++))===Ai?tt=!0:mr===Gi&&(tt=!0,w.charCodeAt(J)===Ai&&++J),w.slice(nr+1,kt-1).replace(/""/g,'"')}for(;J<V;){if((mr=w.charCodeAt(kt=J++))===Ai)tt=!0;else if(mr===Gi)tt=!0,w.charCodeAt(J)===Ai&&++J;else if(mr!==r)continue;return w.slice(nr,kt)}return He=!0,w.slice(nr,V)}for(;(Se=at())!==oa;){for(var Ot=[];Se!==ui&&Se!==oa;)Ot.push(Se),Se=at();R&&(Ot=R(Ot,te++))==null||D.push(Ot)}return D}function s(w,R){return w.map(function(D){return R.map(function(V){return C(D[V])}).join(e)})}function p(w,R){return R==null&&(R=ba(w)),[R.map(C).join(e)].concat(s(w,R)).join(`
`)}function m(w,R){return R==null&&(R=ba(w)),s(w,R).join(`
`)}function g(w){return w.map(x).join(`
`)}function x(w){return w.map(C).join(e)}function C(w){return w==null?"":w instanceof Date?Ui(w):i.test(w+="")?'"'+w.replace(/"/g,'""')+'"':w}return{parse:n,parseRows:a,format:p,formatBody:m,formatRows:g,formatRow:x,formatValue:C}}var Xa=Ji(","),he=Xa.parse,Bn=Xa.parseRows,Ya=Xa.format,ps=Xa.formatBody,jt=Xa.formatRows,ir=Xa.formatRow,Mr=Xa.formatValue,I=N(96156),ar=N(85061),Ln=N(38163),li=N.n(Ln);function Vn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ii(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,m=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var w=[parseFloat(g[r]),parseFloat(g[n])],R=[parseFloat(g[a]),parseFloat(g[s])];C=[w,R]}if(p){var D="Polygon";Array.isArray(p[0])||(D="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(D="LineString");var V={type:D,coordinates:(0,ar.Z)(g[p])};li()(V,!0),C=V.coordinates}var J=rn(rn({},g),{},{_id:x,coordinates:C});m.push(J)}),{dataArray:m}):{dataArray:[]}}var Oi=[],eo={parser:{type:"json",x:"lng",y:"lat"}};function hs(e,i){var r=he(e);return Ii(r,i)}var ga=63710088e-1,Fa={centimeters:ga*100,centimetres:ga*100,degrees:ga/111325,feet:ga*3.28084,inches:ga*39.37,kilometers:ga/1e3,kilometres:ga/1e3,meters:ga,metres:ga,miles:ga/1609.344,millimeters:ga*1e3,millimetres:ga*1e3,nauticalmiles:ga/1852,radians:1,yards:ga*1.0936},Aa={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ga,yards:1.0936133},H={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function K(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function re(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ge(i).geometry;case"LineString":return fe(i).geometry;case"Polygon":return Ge(i).geometry;case"MultiPoint":return Ft(i).geometry;case"MultiLineString":return vr(i).geometry;case"MultiPolygon":return Bt(i).geometry;default:throw new Error(e+" is invalid")}}function ge(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ra(e[0])||!ra(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return K(n,i,r)}function Pe(e,i,r){return r===void 0&&(r={}),mt(e.map(function(n){return ge(n,i)}),r)}function Ge(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var m={type:"Polygon",coordinates:e};return K(m,i,r)}function rt(e,i,r){return r===void 0&&(r={}),mt(e.map(function(n){return Ge(n,i)}),r)}function fe(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return K(n,i,r)}function Fe(e,i,r){return r===void 0&&(r={}),mt(e.map(function(n){return fe(n,i)}),r)}function mt(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function vr(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return K(n,i,r)}function Ft(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return K(n,i,r)}function Bt(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return K(n,i,r)}function gr(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return K(n,i,r)}function bn(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function cn(e,i){i===void 0&&(i="kilometers");var r=Fa[i];if(!r)throw new Error(i+" units is invalid");return e*r}function wt(e,i){i===void 0&&(i="kilometers");var r=Fa[i];if(!r)throw new Error(i+" units is invalid");return e/r}function on(e,i){return Xr(wt(e,i))}function Hr(e){var i=e%360;return i<0&&(i+=360),i}function Xr(e){var i=e%(2*Math.PI);return i*180/Math.PI}function ii(e){var i=e%360;return i*Math.PI/180}function Jr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return cn(wt(e,i),r)}function Ti(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=H[i];if(!n)throw new Error("invalid original units");var a=H[r];if(!a)throw new Error("invalid final units");return e/n*a}function ra(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ei(e){return!!e&&e.constructor===Object}function Ri(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!ra(i))throw new Error("bbox must only contain numbers")})}function Ci(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Jn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Yi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ba(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ba(e[0]);throw new Error("coordinates must only contain numbers")}function sa(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Li(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Hi(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Za(e){return e.type==="Feature"?e.geometry:e}function au(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function wa(e,i,r){if(e!==null)for(var n,a,s,p,m,g,x,C=0,w=0,R,D=e.type,V=D==="FeatureCollection",J=D==="Feature",te=V?e.features.length:1,Se=0;Se<te;Se++){x=V?e.features[Se].geometry:J?e.geometry:e,R=x?x.type==="GeometryCollection":!1,m=R?x.geometries.length:1;for(var He=0;He<m;He++){var tt=0,at=0;if(p=R?x.geometries[He]:x,p!==null){g=p.coordinates;var Ot=p.type;switch(C=r&&(Ot==="Polygon"||Ot==="MultiPolygon")?1:0,Ot){case null:break;case"Point":if(i(g,w,Se,tt,at)===!1)return!1;w++,tt++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],w,Se,tt,at)===!1)return!1;w++,Ot==="MultiPoint"&&tt++}Ot==="LineString"&&tt++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],w,Se,tt,at)===!1)return!1;w++}Ot==="MultiLineString"&&tt++,Ot==="Polygon"&&at++}Ot==="Polygon"&&tt++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(at=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],w,Se,tt,at)===!1)return!1;w++}at++}tt++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(wa(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ta(e,i,r,n){var a=r;return wa(e,function(s,p,m,g,x){p===0&&r===void 0?a=s:a=i(a,s,p,m,g,x)},n),a}function Ss(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ds(e,i,r){var n=r;return Ss(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function na(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Zu(e,i,r){var n=r;return na(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function So(e){var i=[];return wa(e,function(r){i.push(r)}),i}function ja(e,i){var r,n,a,s,p,m,g,x,C,w,R=0,D=e.type==="FeatureCollection",V=e.type==="Feature",J=D?e.features.length:1;for(r=0;r<J;r++){for(m=D?e.features[r].geometry:V?e.geometry:e,x=D?e.features[r].properties:V?e.properties:{},C=D?e.features[r].bbox:V?e.bbox:void 0,w=D?e.features[r].id:V?e.id:void 0,g=m?m.type==="GeometryCollection":!1,p=g?m.geometries.length:1,a=0;a<p;a++){if(s=g?m.geometries[a]:m,s===null){if(i(null,R,x,C,w)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,R,x,C,w)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],R,x,C,w)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function uo(e,i,r){var n=r;return ja(e,function(a,s,p,m,g){s===0&&r===void 0?n=a:n=i(n,a,s,p,m,g)}),n}function ea(e,i){ja(e,function(r,n,a,s,p){var m=r===null?null:r.type;switch(m){case null:case"Point":case"LineString":case"Polygon":return i(K(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var g;switch(m){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],w={type:g,coordinates:C};if(i(K(w,a),n,x)===!1)return!1}})}function $o(e,i,r){var n=r;return ea(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function Qo(e,i){ea(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var m,g=0,x=0,C=0;if(wa(r,function(w,R,D,V,J){if(m===void 0||n>g||V>x||J>C){m=w,g=n,x=V,C=J,s=0;return}var te=lineString([m,w],r.properties);if(i(te,n,a,J,s)===!1)return!1;s++,m=w})===!1)return!1}}})}function ju(e,i,r){var n=r,a=!1;return Qo(e,function(s,p,m,g,x){a===!1&&r===void 0?n=s:n=i(n,s,p,m,g,x),a=!0}),n}function To(e,i){if(!e)throw new Error("geojson is required");ea(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var m=0;m<p.length;m++)if(i(lineString(p[m],r.properties),n,a,m)===!1)return!1;break}}})}function Jo(e,i,r){var n=r;return To(e,function(a,s,p,m){s===0&&r===void 0?n=a:n=i(n,a,s,p,m)}),n}function ya(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":p=p||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var g=m.coordinates;switch(m.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function Co(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":p=p||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var g=m.coordinates;switch(m.type){case"Point":return point(g,p,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],p,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],p,i)}throw new Error("geojson is invalid")}function es(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function lo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?es(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):es(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ou(e,i){var r=[],n={};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),li()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return ea(e,function(s,p){var m=Yi(s),g=p,x=lo(lo({},s.properties),{},{coordinates:m,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function Cc(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function ks(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var $=N(28481),be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ke(e){this.message=e}Ke.prototype=new Error,Ke.prototype.name="InvalidCharacterError";function Rt(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Ke("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=be.indexOf(s);return r}function Rr(e){e=String(e);for(var i,r,n,a,s="",p=0,m=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=be.charAt(i>>18&63)+be.charAt(i>>12&63)+be.charAt(i>>6&63)+be.charAt(i&63)}return m?s.slice(0,m-3)+"===".substring(m):s}var ot=N(6610),Tt=N(5991),co=function(){function e(i,r){(0,ot.Z)(this,e),this.buffers=i,this.type=r}return(0,Tt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),ta;typeof window=="undefined"?ta={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:ta=window;var qa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ts=qa?my.getSystemInfoSync().pixelRatio:ta.devicePixelRatio,sn=N(10379),en=N(46070),Nt=N(77608),Vo=(0,Tt.Z)(function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"cancelBubble",void 0),(0,I.Z)(this,"cancelable",void 0),(0,I.Z)(this,"target",void 0),(0,I.Z)(this,"currentTarget",void 0),(0,I.Z)(this,"preventDefault",void 0),(0,I.Z)(this,"stopPropagation",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),de=N(63349);function Ks(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=su(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function su(e,i){if(!!e){if(typeof e=="string")return vs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vs(e,i)}}function vs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ua=new WeakMap,Ao=function(){function e(){(0,ot.Z)(this,e),ua.set(this,{})}return(0,Tt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=ua.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),ua.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=ua.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var m=p.length;m--;m>0)if(p[m]===n){p.splice(m,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=ua.get(this)[r.type];if(n){var a=Ks(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(m){a.e(m)}finally{a.f()}}}}]),e}();function ql(e){var i=Ac();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Ac(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vu=function(e){(0,sn.Z)(r,e);var i=ql(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,de.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Tt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Ao);function wc(e){var i=Tl();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Tl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gu=function(e){(0,sn.Z)(r,e);var i=wc(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,de.Z)(n),"className",void 0),(0,I.Z)((0,de.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Tt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Vu),uu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Hu,_,T,F;if(uu){var O=my.getSystemInfoSync();Hu=O.screenWidth,_=O.screenHeight,T=O.windowWidth,F=O.windowHeight}else{var q=ta.innerWidth,xe=ta.innerHeight;Hu=q,_=xe,T=q,F=xe}var We={width:Hu,height:_,availWidth:T,availHeight:F,availLeft:0,availTop:0},ct=We.availWidth,ht=We.availHeight,cr={style:[]};function xr(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return cr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return cr}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function In(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ct+"px",height:ht+"px",margin:"0px",padding:"0px"})}function ci(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ct,e.clientHeight=ht),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Qn(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ct,e.offsetHeight=ht)}function qi(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ct,e.scrollHeight=ht)}function fa(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function La(e){var i=Wi();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Wi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Fo(){}var Cs=function(e){(0,sn.Z)(r,e);var i=La(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,de.Z)(n),"className",void 0),(0,I.Z)((0,de.Z)(n),"children",void 0),(0,I.Z)((0,de.Z)(n),"focus",void 0),(0,I.Z)((0,de.Z)(n),"blur",void 0),(0,I.Z)((0,de.Z)(n),"insertBefore",void 0),(0,I.Z)((0,de.Z)(n),"appendChild",void 0),(0,I.Z)((0,de.Z)(n),"removeChild",void 0),(0,I.Z)((0,de.Z)(n),"remove",void 0),(0,I.Z)((0,de.Z)(n),"innerHTML",void 0),(0,I.Z)((0,de.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Fo,n.blur=Fo,n.insertBefore=Fo,n.appendChild=Fo,n.removeChild=Fo,n.remove=Fo,n.innerHTML="",n.tagName=a.toUpperCase(),xr((0,de.Z)(n),s),In((0,de.Z)(n)),fa((0,de.Z)(n)),ci((0,de.Z)(n)),Qn((0,de.Z)(n)),qi((0,de.Z)(n)),n}return(0,Tt.Z)(r)}(Gu);function cl(e){var i=qc();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function qc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wu=function(e){(0,sn.Z)(r,e);var i=cl(r);function r(n){return(0,ot.Z)(this,r),i.call(this,n)}return(0,Tt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Cs);function Tc(e){var i=Iu();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Iu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mu=function(e){(0,sn.Z)(r,e);var i=Tc(r);function r(){return(0,ot.Z)(this,r),i.call(this,"video")}return(0,Tt.Z)(r)}(Wu),Mo={},pa={};function up(e,i){Mo=e,Mo.id=i,"tagName"in Mo||(Mo.tagName="CANVAS"),Mo.type="canvas",Mixin.parentNode(Mo),Mixin.style(Mo),Mixin.classList(Mo),Mixin.clientRegion(Mo),Mixin.offsetRegion(Mo),Mo.focus=function(){},Mo.blur=function(){}}function lp(e,i){var r=1024,n=1024;pa={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in pa||(pa.tagName="CANVAS"),Mixin.parentNode(pa),Mixin.style(pa),Mixin.classList(pa),Mixin.clientRegion(pa),Mixin.offsetRegion(pa),pa.getContext=function(a){if(a==="2d")return e},pa.focus=function(){},pa.blur=function(){}}function go(){return Mo}function If(){return pa}var gu=(0,Tt.Z)(function e(){(0,ot.Z)(this,e);var i=go(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),xr(r),fa(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Ds={href:"",protocol:"",host:""};function Mc(e){var i=fl();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ea=function(e){(0,sn.Z)(r,e);var i=Mc(r);function r(){return(0,ot.Z)(this,r),i.call(this,"body",0)}return(0,Tt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(Cs),Ml=function(e){(0,sn.Z)(r,e);var i=Mc(r);function r(){return(0,ot.Z)(this,r),i.call(this,"html",0)}return(0,Tt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Cs),Kl={},is={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ds,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new gu:i==="video"?new mu:new Cs(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){Kl[i]||(Kl[i]=[]),Kl[i].push(r)},removeEventListener:function(i,r){var n=Kl[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=Kl[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Vo(i)}};is.documentElement=new Ml,is.head=new Cs("head"),is.body=new Ea;var Of=Object,cp=N(90484),fp=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"_w",void 0),(0,I.Z)(this,"_h",void 0),(0,I.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,cp.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Tt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Kc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,pl,Go,Ou;if(Kc){var Xu=my.getSystemInfoSync();pl=Xu.system,Go=Xu.platform,Ou=Xu.language}else{var Ho={versions:function(){var e=ta.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(ta.navigator.browserLanguage||ta.navigator.language).toLowerCase()};Ho.versions.android?Go="android":Ho.versions.trident?Go="IE":Ho.versions.presto?Go="Opera":Ho.versions.webKit?Go="webKit":Ho.versions.gecko?Go="Firefox":Ho.versions.mobile?Go="mobile":Ho.versions.ios?Go="ios":Ho.versions.iPhone?Go="iPhone":Ho.versions.iPad?Go="ipad":Ho.versions.webApp?Go="webApp":Ho.versions.weixin?Go="weixin":Ho.versions.qq&&(Go="qq"),pl=ta.navigator.userAgent,Ou=Ho.language}var Pl=pl.toLowerCase().indexOf("android")!==-1,Yu=Pl?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",$s="Mozilla/5.0 (".concat(Yu,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Ou),$c={platform:Go,language:Ou,appVersion:"5.0 (".concat(Yu,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:$s},Qc={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},Jc=0,qu=0;function $l(e){var i=Date.now(),r=Math.max(Jc+23,i);return qu=setTimeout(function(){e(Jc=r)},r-i),qu}function Pc(e){var i=go();return i.requestAnimationFrame?i.requestAnimationFrame(e):$l(e)}function ef(e){var i=go();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Ic=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ot.Z)(this,e),(0,I.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Tt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=pp(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function pp(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return Rr(i)}var Oc={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},hl={};function tf(e){var i=rf();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ru=new Map,nf=new Map,Rf=new Map,hp={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Il(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Kp(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Il.call(this,"readystatechange",i)}var as=function(e){(0,sn.Z)(r,e);var i=tf(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,de.Z)(n),"onabort",void 0),(0,I.Z)((0,de.Z)(n),"onerror",void 0),(0,I.Z)((0,de.Z)(n),"onload",void 0),(0,I.Z)((0,de.Z)(n),"onloadstart",void 0),(0,I.Z)((0,de.Z)(n),"onprogress",void 0),(0,I.Z)((0,de.Z)(n),"ontimeout",void 0),(0,I.Z)((0,de.Z)(n),"onloadend",void 0),(0,I.Z)((0,de.Z)(n),"onreadystatechange",void 0),(0,I.Z)((0,de.Z)(n),"readyState",void 0),(0,I.Z)((0,de.Z)(n),"response",void 0),(0,I.Z)((0,de.Z)(n),"responseText",void 0),(0,I.Z)((0,de.Z)(n),"_responseType",void 0),(0,I.Z)((0,de.Z)(n),"responseXML",void 0),(0,I.Z)((0,de.Z)(n),"status",void 0),(0,I.Z)((0,de.Z)(n),"statusText",void 0),(0,I.Z)((0,de.Z)(n),"upload",void 0),(0,I.Z)((0,de.Z)(n),"withCredentials",void 0),(0,I.Z)((0,de.Z)(n),"timeout",void 0),(0,I.Z)((0,de.Z)(n),"_url",void 0),(0,I.Z)((0,de.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Ru.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Tt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Rf.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=nf.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return nf.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=Ru.get("requestHeader");p[a]=s,Ru.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m.target=m.target||p,s.call(p,m)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Ao);(0,I.Z)(as,"UNSEND",void 0),(0,I.Z)(as,"OPENED",void 0),(0,I.Z)(as,"HEADERS_RECEIVED",void 0),(0,I.Z)(as,"LOADING",void 0),(0,I.Z)(as,"DONE",void 0),as.UNSEND=0,as.OPENED=1,as.HEADERS_RECEIVED=2,as.LOADING=3,as.DONE=4;function Ka(e){var i=Ql();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ol=function(e){(0,sn.Z)(r,e);var i=Ka(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,de.Z)(a),"touches",void 0),(0,I.Z)((0,de.Z)(a),"targetTouches",void 0),(0,I.Z)((0,de.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=go(),a.currentTarget=go(),a}return(0,Tt.Z)(r)}(Vo);function lu(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,m=p===void 0?0:p,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=m,e.y=x)}function Bi(e){return function(i){var r=new Ol(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return lu(n)}),r.touches.forEach(function(n){return lu(n)}),r.targetTouches.forEach(function(n){return lu(n)}),is.dispatchEvent(r)}}function Na(e){return function(i){i.type=e,is.dispatchEvent(i)}}var Fs=Bi("touchstart"),af=Bi("touchmove"),dl=Bi("touchend"),of=Na("mapCameaParams");function $p(e){var i=Qp();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Qp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rc=function(e){(0,sn.Z)(r,e);var i=$p(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,de.Z)(a),"buttons",void 0),(0,I.Z)((0,de.Z)(a),"which",void 0),(0,I.Z)((0,de.Z)(a),"pointerId",void 0),(0,I.Z)((0,de.Z)(a),"bubbles",void 0),(0,I.Z)((0,de.Z)(a),"button",void 0),(0,I.Z)((0,de.Z)(a),"width",void 0),(0,I.Z)((0,de.Z)(a),"height",void 0),(0,I.Z)((0,de.Z)(a),"pressure",void 0),(0,I.Z)((0,de.Z)(a),"isPrimary",void 0),(0,I.Z)((0,de.Z)(a),"pointerType",void 0),(0,I.Z)((0,de.Z)(a),"altKey",void 0),(0,I.Z)((0,de.Z)(a),"ctrlKey",void 0),(0,I.Z)((0,de.Z)(a),"metaKey",void 0),(0,I.Z)((0,de.Z)(a),"shiftKey",void 0),a.target=go(),a.currentTarget=go(),a}return(0,Tt.Z)(r)}(Vo),Jl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Ku=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Bo="touch";function ec(e,i,r){for(var n=new Rc(e),a=0;a<Jl.length;a++){var s=Jl[a];n[s]=i[s]||Ku[a]}return n.type=e,n.target=go(),n.currentTarget=go(),n.buttons=tc(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=gn(i),n.pointerType=Bo,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function tc(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var to=null;function gn(e){return to===e.identifier}function fo(e){to===null&&(to=e.identifier)}function $u(e){to===e.identifier&&(to=null)}function Qu(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?fo(a):(e==="pointerup"||e==="pointercancel")&&$u(a);var s=ec(e,a,i);is.dispatchEvent(s)}}}var yu=Qu("pointerdown"),Bs=Qu("pointermove"),Lf=Qu("pointerup");function qr(e){var i=sf();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kf=function(e){(0,sn.Z)(r,e);var i=qr(r);function r(n){return(0,ot.Z)(this,r),i.call(this,n)}return(0,Tt.Z)(r)}(Vo);function Lu(e){return function(i){i.type=e,is.dispatchEvent(i)}}var Wa=Lu("mousedown"),Ns=Lu("mousemove"),uf=Lu("mouseup"),ku=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Is=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Po=ku||Is,dp={atob:Rt,btoa:Rr,devicePixelRatio:ts,Blob:co,document:is,Element:Gu,Event:Vo,EventTarget:Ao,HTMLCanvasElement:Of,HTMLElement:Cs,HTMLMediaElement:Wu,HTMLVideoElement:mu,Image:gu,ImageData:fp,navigator:$c,Node:Vu,requestAnimationFrame:Pc,cancelAnimationFrame:ef,screen:We,XMLHttpRequest:as,performance:Qc,URL:Ic,WebGLRenderingContext:Oc,WebGL2RenderingContext:hl,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};is.addEventListener(i,r,n)},removeEventListener:function(i,r,n){is.removeEventListener(i,r)},dispatchEvent:function(i){is.dispatchEvent(i)},innerWidth:We.availWidth,innerHeight:We.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},_a=Po?dp:ta,Df=Po?as:ta.XMLHttpRequest,vp=Po?Ds:ta.location;function Qs(e){var i=e;return typeof e=="string"&&(i=_a.document.getElementById(e)),i}function Os(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function ki(e){return Os(e).split(/\s+/)}function _u(e){var i,r,n=_a==null||(i=_a.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function ha(e,i,r){var n=_a.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function yo(e){var i=e.parentNode;i&&i.removeChild(e)}function zs(e,i){if(e.classList!==void 0)for(var r=ki(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Us(e,i)){var s=Zs(e);ms(e,(s?s+" ":"")+i)}}function cu(e,i){e.classList!==void 0?e.classList.remove(i):ms(e,Os((" "+Zs(e)+" ").replace(" "+i+" "," ")))}function Us(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Zs(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function ms(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Zs(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function On(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var wn=_u(["transform","WebkitTransform"]);function rc(e,i){e.style[wn]=i}function gs(){if(typeof Event=="function")_a.dispatchEvent(new Event("resize"));else{var e=_a.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,_a,0),_a.dispatchEvent(e)}}function xu(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function rs(){var e,i=_a.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,$.Z)(s,2),m=p[0],g=p[1];return m==="initial-scale"});return n?n.split("=")[1]*1:1}var Sa=rs()<1?1:_a.devicePixelRatio,Lc=N(14665);function kc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var da=N(51814);function Ma(e,i,r){return(0,da.Z)()?Ma=Reflect.construct:Ma=function(a,s,p){var m=[null];m.push.apply(m,s);var g=Function.bind.apply(a,m),x=new g;return p&&(0,Lc.Z)(x,p.prototype),x},Ma.apply(null,arguments)}function Dc(e){var i=typeof Map=="function"?new Map:void 0;return Dc=function(n){if(n===null||!kc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Ma(n,arguments,(0,Nt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Lc.Z)(a,n)},Dc(e)}function Rl(e){var i=bu();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Js=function(e){(0,sn.Z)(r,e);var i=Rl(r);function r(n,a,s){var p;return(0,ot.Z)(this,r),p=i.call(this,n),(0,I.Z)((0,de.Z)(p),"status",void 0),(0,I.Z)((0,de.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,Tt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(Dc(Error));function No(e){var i=new Df;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var vl=function(i,r){var n=No(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Js("".concat(n.statusText),n.status,i.url)):r(new Js(n.statusText,n.status,i.url))},n.send(),n},Eu=function(i,r){var n=No(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Js(n.statusText,n.status,i.url))},n.send(),n};function lf(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Ll="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",kl=function(i,r){return Eu(i,function(n,a){if(n)r(n);else if(a){var s=new _a.Image;s.crossOrigin="anonymous";var p=_a.URL||_a.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var m=new _a.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(m):Ll}})},Dl=2*Math.PI*6378137/2;function nc(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;ml(i,n)}),i}function ml(e,i){return Array.isArray(i[0])?i.forEach(function(r){ml(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function mp(e,i){return Ju(e,i)}function Ju(e,i){return Array.isArray(e[0])?e.map(function(r){return Ju(r,i)}):i(e)}function Du(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=cf(e,i);var n=e[0],a=e[1],s=n*Dl/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*Dl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function Ff(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/Dl*180,s=n/Dl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function gl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function eu(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function cf(e,i){if(i===!1)return e;var r=gl(e[0]),n=eu(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function js(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var m=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(m*s+g),p=n*(x*p+a),[Math.floor(s),Math.floor(p)]}function gp(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),m=p[0],g=p[1];m=(m/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=m/a;return[C,x]}function ic(e,i,r){var n=ii(i[1]-e[1]),a=ii(i[0]-e[0]),s=ii(e[1]),p=ii(i[1]),m=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return cn(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),r="meters")}function l(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,m=n*Math.log((1+s)/(1-s))/2;return[p,m]}function f(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function c(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function d(e){return[[e[0],e[1]],[e[2],e[3]]]}function E(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function A(e,i){return e[0]*i[0]+e[1]*i[1]}function M(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function L(e,i){return Math.acos(A(e,i)/(M(e)*M(i)))*180/Math.PI}function U(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function X(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],m=e[s+1],g=E(p,m);n+=g;var x=[p[0]-m[0],p[1]-m[1]],C=U(r,x);if(s>0){var w=a[s-1].rotation;w-C>360-w+C&&(C=C+360)}a.push({start:p,end:m,dis:g,rotation:C,duration:0})}return a.map(function(R){R.duration=i*(R.dis/n)}),a}}var oe=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ot.Z)(this,e),(0,I.Z)(this,"limit",void 0),(0,I.Z)(this,"cache",void 0),(0,I.Z)(this,"destroy",void 0),(0,I.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Tt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function ue(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var pe=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ot.Z)(this,e),(0,I.Z)(this,"duration",16),(0,I.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Tt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Oe=N(2650);function Ie(e){return typeof e=="string"?!!Oe.ZP(e):!1}function ke(e){var i=Oe.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Ae(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function je(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Je(e){var i=_a.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],m=0;m<e.colors.length;++m){var g=(e.positions[m]-s)/(p-s);n.addColorStop(g,e.colors[m])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Po)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var yt;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(yt||(yt={}));var Wt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vt(e,i,r){var n=e.classList;for(var a in Wt)Wt.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Pt(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var pr={BACK:1029,FRONT:1028};function Or(e){switch(e){case"GAODE1.x":return pr.BACK;case"GAODE2.x":return pr.BACK;case"MAPBOX":return pr.FRONT;case"SIMPLE":return pr.FRONT;case"GLOBEL":return pr.BACK;case"L7MAP":return pr.FRONT;default:return pr.FRONT}}function Dr(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function un(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Fn(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Nn(e){if(e.length===0)throw new Error("mean requires at least one data point");return Fn(e)/e.length}function Un(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var Di={min:un,max:Dr,mean:Nn,sum:Fn,mode:Un};function nn(e,i){return e.map(function(r){return r[i]})}function ai(e,i){return Di[e](i)}function fi(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){ei(e,function(m){p(m)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function ei(e,i){var r=e,n=[];if(typeof r=="string")kl({url:r},function(p,m){n.push(m),i(n)});else{var a=r.length,s=0;r.forEach(function(p){kl({url:p},function(m,g){s++,n.push(g),s===a&&i(n)})})}return fi}function Gn(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,m={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return m}var yi=N(30236),Kn=N.n(yi),Hn=N(47037),Pa=N.n(Hn),ro=N(23560),no=N.n(ro),Wo=N(50361),Va=N.n(Wo),io=N(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Rs(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function m(C){try{x(n.next(C))}catch(w){p(w)}}function g(C){try{x(n.throw(C))}catch(w){p(w)}}function x(C){C.done?s(C.value):a(C.value).then(m,g)}x((n=n.apply(e,i||[])).next())})}function ys(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function m(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Fu(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(m){p={error:m}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function _s(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Fu(arguments[i]));return e}function ka(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ia(e,i){return i={exports:{}},e(i,i.exports),i.exports}var el=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});ka(el);var yl=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});ka(yl);var Ls=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof io=="object"&&typeof io.nextTick=="function";function a(m){setTimeout(m,0)}function s(m){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return m(function(){return g.apply(void 0,x)})}}var p;r?p=setImmediate:n?p=io.nextTick:p=a,i.default=s(p)});ka(Ls);var ac=Ls.fallback,Fc=Ls.wrap,Su=Ls.hasSetImmediate,oc=Ls.hasNextTick,fu=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(yl),n=a(Ls);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,Oa.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var w=x.pop(),R=g.apply(this,x);return p(R,w)}:(0,r.default)(function(x,C){var w;try{w=g.apply(this,x)}catch(R){return C(R)}if(w&&typeof w.then=="function")return p(w,C);C(null,w)})}function p(g,x){return g.then(function(C){m(x,null,C)},function(C){m(x,C&&C.message?C:new Error(C))})}function m(g,x,C){try{g(x,C)}catch(w){(0,n.default)(function(R){throw R},w)}}e.exports=i.default});ka(fu);var Oa=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(fu);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function p(g){return typeof g[Symbol.asyncIterator]=="function"}function m(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=m,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});ka(Oa);var tl=Oa.isAsyncIterable,_l=Oa.isAsyncGenerator,xl=Oa.isAsync,Xi=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,m=[],g=arguments.length;g--;)m[g]=arguments[g];return typeof m[a-1]=="function"?n.apply(this,m):new Promise(function(x,C){m[a-1]=function(w){for(var R=[],D=arguments.length-1;D-- >0;)R[D]=arguments[D+1];if(w)return C(w);x(R.length>1?R:R[0])},n.apply(p,m)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});ka(Xi);var As=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(el),n=s(Oa),a=s(Xi);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,m,g){var x=(0,r.default)(m)?[]:{};p(m,function(C,w,R){(0,n.default)(C)(function(D){for(var V,J=[],te=arguments.length-1;te-- >0;)J[te]=arguments[te+1];J.length<2&&(V=J,J=V[0]),x[w]=J,R(D)})},function(C){return g(C,x)})},3),e.exports=i.default});ka(As);var Xo=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var m=n;n=null,m.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});ka(Xo);var Bu=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});ka(Bu);var sc=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(el),n=a(Bu);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,w=x.length;return function(){return++C<w?{value:x[C],key:C}:null}}function p(x){var C=-1;return function(){var R=x.next();return R.done?null:(C++,{value:R.value,key:C})}}function m(x){var C=x?Object.keys(x):[],w=-1,R=C.length;return function(){var V=C[++w];return w<R?{value:x[V],key:V}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?p(C):m(x)}e.exports=i.default});ka(sc);var bl=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});ka(bl);var Fl=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});ka(Fl);var Vs=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Fl);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,m,g){var x=!1,C=!1,w=!1,R=0,D=0;function V(){R>=p||w||x||(w=!0,s.next().then(function(Se){var He=Se.value,tt=Se.done;if(!(C||x)){if(w=!1,tt){x=!0,R<=0&&g(null);return}R++,m(He,D,J),D++,V()}}).catch(te))}function J(Se,He){if(R-=1,!C){if(Se)return te(Se);if(Se===!1){x=!0,C=!0;return}if(He===r.default||x&&R<=0)return x=!0,g(null);V()}}function te(Se){C||(w=!1,x=!0,g(Se))}V()}e.exports=i.default});ka(Vs);var Bl=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=m(Xo),n=m(sc),a=m(bl),s=m(Vs),p=m(Fl);function m(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,w){if(w=(0,r.default)(w),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return w(null);if((0,Oa.isAsyncGenerator)(x))return(0,s.default)(x,g,C,w);if((0,Oa.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,w);var R=(0,n.default)(x),D=!1,V=!1,J=0,te=!1;function Se(tt,at){if(!V)if(J-=1,tt)D=!0,w(tt);else if(tt===!1)D=!0,V=!0;else{if(at===p.default||D&&J<=0)return D=!0,w(null);te||He()}}function He(){for(te=!0;J<g&&!D;){var tt=R();if(tt===null){D=!0,J<=0&&w(null);return}J+=1,C(tt.value,tt.key,(0,a.default)(Se))}te=!1}He()}},e.exports=i.default});ka(Bl);var Gs=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Bl),n=s(Oa),a=s(Xi);function s(m){return m&&m.__esModule?m:{default:m}}function p(m,g,x,C){return(0,r.default)(g)(m,(0,n.default)(x),C)}i.default=(0,a.default)(p,4),e.exports=i.default});ka(Gs);var rl=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Gs),n=a(Xi);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,m,g){return(0,r.default)(p,1,m,g)}i.default=(0,n.default)(s,3),e.exports=i.default});ka(rl);var Bc=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(As),n=a(rl);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,m){return(0,r.default)(n.default,p,m)}e.exports=i.default}),pu=ka(Bc),Ga=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,pu(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,_s(n.args)),a(null,i)})},e}(),uc=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(el),n=x(Fl),a=x(Gs),s=x(Xo),p=x(bl),m=x(Oa),g=x(Xi);function x(D){return D&&D.__esModule?D:{default:D}}function C(D,V,J){J=(0,s.default)(J);var te=0,Se=0,He=D.length,tt=!1;He===0&&J(null);function at(Ot,kt){Ot===!1&&(tt=!0),tt!==!0&&(Ot?J(Ot):(++Se===He||kt===n.default)&&J(null))}for(;te<He;te++)V(D[te],te,(0,p.default)(at))}function w(D,V,J){return(0,a.default)(D,Infinity,V,J)}function R(D,V,J){var te=(0,r.default)(D)?C:w;return te(D,(0,m.default)(V),J)}i.default=(0,g.default)(R,3),e.exports=i.default});ka(uc);var Bf=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(uc),n=a(As);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,m){return(0,n.default)(r.default,p,m)}e.exports=i.default}),yp=ka(Bf),Nf=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return yp(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return Rs(n,void 0,void 0,function(){return ys(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Jp=Ia(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(Xo),n=p(bl),a=p(Oa),s=p(Xi);function p(g){return g&&g.__esModule?g:{default:g}}function m(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function w(D){var V=(0,a.default)(g[C++]);V.apply(void 0,D.concat([(0,n.default)(R)]))}function R(D){for(var V=[],J=arguments.length-1;J-- >0;)V[J]=arguments[J+1];if(D!==!1){if(D||C===g.length)return x.apply(void 0,[D].concat(V));w(V)}}w([])}i.default=(0,s.default)(m),e.exports=i.default}),eh=ka(Jp),lc=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return eh(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),cc=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return pu(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),hu=N(26729),Bh=N.n(hu),Nl=N(69848),Nc=N.n(Nl);function th(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?th(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):th(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zc(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,m=p===void 0?0:p,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=rh(C),e}var w=new(Nc())({radius:n,minZoom:m,maxZoom:s}),R={type:"FeatureCollection",features:[]};return R.features=e.dataArray.map(function(D){return{type:"Feature",geometry:{type:"Point",coordinates:D.coordinates},properties:Nh({},D)}}),w.load(R.features),w}function rh(e){return e.map(function(i,r){return Nh({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Ed(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Sd(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function nh(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function ih(e){if(e.length===0)throw new Error("mean requires at least one data point");return nh(e)/e.length}var Cd={min:Sd,max:Ed,mean:ih,sum:nh};function ff(e,i){return e.map(function(r){return r[i]*1})}function zh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _o(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _p(e){var i=Uh();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Uh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xp(e,i){if(Array.isArray(i))return i}var bp=function(e){(0,sn.Z)(r,e);var i=_p(r);function r(n,a){var s;return(0,ot.Z)(this,r),s=i.call(this),(0,I.Z)((0,de.Z)(s),"data",void 0),(0,I.Z)((0,de.Z)(s),"extent",void 0),(0,I.Z)((0,de.Z)(s),"hooks",{init:new Ga}),(0,I.Z)((0,de.Z)(s),"parser",{type:"geojson"}),(0,I.Z)((0,de.Z)(s),"transforms",[]),(0,I.Z)((0,de.Z)(s),"cluster",!1),(0,I.Z)((0,de.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,de.Z)(s),"mapService",void 0),(0,I.Z)((0,de.Z)(s),"invalidExtent",!1),(0,I.Z)((0,de.Z)(s),"dataArrayChanged",!1),(0,I.Z)((0,de.Z)(s),"originData",void 0),(0,I.Z)((0,de.Z)(s),"rawData",void 0),(0,I.Z)((0,de.Z)(s),"cfg",{}),(0,I.Z)((0,de.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Tt.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,m=p.method,g=m===void 0?"sum":m,x=p.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(w){w.id||(w.properties.point_count=1)}),(x||no()(g))&&(C=C.map(function(w){var R=w.id;if(R){var D=s.clusterIndex.getLeaves(R,Infinity),V=D.map(function(Se){return Se.properties}),J;if(Pa()(g)&&x){var te=ff(V,x);J=Cd[g](te)}no()(g)&&(J=g(V)),w.properties.stat=J}else w.properties.point_count=1;return w})),this.data=jn("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var m=a<this.originData.features.length?this.originData.features[a]:"null",g=Va()(m);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(p){return p._id===a?_o(_o({},p),s):p}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(m){return m[a]===s});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=f(d(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=Kn()(this.cfg,a,xp);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=_o(_o({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=jn(s);this.data=p(this.originData,a),this.extent=nc(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var m=p.type,g=gi(m)(a.data,p);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=zc(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(hu.EventEmitter);function zf(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Uf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Zf(e,i){if(!!e){if(typeof e=="string")return zl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zl(e,i)}}function zl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var fc=6378e3;function jf(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*fc)*(256<<20)/2,p=Ep(r,a),m=p.gridHash,g=p.gridOffset,x=Cp(m,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Ep(e,i){var r=Infinity,n=-Infinity,a,s=Uf(e),p;try{for(s.s();!(p=s.n()).done;){var m=p.value;a=m.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(tt){s.e(tt)}finally{s.f()}var g=(r+n)/2,x=pc(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},w=Uf(e),R;try{for(w.s();!(R=w.n()).done;){var D=R.value,V=D.coordinates[1],J=D.coordinates[0];if(Number.isFinite(V)&&Number.isFinite(J)){var te=Math.floor((V+90)/x.yOffset),Se=Math.floor((J+180)/x.xOffset),He="".concat(te,"-").concat(Se);C[He]=C[He]||{count:0,points:[]},C[He].count+=1,C[He].points.push(D)}}}catch(tt){w.e(tt)}finally{w.f()}return{gridHash:C,gridOffset:x}}function pc(e,i){var r=Sp(e),n=Vf(i,e);return{yOffset:r,xOffset:n}}function Sp(e){return e/fc*(180/Math.PI)}function Vf(e,i){return i/fc*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Cp(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),m=parseInt(p[0],10),g=parseInt(p[1],10),x={};if(r.field&&r.method){var C=nn(e[a].points,r.field);x[r.method]=Di[r.method](C)}return Object.assign(x,{_id:s,coordinates:js([-180+i.xOffset*(g+.5),-90+i.yOffset*(m+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var nl=Math.PI/3,pf=[0,nl,2*nl,3*nl,4*nl,5*nl];function tu(e){return e[0]}function Gf(e){return e[1]}function Hf(){var e=0,i=0,r=1,n=1,a=tu,s=Gf,p,m,g;function x(w){var R={},D=[],V,J=w.length;for(V=0;V<J;++V)if(!(isNaN(Se=+a.call(null,te=w[V],V,w))||isNaN(He=+s.call(null,te,V,w)))){var te,Se,He,tt=Math.round(He=He/g),at=Math.round(Se=Se/m-(tt&1)/2),Ot=He-tt;if(Math.abs(Ot)*3>1){var kt=Se-at,nr=at+(Se<at?-1:1)/2,mr=tt+(He<tt?-1:1),Gr=Se-nr,ln=He-mr;kt*kt+Ot*Ot>Gr*Gr+ln*ln&&(at=nr+(tt&1?1:-1)/2,tt=mr)}var Tr=at+"-"+tt,An=R[Tr];An?An.push(te):(D.push(An=R[Tr]=[te]),An.x=(at+(tt&1)/2)*m,An.y=tt*g)}return D}function C(w){var R=0,D=0;return pf.map(function(V){var J=Math.sin(V)*w,te=-Math.cos(V)*w,Se=J-R,He=te-D;return R=J,D=te,[Se,He]})}return x.hexagon=function(w){return"m"+C(w==null?p:+w).join("l")+"z"},x.centers=function(){for(var w=[],R=Math.round(i/g),D=Math.round(e/m),V=R*g;V<n+p;V+=g,++R)for(var J=D*m+(R&1)*m/2;J<r+m/2;J+=m)w.push([J,V]);return w},x.mesh=function(){var w=C(p).slice(0,4).join("l");return x.centers().map(function(R){return"M"+R+"m"+w}).join("")},x.x=function(w){return arguments.length?(a=w,x):a},x.y=function(w){return arguments.length?(s=w,x):s},x.radius=function(w){return arguments.length?(p=+w,m=p*2*Math.sin(nl),g=p*1.5,x):p},x.size=function(w){return arguments.length?(e=i=0,r=+w[0],n=+w[1],x):[r-e,n-i]},x.extent=function(w){return arguments.length?(e=+w[0][0],i=+w[0][1],r=+w[1][0],n=+w[1][1],x):[[e,i],[r,n]]},x.radius(1)}function hf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function df(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ap=6378e3;function El(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,m=a/(2*Math.PI*Ap)*(256<<20)/2,g=r.map(function(R){var D=js(R.coordinates),V=(0,$.Z)(D,2),J=V[0],te=V[1];return df(df({},R),{},{coordinates:[J,te]})}),x=Hf().radius(m).x(function(R){return R.coordinates[0]}).y(function(R){return R.coordinates[1]}),C=x(g),w={dataArray:C.map(function(R,D){var V;if(i.field&&p){var J=nn(R,i.field);R[p]=Di[p](J)}return V={},(0,I.Z)(V,i.method,R[p]),(0,I.Z)(V,"count",R.length),(0,I.Z)(V,"rawData",R),(0,I.Z)(V,"coordinates",[R.x,R.y]),(0,I.Z)(V,"_id",D),V}),radius:m,xOffset:m,yOffset:m,type:"hexagon"};return w}function hc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ah(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hc(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wp(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var m=p[n];return ah(ah({},p),s[m])}),e}function Zh(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Xn("geojson",ou),Xn("image",fi),Xn("csv",hs),Xn("json",Ii),Xn("raster",Gn),qn("cluster",zc),qn("filter",zf),qn("join",wp),qn("map",Zh),qn("grid",jf),qn("hexagon",El);var Ad=Oi,wd=eo,du=bp,Td=N(28660),jr=N(86700),vf=N(84879),Ut={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},jh=N(31745),Md=N.n(jh);function il(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Uc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?il(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):il(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dc(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vc(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function vc(e,i){if(!!e){if(typeof e=="string")return oh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oh(e,i)}}function oh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Zc=30;function Tp(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,m=p===void 0?{}:p,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,w=C===void 0?0:C,R=0,D=x;Array.from(i).forEach(function(J,te){if(!m[J]){var Se=r(J,te);D+Zc>s&&(D=0,R++),m[J]={x:D,y:w+R*Zc,width:Zc,height:Zc,advance:Se},D+=Zc}});var V=n+a*2;return{mapping:m,xOffset:D,yOffset:w+R*V,canvasHeight:Ul(w+(R+1)*V)}}function sh(e,i,r){var n=0,a=0,s=0,p=[],m={},g=dc(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!m[C.id]){var w=C.size;n+w+i>r&&(va(m,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:C,xOffset:n}),n=n+w+i,s=Math.max(s,w)}}}catch(D){g.e(D)}finally{g.f()}p.length>0&&va(m,p,a);var R=Ul(s+a+i);return{mapping:m,canvasHeight:R}}function va(e,i,r){var n=dc(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,m=s.xOffset;e[p.id]=Uc(Uc({},p),{},{x:m,y:r,image:p.image,width:p.width,height:p.height})}}catch(g){n.e(g)}finally{n.f()}}function Ul(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Io,Hs;function uh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Vh(e,i){if(!!e){if(typeof e=="string")return Gh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gh(e,i)}}function Gh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Hh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function lh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ch=Od(),Pd="sans-serif",Id="normal",Wf=24,Wh=3,Xh=.25,Xf=8,Da=1024,fh=1,Sl=1,mf=3,Yh=null;function Od(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function B(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function me(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var ze=(Io=(0,jr.b2)(),Io(Hs=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"fontAtlas",void 0),(0,I.Z)(this,"iconFontMap",void 0),(0,I.Z)(this,"iconFontGlyphs",{}),(0,I.Z)(this,"fontOptions",void 0),(0,I.Z)(this,"key",void 0),(0,I.Z)(this,"cache",new oe(mf))}return(0,Tt.Z)(e,[{key:"scale",get:function(){return Sl}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Pd,fontWeight:Id,characterSet:ch,fontSize:Wf,buffer:Wh,sdf:!0,cutoff:Xh,radius:Xf,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=lh(lh({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,m=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,w=s.radius,R=s.cutoff,D=s.iconfont,V=a&&a.data;V||(V=_a.document.createElement("canvas"),V.width=Da);var J=V.getContext("2d");B(J,p,g,m);var te=Tp(lh({getFontWidth:function(qs){return J.measureText(qs).width},fontHeight:g*Sl,buffer:x,characterSet:n,maxCanvasWidth:Da},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Se=te.mapping,He=te.canvasHeight,tt=te.xOffset,at=te.yOffset,Ot=J.getImageData(0,0,V.width,V.height);if(V.height=He,J.putImageData(Ot,0,0),B(J,p,g,m),C){var kt=new(Md())(g,x,w,R,p,m),nr=J.getImageData(0,0,kt.size,kt.size),mr=uh(n),Gr;try{for(mr.s();!(Gr=mr.n()).done;){var ln=Gr.value;if(D){var Tr=String.fromCharCode(parseInt(ln.replace("&#x","").replace(";",""),16)),An=kt.draw(Tr);me(An,nr)}else me(kt.draw(ln),nr);J.putImageData(nr,Se[ln].x,Se[ln].y)}}catch(wo){mr.e(wo)}finally{mr.f()}}else{var Rn=uh(n),di;try{for(Rn.s();!(di=Rn.n()).done;){var mo=di.value;J.fillText(mo,Se[mo].x,Se[mo].y+g*fh)}}catch(wo){Rn.e(wo)}finally{Rn.f()}}return{xOffset:tt,yOffset:at,mapping:Se,data:V,width:V.width,height:V.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,m,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,m=new Set(Object.keys(p)),g=new Set(n);return g.forEach(function(x){m.has(x)||s.push(x)}),s}}]),e}())||Hs),Dt,ur;function Lt(e){var i=tr();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function tr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dr=3,yr=1024,_r=64,Ir=(Dt=(0,jr.b2)(),Dt(ur=function(e){(0,sn.Z)(r,e);var i=Lt(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"canvasHeight",128),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"canvas",void 0),(0,I.Z)((0,de.Z)(n),"iconData",void 0),(0,I.Z)((0,de.Z)(n),"iconMap",void 0),(0,I.Z)((0,de.Z)(n),"ctx",void 0),(0,I.Z)((0,de.Z)(n),"loadingImageCount",0),n}return(0,Tt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=_a.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,m=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:_r}),this.updateIconMap(),this.loadImage(s).then(function(g){m=g;var x=p.iconData.find(function(C){return C.id===a});x&&(x.image=m,x.width=m.width,x.height=m.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var m=this,g=p.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:_r}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var w=m.iconData.find(function(R){return R.id===a});w&&(w.image=x,w.width=x.width,w.height=x.height),m.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var m=new Image;m.crossOrigin="anonymous",m.onload=function(){s(m)},m.onerror=function(){p(new Error("Could not load image at "+a))},m.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=yr,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],m=p.x,g=p.y,x=p.image,C=p.width,w=C===void 0?64:C,R=p.height,D=R===void 0?64:R,V=Math.max(w,D),J=V/_r,te=D/J,Se=w/J;x&&a.ctx.drawImage(x,m+(_r-Se)/2,g+(_r-te)/2,Se,te)})}},{key:"updateIconMap",value:function(){var a=sh(this.iconData,dr,yr),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,m){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){p(g)},g.onerror=function(){m(new Error("Could not load image at "+a))},g.src=a})}}]),r}(hu.EventEmitter))||ur),or=N(49685);function Fr(){var e=new or.WT(16);return or.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function br(e){var i=new or.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Pr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function st(e,i,r,n,a,s,p,m,g,x,C,w,R,D,V,J){var te=new or.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=p,te[7]=m,te[8]=g,te[9]=x,te[10]=C,te[11]=w,te[12]=R,te[13]=D,te[14]=V,te[15]=J,te}function Xt(e,i,r,n,a,s,p,m,g,x,C,w,R,D,V,J,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=m,e[7]=g,e[8]=x,e[9]=C,e[10]=w,e[11]=R,e[12]=D,e[13]=V,e[14]=J,e[15]=te,e}function Er(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ur(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],m=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=m}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function fr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],m=i[5],g=i[6],x=i[7],C=i[8],w=i[9],R=i[10],D=i[11],V=i[12],J=i[13],te=i[14],Se=i[15],He=r*m-n*p,tt=r*g-a*p,at=r*x-s*p,Ot=n*g-a*m,kt=n*x-s*m,nr=a*x-s*g,mr=C*J-w*V,Gr=C*te-R*V,ln=C*Se-D*V,Tr=w*te-R*J,An=w*Se-D*J,Rn=R*Se-D*te,di=He*Rn-tt*An+at*Tr+Ot*ln-kt*Gr+nr*mr;return di?(di=1/di,e[0]=(m*Rn-g*An+x*Tr)*di,e[1]=(a*An-n*Rn-s*Tr)*di,e[2]=(J*nr-te*kt+Se*Ot)*di,e[3]=(R*kt-w*nr-D*Ot)*di,e[4]=(g*ln-p*Rn-x*Gr)*di,e[5]=(r*Rn-a*ln+s*Gr)*di,e[6]=(te*at-V*nr-Se*tt)*di,e[7]=(C*nr-R*at+D*tt)*di,e[8]=(p*An-m*ln+x*mr)*di,e[9]=(n*ln-r*An-s*mr)*di,e[10]=(V*kt-J*at+Se*He)*di,e[11]=(w*at-C*kt-D*He)*di,e[12]=(m*Gr-p*Tr-g*mr)*di,e[13]=(r*Tr-n*Gr+a*mr)*di,e[14]=(J*tt-V*Ot-te*He)*di,e[15]=(C*Ot-w*tt+R*He)*di,e):null}function Lr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],m=i[5],g=i[6],x=i[7],C=i[8],w=i[9],R=i[10],D=i[11],V=i[12],J=i[13],te=i[14],Se=i[15];return e[0]=m*(R*Se-D*te)-w*(g*Se-x*te)+J*(g*D-x*R),e[1]=-(n*(R*Se-D*te)-w*(a*Se-s*te)+J*(a*D-s*R)),e[2]=n*(g*Se-x*te)-m*(a*Se-s*te)+J*(a*x-s*g),e[3]=-(n*(g*D-x*R)-m*(a*D-s*R)+w*(a*x-s*g)),e[4]=-(p*(R*Se-D*te)-C*(g*Se-x*te)+V*(g*D-x*R)),e[5]=r*(R*Se-D*te)-C*(a*Se-s*te)+V*(a*D-s*R),e[6]=-(r*(g*Se-x*te)-p*(a*Se-s*te)+V*(a*x-s*g)),e[7]=r*(g*D-x*R)-p*(a*D-s*R)+C*(a*x-s*g),e[8]=p*(w*Se-D*J)-C*(m*Se-x*J)+V*(m*D-x*w),e[9]=-(r*(w*Se-D*J)-C*(n*Se-s*J)+V*(n*D-s*w)),e[10]=r*(m*Se-x*J)-p*(n*Se-s*J)+V*(n*x-s*m),e[11]=-(r*(m*D-x*w)-p*(n*D-s*w)+C*(n*x-s*m)),e[12]=-(p*(w*te-R*J)-C*(m*te-g*J)+V*(m*R-g*w)),e[13]=r*(w*te-R*J)-C*(n*te-a*J)+V*(n*R-a*w),e[14]=-(r*(m*te-g*J)-p*(n*te-a*J)+V*(n*g-a*m)),e[15]=r*(m*R-g*w)-p*(n*R-a*w)+C*(n*g-a*m),e}function $r(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],m=e[6],g=e[7],x=e[8],C=e[9],w=e[10],R=e[11],D=e[12],V=e[13],J=e[14],te=e[15],Se=i*p-r*s,He=i*m-n*s,tt=i*g-a*s,at=r*m-n*p,Ot=r*g-a*p,kt=n*g-a*m,nr=x*V-C*D,mr=x*J-w*D,Gr=x*te-R*D,ln=C*J-w*V,Tr=C*te-R*V,An=w*te-R*J;return Se*An-He*Tr+tt*ln+at*Gr-Ot*mr+kt*nr}function Tn(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],m=i[4],g=i[5],x=i[6],C=i[7],w=i[8],R=i[9],D=i[10],V=i[11],J=i[12],te=i[13],Se=i[14],He=i[15],tt=r[0],at=r[1],Ot=r[2],kt=r[3];return e[0]=tt*n+at*m+Ot*w+kt*J,e[1]=tt*a+at*g+Ot*R+kt*te,e[2]=tt*s+at*x+Ot*D+kt*Se,e[3]=tt*p+at*C+Ot*V+kt*He,tt=r[4],at=r[5],Ot=r[6],kt=r[7],e[4]=tt*n+at*m+Ot*w+kt*J,e[5]=tt*a+at*g+Ot*R+kt*te,e[6]=tt*s+at*x+Ot*D+kt*Se,e[7]=tt*p+at*C+Ot*V+kt*He,tt=r[8],at=r[9],Ot=r[10],kt=r[11],e[8]=tt*n+at*m+Ot*w+kt*J,e[9]=tt*a+at*g+Ot*R+kt*te,e[10]=tt*s+at*x+Ot*D+kt*Se,e[11]=tt*p+at*C+Ot*V+kt*He,tt=r[12],at=r[13],Ot=r[14],kt=r[15],e[12]=tt*n+at*m+Ot*w+kt*J,e[13]=tt*a+at*g+Ot*R+kt*te,e[14]=tt*s+at*x+Ot*D+kt*Se,e[15]=tt*p+at*C+Ot*V+kt*He,e}function Qt(e,i,r){var n=r[0],a=r[1],s=r[2],p,m,g,x,C,w,R,D,V,J,te,Se;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],m=i[1],g=i[2],x=i[3],C=i[4],w=i[5],R=i[6],D=i[7],V=i[8],J=i[9],te=i[10],Se=i[11],e[0]=p,e[1]=m,e[2]=g,e[3]=x,e[4]=C,e[5]=w,e[6]=R,e[7]=D,e[8]=V,e[9]=J,e[10]=te,e[11]=Se,e[12]=p*n+C*a+V*s+i[12],e[13]=m*n+w*a+J*s+i[13],e[14]=g*n+R*a+te*s+i[14],e[15]=x*n+D*a+Se*s+i[15]),e}function rr(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function En(e,i,r,n){var a=n[0],s=n[1],p=n[2],m=Math.hypot(a,s,p),g,x,C,w,R,D,V,J,te,Se,He,tt,at,Ot,kt,nr,mr,Gr,ln,Tr,An,Rn,di,mo;return m<or.Ib?null:(m=1/m,a*=m,s*=m,p*=m,g=Math.sin(r),x=Math.cos(r),C=1-x,w=i[0],R=i[1],D=i[2],V=i[3],J=i[4],te=i[5],Se=i[6],He=i[7],tt=i[8],at=i[9],Ot=i[10],kt=i[11],nr=a*a*C+x,mr=s*a*C+p*g,Gr=p*a*C-s*g,ln=a*s*C-p*g,Tr=s*s*C+x,An=p*s*C+a*g,Rn=a*p*C+s*g,di=s*p*C-a*g,mo=p*p*C+x,e[0]=w*nr+J*mr+tt*Gr,e[1]=R*nr+te*mr+at*Gr,e[2]=D*nr+Se*mr+Ot*Gr,e[3]=V*nr+He*mr+kt*Gr,e[4]=w*ln+J*Tr+tt*An,e[5]=R*ln+te*Tr+at*An,e[6]=D*ln+Se*Tr+Ot*An,e[7]=V*ln+He*Tr+kt*An,e[8]=w*Rn+J*di+tt*mo,e[9]=R*Rn+te*di+at*mo,e[10]=D*Rn+Se*di+Ot*mo,e[11]=V*Rn+He*di+kt*mo,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Vr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],m=i[6],g=i[7],x=i[8],C=i[9],w=i[10],R=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=p*a+C*n,e[6]=m*a+w*n,e[7]=g*a+R*n,e[8]=x*a-s*n,e[9]=C*a-p*n,e[10]=w*a-m*n,e[11]=R*a-g*n,e}function Ar(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],m=i[2],g=i[3],x=i[8],C=i[9],w=i[10],R=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=p*a-C*n,e[2]=m*a-w*n,e[3]=g*a-R*n,e[8]=s*n+x*a,e[9]=p*n+C*a,e[10]=m*n+w*a,e[11]=g*n+R*a,e}function Wr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],m=i[2],g=i[3],x=i[4],C=i[5],w=i[6],R=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=p*a+C*n,e[2]=m*a+w*n,e[3]=g*a+R*n,e[4]=x*a-s*n,e[5]=C*a-p*n,e[6]=w*a-m*n,e[7]=R*a-g*n,e}function Kr(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function xi(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ni(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),m,g,x;return p<or.Ib?null:(p=1/p,n*=p,a*=p,s*=p,m=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*m,e[2]=s*n*x-a*m,e[3]=0,e[4]=n*a*x-s*m,e[5]=a*a*x+g,e[6]=s*a*x+n*m,e[7]=0,e[8]=n*s*x+a*m,e[9]=a*s*x-n*m,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Yr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function an(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $n(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pi(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],m=n+n,g=a+a,x=s+s,C=n*m,w=n*g,R=n*x,D=a*g,V=a*x,J=s*x,te=p*m,Se=p*g,He=p*x;return e[0]=1-(D+J),e[1]=w+He,e[2]=R-Se,e[3]=0,e[4]=w-He,e[5]=1-(C+J),e[6]=V+te,e[7]=0,e[8]=R+Se,e[9]=V-te,e[10]=1-(C+D),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Zi(e,i){var r=new or.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],m=i[4],g=i[5],x=i[6],C=i[7],w=n*n+a*a+s*s+p*p;return w>0?(r[0]=(m*p+C*n+g*s-x*a)*2/w,r[1]=(g*p+C*a+x*n-m*s)*2/w,r[2]=(x*p+C*s+m*a-g*n)*2/w):(r[0]=(m*p+C*n+g*s-x*a)*2,r[1]=(g*p+C*a+x*n-m*s)*2,r[2]=(x*p+C*s+m*a-g*n)*2),pi(e,i,r),e}function po(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function ho(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],m=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,m),e[2]=Math.hypot(g,x,C),e}function Ni(e,i){var r=new or.WT(3);ho(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,m=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,w=i[6]*s,R=i[8]*n,D=i[9]*a,V=i[10]*s,J=p+C+V,te=0;return J>0?(te=Math.sqrt(J+1)*2,e[3]=.25*te,e[0]=(w-D)/te,e[1]=(R-g)/te,e[2]=(m-x)/te):p>C&&p>V?(te=Math.sqrt(1+p-C-V)*2,e[3]=(w-D)/te,e[0]=.25*te,e[1]=(m+x)/te,e[2]=(R+g)/te):C>V?(te=Math.sqrt(1+C-p-V)*2,e[3]=(R-g)/te,e[0]=(m+x)/te,e[1]=.25*te,e[2]=(w+D)/te):(te=Math.sqrt(1+V-p-C)*2,e[3]=(m-x)/te,e[0]=(R+g)/te,e[1]=(w+D)/te,e[2]=.25*te),e}function os(e,i,r,n){var a=i[0],s=i[1],p=i[2],m=i[3],g=a+a,x=s+s,C=p+p,w=a*g,R=a*x,D=a*C,V=s*x,J=s*C,te=p*C,Se=m*g,He=m*x,tt=m*C,at=n[0],Ot=n[1],kt=n[2];return e[0]=(1-(V+te))*at,e[1]=(R+tt)*at,e[2]=(D-He)*at,e[3]=0,e[4]=(R-tt)*Ot,e[5]=(1-(w+te))*Ot,e[6]=(J+Se)*Ot,e[7]=0,e[8]=(D+He)*kt,e[9]=(J-Se)*kt,e[10]=(1-(w+V))*kt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function $a(e,i,r,n,a){var s=i[0],p=i[1],m=i[2],g=i[3],x=s+s,C=p+p,w=m+m,R=s*x,D=s*C,V=s*w,J=p*C,te=p*w,Se=m*w,He=g*x,tt=g*C,at=g*w,Ot=n[0],kt=n[1],nr=n[2],mr=a[0],Gr=a[1],ln=a[2],Tr=(1-(J+Se))*Ot,An=(D+at)*Ot,Rn=(V-tt)*Ot,di=(D-at)*kt,mo=(1-(R+Se))*kt,wo=(te+He)*kt,qs=(V+tt)*nr,Pu=(te-He)*nr,iu=(1-(R+J))*nr;return e[0]=Tr,e[1]=An,e[2]=Rn,e[3]=0,e[4]=di,e[5]=mo,e[6]=wo,e[7]=0,e[8]=qs,e[9]=Pu,e[10]=iu,e[11]=0,e[12]=r[0]+mr-(Tr*mr+di*Gr+qs*ln),e[13]=r[1]+Gr-(An*mr+mo*Gr+Pu*ln),e[14]=r[2]+ln-(Rn*mr+wo*Gr+iu*ln),e[15]=1,e}function ns(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,m=n+n,g=a+a,x=r*p,C=n*p,w=n*m,R=a*p,D=a*m,V=a*g,J=s*p,te=s*m,Se=s*g;return e[0]=1-w-V,e[1]=C+Se,e[2]=R-te,e[3]=0,e[4]=C-Se,e[5]=1-x-V,e[6]=D+J,e[7]=0,e[8]=R+te,e[9]=D-J,e[10]=1-x-w,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Oo(e,i,r,n,a,s,p){var m=1/(r-i),g=1/(a-n),x=1/(s-p);return e[0]=s*2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*m,e[9]=(a+n)*g,e[10]=(p+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*x,e[15]=0,e}function Yo(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var zo=Yo;function xs(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function xo(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),m=Math.tan(i.rightDegrees*Math.PI/180),g=2/(p+m),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((p-m)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function _i(e,i,r,n,a,s,p){var m=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*m,e[13]=(a+n)*g,e[14]=(p+s)*x,e[15]=1,e}var qo=_i;function ia(e,i,r,n,a,s,p){var m=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*m,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function ss(e,i,r,n){var a,s,p,m,g,x,C,w,R,D,V=i[0],J=i[1],te=i[2],Se=n[0],He=n[1],tt=n[2],at=r[0],Ot=r[1],kt=r[2];return Math.abs(V-at)<or.Ib&&Math.abs(J-Ot)<or.Ib&&Math.abs(te-kt)<or.Ib?Er(e):(C=V-at,w=J-Ot,R=te-kt,D=1/Math.hypot(C,w,R),C*=D,w*=D,R*=D,a=He*R-tt*w,s=tt*C-Se*R,p=Se*w-He*C,D=Math.hypot(a,s,p),D?(D=1/D,a*=D,s*=D,p*=D):(a=0,s=0,p=0),m=w*p-R*s,g=R*a-C*p,x=C*s-w*a,D=Math.hypot(m,g,x),D?(D=1/D,m*=D,g*=D,x*=D):(m=0,g=0,x=0),e[0]=a,e[1]=m,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=w,e[7]=0,e[8]=p,e[9]=x,e[10]=R,e[11]=0,e[12]=-(a*V+s*J+p*te),e[13]=-(m*V+g*J+x*te),e[14]=-(C*V+w*J+R*te),e[15]=1,e)}function ti(e,i,r,n){var a=i[0],s=i[1],p=i[2],m=n[0],g=n[1],x=n[2],C=a-r[0],w=s-r[1],R=p-r[2],D=C*C+w*w+R*R;D>0&&(D=1/Math.sqrt(D),C*=D,w*=D,R*=D);var V=g*R-x*w,J=x*C-m*R,te=m*w-g*C;return D=V*V+J*J+te*te,D>0&&(D=1/Math.sqrt(D),V*=D,J*=D,te*=D),e[0]=V,e[1]=J,e[2]=te,e[3]=0,e[4]=w*te-R*J,e[5]=R*V-C*te,e[6]=C*J-w*V,e[7]=0,e[8]=C,e[9]=w,e[10]=R,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function zi(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ma(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ro(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function al(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Te(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Zt(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function bt(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function pn(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],m=e[5],g=e[6],x=e[7],C=e[8],w=e[9],R=e[10],D=e[11],V=e[12],J=e[13],te=e[14],Se=e[15],He=i[0],tt=i[1],at=i[2],Ot=i[3],kt=i[4],nr=i[5],mr=i[6],Gr=i[7],ln=i[8],Tr=i[9],An=i[10],Rn=i[11],di=i[12],mo=i[13],wo=i[14],qs=i[15];return Math.abs(r-He)<=or.Ib*Math.max(1,Math.abs(r),Math.abs(He))&&Math.abs(n-tt)<=or.Ib*Math.max(1,Math.abs(n),Math.abs(tt))&&Math.abs(a-at)<=or.Ib*Math.max(1,Math.abs(a),Math.abs(at))&&Math.abs(s-Ot)<=or.Ib*Math.max(1,Math.abs(s),Math.abs(Ot))&&Math.abs(p-kt)<=or.Ib*Math.max(1,Math.abs(p),Math.abs(kt))&&Math.abs(m-nr)<=or.Ib*Math.max(1,Math.abs(m),Math.abs(nr))&&Math.abs(g-mr)<=or.Ib*Math.max(1,Math.abs(g),Math.abs(mr))&&Math.abs(x-Gr)<=or.Ib*Math.max(1,Math.abs(x),Math.abs(Gr))&&Math.abs(C-ln)<=or.Ib*Math.max(1,Math.abs(C),Math.abs(ln))&&Math.abs(w-Tr)<=or.Ib*Math.max(1,Math.abs(w),Math.abs(Tr))&&Math.abs(R-An)<=or.Ib*Math.max(1,Math.abs(R),Math.abs(An))&&Math.abs(D-Rn)<=or.Ib*Math.max(1,Math.abs(D),Math.abs(Rn))&&Math.abs(V-di)<=or.Ib*Math.max(1,Math.abs(V),Math.abs(di))&&Math.abs(J-mo)<=or.Ib*Math.max(1,Math.abs(J),Math.abs(mo))&&Math.abs(te-wo)<=or.Ib*Math.max(1,Math.abs(te),Math.abs(wo))&&Math.abs(Se-qs)<=or.Ib*Math.max(1,Math.abs(Se),Math.abs(qs))}var ji=Tn,Ee=al,ne,Ve,pt=(ne=(0,jr.b2)(),ne(Ve=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"overridedViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredProjectionMatrix",void 0),(0,I.Z)(this,"viewMatrixInverse",void 0),(0,I.Z)(this,"cameraPosition",void 0)}return(0,Tt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Fr(),fr(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,$.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=Kr(Fr(),[r,n,0]);this.jitteredProjectionMatrix=Tn(Fr(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Tn(Fr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Ve),It,qe;function Be(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=nt(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function nt(e,i){if(!!e){if(typeof e=="string")return _e(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _e(e,i)}}function _e(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ze=(It=(0,jr.b2)(),It(qe=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"controlCorners",void 0),(0,I.Z)(this,"controlContainer",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"controls",[]),(0,I.Z)(this,"unAddControls",[])}return(0,Tt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Ut.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Ut.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Be(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=ha("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=p.map(function(g){return n+g}).join(" ");r[p.join("")]=ha("div",m,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&yo(this.controlCorners[r]);this.controlContainer&&yo(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||qe),Ce,ft,Et=(Ce=(0,jr.b2)(),Ce(ft=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"markers",[]),(0,I.Z)(this,"markerLayers",[]),(0,I.Z)(this,"unAddMarkers",[]),(0,I.Z)(this,"unAddMarkerLayers",[])}return(0,Tt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ut.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||ft),hr,zr,Zr=(hr=(0,jr.b2)(),hr(zr=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"popup",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"unAddPopup",void 0)}return(0,Tt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ut.IMapService)}}]),e}())||zr),tn=N(82492),Br=N.n(tn),Cn={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},fn=Cn,xn,yn;function mn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ca={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},us={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ha=(xn=(0,jr.b2)(),xn(yn=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"sceneConfigCache",{}),(0,I.Z)(this,"layerConfigCache",{})}return(0,Tt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return fn[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=Wn(Wn({},Ca),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=Wn({},Br()({},this.sceneConfigCache[r],us,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||yn);function Sn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function oi(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,m){return m(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function ws(){var e=new or.WT(4);return or.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Cl(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Cu(e,i,r,n){var a=new or.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function qh(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Nu(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function jc(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Mp(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function v0(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function ls(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Kh(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function gf(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Rd(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Ld(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function xv(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Pp(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function yf(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function m0(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function g0(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function vm(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function Ts(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function Yf(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function y0(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function t(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function o(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function u(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],m=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],w=i[1],R=i[2],D=i[3];return e[0]=w*x-R*g+D*m,e[1]=-(C*x)+R*p-D*s,e[2]=C*g-w*p+D*a,e[3]=-(C*m)+w*s-R*a,e}function h(e,i,r,n){var a=i[0],s=i[1],p=i[2],m=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=m+n*(r[3]-m),e}function y(e,i){i=i||1;var r,n,a,s,p,m;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,m=a*a+s*s;while(m>=1);var g=Math.sqrt((1-p)/m);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function b(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function S(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],m=r[1],g=r[2],x=r[3],C=x*n+m*s-g*a,w=x*a+g*n-p*s,R=x*s+p*a-m*n,D=-p*n-m*a-g*s;return e[0]=C*x+D*-p+w*-g-R*-m,e[1]=w*x+D*-m+R*-p-C*-g,e[2]=R*x+D*-g+C*-m-w*-p,e[3]=i[3],e}function P(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function k(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function z(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Z(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],m=i[1],g=i[2],x=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var W=null,ee=null,ie=null,Me=null,Re=null,Ye=null,Ue=null,ut=function(){var e=ws();return function(i,r,n,a,s,p){var m,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,m=n;m<g;m+=r)e[0]=i[m],e[1]=i[m+1],e[2]=i[m+2],e[3]=i[m+3],s(e,e,p),i[m]=e[0],i[m+1]=e[1],i[m+2]=e[2],i[m+3]=e[3];return i}}(),_t=Math.PI/180,Gt=512,Yt=4003e4;function lr(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,m=p===void 0?!1:p,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},w=Gt*s,R=Math.cos(r*_t),D=w/360,V=D/R,J=w/Yt/R;if(C.pixelsPerMeter=[J,-J,J],C.metersPerPixel=[1/J,-1/J,1/J],C.pixelsPerDegree=[D,-V,J],C.degreesPerPixel=[1/D,-1/V,1/J],m){var te=_t*Math.tan(r*_t)/R,Se=D*te/2,He=w/Yt*te,tt=He/V*J;C.pixelsPerDegree2=[0,-Se,He],C.pixelsPerMeter2=[tt,0,tt],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var wr;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(wr||(wr={}));var Nr={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},kn,hn,zn,dn,Mi,ri=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Pn=(kn=(0,jr.b2)(),hn=(0,jr.f3)(Ut.ICameraService),kn(zn=(dn=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"needRefresh",!0),Sn(this,"cameraService",Mi,this),(0,I.Z)(this,"coordinateSystem",void 0),(0,I.Z)(this,"viewportCenter",void 0),(0,I.Z)(this,"viewportCenterProjection",void 0),(0,I.Z)(this,"pixelsPerDegree",void 0),(0,I.Z)(this,"pixelsPerDegree2",void 0),(0,I.Z)(this,"pixelsPerMeter",void 0)}return(0,Tt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=lr({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,m=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=m,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===wr.LNGLAT||this.coordinateSystem===wr.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===wr.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===wr.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=lr({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),m=p.pixelsPerMeter,g=p.pixelsPerDegree,x=p.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),w=this.cameraService.getProjectionMatrix(),R=Tn([],w,C),D=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=b([],[D[0],D[1],0,1],R),C=this.cameraService.getViewMatrixUncentered()||C,R=Tn([],w,C),R=Tn([],R,ri),this.cameraService.setViewProjectionMatrix(R),this.pixelsPerMeter=m,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),Mi=oi(dn.prototype,"cameraService",[hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dn))||zn),Vi=N(20396),vi=N.n(Vi),hi;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(hi||(hi={}));var Zn,ca,ao,bo,Eo;function vo(e){var i=Lo();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cs={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},fs=(Zn=(0,jr.b2)(),ca=(0,jr.f3)(Ut.IMapService),Zn(ao=(bo=function(e){(0,sn.Z)(r,e);var i=vo(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"indragging",!1),Sn((0,de.Z)(n),"mapService",Eo,(0,de.Z)(n)),(0,I.Z)((0,de.Z)(n),"hammertime",void 0),(0,I.Z)((0,de.Z)(n),"lastClickTime",0),(0,I.Z)((0,de.Z)(n),"lastClickXY",[-1,-1]),(0,I.Z)((0,de.Z)(n),"clickTimer",void 0),(0,I.Z)((0,de.Z)(n),"$containter",void 0),(0,I.Z)((0,de.Z)(n),"onDrag",function(m){var g=n.interactionEvent(m);g.type=cs[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(hi.Drag,g)}),(0,I.Z)((0,de.Z)(n),"onHammer",function(m){m.srcEvent.stopPropagation();var g=n.interactionEvent(m);n.emit(hi.Hover,g)}),(0,I.Z)((0,de.Z)(n),"onTouch",function(m){var g=m.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,I.Z)((0,de.Z)(n),"onHover",function(m){var g=m.clientX,x=m.clientY,C=g,w=x,R=m.type,D=n.mapService.getMapContainer();if(D)if(Po)C=C-D.left-0,w=w-D.top-0;else{var V=D.getBoundingClientRect(),J=V.top,te=V.left;C=C-te-D.clientLeft,w=w-J-D.clientTop}var Se=n.mapService.containerToLngLat([C,w]);if(R==="click"){if(!Po&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,w,Se);return}if(R==="touch"){n.isDoubleTap(C,w,Se);return}R!=="click"&&R!=="dblclick"&&n.emit(hi.Hover,{x:C,y:w,lngLat:Se,type:R,target:m})}),n}return(0,Tt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(hi.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(hi.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(hi.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(hi.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Po)_a.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(vi()).Manager(a);s.add(new(vi()).Tap({event:"dblclick",taps:2})),s.add(new(vi()).Tap({event:"click"})),s.add(new(vi()).Pan({threshold:0,pointers:0})),s.add(new(vi()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Po)_a.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,m,g;p==="touch"?(g=Math.floor(a.pointers[0].clientY),m=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),m=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),w=C.top,R=C.left;m-=R,g-=w}var D=this.mapService.containerToLngLat([m,g]);return{x:m,y:g,lngLat:D,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var m=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(hi.Hover,{x:a,y:s,lngLat:p,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",m.emit(hi.Hover,{x:a,y:s,lngLat:p,type:x})},400))}}]),r}(Bh()),Eo=oi(bo.prototype,"mapService",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bo))||ao),za=N(92137),bs=N(87757),Pi=N.n(bs),Uo=0;function Es(e){if(Po)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Uo++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Ki(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var G;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(G||(G={}));var Ra,aa,Ws,Ms,Qa,Zo,Ps,$i,Zl,Au,jl,ko,Vl;function ol(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ol(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ol(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var qf=(Ra=(0,jr.b2)(),aa=(0,jr.f3)(Ut.IMapService),Ws=(0,jr.f3)(Ut.IRendererService),Ms=(0,jr.f3)(Ut.IGlobalConfigService),Qa=(0,jr.f3)(Ut.IInteractionService),Zo=(0,jr.f3)(Ut.ILayerService),Ra(Ps=($i=function(){function e(){var i=this;(0,ot.Z)(this,e),Sn(this,"mapService",Zl,this),Sn(this,"rendererService",Au,this),Sn(this,"configService",jl,this),Sn(this,"interactionService",ko,this),Sn(this,"layerService",Vl,this),(0,I.Z)(this,"pickingFBO",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0),(0,I.Z)(this,"alreadyInPicking",!1),(0,I.Z)(this,"pickBufferScale",1),(0,I.Z)(this,"lastPickTime",new Date().getTime()),(0,I.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,m=n.lngLat,g=n.type,x=n.target,C=!1,w=i.rendererService,R=w.getViewportSize,D=w.readPixels,V=w.getContainer,J=i.getContainerSize(V()),te=J.width,Se=J.height;te*=Sa,Se*=Sa;var He=r.getLayerConfig(),tt=He.enableHighlight,at=He.enableSelect,Ot=s*Sa,kt=p*Sa;if(Ot>te-1*Sa||Ot<0||kt>Se-1*Sa||kt<0)return!1;var nr;if(nr=D({x:Math.floor(Ot/i.pickBufferScale),y:Math.floor((Se-(p+1)*Sa)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),nr[0]!==0||nr[1]!==0||nr[2]!==0){var mr=Ae(nr),Gr=r.getSource().getFeatureById(mr);mr!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var ln={x:s,y:p,type:g,lngLat:m,featureId:mr,feature:Gr,target:x};Gr&&(C=!0,r.setCurrentPickId(mr),i.triggerHoverOnLayer(r,ln))}else{var Tr={x:s,y:p,lngLat:m,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,Vc(Vc({},Tr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Tr),r.setCurrentPickId(null)}if(tt&&i.highlightPickedFeature(r,nr),at&&g==="click"&&((a=nr)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var An=Ae(nr);r.getCurrentSelectedId()===null||An!==r.getCurrentSelectedId()?(i.selectFeature(r,nr),r.setCurrentSelectedId(An)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Tt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,m=n.getContainer,g=this.getContainerSize(m()),x=g.width,C=g.height;x*=Sa,C*=Sa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.interactionService.on(hi.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,za.Z)(Pi().mark(function n(a,s,p){var m=this,g,x,C,w;return Pi().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,w=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:m.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var V=m.pickBox(a,s);p(V)});case 3:case"end":return D.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(Tr){var An=Tr<0?0:Tr;return Math.floor(An*Sa/a.pickBufferScale)}),p=(0,$.Z)(s,4),m=p[0],g=p[1],x=p[2],C=p[3],w=this.rendererService,R=w.getViewportSize,D=w.readPixels,V=w.getContainer,J=this.getContainerSize(V()),te=J.width,Se=J.height;if(te*=Sa,Se*=Sa,m>(te-1)*Sa/this.pickBufferScale||x<0||g>(Se-1)*Sa/this.pickBufferScale||C<0)return[];var He,tt=Math.min(te/this.pickBufferScale,x)-m,at=Math.min(Se/this.pickBufferScale,C)-g;He=D({x:m,y:Math.floor(Se/this.pickBufferScale-(C+1)),width:tt,height:at,data:new Uint8Array(tt*at*4),framebuffer:this.pickingFBO});for(var Ot=[],kt={},nr=0;nr<He.length/4;nr=nr+1){var mr=He.slice(nr*4,nr*4+4),Gr=Ae(mr);if(Gr!==-1&&!kt[Gr]){var ln=r.getSource().getFeatureById(Gr);Ot.push(Vc(Vc({},ln),{},{pickedFeatureIdx:Gr})),kt[Gr]=!0}}return Ot}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,p=s===void 0?"":s,m=a.cursorEnabled;if(m){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",p))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Sa,height:r.height/Sa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,za.Z)(Pi().mark(function n(a){var s;return Pi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){m.next=2;break}return m.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){m.next=7;break}return m.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return m.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=Sa,s*=Sa,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,za.Z)(Pi().mark(function n(a){var s=this,p,m,g,x,C;return Pi().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:p=this.rendererService,m=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=p.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var D=s.layerService.getRenderList();D.filter(function(V){return V.needPick(a.type)}).reverse().some(function(V){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),V.hooks.beforePickingEncode.call(),V.renderModels(!0),V.hooks.afterPickingEncode.call();var J=s.pickFromPickingFBO(V,a);return J&&!V.getLayerConfig().enablePropagation})});case 3:case"end":return R.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Ki(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,$.Z)(n,3),s=a[0],p=a[1],m=a[2];r.hooks.beforeHighlight.call([s,p,m])}},{key:"selectFeature",value:function(r,n){var a=(0,$.Z)(n,3),s=a[0],p=a[1],m=a[2];r.hooks.beforeSelect.call([s,p,m])}}]),e}(),Zl=oi($i.prototype,"mapService",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au=oi($i.prototype,"rendererService",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jl=oi($i.prototype,"configService",[Ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko=oi($i.prototype,"interactionService",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=oi($i.prototype,"layerService",[Zo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$i))||Ps),Ip=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ot.Z)(this,e),(0,I.Z)(this,"autoStart",void 0),(0,I.Z)(this,"startTime",0),(0,I.Z)(this,"oldTime",0),(0,I.Z)(this,"running",!1),(0,I.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Tt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),mc,Kf,ph,$f,Op,_f,hh,gc,Rp;function Lp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function xf(e,i){if(!!e){if(typeof e=="string")return Qf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qf(e,i)}}function Qf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var $h=(mc=(0,jr.b2)(),Kf=(0,jr.f3)(Ut.IRendererService),ph=(0,jr.f3)(Ut.IMapService),$f=(0,jr.f3)(Ut.IGlobalConfigService),mc(Op=(_f=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"clock",new Ip),(0,I.Z)(this,"alreadyInRendering",!1),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"layerList",[]),(0,I.Z)(this,"layerRenderID",void 0),(0,I.Z)(this,"sceneInited",!1),(0,I.Z)(this,"animateInstanceCount",0),(0,I.Z)(this,"shaderPicking",!0),(0,I.Z)(this,"enableRender",!0),Sn(this,"renderService",hh,this),Sn(this,"mapService",gc,this),Sn(this,"configService",Rp,this)}return(0,Tt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,za.Z)(Pi().mark(function n(){var a,s,p;return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=Lp(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=20;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.getLayerConfig().enableMultiPassRenderer){g.next=16;break}return g.next=14,p.renderMultiPass();case 14:g.next=17;break;case 16:p.render();case 17:p.hooks.afterRender.call();case 18:g.next=7;break;case 20:g.next=25;break;case 22:g.prev=22,g.t0=g.catch(5),a.e(g.t0);case 25:return g.prev=25,a.f(),g.finish(25);case 28:this.alreadyInRendering=!1;case 29:case"end":return g.stop()}},n,this,[[5,22,25,28]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).forEach(function(a){r.layerList.push(a)})}),this.layerList.sort(function(n,a){return n.zIndex-a.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=_a.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=ke(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){_a.cancelAnimationFrame(this.layerRenderID)}}]),e}(),hh=oi(_f.prototype,"renderService",[Kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gc=oi(_f.prototype,"mapService",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp=oi(_f.prototype,"configService",[$f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_f))||Op),bf=N(81253),dh=N(14293),sl=N.n(dh),Qh=function(){function e(i){var r=this;(0,ot.Z)(this,e),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"scale",void 0),(0,I.Z)(this,"descriptor",void 0),(0,I.Z)(this,"featureBufferLayout",[]),(0,I.Z)(this,"needRescale",!1),(0,I.Z)(this,"needRemapping",!1),(0,I.Z)(this,"needRegenerateVertices",!1),(0,I.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,I.Z)(this,"vertexAttribute",void 0),(0,I.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var m,g=(m=r.scale)===null||m===void 0?void 0:m.scalers[p].func,x=g(s);return x})}),this.setProps(i)}return(0,Tt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,ar.Z)(r));if(!sl()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),vh=["buffer","update","name"],Gc,kp,mh,Jf,Dp,ep;function Fp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fp(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jh(e){return new Promise(function(i){return setTimeout(i,e)})}var Bp=(Gc={},(0,I.Z)(Gc,G.FLOAT,4),(0,I.Z)(Gc,G.UNSIGNED_BYTE,1),(0,I.Z)(Gc,G.UNSIGNED_SHORT,2),Gc),kd=(kp=(0,jr.b2)(),mh=(0,jr.f3)(Ut.IRendererService),kp(Jf=(Dp=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"attributesAndIndices",void 0),Sn(this,"rendererService",ep,this),(0,I.Z)(this,"attributes",[]),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Tt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Qh(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(Hc(Hc({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(at){return at.name===r});if(p&&p.descriptor){var m=p.descriptor,g=m.update,x=m.buffer,C=m.size,w=C===void 0?0:C,R=Bp[x.type||G.FLOAT];if(g){var D=this.featureLayout,V=D.elements,J=D.sizePerElement,te=V.slice(a,s);if(!te.length)return;var Se=te[0].offset,He=Se*w*R,tt=te.map(function(at,Ot){for(var kt=at.featureIdx,nr=at.vertices,mr=at.normals,Gr=nr.length/J,ln=[],Tr=0;Tr<Gr;Tr++){var An=mr?mr.slice(Tr*3,Tr*3+3):[];ln.push.apply(ln,(0,ar.Z)(g(n[kt],kt,nr.slice(Tr*J,Tr*J+J),Ot,An)))}return ln}).reduce(function(at,Ot){return at.push.apply(at,(0,ar.Z)(Ot)),at},[]);p.vertexAttribute.updateBuffer({data:tt,offset:He})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(He){return He.resetDescriptor(),He.descriptor}),m=0,g=[],x=[],C=[],w=3;r.forEach(function(He,tt){var at=s.triangulation(He,a),Ot=at.indices,kt=at.vertices,nr=at.normals,mr=at.size;Ot.forEach(function(An){x.push(An+m)}),w=mr;var Gr=kt.length/mr;s.featureLayout.sizePerElement=w,s.featureLayout.elements.push({featureIdx:tt,vertices:kt,normals:nr,offset:m}),m+=Gr;for(var ln=function(Rn){var di=(nr==null?void 0:nr.slice(Rn*3,Rn*3+3))||[],mo=kt.slice(Rn*mr,Rn*mr+mr);p.forEach(function(wo,qs){if(wo&&wo.update){var Pu;(Pu=wo.buffer.data).push.apply(Pu,(0,ar.Z)(wo.update(He,tt,mo,Rn,di)))}})},Tr=0;Tr<Gr;Tr++)ln(Tr)});var R=this.rendererService,D=R.createAttribute,V=R.createBuffer,J=R.createElements,te={};p.forEach(function(He,tt){if(He){var at=He.buffer,Ot=He.update,kt=He.name,nr=(0,bf.Z)(He,vh),mr=D(Hc({buffer:V(at)},nr));te[He.name||""]=mr,s.attributes[tt].vertexAttribute=mr}});var Se=J({data:x,type:G.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:te,elements:Se},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),ep=oi(Dp.prototype,"rendererService",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp))||Jf),Dd=N(67709),Fd=N.n(Dd),Bd,ed,bv,Np,Do,Al,Ev,Wc,td,Nd,gh,Gl,yh,zp,_h,xh,rd,Xs,Up,zd,Ud,Zd,jd,Vd,wu,bh,Gd,Hl,Sv,Hd,Ef,tp,rp;function Zp(e){var i=jp();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function jp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cv=(Bd=(0,jr.b2)(),ed=(0,jr.f3)(Ut.SceneID),bv=(0,jr.f3)(Ut.IIconService),Np=(0,jr.f3)(Ut.IFontService),Do=(0,jr.f3)(Ut.IControlService),Al=(0,jr.f3)(Ut.IGlobalConfigService),Ev=(0,jr.f3)(Ut.IMapService),Wc=(0,jr.f3)(Ut.ICoordinateSystemService),td=(0,jr.f3)(Ut.IRendererService),Nd=(0,jr.f3)(Ut.ILayerService),gh=(0,jr.f3)(Ut.ICameraService),Gl=(0,jr.f3)(Ut.IInteractionService),yh=(0,jr.f3)(Ut.IPickingService),zp=(0,jr.f3)(Ut.IShaderModuleService),_h=(0,jr.f3)(Ut.IMarkerService),xh=(0,jr.f3)(Ut.IPopupService),Bd(rd=(Xs=function(e){(0,sn.Z)(r,e);var i=Zp(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,de.Z)(n),"destroyed",!1),(0,I.Z)((0,de.Z)(n),"loaded",!1),(0,I.Z)((0,de.Z)(n),"loadFont",!1),(0,I.Z)((0,de.Z)(n),"fontFamily",""),Sn((0,de.Z)(n),"id",Up,(0,de.Z)(n)),Sn((0,de.Z)(n),"iconService",zd,(0,de.Z)(n)),Sn((0,de.Z)(n),"fontService",Ud,(0,de.Z)(n)),Sn((0,de.Z)(n),"controlService",Zd,(0,de.Z)(n)),Sn((0,de.Z)(n),"configService",jd,(0,de.Z)(n)),Sn((0,de.Z)(n),"map",Vd,(0,de.Z)(n)),Sn((0,de.Z)(n),"coordinateSystemService",wu,(0,de.Z)(n)),Sn((0,de.Z)(n),"rendererService",bh,(0,de.Z)(n)),Sn((0,de.Z)(n),"layerService",Gd,(0,de.Z)(n)),Sn((0,de.Z)(n),"cameraService",Hl,(0,de.Z)(n)),Sn((0,de.Z)(n),"interactionService",Sv,(0,de.Z)(n)),Sn((0,de.Z)(n),"pickingService",Hd,(0,de.Z)(n)),Sn((0,de.Z)(n),"shaderModuleService",Ef,(0,de.Z)(n)),Sn((0,de.Z)(n),"markerService",tp,(0,de.Z)(n)),Sn((0,de.Z)(n),"popupService",rp,(0,de.Z)(n)),(0,I.Z)((0,de.Z)(n),"inited",!1),(0,I.Z)((0,de.Z)(n),"initPromise",void 0),(0,I.Z)((0,de.Z)(n),"rendering",!1),(0,I.Z)((0,de.Z)(n),"$container",void 0),(0,I.Z)((0,de.Z)(n),"canvas",void 0),(0,I.Z)((0,de.Z)(n),"markerContainer",void 0),(0,I.Z)((0,de.Z)(n),"hooks",void 0),(0,I.Z)((0,de.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),gs(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,I.Z)((0,de.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Nf},n}return(0,Tt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,za.Z)(Pi().mark(function p(){return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(hi.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,za.Z)(Pi().mark(function p(){var m,g;return Pi().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(m=Es(s.configService.getSceneConfig(s.id).id||""),s.$container=m,!m){C.next=11;break}return s.canvas=ha("canvas","",m),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Fd()(s.$container,s.handleWindowResized),_a.matchMedia&&((g=_a.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,za.Z)(Pi().mark(function p(){return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(hi.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,za.Z)(Pi().mark(function p(){var m;return Pi().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(m=a.canvas,s.$container=m||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"render",value:function(){var n=(0,za.Z)(Pi().mark(function s(){return Pi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.rendering||this.destroyed)){m.next=2;break}return m.abrupt("return");case 2:if(this.rendering=!0,this.inited){m.next=23;break}return m.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){m.next=18;break}return m.prev=8,m.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:m.next=18;break;case 13:m.prev=13,m.t0=m.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(m.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return m.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var m=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return m}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=ha("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Dd.unbind)(this.$container,this.handleWindowResized),_a.matchMedia){var m;(m=_a.matchMedia("screen and (min-resolution: 2dppx)"))===null||m===void 0||m.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=Sa,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=m*p,x.height=g*p),this.rendererService.viewport({x:0,y:0,width:p*m,height:p*g})}},{key:"setCanvas",value:function(){var a,s,p=Sa,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=m*p,x.height=g*p,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(hu.EventEmitter),Up=oi(Xs.prototype,"id",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd=oi(Xs.prototype,"iconService",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud=oi(Xs.prototype,"fontService",[Np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd=oi(Xs.prototype,"controlService",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=oi(Xs.prototype,"configService",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=oi(Xs.prototype,"map",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wu=oi(Xs.prototype,"coordinateSystemService",[Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bh=oi(Xs.prototype,"rendererService",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=oi(Xs.prototype,"layerService",[Nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hl=oi(Xs.prototype,"cameraService",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=oi(Xs.prototype,"interactionService",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=oi(Xs.prototype,"pickingService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ef=oi(Xs.prototype,"shaderModuleService",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tp=oi(Xs.prototype,"markerService",[_h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp=oi(Xs.prototype,"popupService",[xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs))||rd),Av=N(44908),Wd=N.n(Av);function wv(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Xd=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function nd(e){var i={};return e=e.replace(Xd,function(r,n,a){var s=a.split(":"),p=s[0].trim(),m="";switch(s.length>1&&(m=s[1].trim()),n){case"bool":m=m==="true";break;case"float":case"int":m=Number(m);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":m?m=m.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):m=new Array(wv(n)).fill(0);break;default:}return i[p]=m,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var yc,Yd;function id(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function np(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?id(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):id(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var qd="#define PI 3.14159265359",Kd=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Tv=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Mv=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,$d=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,Pv=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Eh=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Iv=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,ad=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,_0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Ov=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,x0=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,b0=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,E0=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,S0=/precision\s+(high|low|medium)p\s+float/,C0=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,A0=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,w0=(yc=(0,jr.b2)(),yc(Yd=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"moduleCache",{}),(0,I.Z)(this,"rawContentCache",{})}return(0,Tt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:qd,fs:qd}),this.registerModule("decode",{vs:Kd,fs:""}),this.registerModule("projection",{vs:Iv,fs:""}),this.registerModule("project",{vs:Eh,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:ad}),this.registerModule("lighting",{vs:Mv,fs:""}),this.registerModule("light",{vs:Tv,fs:""}),this.registerModule("picking",{vs:Pv,fs:$d}),this.registerModule("styleMapping",{vs:_0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:E0,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Ov,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:x0,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:b0,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,m=nd(a),g=m.content,x=m.uniforms,C=nd(s),w=C.content,R=C.uniforms;this.rawContentCache[r]={fs:w,uniforms:np(np(np({},x),R),p),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),m=p.content,g=p.includeList,x=this.processModule(s,[],"fs"),C=x.content,w=x.includeList,R=C,D=Wd()(g.concat(w).concat(r)).reduce(function(V,J){return np(np({},V),n.rawContentCache[J].uniforms)},{});return S0.test(C)||(R=C0+C),this.moduleCache[r]={fs:R.trim(),uniforms:D,vs:m.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(A0,function(m,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var w=s.rawContentCache[C][a];n.push(C);var R=s.processModule(w,n,a),D=R.content;return D});return{content:p,includeList:n}}}]),e}())||Yd),od=N(66213),ru;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(ru||(ru={}));var Sh,Qd,Sf=(Sh=(0,jr.b2)(),Sh(Qd=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"config",void 0)}return(0,Tt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return ru.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ut.IRendererService),this.cameraService=r.getContainer().get(Ut.ICameraService),this.mapService=r.getContainer().get(Ut.IMapService),this.interactionService=r.getContainer().get(Ut.IInteractionService),this.layerService=r.getContainer().get(Ut.ILayerService),this.shaderModuleService=r.getContainer().get(Ut.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Qd),Jd,mm;function Qx(e){var i=Jx();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eb=(Jd=(0,jr.b2)(),Jd(mm=function(e){(0,sn.Z)(r,e);var i=Qx(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,od.Z)((0,Nt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Sf))||mm),gm,ym,_m,T0,xm;function tb(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rb(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function rb(e,i){if(!!e){if(typeof e=="string")return bm(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bm(e,i)}}function bm(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var nb=(gm=(0,jr.b2)(),ym=(0,jr.f3)(Ut.IPostProcessor),gm(_m=(T0=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"passes",[]),Sn(this,"postProcessor",xm,this),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"renderFlag",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0)}return(0,Tt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,za.Z)(Pi().mark(function n(){var a,s,p;return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=tb(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return p=s.value,g.next=7,p.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===ru.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),xm=oi(T0.prototype,"postProcessor",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T0))||_m),Em,Sm;function Cm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Am(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ib(e){var i=ab();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ob=(Em=(0,jr.b2)(),Em(Sm=function(e){(0,sn.Z)(r,e);var i=ib(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"pickingFBO",void 0),(0,I.Z)((0,de.Z)(n),"layer",void 0),(0,I.Z)((0,de.Z)(n),"width",0),(0,I.Z)((0,de.Z)(n),"height",0),(0,I.Z)((0,de.Z)(n),"alreadyInRendering",!1),(0,I.Z)((0,de.Z)(n),"pickFromPickingFBO",function(m){var g=m.x,x=m.y,C=m.lngLat,w=m.type;if(!(!n.layer.isVisible()||!n.layer.needPick(w))){var R=n.rendererService,D=R.getViewportSize,V=R.readPixels,J=R.useFramebuffer,te=D(),Se=te.width,He=te.height,tt=n.layer.getLayerConfig(),at=tt.enableHighlight,Ot=tt.enableSelect,kt=g*Sa,nr=x*Sa;if(!(kt>Se||kt<0||nr>He||nr<0)){var mr;J(n.pickingFBO,function(){var Gr;if(mr=V({x:Math.round(kt),y:Math.round(He-(x+1)*Sa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),mr[0]!==0||mr[1]!==0||mr[2]!==0){var ln=Ae(mr),Tr=n.layer.getSource().getFeatureById(ln),An={x:g,y:x,type:w,lngLat:C,featureId:ln,feature:Tr};Tr&&(n.layer.setCurrentPickId(ln),n.triggerHoverOnLayer(An))}else{var Rn={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+w:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Am(Am({},Rn),{},{type:"unpick"})),n.triggerHoverOnLayer(Rn),n.layer.setCurrentPickId(null)}at&&n.highlightPickedFeature(mr),Ot&&w==="click"&&((Gr=mr)===null||Gr===void 0?void 0:Gr.toString())!==[0,0,0,0].toString()&&n.selectFeature(mr)})}}}),n}return(0,Tt.Z)(r,[{key:"getType",value:function(){return ru.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,od.Z)((0,Nt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,m=p.createTexture2D,g=p.createFramebuffer,x=p.getViewportSize,C=x(),w=C.width,R=C.height;this.pickingFBO=g({color:m({width:w,height:R,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.interactionService.on(hi.Hover,this.pickFromPickingFBO),this.interactionService.on(hi.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(hi.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,m=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=m(),w=C.width,R=C.height;this.alreadyInRendering=!0,(this.width!==w||this.height!==R)&&(this.pickingFBO.resize({width:w,height:R}),this.width=w,this.height=R),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var D=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(D),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,$.Z)(a,3),p=s[0],m=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([p,m,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,$.Z)(a,3),p=s[0],m=s[1],g=s[2];this.layer.hooks.beforeSelect.call([p,m,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=je(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=je(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(Sf))||Sm),sb=N(11700),ub=N.n(sb),lb=N(68929),cb=N.n(lb),wm,Tm,Mm,M0,Pm;function Im(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ev(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Im(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Im(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var fb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ip=(wm=(0,jr.b2)(),Tm=(0,jr.f3)(Ut.IShaderModuleService),wm(Mm=(M0=function(){function e(){(0,ot.Z)(this,e),Sn(this,"shaderModuleService",Pm,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"config",void 0),(0,I.Z)(this,"quad",fb),(0,I.Z)(this,"enabled",!0),(0,I.Z)(this,"renderToScreen",!1),(0,I.Z)(this,"model",void 0),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"optionsToUpdate",{})}return(0,Tt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return ru.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ut.IRendererService),this.shaderModuleService=r.getContainer().get(Ut.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,m=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,w=g.uniforms;this.model=m({vs:x,fs:C,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:ev(ev({u_Texture:null},w),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,m=p.useFramebuffer,g=p.getViewportSize,x=p.clear,C=g(),w=C.width,R=C.height;m(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var D=ev({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[w,R]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(D.u_BloomFinal=1,D.u_Texture2=n),a.model.draw({uniforms:D})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=ev(ev({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){sl()(r[a])||(n["u_".concat(ub()(cb()(a)))]=r[a])}),n}}]),e}(),Pm=oi(M0.prototype,"shaderModuleService",[Tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M0))||Mm),Om,Rm;function Lm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function km(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Lm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pb(e){var i=hb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,vb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mb=(Om=(0,jr.b2)(),Om(Rm=function(e){(0,sn.Z)(r,e);var i=pb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:vb,fs:db});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,m=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:km(km({},m),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return sl()(a.bloomRadius)||(s.u_radius=a.bloomRadius),sl()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),sl()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(ip))||Rm),Dm,Fm;function Bm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gb(e){var i=yb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _b=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,xb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bb=(Dm=(0,jr.b2)(),Dm(Fm=function(e){(0,sn.Z)(r,e);var i=gb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xb,fs:_b});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,m=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Nm(Nm({},m),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return sl()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(ip))||Fm),zm,Um;function Zm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Eb(e){var i=Sb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Ab=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wb=(zm=(0,jr.b2)(),zm(Um=function(e){(0,sn.Z)(r,e);var i=Eb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ab,fs:Cb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,m=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:jm(jm({},m),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return sl()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(ip))||Um),Vm,Gm;function Hm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tb(e){var i=Mb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Ib=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ob=(Vm=(0,jr.b2)(),Vm(Gm=function(e){(0,sn.Z)(r,e);var i=Tb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Ib,fs:Pb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,m=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Wm(Wm({},m),{},{u_ViewportSize:[x,C]})}}}]),r}(ip))||Gm),Xm,Ym;function Rb(e){var i=Lb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Lb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Db=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fb=(Xm=(0,jr.b2)(),Xm(Ym=function(e){(0,sn.Z)(r,e);var i=Rb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Db,fs:kb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(ip))||Ym),qm,Km;function $m(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$m(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$m(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Bb(e){var i=Nb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Nb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ub=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Zb=(qm=(0,jr.b2)(),qm(Km=function(e){(0,sn.Z)(r,e);var i=Bb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Ub,fs:zb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,m=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Qm(Qm({},m),{},{u_ViewportSize:[x,C]})}}}]),r}(ip))||Km),Jm,eg;function tg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jb(e){var i=Vb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Hb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Wb=(Jm=(0,jr.b2)(),Jm(eg=function(e){(0,sn.Z)(r,e);var i=jb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Hb,fs:Gb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,m=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:rg(rg({},m),{},{u_ViewportSize:[x,C]})}}}]),r}(ip))||eg),ng,ig;function Xb(e){var i=Yb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Kb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$b=(ng=(0,jr.b2)(),ng(ig=function(e){(0,sn.Z)(r,e);var i=Xb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Kb,fs:qb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(ip))||ig),ag,og;function Qb(e){var i=Jb();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,t2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,r2=(ag=(0,jr.b2)(),ag(og=function(e){(0,sn.Z)(r,e);var i=Qb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:e2,fs:t2}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(ip))||og),sg,ug,lg,cg,sd,fg,n2=(sg=(0,jr.b2)(),ug=(0,jr.f3)(Ut.IRendererService),lg=(0,jr.zY)(),sg(cg=(sd=function(){function e(){(0,ot.Z)(this,e),Sn(this,"rendererService",fg,this),(0,I.Z)(this,"passes",[]),(0,I.Z)(this,"readFBO",void 0),(0,I.Z)(this,"writeFBO",void 0)}return(0,Tt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,m=s.height;return a({x:0,y:0,width:p,height:m,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,za.Z)(Pi().mark(function p(){return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,za.Z)(Pi().mark(function n(a,s){var p,m;return Pi().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:p=x.sent,m=0;case 4:if(!(m<4)){x.next=11;break}return x.next=7,s.render(a,p);case 7:this.swap(),m++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,za.Z)(Pi().mark(function n(a){var s,p;return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,p);case 7:g.next=12;break;case 9:return g.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),fg=oi(sd.prototype,"rendererService",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oi(sd.prototype,"init",[lg],Object.getOwnPropertyDescriptor(sd.prototype,"init"),sd.prototype),sd))||cg),pg,hg;function i2(e){var i=a2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function a2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o2=(pg=(0,jr.b2)(),pg(hg=function(e){(0,sn.Z)(r,e);var i=i2(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getType",value:function(){return ru.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,od.Z)((0,Nt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,m=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();p(g,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Sf))||hg),dg,vg,mg,P0,gg;function yg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function s2(e){var i=u2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function u2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l2=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,xg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,c2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function bg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var f2=1,p2=(dg=(0,jr.b2)(),vg=(0,jr.f3)(Ut.IShaderModuleService),dg(mg=(P0=function(e){(0,sn.Z)(r,e);var i=s2(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),Sn((0,de.Z)(n),"shaderModuleService",gg,(0,de.Z)(n)),(0,I.Z)((0,de.Z)(n),"haltonSequence",[]),(0,I.Z)((0,de.Z)(n),"accumulatingId",0),(0,I.Z)((0,de.Z)(n),"frame",0),(0,I.Z)((0,de.Z)(n),"timer",void 0),(0,I.Z)((0,de.Z)(n),"sampleRenderTarget",void 0),(0,I.Z)((0,de.Z)(n),"prevRenderTarget",void 0),(0,I.Z)((0,de.Z)(n),"outputRenderTarget",void 0),(0,I.Z)((0,de.Z)(n),"copyRenderTarget",void 0),(0,I.Z)((0,de.Z)(n),"blendModel",void 0),(0,I.Z)((0,de.Z)(n),"outputModel",void 0),(0,I.Z)((0,de.Z)(n),"copyModel",void 0),n}return(0,Tt.Z)(r,[{key:"getType",value:function(){return ru.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,od.Z)((0,Nt.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,m=p.createFramebuffer,g=p.createTexture2D;this.sampleRenderTarget=m({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.prevRenderTarget=m({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.outputRenderTarget=m({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.copyRenderTarget=m({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([bg(x,2),bg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",l2),this.outputModel=this.createTriangleModel("copy-pass",xg,{blend:{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:G.ONE,dstAlpha:G.ONE_MINUS_SRC_ALPHA},equation:{rgb:G.FUNC_ADD,alpha:G.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",xg)}},{key:"render",value:function(a){var s=this,p=this.rendererService,m=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),w=C.width,R=C.height;this.sampleRenderTarget.resize({width:w,height:R}),this.prevRenderTarget.resize({width:w,height:R}),this.outputRenderTarget.resize({width:w,height:R}),this.copyRenderTarget.resize({width:w,height:R}),this.resetFrame(),this.stopAccumulating();var D=a.multiPassRenderer.getPostProcessor().getReadFBO();x(D,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:D}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var V=function J(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),_a.requestAnimationFrame(function(){J(te)}))};this.accumulatingId=f2++,this.timer=_a.setTimeout(function(){V(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,m=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),w=C.width,R=C.height,D=a.getLayerConfig(),V=D.jitterScale,J=V===void 0?1:V,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/w*J,(te[1]*2-1)/R*J),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Se=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Se.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var He=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=He,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,_a.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:c2,fs:s});var m=this.shaderModuleService.getModule(a),g=m.vs,x=m.fs,C=m.uniforms,w=this.rendererService,R=w.createAttribute,D=w.createBuffer,V=w.createModel;return V(_g({vs:g,fs:x,attributes:{a_Position:R({buffer:D({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:_g({},C),depth:{enable:!1},count:3},p))}}]),r}(Sf),gg=oi(P0.prototype,"shaderModuleService",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P0))||mg),tv=new jr.W2;tv.bind(Ut.IGlobalConfigService).to(Ha).inSingletonScope(),(0,jr.GW)((0,jr.b2)(),hu.EventEmitter),tv.bind(Ut.IEventEmitter).to(hu.EventEmitter);var Eg=(0,vf.Z)(tv,!1),I0=function(i){var r=Eg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},sP=function(i){var r=Eg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},Wl=tv,h2=0;function d2(){var e=new jr.W2;return e.parent=tv,e.bind(Ut.SceneID).toConstantValue("".concat(h2++)),e.bind(Ut.IShaderModuleService).to(w0).inSingletonScope(),e.bind(Ut.ILayerService).to($h).inSingletonScope(),e.bind(Ut.ISceneService).to(Cv).inSingletonScope(),e.bind(Ut.ICameraService).to(pt).inSingletonScope(),e.bind(Ut.ICoordinateSystemService).to(Pn).inSingletonScope(),e.bind(Ut.IInteractionService).to(fs).inSingletonScope(),e.bind(Ut.IPickingService).to(qf).inSingletonScope(),e.bind(Ut.IControlService).to(Ze).inSingletonScope(),e.bind(Ut.IMarkerService).to(Et).inSingletonScope(),e.bind(Ut.IIconService).to(Ir).inSingletonScope(),e.bind(Ut.IFontService).to(ze).inSingletonScope(),e.bind(Ut.IPopupService).to(Zr).inSingletonScope(),e.bind(Ut.INormalPass).to(eb).whenTargetNamed("clear"),e.bind(Ut.INormalPass).to(ob).whenTargetNamed("pixelPicking"),e.bind(Ut.INormalPass).to(o2).whenTargetNamed("render"),e.bind(Ut.INormalPass).to(p2).whenTargetNamed("taa"),e.bind(Ut.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Ut.INormalPass,r)}}),e.bind(Ut.IPostProcessingPass).to(Fb).whenTargetNamed("copy"),e.bind(Ut.IPostProcessingPass).to(mb).whenTargetNamed("bloom"),e.bind(Ut.IPostProcessingPass).to(bb).whenTargetNamed("blurH"),e.bind(Ut.IPostProcessingPass).to(wb).whenTargetNamed("blurV"),e.bind(Ut.IPostProcessingPass).to($b).whenTargetNamed("noise"),e.bind(Ut.IPostProcessingPass).to(r2).whenTargetNamed("sepia"),e.bind(Ut.IPostProcessingPass).to(Ob).whenTargetNamed("colorHalftone"),e.bind(Ut.IPostProcessingPass).to(Zb).whenTargetNamed("hexagonalPixelate"),e.bind(Ut.IPostProcessingPass).to(Wb).whenTargetNamed("ink"),e.bind(Ut.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Ut.IPostProcessingPass,r);return n.setName(r),n}}),e}function v2(e){var i=new jr.W2;return i.parent=e,i.bind(Ut.IStyleAttributeService).to(kd).inSingletonScope(),i.bind(Ut.IMultiPassRenderer).to(nb).inSingletonScope(),i.bind(Ut.IPostProcessor).to(n2).inSingletonScope(),i}var uP=N(74691),m2=null;function lP(e){return m2.indexOf(e)}var g2=2,cP=4,y2=64,fP=128,_2=256,x2=512,pP=8192,hP=16384,dP=32768,b2=null,Sg=131072,vP=262144,E2=524288,mP=1048576,S2=2097152,gP=4194304,C2=8388608,A2=16777216,w2=null;function Rv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function yP(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,m=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],w=[],R=[],D=[Rv(i[0],i[1]),Rv(i[2],i[3])],V=[Rv(m[0],m[1]),Rv(m[2],m[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(J){var te=_slicedToArray(J,2),Se=te[0],He=te[1];C.push([].concat(D,[(Se+1)*C2+(He+1)*S2+getShapeIndex(s)*Sg+r,(n+512)*E2+(a+512)*y2])),w.push([].concat(V,[g,x])),R.push([p,0,0,0])}),{packedBuffer:C,packedBuffer2:w,packedBuffer3:R}}function _P(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*w2+r*A2+n*Sg+r*b2+n*x2+r*_2+n*g2+r}var _c;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(_c||(_c={}));var nu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(nu||(nu={}));var Vp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Vp||(Vp={}));var Dn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Dn||(Dn={}));var T2=["mapload","mapchange","mapAfterFrameChange"],Ch={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},O0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Gp;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Gp||(Gp={}));function Cg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ag(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function M2(e){var i=P2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function P2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I2=0,Lv=function(e){(0,sn.Z)(r,e);var i=M2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this),(0,I.Z)((0,de.Z)(a),"controlOption",void 0),(0,I.Z)((0,de.Z)(a),"container",void 0),(0,I.Z)((0,de.Z)(a),"sceneContainer",void 0),(0,I.Z)((0,de.Z)(a),"mapsService",void 0),(0,I.Z)((0,de.Z)(a),"renderService",void 0),(0,I.Z)((0,de.Z)(a),"layerService",void 0),(0,I.Z)((0,de.Z)(a),"controlService",void 0),(0,I.Z)((0,de.Z)(a),"isShow",void 0),a.controlOption=Ag(Ag({},a.getDefault()),n||{}),a}return(0,Tt.Z)(r,[{key:"getDefault",value:function(){return{position:Gp.TOPRIGHT,name:"".concat(I2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Gp.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Ut.IMapService),this.renderService=a.get(Ut.IRendererService),this.layerService=a.get(Ut.ILayerService),this.controlService=a.get(Ut.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,m=this.controlService.controlCorners[p];return zs(s,"l7-control"),p.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;zs(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;cu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;yo(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(hu.EventEmitter);function O2(e){var i=R2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function R2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xP=function(e){(0,sn.Z)(r,e);var i=O2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,de.Z)(a),"layerControlInputs",void 0),(0,I.Z)((0,de.Z)(a),"layers",void 0),(0,I.Z)((0,de.Z)(a),"lastZIndex",void 0),(0,I.Z)((0,de.Z)(a),"handlingClick",void 0),(0,I.Z)((0,de.Z)(a),"layersLink",void 0),(0,I.Z)((0,de.Z)(a),"baseLayersList",void 0),(0,I.Z)((0,de.Z)(a),"separator",void 0),(0,I.Z)((0,de.Z)(a),"overlaysList",void 0),(0,I.Z)((0,de.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),ue(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,de.Z)(a)),a}return(0,Tt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Gp.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;zs(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(zs(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):cu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return cu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=ha("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var m=this.form=ha("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=ha("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",p||this.expand(),this.baseLayersList=ha("div",a+"-base",m),this.separator=ha("div",a+"-separator",m),this.overlaysList=ha("div",a+"-overlays",m),s.appendChild(m)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,m=p===void 0?{}:p,g=s.overlayers,x=g===void 0?{}:g;Object.keys(m).forEach(function(C,w){a.addLayer(m[C],C,!1)}),Object.keys(x).forEach(function(C,w){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;On(this.baseLayersList),On(this.overlaysList),this.layerControlInputs=[];var a,s,p,m,g=0;for(p=0;p<this.layers.length;p++)m=this.layers[p],this.addItem(m),s=s||m.overlay,a=a||!m.overlay,g+=m.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,m=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],p=this.layerService.getLayer(s.layerId),p&&p.inited){var x=p.getMinZoom(),C=p.getMaxZoom();s.disabled=m<x||m>C}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var m=this.controlOption,g=m.sortLayers,x=m.sortFunction,C=m.autoZIndex;g&&this.layers.sort(function(w,R){return x(w.layer,R.layer,w.name,R.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",m=document.createElement("div");return m.innerHTML=p,m.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),m=p&&p.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=m):g=this.createRadioElement("l7-base-layers",m),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var w=a.overlay?this.overlaysList:this.baseLayersList;return w.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,m=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],p=this.layerService.getLayer(s.layerId),s.checked?m.push(p):s.checked||g.push(p);g.forEach(function(C){C.hide()}),m.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(Lv);function L2(e){var i=k2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function k2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D2=function(e){(0,sn.Z)(r,e);var i=L2(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getDefault",value:function(){return{position:Gp.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=ha("div",a),p=ha("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(Lv);function F2(e){var i=B2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function B2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bP=function(e){(0,sn.Z)(r,e);var i=F2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,de.Z)(a),"mScale",void 0),(0,I.Z)((0,de.Z)(a),"iScale",void 0),ue(["update"],(0,de.Z)(a)),a}return(0,Tt.Z)(r,[{key:"getDefault",value:function(){return{position:Gp.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=ha("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,m=a.containerToLngLat([0,p]),g=a.containerToLngLat([s,p]),x=ic([m.lng,m.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,m=s.imperial;p&&a&&this.updateMetric(a),m&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,m,g;s>5280?(p=s/5280,m=this.getRoundNum(p),this.updateScale(this.iScale,m+" mi",m/p)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,p){var m=this.controlOption.maxWidth;a.style.width=Math.round(m*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,m=p.metric,g=p.imperial;m&&(this.mScale=ha("div",a,s)),g&&(this.iScale=ha("div",a,s))}}]),r}(Lv);function N2(e){var i=z2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EP=function(e){(0,sn.Z)(r,e);var i=N2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,de.Z)(a),"disabled",void 0),(0,I.Z)((0,de.Z)(a),"zoomInButton",void 0),(0,I.Z)((0,de.Z)(a),"zoomOutButton",void 0),ue(["updateDisabled","zoomIn","zoomOut"],(0,de.Z)(a)),a}return(0,Tt.Z)(r,[{key:"getDefault",value:function(){return{position:Gp.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=ha("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,m,g){var x=ha("a",p,m);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";cu(this.zoomInButton,s),cu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&zs(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&zs(this.zoomInButton,s)}}]),r}(Lv);function wg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function U2(e){var i=Z2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function Z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mg=function(e){(0,sn.Z)(r,e);var i=U2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this),(0,I.Z)((0,de.Z)(a),"markerOption",void 0),(0,I.Z)((0,de.Z)(a),"defaultMarker",void 0),(0,I.Z)((0,de.Z)(a),"popup",void 0),(0,I.Z)((0,de.Z)(a),"mapsService",void 0),(0,I.Z)((0,de.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,de.Z)(a),"lngLat",void 0),(0,I.Z)((0,de.Z)(a),"scene",void 0),(0,I.Z)((0,de.Z)(a),"added",!1),(0,I.Z)((0,de.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Tg(Tg({},a.getDefault()),n),ue(["update","onMove","onUp","addDragHandler","onMapClick"],(0,de.Z)(a)),a.init(),a}return(0,Tt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:yt.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Ut.IMapService),this.sceneSerive=a.get(Ut.ISceneService);var s=this.markerOption,p=s.element,m=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&yo(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&yo(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),rc(s,"".concat(Wt[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,m=this.lngLat,g=m.lng,x=m.lat,C=this.mapsService.getBounds(),w=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var R=this.mapsService.getContainer(),D=0,V=0;if(R&&(D=R.scrollWidth,V=R.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(w.x>D){var J=this.mapsService.lngLatToContainer([g-360,x]);w.x=J.x}if(w.x<0){var te=this.mapsService.lngLatToContainer([g+360,x]);w.x=te.x}}(w.x>D||w.x<0||w.y>V||w.y<0)&&(s.style.display="none"),s.style.left=w.x+p[0]+"px",s.style.top=w.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,m=p.color,g=p.anchor;if(!s){this.defaultMarker=!0,s=ha("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",m),x.appendChild(C),s.appendChild(x)}zs(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(w){var R,D,V=((R=a.markerOption)===null||R===void 0?void 0:R.style)&&((D=a.markerOption)===null||D===void 0?void 0:D.style[w]);s&&(s.style[w]=V)}),s.addEventListener("click",function(w){a.onMapClick(w)}),s.addEventListener("click",this.eventHandle),Vt(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(hu.EventEmitter);function Pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ig(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function j2(e){var i=V2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SP=function(e){(0,sn.Z)(r,e);var i=j2(r);function r(n){var a,s;return(0,ot.Z)(this,r),s=i.call(this),(0,I.Z)((0,de.Z)(s),"markers",[]),(0,I.Z)((0,de.Z)(s),"markerLayerOption",void 0),(0,I.Z)((0,de.Z)(s),"clusterIndex",void 0),(0,I.Z)((0,de.Z)(s),"points",[]),(0,I.Z)((0,de.Z)(s),"clusterMarkers",[]),(0,I.Z)((0,de.Z)(s),"mapsService",void 0),(0,I.Z)((0,de.Z)(s),"scene",void 0),(0,I.Z)((0,de.Z)(s),"zoom",void 0),(0,I.Z)((0,de.Z)(s),"bbox",void 0),s.markerLayerOption=Br()(s.getDefault(),n),ue(["update"],(0,de.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Tt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Ut.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;s&&this.addPoint(a,this.markers.length),this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),m=p.lng,g=p.lat,x={geometry:{type:"Point",coordinates:[m,g]},properties:Ig(Ig({},a.getExtData()),{},{marker_id:s})};this.points.push(x)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,m=p===void 0?0:p,g=a.maxZoom;this.clusterIndex=new(Nc())({radius:s,minZoom:m,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,m=a[0].concat(a[1]),g=this.clusterIndex.getClusters(m,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,w=p.markerLayerOption.clusterOption,R=w.field,D=w.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var V,J=p.getLeaves((V=x.properties)===null||V===void 0?void 0:V.cluster_id);if(x.properties.clusterData=J,R&&D){var te=J==null?void 0:J.map(function(Ot){var kt=(0,I.Z)({},R,Ot.properties[R]);return kt}),Se=nn(te,R),He=ai(D,Se),tt="point_"+D;x.properties[tt]=He.toFixed(2)}}var at=p.clusterMarker(x);p.clusterMarkers.push(at),at.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,m=p.element,g=m===void 0?this.generateElement.bind(this):m,x=new Mg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!c(this.bbox,s))&&(this.bbox=f(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(a){var s=ha("div","l7-marker-cluster"),p=ha("div","",s),m=ha("span","",p),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var w=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return m.textContent=w,s}}]),r}(hu.EventEmitter);function Og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Og(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function G2(e){var i=H2();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function H2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lg=function(e){(0,sn.Z)(r,e);var i=G2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this),(0,I.Z)((0,de.Z)(a),"popupOption",void 0),(0,I.Z)((0,de.Z)(a),"mapsService",void 0),(0,I.Z)((0,de.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,de.Z)(a),"lngLat",void 0),(0,I.Z)((0,de.Z)(a),"content",void 0),(0,I.Z)((0,de.Z)(a),"closeButton",void 0),(0,I.Z)((0,de.Z)(a),"timeoutInstance",void 0),(0,I.Z)((0,de.Z)(a),"container",void 0),(0,I.Z)((0,de.Z)(a),"tip",void 0),(0,I.Z)((0,de.Z)(a),"scene",void 0),a.popupOption=Rg(Rg({},a.getdefault()),n),ue(["update","onClickClose","remove"],(0,de.Z)(a)),a}return(0,Tt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Ut.IMapService),this.sceneSerive=a.get(Ut.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),m;for(p.innerHTML=a;m=p.firstChild,!!m;)s.appendChild(m);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&yo(this.content),this.content=ha("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=ha("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var m=window.document.createElement(a);return s!==void 0&&(m.className=s),p&&p.appendChild(m),m}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:yt.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,m=p.className,g=p.maxWidth,x=p.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),m&&m.split(" ").forEach(function(R){return a.container.classList.add(R)});var w=this.popupOption.stopPropagation;w&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(R){a.container.addEventListener(R,function(D){D.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),rc(this.container,"".concat(Wt[x])),Vt(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,m=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=g.x+m[0]+"px",this.container.style.top=g.y-m[1]+"px"}}}]),r}(hu.EventEmitter);function W2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}W2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var X2=N(88307),Y2=N.n(X2),q2=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,m=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:g||0},m&&(this.attribute.size=m)}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),ap,rv,op,xc,nv,Hp,iv,kv,Cf,Ah,Tu,Af,wf,Dv,K2=(ap={},(0,I.Z)(ap,G.POINTS,"points"),(0,I.Z)(ap,G.LINES,"lines"),(0,I.Z)(ap,G.LINE_LOOP,"line loop"),(0,I.Z)(ap,G.LINE_STRIP,"line strip"),(0,I.Z)(ap,G.TRIANGLES,"triangles"),(0,I.Z)(ap,G.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(ap,G.TRIANGLE_STRIP,"triangle strip"),ap),kg=(rv={},(0,I.Z)(rv,G.STATIC_DRAW,"static"),(0,I.Z)(rv,G.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(rv,G.STREAM_DRAW,"stream"),rv),R0=(op={},(0,I.Z)(op,G.BYTE,"int8"),(0,I.Z)(op,G.UNSIGNED_INT,"int16"),(0,I.Z)(op,G.INT,"int32"),(0,I.Z)(op,G.UNSIGNED_BYTE,"uint8"),(0,I.Z)(op,G.UNSIGNED_SHORT,"uint16"),(0,I.Z)(op,G.UNSIGNED_INT,"uint32"),(0,I.Z)(op,G.FLOAT,"float"),op),$2=(xc={},(0,I.Z)(xc,G.ALPHA,"alpha"),(0,I.Z)(xc,G.LUMINANCE,"luminance"),(0,I.Z)(xc,G.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(xc,G.RGB,"rgb"),(0,I.Z)(xc,G.RGBA,"rgba"),(0,I.Z)(xc,G.RGBA4,"rgba4"),(0,I.Z)(xc,G.RGB5_A1,"rgb5 a1"),(0,I.Z)(xc,G.RGB565,"rgb565"),(0,I.Z)(xc,G.DEPTH_COMPONENT,"depth"),(0,I.Z)(xc,G.DEPTH_STENCIL,"depth stencil"),xc),Q2=(nv={},(0,I.Z)(nv,G.DONT_CARE,"dont care"),(0,I.Z)(nv,G.NICEST,"nice"),(0,I.Z)(nv,G.FASTEST,"fast"),nv),Dg=(Hp={},(0,I.Z)(Hp,G.NEAREST,"nearest"),(0,I.Z)(Hp,G.LINEAR,"linear"),(0,I.Z)(Hp,G.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(Hp,G.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(Hp,G.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(Hp,G.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Hp),Fg=(iv={},(0,I.Z)(iv,G.REPEAT,"repeat"),(0,I.Z)(iv,G.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(iv,G.MIRRORED_REPEAT,"mirror"),iv),J2=(kv={},(0,I.Z)(kv,G.NONE,"none"),(0,I.Z)(kv,G.BROWSER_DEFAULT_WEBGL,"browser"),kv),eE=(Cf={},(0,I.Z)(Cf,G.NEVER,"never"),(0,I.Z)(Cf,G.ALWAYS,"always"),(0,I.Z)(Cf,G.LESS,"less"),(0,I.Z)(Cf,G.LEQUAL,"lequal"),(0,I.Z)(Cf,G.GREATER,"greater"),(0,I.Z)(Cf,G.GEQUAL,"gequal"),(0,I.Z)(Cf,G.EQUAL,"equal"),(0,I.Z)(Cf,G.NOTEQUAL,"notequal"),Cf),Bg=(Ah={},(0,I.Z)(Ah,G.FUNC_ADD,"add"),(0,I.Z)(Ah,G.MIN_EXT,"min"),(0,I.Z)(Ah,G.MAX_EXT,"max"),(0,I.Z)(Ah,G.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Ah,G.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ah),Fv=(Tu={},(0,I.Z)(Tu,G.ZERO,"zero"),(0,I.Z)(Tu,G.ONE,"one"),(0,I.Z)(Tu,G.SRC_COLOR,"src color"),(0,I.Z)(Tu,G.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Tu,G.SRC_ALPHA,"src alpha"),(0,I.Z)(Tu,G.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Tu,G.DST_COLOR,"dst color"),(0,I.Z)(Tu,G.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Tu,G.DST_ALPHA,"dst alpha"),(0,I.Z)(Tu,G.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Tu,G.CONSTANT_COLOR,"constant color"),(0,I.Z)(Tu,G.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Tu,G.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Tu,G.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Tu,G.SRC_ALPHA_SATURATE,"src alpha saturate"),Tu),tE=(Af={},(0,I.Z)(Af,G.NEVER,"never"),(0,I.Z)(Af,G.ALWAYS,"always"),(0,I.Z)(Af,G.LESS,"less"),(0,I.Z)(Af,G.LEQUAL,"lequal"),(0,I.Z)(Af,G.GREATER,"greater"),(0,I.Z)(Af,G.GEQUAL,"gequal"),(0,I.Z)(Af,G.EQUAL,"equal"),(0,I.Z)(Af,G.NOTEQUAL,"notequal"),Af),ud=(wf={},(0,I.Z)(wf,G.ZERO,"zero"),(0,I.Z)(wf,G.KEEP,"keep"),(0,I.Z)(wf,G.REPLACE,"replace"),(0,I.Z)(wf,G.INVERT,"invert"),(0,I.Z)(wf,G.INCR,"increment"),(0,I.Z)(wf,G.DECR,"decrement"),(0,I.Z)(wf,G.INCR_WRAP,"increment wrap"),(0,I.Z)(wf,G.DECR_WRAP,"decrement wrap"),wf),rE=(Dv={},(0,I.Z)(Dv,G.FRONT,"front"),(0,I.Z)(Dv,G.BACK,"back"),Dv),nE=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:kg[a||G.STATIC_DRAW],type:R0[s||G.UNSIGNED_BYTE]})}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),iE=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:kg[a||G.STATIC_DRAW],type:R0[s||G.UNSIGNED_BYTE],count:p})}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),aE=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,m=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(p)&&(x.colors=p.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),oE=N(36719),sE=N.n(oE),uE=N(68630),lE=N.n(uE);function Ng(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ng(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ng(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var cE=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawPickCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,m=r.primitive,g=r.count,x=r.elements,C=r.depth,w=r.blend,R=r.stencil,D=r.cull,V=r.instances,J={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(tt){J[tt]=i.prop(tt)}));var te={};Object.keys(s).forEach(function(tt){te[tt]=s[tt].get()});var Se={attributes:te,frag:a,uniforms:J,vert:n,blend:{},primitive:K2[m===void 0?G.TRIANGLES:m]};V&&(Se.instances=V),g&&(Se.count=g),x&&(Se.elements=x.get()),this.initDepthDrawParams({depth:C},Se),this.initBlendDrawParams({blend:w},Se),this.initStencilDrawParams({stencil:R},Se),this.initCullDrawParams({cull:D},Se),this.drawCommand=i(Se);var He=Va()(Se);He.blend=Tf(Tf({},He.blend),{},{enable:!1}),He.stencil=Tf(Tf({},He.stencil),{},{enable:!1}),this.drawPickCommand=i(He),this.drawParams=Se}return(0,Tt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=Tf(Tf({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Tf(Tf({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var m=(0,cp.Z)(a[p]);m==="boolean"||m==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:eE[a.func||G.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,m=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:Fv[p&&p.srcRGB||G.SRC_ALPHA],srcAlpha:Fv[p&&p.srcAlpha||G.SRC_ALPHA],dstRGB:Fv[p&&p.dstRGB||G.ONE_MINUS_SRC_ALPHA],dstAlpha:Fv[p&&p.dstAlpha||G.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Bg[m&&m.rgb||G.FUNC_ADD],alpha:Bg[m&&m.alpha||G.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,m=p===void 0?-1:p,g=a.func,x=g===void 0?{cmp:G.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,w=C===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:C,R=a.opBack,D=R===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:R;n.stencil={enable:!!s,mask:m,func:Tf(Tf({},x),{},{cmp:tE[x.cmp]}),opFront:{fail:ud[w.fail],zfail:ud[w.zfail],zpass:ud[w.zpass]},opBack:{fail:ud[D.fail],zfail:ud[D.zfail],zpass:ud[D.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,m=p===void 0?G.BACK:p;n.cull={enable:!!s,face:rE[m]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||sE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}lE()(n)&&Object.keys(n).forEach(function(m){p.extractUniformsRecursively(m,n[m],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(m,g){Object.keys(m).forEach(function(x){p.extractUniformsRecursively(x,m[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),fE=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?G.UNSIGNED_BYTE:a,p=r.width,m=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,w=C===void 0?G.RGBA:C,R=r.mipmap,D=R===void 0?!1:R,V=r.wrapS,J=V===void 0?G.CLAMP_TO_EDGE:V,te=r.wrapT,Se=te===void 0?G.CLAMP_TO_EDGE:te,He=r.aniso,tt=He===void 0?0:He,at=r.alignment,Ot=at===void 0?1:at,kt=r.premultiplyAlpha,nr=kt===void 0?!1:kt,mr=r.mag,Gr=mr===void 0?G.NEAREST:mr,ln=r.min,Tr=ln===void 0?G.NEAREST:ln,An=r.colorSpace,Rn=An===void 0?G.BROWSER_DEFAULT_WEBGL:An,di=r.x,mo=di===void 0?0:di,wo=r.y,qs=wo===void 0?0:wo,Pu=r.copy,iu=Pu===void 0?!1:Pu;this.width=p,this.height=m;var bd={width:p,height:m,type:R0[s],format:$2[w],wrapS:Fg[J],wrapT:Fg[Se],mag:Dg[Gr],min:Dg[Tr],alignment:Ot,flipY:x,colorSpace:J2[Rn],premultiplyAlpha:nr,aniso:tt,x:mo,y:qs,copy:iu};n&&(bd.data=n),typeof D=="number"?bd.mipmap=Q2[D]:typeof D=="boolean"&&(bd.mipmap=D),this.texture=i.texture(bd)}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),zg,Ug,pE=(zg=(0,jr.b2)(),zg(Ug=function(){function e(){var i=this;(0,ot.Z)(this,e),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(r){return new cE(i.gl,r)}),(0,I.Z)(this,"createAttribute",function(r){return new q2(i.gl,r)}),(0,I.Z)(this,"createBuffer",function(r){return new nE(i.gl,r)}),(0,I.Z)(this,"createElements",function(r){return new iE(i.gl,r)}),(0,I.Z)(this,"createTexture2D",function(r){return new fE(i.gl,r)}),(0,I.Z)(this,"createFramebuffer",function(r){return new aE(i.gl,r)}),(0,I.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,I.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,m=p===void 0?null:p,g={color:n,depth:a,stencil:s};g.framebuffer=m===null?m:m.get(),i.gl.clear(g)}),(0,I.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,I.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,m=r.height,g={x:a,y:s,width:p,height:m};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,I.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){if(Po)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,I.Z)(this,"getCanvas",function(){return i.canvas}),(0,I.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,I.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Tt.Z)(e,[{key:"init",value:function(){var i=(0,za.Z)(Pi().mark(function n(a,s){var p=this;return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){Y2()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(R,D){(R||!D)&&C(R),x(D)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Ug);function Zg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var hE=function(){function e(i){(0,ot.Z)(this,e),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=d2();this.container=p,n.setContainer(p,r,a,s),p.bind(Ut.IRendererService).to(pE).inSingletonScope(),this.sceneService=p.get(Ut.ISceneService),this.mapService=p.get(Ut.IMapService),this.iconService=p.get(Ut.IIconService),this.fontService=p.get(Ut.IFontService),this.controlService=p.get(Ut.IControlService),this.layerService=p.get(Ut.ILayerService),this.markerService=p.get(Ut.IMarkerService),this.interactionService=p.get(Ut.IInteractionService),this.popupService=p.get(Ut.IPopupService),Po?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Tt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=v2(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,$.Z)(a,2),p=s[0],m=s[1];n.fontService.addIconFont(p,m)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Po?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){O0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){O0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){O0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||jg(jg({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Ut.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Qs(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new D2({position:a}))}}]),e}(),dE=N(52353),vE=N.n(dE),mE=N(13218),zu=N.n(mE),Wp,Vg=(Wp={},(0,I.Z)(Wp,_c.additive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Wp,_c.none,{enable:!1}),(0,I.Z)(Wp,_c.normal,{enable:!0,func:{srcRGB:G.SRC_ALPHA,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Wp,_c.subtractive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:G.ZERO,dstAlpha:G.ONE_MINUS_SRC_COLOR},equation:{rgb:G.FUNC_SUBTRACT,alpha:G.FUNC_SUBTRACT}}),(0,I.Z)(Wp,_c.max,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MAX_EXT}}),(0,I.Z)(Wp,_c.min,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MIN_EXT}}),Wp),gE=N(81763),xa=N.n(gE),CP=1024;function ul(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function yE(e,i){e.opacity&&Bv("opacity",i,e.opacity),e.strokeWidth&&Bv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Bv("strokeOpacity",i,e.strokeOpacity),e.stroke&&_E("stroke",i,e.stroke),e.offsets&&Gg("offsets",i,e.offsets),e.textOffset&&Gg("textOffset",i,e.textOffset),e.thetaOffset&&Bv("thetaOffset",i,e.thetaOffset)}function Bv(e,i,r){Pa()(r)?ul(e,i,r,function(n){return n}):xa()(r)?ul(e,i,[r],void 0):Array.isArray(r)&&r.length===2?Pa()(r[0])&&no()(r[1])||Pa()(r[0])&&Array.isArray(r[1])&&xa()(r[1][0])&&xa()(r[1][1])?ul(e,i,r[0],r[1]):ul(e,i,[1],void 0):ul(e,i,[1],void 0)}function Gg(e,i,r){Pa()(r)?ul(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&Pa()(r[0])&&no()(r[1])?ul(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&xa()(r[0])&&xa()(r[1])?ul(e,i,r,void 0):ul(e,i,[0,0],void 0)}function _E(e,i,r){Pa()(r)?ul(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(Pa()(r[0])&&no()(r[1])||Pa()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?ul(e,i,r[0],r[1]):ul(e,i,"#fff",void 0)}function Hg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function Wg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),p=s.enablePicking,m=s.enableTAA;return m?a.add(n("taa")):a.add(n("render")),Hg(i).forEach(function(g){var x=(0,$.Z)(g,2),C=x[0],w=x[1];a.add(r(C),w)}),a.add(r("copy")),a}var xE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function bE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}xE.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var EE=["passes"],SE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Xg,L0,Yg;function CE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=AE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function AE(e,i){if(!!e){if(typeof e=="string")return qg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qg(e,i)}}function qg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Uu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wE(e){var i=TE();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function TE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $g=0,wh=(Xg=I0(Ut.IGlobalConfigService),L0=function(e){(0,sn.Z)(r,e);var i=wE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,de.Z)(n),"id","".concat($g++)),(0,I.Z)((0,de.Z)(n),"name","".concat($g)),(0,I.Z)((0,de.Z)(n),"type",void 0),(0,I.Z)((0,de.Z)(n),"visible",!0),(0,I.Z)((0,de.Z)(n),"zIndex",0),(0,I.Z)((0,de.Z)(n),"minZoom",void 0),(0,I.Z)((0,de.Z)(n),"maxZoom",void 0),(0,I.Z)((0,de.Z)(n),"inited",!1),(0,I.Z)((0,de.Z)(n),"layerModelNeedUpdate",!1),(0,I.Z)((0,de.Z)(n),"pickedFeatureID",null),(0,I.Z)((0,de.Z)(n),"selectedFeatureID",null),(0,I.Z)((0,de.Z)(n),"styleNeedUpdate",!1),(0,I.Z)((0,de.Z)(n),"rendering",void 0),(0,I.Z)((0,de.Z)(n),"clusterZoom",0),(0,I.Z)((0,de.Z)(n),"layerType",void 0),(0,I.Z)((0,de.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,de.Z)(n),"hooks",{init:new cc,afterInit:new cc,beforeRender:new cc,beforeRenderData:new lc,afterRender:new Ga,beforePickingEncode:new Ga,afterPickingEncode:new Ga,beforeHighlight:new Ga(["pickedColor"]),afterHighlight:new Ga,beforeSelect:new Ga(["pickedColor"]),afterSelect:new Ga,beforeDestroy:new Ga,afterDestroy:new Ga}),(0,I.Z)((0,de.Z)(n),"models",[]),(0,I.Z)((0,de.Z)(n),"multiPassRenderer",void 0),(0,I.Z)((0,de.Z)(n),"plugins",void 0),(0,I.Z)((0,de.Z)(n),"sourceOption",void 0),(0,I.Z)((0,de.Z)(n),"layerModel",void 0),(0,I.Z)((0,de.Z)(n),"shapeOption",void 0),(0,I.Z)((0,de.Z)(n),"sceneContainer",void 0),(0,I.Z)((0,de.Z)(n),"layerChildren",[]),Sn((0,de.Z)(n),"configService",Yg,(0,de.Z)(n)),(0,I.Z)((0,de.Z)(n),"shaderModuleService",void 0),(0,I.Z)((0,de.Z)(n),"cameraService",void 0),(0,I.Z)((0,de.Z)(n),"coordinateService",void 0),(0,I.Z)((0,de.Z)(n),"iconService",void 0),(0,I.Z)((0,de.Z)(n),"fontService",void 0),(0,I.Z)((0,de.Z)(n),"pickingService",void 0),(0,I.Z)((0,de.Z)(n),"rendererService",void 0),(0,I.Z)((0,de.Z)(n),"layerService",void 0),(0,I.Z)((0,de.Z)(n),"interactionService",void 0),(0,I.Z)((0,de.Z)(n),"mapService",void 0),(0,I.Z)((0,de.Z)(n),"styleAttributeService",void 0),(0,I.Z)((0,de.Z)(n),"layerSource",void 0),(0,I.Z)((0,de.Z)(n),"postProcessingPassFactory",void 0),(0,I.Z)((0,de.Z)(n),"normalPassFactory",void 0),(0,I.Z)((0,de.Z)(n),"animateOptions",{enable:!1}),(0,I.Z)((0,de.Z)(n),"container",void 0),(0,I.Z)((0,de.Z)(n),"encodedData",void 0),(0,I.Z)((0,de.Z)(n),"configSchema",void 0),(0,I.Z)((0,de.Z)(n),"currentPickId",null),(0,I.Z)((0,de.Z)(n),"rawConfig",void 0),(0,I.Z)((0,de.Z)(n),"needUpdateConfig",void 0),(0,I.Z)((0,de.Z)(n),"pendingStyleAttributes",[]),(0,I.Z)((0,de.Z)(n),"scaleOptions",{}),(0,I.Z)((0,de.Z)(n),"animateStartTime",void 0),(0,I.Z)((0,de.Z)(n),"aniamateStatus",!1),(0,I.Z)((0,de.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,I.Z)((0,de.Z)(n),"isDestroied",!1),(0,I.Z)((0,de.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,m=s.fitBoundsOptions;p&&n.fitBounds(m),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Tt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Uu(Uu({},this.needUpdateConfig),a);else{var s=this.container.get(Ut.SceneID);yE(a,this),this.configService.setLayerConfig(s,this.id,Uu(Uu(Uu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Ut.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ut.IIconService),this.fontService=this.container.get(Ut.IFontService),this.rendererService=this.container.get(Ut.IRendererService),this.layerService=this.container.get(Ut.ILayerService),this.interactionService=this.container.get(Ut.IInteractionService),this.pickingService=this.container.get(Ut.IPickingService),this.mapService=this.container.get(Ut.IMapService);var p=this.getLayerConfig(),m=p.enableMultiPassRenderer,g=p.passes;m&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Ut.ICameraService),this.coordinateService=this.container.get(Ut.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ut.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ut.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ut.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ut.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ut.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(R){var D=R.attributeName,V=R.attributeField,J=R.attributeValues,te=R.updateOptions;a.styleAttributeService.updateStyleAttribute(D,{scale:Uu({field:V},a.splitValuesAndCallbackInAttribute(J,a.getLayerConfig()[D]))},te)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ut.ILayerPlugin);var x=CE(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var w=C.value;w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(R){x.e(R)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Uu(Uu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var m,g,x,C=(m=this.styleAttributeService)===null||m===void 0||(g=m.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,w=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,p),bE(this,C,w),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return zu()(a)?(s.enable=!0,s=Uu(Uu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var m=p.getSource();m?p.layerSource.setData(a,s):(p.source(new du(a,s)),p.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,p=a.passes,m=(0,bf.Z)(a,EE);return p&&Hg(p).forEach(function(g){var x=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(g[0]);x&&x.updateOptions(g[1])}),this.rawConfig=Uu(Uu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(a,s){return zu()(a)?this.scaleOptions=Uu(Uu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,za.Z)(Pi().mark(function s(){return Pi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.getEncodedData().length===0){m.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){m.next=6;break}return m.next=4,this.multiPassRenderer.render();case 4:m.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return m.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=zu()(a)?!0:a,zu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(zu()(a)){var m=a.x,g=m===void 0?0:m,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:zu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:zu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:zu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:zu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(je(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=zu()(a)?!0:a,zu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(zu()(a)){var m=a.x,g=m===void 0?0:m,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:zu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:zu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:zu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:zu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(je(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,m=s.minZoom,g=m===void 0?-Infinity:m,x=s.maxZoom,C=x===void 0?Infinity:x;return!!p&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var p=this.getLayerConfig(),m=p.passes,g=m===void 0?[]:m;this.multiPassRenderer=Wg(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,w=x.height;this.multiPassRenderer.resize(C,w)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,m=p.some(function(g){return Math.abs(g)===Infinity});return m?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var p=s.range().map(function(x){return(0,I.Z)({value:s.invertExtent(x)},a,x)});return p}else if(s.ticks){var m=s.ticks().map(function(x){return(0,I.Z)({value:x},a,s(x))});return m}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!vE()(x)}).map(function(x){return(0,I.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,m=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,bf.Z)(a,SE);this.shaderModuleService.registerModule(s,{vs:p,fs:m});var w=this.shaderModuleService.getModule(s),R=w.vs,D=w.fs,V=w.uniforms,J=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),Se=te.attributes,He=te.elements;return J(Uu({attributes:Se,uniforms:V,fs:D,vs:R,elements:He,blend:Vg[_c.normal]},C))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,m=p===void 0?!0:p,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(m||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,za.Z)(Pi().mark(function s(p){return Pi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,p.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,m){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Uu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},m):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:m})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:no()(a)?void 0:a||s,callback:no()(a)?a:void 0}}}]),r}(hu.EventEmitter),Yg=oi(L0.prototype,"configService",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L0),ME=N(18446),ld=N.n(ME),Qg,k0,Jg;function PE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=IE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function IE(e,i){if(!!e){if(typeof e=="string")return ey(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ey(e,i)}}function ey(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var jo=(Qg=I0(Ut.IGlobalConfigService),k0=function(){function e(i){(0,ot.Z)(this,e),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),Sn(this,"configService",Jg,this),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Ut.IRendererService),this.shaderModuleService=i.getContainer().get(Ut.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Ut.IStyleAttributeService),this.mapService=i.getContainer().get(Ut.IMapService),this.iconService=i.getContainer().get(Ut.IIconService),this.fontService=i.getContainer().get(Ut.IFontService),this.cameraService=i.getContainer().get(Ut.ICameraService),this.layerService=i.getContainer().get(Ut.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:G.NEAREST,min:G.NEAREST,width:1,height:1}))}return(0,Tt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return ld()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),ld()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),ld()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),ld()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),ld()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),ld()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!xa()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!xa()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!xa()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!xa()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Pa()(r)?!!(0,Oe.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=ke(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&xa()(r[0])&&xa()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=PE(a),p;try{for(s.s();!(p=s.n()).done;){var m=p.value,g=m.attr,x=m.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,ar.Z)(ke(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(xa()(C)?C:1):this.patchMod(r,x)}}catch(w){s.e(w)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),m=p*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var w=g.length;w<m;w++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Vg[_c[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Jg=oi(k0.prototype,"configService",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0),OE=N(9187),Mf=N.n(OE),ty=100,AP=36,wP=40;function ry(e){return e/180*Math.acos(-1)}function ny(e){var i=ry(e[0])+Math.PI/2,r=ry(e[1]),n=ty+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function TP(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,m=2+p,g=2*m,x=[],C=[],w=[],R=[],D=[],V=[],J=0;J<=m;J++){for(var te=J/m,Se=te*Math.PI,He=0;He<=g;He++){var tt=He/g,at=tt*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Se),mat4.identity(r),mat4.rotateY(r,r,at),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),w.push(s.slice()),R.push.apply(R,_toConsumableArray(s.slice())),vec3.normalize(s,s),D.push.apply(D,_toConsumableArray(s.slice())),V.push([tt,1-te]),R.push(tt,1-te)}if(J>0)for(var Ot=w.length,kt=Ot-2*(g+1);kt+g+2<Ot;kt++)x.push([kt,kt+1,kt+g+1]),C.push(kt,kt+1,kt+g+1),x.push([kt+g+1,kt+1,kt+g+2]),C.push(kt+g+1,kt+1,kt+g+2)}return{cells:x,positions:w,uvs:V,positionsArr:R,indicesArr:C,normalArr:D}}var bi=N(31437),Nv=bi.Ue(),MP=bi.Ue(),Ys=bi.Ue(),Xp=bi.Ue(),cd=bi.Ue();function D0(e,i,r,n,a){bi.IH(e,r,n),bi.Fv(e,e),i=bi.al(-e[1],e[0]);var s=bi.al(-r[1],r[0]);return[a/bi.AK(i,s),i]}function Yp(e,i){return bi.t8(e,-i[1],i[0])}function fd(e,i,r){return bi.lu(e,i,r),bi.Fv(e,e),e}function F0(e,i){return e[0]===i[0]&&e[1]===i[1]}function PP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var iy=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ot.Z)(this,e),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",bi.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Tt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,m=1;m<s;m++){var g,x,C,w=r[m-1];w.push((g=n[m-1][2])!==null&&g!==void 0?g:0);var R=n[m-1],D=r[m];D.push((x=n[m][2])!==null&&x!==void 0?x:0);var V=n[m],J=m<r.length-1?[].concat((0,ar.Z)(r[m+1]),[(C=n[m+1][2])!==null&&C!==void 0?C:0]):null,te=m<n.length-1?n[m+1]:null,Se=this.segment_gaode2(a,p,w,D,J,R,V,te);p+=Se}if(this.dash)for(var He=0;He<a.positions.length/6;He++)a.positions[He*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,m=1;m<s;m++){var g,x,C,w=r[m-1];w.push((g=n[m-1][2])!==null&&g!==void 0?g:0);var R=n[m-1],D=r[m];D.push((x=n[m][2])!==null&&x!==void 0?x:0);var V=n[m],J=m<r.length-1?[].concat((0,ar.Z)(r[m+1]),[(C=n[m+1][2])!==null&&C!==void 0?C:0]):null,te=m<n.length-1?n[m+1]:null,Se=this.simpleSegment(a,p,w,D,J,R,V,te);p+=Se}if(this.dash)for(var He=0;He<a.positions.length/6;He++)a.positions[He*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var m=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.segment(n,s,m,g,x);s+=C}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var m=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.simpleSegment(n,s,m,g,x);s+=C}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,m,g,x){var C=0,w=r.indices,R=r.positions,D=r.normals,V=this.cap==="square",J=this.join==="bevel",te=js([g[0],g[1]]),Se=js([m[0],m[1]]);fd(Ys,s,a);var He=0;if(this.dash&&(He=this.lineSegmentDistance(te,Se),this.totalDistance+=He),this.normal||(this.normal=bi.Ue(),Yp(this.normal,Ys)),!this.started)if(this.started=!0,V){var tt=bi.Ue(),at=bi.Ue();bi.IH(tt,this.normal,Ys),bi.IH(at,this.normal,Ys),D.push(at[0],at[1],0),D.push(tt[0],tt[1],0),R.push(a[0],a[1],a[2]|0,this.totalDistance-He,-this.thickness,a[2]|0),R.push(a[0],a[1],a[2]|0,this.totalDistance-He,this.thickness,a[2]|0)}else this.extrusions(R,D,a,this.normal,this.thickness,this.totalDistance-He);if(w.push(n+0,n+1,n+2),p){F0(s,p)&&bi.IH(p,s,bi.Fv(p,bi.$X(p,s,a))),fd(Xp,p,s);var nr=D0(cd,bi.Ue(),Ys,Xp,this.thickness),mr=(0,$.Z)(nr,2),Gr=mr[0],ln=mr[1],Tr=bi.AK(cd,this.normal)<0?-1:1,An=J;if(!An&&this.join==="miter"){var Rn=Gr;Rn>this.miterLimit&&(An=!0)}An?(D.push(this.normal[0],this.normal[1],0),D.push(ln[0],ln[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Tr,s[2]|0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Tr,s[2]|0),w.push.apply(w,(0,ar.Z)(this.lastFlip!==-Tr?[n,n+2,n+3]:[n+2,n+1,n+3])),w.push(n+2,n+3,n+4),Yp(Nv,Xp),bi.JG(this.normal,Nv),D.push(this.normal[0],this.normal[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Tr,s[2]|0),C+=3):(this.extrusions(R,D,s,ln,Gr,this.totalDistance),w.push.apply(w,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Tr=-1,bi.JG(this.normal,ln),C+=2),this.lastFlip=Tr}else{if(Yp(this.normal,Ys),V){var Ot=bi.Ue(),kt=bi.Ue();bi.lu(kt,Ys,this.normal),bi.IH(Ot,Ys,this.normal),D.push(kt[0],kt[1],0),D.push(Ot[0],Ot[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(R,D,s,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,p){var m=0,g=r.indices,x=r.positions,C=r.normals,w=js([s[0],s[1]]),R=js([a[0],a[1]]);fd(Ys,w,R);var D=0;if(this.dash&&(D=this.lineSegmentDistance(w,R),this.totalDistance+=D),this.normal||(this.normal=bi.Ue(),Yp(this.normal,Ys)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-D)),g.push(n+0,n+1,n+2),!p)Yp(this.normal,Ys),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),m+=2;else{var V=js([p[0],p[1]]);F0(w,V)&&bi.IH(V,w,bi.Fv(V,bi.$X(V,w,R))),fd(Xp,V,w);var J=D0(cd,bi.Ue(),Ys,Xp,this.thickness),te=(0,$.Z)(J,2),Se=te[0],He=te[1],tt=bi.AK(cd,this.normal)<0?-1:1;this.extrusions(x,C,s,He,Se,this.totalDistance),g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),tt=-1,bi.JG(this.normal,He),m+=2,this.lastFlip=tt}return m}},{key:"segment",value:function(r,n,a,s,p){var m=0,g=r.indices,x=r.positions,C=r.normals,w=this.cap==="square",R=this.join==="bevel",D=js([s[0],s[1]]),V=js([a[0],a[1]]);fd(Ys,D,V);var J=0;if(this.dash&&(J=this.lineSegmentDistance(D,V),this.totalDistance+=J),this.normal||(this.normal=bi.Ue(),Yp(this.normal,Ys)),!this.started)if(this.started=!0,w){var te=bi.Ue(),Se=bi.Ue();bi.IH(te,this.normal,Ys),bi.IH(Se,this.normal,Ys),C.push(Se[0],Se[1],0),C.push(te[0],te[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-J,-this.thickness,a[2]|0),x.push(a[0],a[1],a[2]|0,this.totalDistance-J,this.thickness,a[2]|0)}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-J);if(g.push(n+0,n+1,n+2),p){var at=js([p[0],p[1]]);F0(D,at)&&bi.IH(at,D,bi.Fv(at,bi.$X(at,D,V))),fd(Xp,at,D);var Ot=D0(cd,bi.Ue(),Ys,Xp,this.thickness),kt=(0,$.Z)(Ot,2),nr=kt[0],mr=kt[1],Gr=bi.AK(cd,this.normal)<0?-1:1,ln=R;if(!ln&&this.join==="miter"){var Tr=nr;Tr>this.miterLimit&&(ln=!0)}ln?(C.push(this.normal[0],this.normal[1],0),C.push(mr[0],mr[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Gr,s[2]|0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Gr,s[2]|0),g.push.apply(g,(0,ar.Z)(this.lastFlip!==-Gr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),Yp(Nv,Xp),bi.JG(this.normal,Nv),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Gr,s[2]|0),m+=3):(this.extrusions(x,C,s,mr,nr,this.totalDistance),g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Gr=-1,bi.JG(this.normal,mr),m+=2),this.lastFlip=Gr}else{if(Yp(this.normal,Ys),w){var He=bi.Ue(),tt=bi.Ue();bi.lu(tt,Ys,this.normal),bi.IH(He,Ys,this.normal),C.push(tt[0],tt[1],0),C.push(He[0],He[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),m+=2}return m}},{key:"extrusions",value:function(r,n,a,s,p,m){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,m,-p,a[2]|0),r.push(a[0],a[1],a[2]|0,m,p,a[2]|0)}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Th(e){if(xa()(e[0]))return e;if(xa()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(xa()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function RE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,m=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,p+=C,m++)}return{center:[s/m,p/m],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Ja=N(77160);function LE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Mf().flatten(e),s=a.vertices,p=a.dimensions,m=[],g=[],x=0;x<s.length/p;x++)p===2?m.push(s[x*2],s[x*2+1],1):m.push(s[x*3],s[x*3+1],1);var C=Mf()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,ar.Z)(C));for(var w=function(V){var J=a.vertices.slice(V*p,(V+1)*p),te=a.vertices.slice((V+1)*p,(V+2)*p);te.length===0&&(te=a.vertices.slice(0,p));var Se=m.length/3;m.push(J[0],J[1],1,te[0],te[1],1,J[0],J[1],0,te[0],te[1],0),g.push.apply(g,(0,ar.Z)([0,2,1,2,3,1].map(function(He){return He+Se})))},R=0;R<n;R++)w(R);return{positions:m,index:g}}function kE(e){var i=Mf().flatten(e),r=Mf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function ay(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Mf().flatten(e),p=s.vertices,m=s.dimensions,g=[],x=[],C=[],w=0;w<p.length/m;w++)m===2?g.push(p[w*2],p[w*2+1],1,-1,-1):g.push(p[w*3],p[w*3+1],1,-1,-1),C.push(0,0,1);var R=Mf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,ar.Z)(R));for(var D=function(te){var Se=s.vertices.slice(te*m,(te+1)*m),He=s.vertices.slice((te+1)*m,(te+2)*m);He.length===0&&(He=s.vertices.slice(0,m));var tt=g.length/5;g.push(Se[0],Se[1],1,0,0,He[0],He[1],1,.1,0,Se[0],Se[1],0,0,.8,He[0],He[1],0,.1,.8);var at=DE([He[0],He[1],1],[Se[0],Se[1],0],[Se[0],Se[1],1],i);C.push.apply(C,(0,ar.Z)(at).concat((0,ar.Z)(at),(0,ar.Z)(at),(0,ar.Z)(at))),x.push.apply(x,(0,ar.Z)([1,2,0,3,2,1].map(function(Ot){return Ot+tt})))},V=0;V<a;V++)D(V);return{positions:g,index:x,normals:C}}function DE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Ja.create(),s=Ja.create(),p=Ja.create();n&&(e=Du(e),i=Du(i),r=Du(r));var m=Ja.fromValues.apply(Ja,(0,ar.Z)(e)),g=Ja.fromValues.apply(Ja,(0,ar.Z)(i)),x=Ja.fromValues.apply(Ja,(0,ar.Z)(r));Ja.sub(a,x,g),Ja.sub(s,m,g),Ja.cross(p,a,s);var C=Ja.create();return Ja.normalize(C,p),C}var bc,Mh;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Mh||(Mh={}));var Ph;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Ph||(Ph={}));function av(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var m=Math.sin(p+Math.PI/4),g=Math.cos(p+Math.PI/4);return[m,g,0]});return s}function oy(){return av(30)}function sy(){return av(4)}function uy(){return av(3)}function ly(){return av(6,1)}function cy(){return av(5)}var pd=(bc={},(0,I.Z)(bc,Ph.CIRCLE,oy),(0,I.Z)(bc,Ph.HEXAGON,ly),(0,I.Z)(bc,Ph.TRIANGLE,uy),(0,I.Z)(bc,Ph.SQUARE,sy),(0,I.Z)(bc,Ph.PENTAGON,cy),(0,I.Z)(bc,Mh.CYLINDER,oy),(0,I.Z)(bc,Mh.HEXAGONCOLUMN,ly),(0,I.Z)(bc,Mh.TRIANGLECOLUMN,uy),(0,I.Z)(bc,Mh.SQUARECOLUMN,sy),(0,I.Z)(bc,Mh.PENTAGONCOLUMN,cy),bc),zv={};function hd(e){var i=Th(e.coordinates);return{vertices:[].concat((0,ar.Z)(i),(0,ar.Z)(i),(0,ar.Z)(i),(0,ar.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function FE(e){var i=Th(e.coordinates),r=ny(i);return{vertices:[].concat((0,ar.Z)(r),(0,ar.Z)(r),(0,ar.Z)(r),(0,ar.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function fy(e){var i=e.shape,r=ZE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function py(e){var i=Th(e.coordinates);return{vertices:(0,ar.Z)(i),indices:[0],size:i.length}}function hy(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new iy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var m=0;m<s.length;m++){var g=s[m],x=p[m];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.extrude(R)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,size:6}}function BE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new iy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var m=0;m<s.length;m++){var g=s[m],x=p[m];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.simpleExtrude(R)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,size:6}}function B0(e){var i=e.coordinates,r=Mf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Mf()(n,s,a),vertices:n,size:a}}function NE(e){var i=e.coordinates,r=Mf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Mf()(n,s,a),vertices:zE(n),size:a+4}}function zE(e){for(var i=[],r=RE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],m=e[s+1];i.push.apply(i,[p,m,0].concat((0,ar.Z)(n),[a]))}return i}function dy(e){var i=e.coordinates,r=ay(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function vy(e){var i=e.shape,r=VE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function gy(e){var i=e.coordinates,r=[].concat((0,ar.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,ar.Z)(i[1]),[0,1,0],(0,ar.Z)(i[0]),[0,0,1],(0,ar.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Uv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,ar.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},m=0;m<r;m++)p(m);return{vertices:a,indices:s,size:7}}function UE(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Zv(-1,1),a=Zv(1,1),s=Zv(-1,-1),p=Zv(1,-1),m=[].concat((0,ar.Z)(i),(0,ar.Z)(n),(0,ar.Z)(i),(0,ar.Z)(s),(0,ar.Z)(i),(0,ar.Z)(p),(0,ar.Z)(i),(0,ar.Z)(a)),g=[0,1,2,3,0,2];return{vertices:m,indices:g,size:5}}function ZE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(zv&&zv[e])return zv[e];var r=pd[e]?pd[e]():pd.cylinder(),n=ay([r],i);return zv[e]=n,n}function IP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,m,g=vec3.create(),x=vec3.create(),C=vec3.create(),w=0,R=i.length;w<R;w+=3){s=i[w+0]*3,p=i[w+1]*3,m=i[w+2]*3;var D=[e[s],e[s+1]],V=[e[p],e[p+1]],J=[e[m],e[m+1]];n&&(D=lngLatToMeters(D),V=lngLatToMeters(V),J=lngLatToMeters(J));var te=D,Se=_slicedToArray(te,2),He=Se[0],tt=Se[1],at=vec3.fromValues(He,tt,e[s+2]),Ot=V,kt=_slicedToArray(Ot,2),nr=kt[0],mr=kt[1],Gr=vec3.fromValues(nr,mr,e[p+2]),ln=J,Tr=_slicedToArray(ln,2),An=Tr[0],Rn=Tr[1],di=vec3.fromValues(An,Rn,e[m+2]);vec3.sub(g,di,Gr),vec3.sub(x,at,Gr),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[p]+=g[0],a[p+1]+=g[1],a[p+2]+=g[2],a[m]+=g[0],a[m+1]+=g[1],a[m+2]+=g[2]}return jE(a),a}function jE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function OP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function VE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=pd[e]?pd[e]():pd.circle(),n=i.indexOf(e)===-1?kE([r]):LE([r]);return n}function Zv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function RP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function LP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function GE(e){var i=HE();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function HE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,XE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,YE=function(e){(0,sn.Z)(r,e);var i=GE(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"cityCenter",void 0),(0,I.Z)((0,de.Z)(n),"cityMinSize",void 0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.baseColor,g=m===void 0?"rgb(16,16,16)":m,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,w=a.windowColor,R=w===void 0?"rgb(30,60,89)":w,D=a.time,V=D===void 0?0:D,J=a.sweep,te=J===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:J;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:ke(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:p,u_baseColor:ke(g),u_brightColor:ke(C),u_windowColor:ke(R),u_time:this.layer.getLayerAnimateTime()||V}}},{key:"calCityGeo",value:function(){var a=(0,$.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],m=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(m+s)/2,(g+p)/2]);var x=this.mapService.lngLatToCoord([m,g]),C=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var w=m-s,R=g-p;this.cityCenter=[(m+s)/2,(g+p)/2],this.cityMinSize=Math.sqrt(Math.pow(w,2)+Math.pow(R,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:XE,fragmentShader:WE,triangulation:dy,cull:{enable:!0,face:G.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,p,m,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,p,m,g){var x=s.size;return[m[3],m[4]]}}})}}]),r}(jo);function qE(e){var i=KE();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function KE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $E=function(e){(0,sn.Z)(r,e);var i=qE(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"type","PolygonLayer"),n}return(0,Tt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new YE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(wh);function QE(e){var i=JE();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,tS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,rS=function(e){(0,sn.Z)(r,e);var i=QE(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:eS,fragmentShader:tS,triangulation:vy,depth:{enable:!1},primitive:G.TRIANGLES,blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,p){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(jo);function nS(e){var i=iS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function iS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,oS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,sS=function(e){(0,sn.Z)(r,e);var i=nS(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:aS,fragmentShader:oS,triangulation:fy,depth:{enable:!0},blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,p,m,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,p){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(jo);function uS(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,m=e/2,g=i/2,x=0;x<p;x++)for(var C=x-g,w=0;w<s;w++){var R=w-m;n.push(R/m,-C/g,0),a.push(w/e),a.push(1-x/i)}for(var D=0;D<i;D++)for(var V=0;V<e;V++){var J=V+s*D,te=V+s*(D+1),Se=V+1+s*(D+1),He=V+1+s*D;r.push(J,te,He),r.push(te,Se,He)}return{vertices:n,indices:r,uvs:a}}var yy,_y;function xy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function by(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lS(e){var i=cS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function cS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,pS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,hS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,dS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,vS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,mS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Ey=(yy=(0,jr.b2)(),yy(_y=function(e){(0,sn.Z)(r,e);var i=lS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"colorTexture",void 0),(0,I.Z)((0,de.Z)(n),"heatmapFramerBuffer",void 0),(0,I.Z)((0,de.Z)(n),"intensityModel",void 0),(0,I.Z)((0,de.Z)(n),"colorModel",void 0),(0,I.Z)((0,de.Z)(n),"shapeType",void 0),n}return(0,Tt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,m=s.useFramebuffer;m(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,m=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,w=this.styleAttributeService.getLayerStyleAttribute("shape"),R=(w==null||(a=w.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=R,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=R==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var D=g(),V=D.width,J=D.height;return this.heatmapFramerBuffer=p({color:x({width:Math.floor(V/4),height:Math.floor(J/4),wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Dn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,p,m,g){return[m[3],m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:mS,fragmentShader:vS,triangulation:UE,depth:{enable:!1},cull:{enable:!0,face:Or(this.mapService.version)},blend:{enable:!0,func:{srcRGB:G.ONE,srcAlpha:1,dstRGB:G.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;this.shaderModuleService.registerModule("heatmapColor",{vs:dS,fs:hS});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,w=x.fs,R=x.uniforms,D=this.rendererService,V=D.createAttribute,J=D.createElements,te=D.createBuffer,Se=D.createModel;return Se({vs:C,fs:w,attributes:{a_Position:V({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:G.FLOAT}),size:3}),a_Uv:V({buffer:te({data:[0,1,1,1,0,0,1,0],type:G.FLOAT}),size:2})},uniforms:by({},R),depth:{enable:!1},blend:this.getBlend(),count:6,elements:J({data:[0,2,1,2,3,1],type:G.UNSIGNED_INT,count:6}),stencil:Pt(p,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,m=p===void 0?10:p,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:m}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=Fr();fr(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ar.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=this.rendererService.getViewportSize,C=x(),w=C.width,R=C.height,D=uS(w/4,R/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:pS,fs:fS});var V=this.shaderModuleService.getModule("heatmap3dColor"),J=V.vs,te=V.fs,Se=V.uniforms,He=this.rendererService,tt=He.createAttribute,at=He.createElements,Ot=He.createBuffer,kt=He.createModel;return kt({vs:J,fs:te,attributes:{a_Position:tt({buffer:Ot({data:D.vertices,type:G.FLOAT}),size:3}),a_Uv:tt({buffer:Ot({data:D.uvs,type:G.FLOAT}),size:2})},primitive:G.TRIANGLES,uniforms:by({},Se),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:G.SRC_ALPHA,srcAlpha:1,dstRGB:G.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:at({data:D.indices,type:G.UNSIGNED_INT,count:D.indices.length}),stencil:Pt(p,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,m=Je(p);this.colorTexture=a({data:new Uint8Array(m.data),width:m.width,height:m.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.NEAREST,mag:G.NEAREST,flipY:!1})}}]),r}(jo))||_y);function gS(e){var i=yS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function yS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _S=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,xS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,bS=function(e){(0,sn.Z)(r,e);var i=gS(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:xS,fragmentShader:_S,triangulation:vy,depth:{enable:!1},primitive:G.TRIANGLES,blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,p){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(jo),ES={heatmap:Ey,heatmap3d:Ey,grid:rS,grid3d:sS,hexagon:bS},SS=ES;function CS(e){var i=AS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function AS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=function(e){(0,sn.Z)(r,e);var i=CS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"type","HeatMapLayer"),n}return(0,Tt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new SS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),m=p.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(m==null?void 0:m.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(m==null?void 0:m.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(wh);function TS(e){var i=MS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,IS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,OS=function(e){(0,sn.Z)(r,e);var i=TS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,m=p===void 0?!1:p,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),w=this.rendererService.createTexture2D;if(this.texture=w({height:0,width:0}),Po){var R=this.layerService.sceneService.getSceneConfig().canvas,D=R.createImage();D.crossOrigin="anonymous",D.src=C.data.originData,D.onload=function(){a.texture=w({data:D,width:D.width,height:D.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(V){a.texture=w({data:V[0],width:V[0].width,height:V[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:IS,fragmentShader:PS,triangulation:gy,primitive:G.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Pt(m,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,p,m,g){return[m[3],m[4]]}}})}}]),r}(jo),RS={image:OS},LS=RS;function kS(e){var i=DS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=function(e){(0,sn.Z)(r,e);var i=kS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"type","ImageLayer"),n}return(0,Tt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new LS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(wh);function BS(e){var i=NS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function NS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zS=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,US=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ZS=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,jS=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,VS=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,GS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,HS={solid:0,dash:1},WS=function(e){(0,sn.Z)(r,e);var i=BS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,R=a.dashArray,D=R===void 0?[10,5]:R,V=a.forward,J=V===void 0?!0:V,te=a.lineTexture,Se=te===void 0?!1:te,He=a.iconStep,tt=He===void 0?100:He,at=a.segmentNumber,Ot=at===void 0?30:at,kt=a.thetaOffset,nr=kt===void 0?.314:kt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:nr})){this.judgeStyleAttributes({opacity:s,thetaOffset:nr});var mr=this.layer.getEncodedData(),Gr=this.calDataFrame(this.cellLength,mr,this.cellProperties),ln=Gr.data,Tr=Gr.width,An=Gr.height;this.rowCount=An,this.dataTexture=this.cellLength>0&&ln.length>0?this.createTexture2D({flipY:!0,data:ln,format:G.LUMINANCE,type:G.FLOAT,width:Tr,height:An}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}D.length===2&&D.push(0,0);var Rn=0,di=[0,0,0,0],mo=[0,0,0,0];return p&&m&&(di=ke(p),mo=ke(m),Rn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:xa()(nr)?nr:0,u_opacity:xa()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ot,u_line_type:HS[w||"solid"],u_dash_array:D,u_blur:.9,u_lineDir:J?1:-1,u_texture:this.texture,u_line_texture:Se?1:0,u_icon_step:tt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Rn,u_sourceColor:di,u_targetColor:mo}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,m=a.lineType;return m==="dash"?{frag:zS,vert:US,type:"dash"}:s&&p?{frag:VS,vert:GS,type:"linear"}:{frag:ZS,vert:jS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,m=a.mask,g=m===void 0?!1:m,x=a.maskInside,C=x===void 0?!0:x,w=this.getShaders(),R=w.frag,D=w.vert,V=w.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+V,vertexShader:D,fragmentShader:R,triangulation:Uv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Pt(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(p,m,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=a.iconService.getIconMap(),w=p.texture,R=C[w]||{x:0,y:0},D=R.x,V=R.y;return[D,V]}}})}}]),r}(jo);function XS(e){var i=YS();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function YS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,KS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,$S=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,QS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,JS={solid:0,dash:1},eC=function(e){(0,sn.Z)(r,e);var i=XS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,R=a.dashArray,D=R===void 0?[10,5]:R,V=a.lineTexture,J=V===void 0?!1:V,te=a.iconStep,Se=te===void 0?100:te,He=a.segmentNumber,tt=He===void 0?30:He,at=a.globalArcHeight,Ot=at===void 0?10:at;D.length===2&&D.push(0,0);var kt=0,nr=[0,0,0,0],mr=[0,0,0,0];if(p&&m&&(nr=ke(p),mr=ke(m),kt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Gr=this.layer.getEncodedData(),ln=this.calDataFrame(this.cellLength,Gr,this.cellProperties),Tr=ln.data,An=ln.width,Rn=ln.height;this.rowCount=Rn,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:G.LUMINANCE,type:G.FLOAT,width:An,height:Rn}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ty,u_global_height:Ot,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:tt,u_line_type:JS[w]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:kt,u_sourceColor:nr,u_targetColor:mr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,m=a.lineType;return s&&p?{frag:$S,vert:QS,type:"linear"}:{frag:qS,vert:KS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,m=a.mask,g=m===void 0?!1:m,x=a.maskInside,C=x===void 0?!0:x,w=this.getShaders(),R=w.frag,D=w.vert,V=w.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+V,vertexShader:D,fragmentShader:R,triangulation:Uv,blend:this.getBlend(),segmentNumber:p,stencil:Pt(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(p,m,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=a.iconService.getIconMap(),w=p.texture,R=C[w]||{x:0,y:0},D=R.x,V=R.y;return[D,V]}}})}}]),r}(jo);function tC(e){var i=rC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,iC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,aC=function(e){(0,sn.Z)(r,e);var i=tC(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,g=a.forward,x=g===void 0?!0:g,C=a.segmentNumber,w=C===void 0?30:C,R=a.thetaOffset,D=R===void 0?.314:R,V=0,J=[0,0,0,0],te=[0,0,0,0];return p&&m&&(J=ke(p),te=ke(m),V=1),{u_thetaOffset:D,u_opacity:xa()(s)?s:1,segmentNumber:w,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:V,u_sourceColor:J,u_targetColor:te}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:iC,fragmentShader:nC,triangulation:Uv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(s,p,m,g){return[m[3],m[4],m[5],m[6]]}}})}}]),r}(jo);function oC(e){var i=sC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function sC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,lC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,cC={solid:0,dash:1},fC=function(e){(0,sn.Z)(r,e);var i=oC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,R=a.dashArray,D=R===void 0?[10,5]:R,V=a.lineTexture,J=V===void 0?!1:V,te=a.iconStep,Se=te===void 0?100:te,He=a.segmentNumber,tt=He===void 0?30:He;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var at=0,Ot=[0,0,0,0],kt=[0,0,0,0];if(p&&m&&(Ot=ke(p),kt=ke(m),at=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var nr=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,nr,this.cellProperties),Gr=mr.data,ln=mr.width,Tr=mr.height;this.rowCount=Tr,this.dataTexture=this.cellLength>0&&Gr.length>0?this.createTexture2D({flipY:!0,data:Gr,format:G.LUMINANCE,type:G.FLOAT,width:ln,height:Tr}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:tt,u_line_type:cC[w]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:at,u_sourceColor:Ot,u_targetColor:kt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:lC,fragmentShader:uC,triangulation:Uv,depth:{enable:!1},blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(p,m,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=a.iconService.getIconMap(),w=p.texture,R=C[w]||{x:0,y:0},D=R.x,V=R.y;return[D,V]}}})}}]),r}(jo);function pC(e){var i=hC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function hC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,vC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,mC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Sy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,gC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,yC={solid:0,dash:1},Cy=function(e){(0,sn.Z)(r,e);var i=pC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,R=a.dashArray,D=R===void 0?[10,5,0,0]:R,V=a.lineTexture,J=V===void 0?!1:V,te=a.iconStep,Se=te===void 0?100:te,He=a.vertexHeightScale,tt=He===void 0?20:He,at=a.borderWidth,Ot=at===void 0?0:at,kt=a.borderColor,nr=kt===void 0?"#ccc":kt,mr=a.raisingHeight,Gr=mr===void 0?0:mr,ln=a.heightfixed,Tr=ln===void 0?!1:ln;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var An=0,Rn=[0,0,0,0],di=[0,0,0,0];if(p&&m&&(Rn=ke(p),di=ke(m),An=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var mo=this.layer.getEncodedData(),wo=this.calDataFrame(this.cellLength,mo,this.cellProperties),qs=wo.data,Pu=wo.width,iu=wo.height;this.rowCount=iu,this.dataTexture=this.cellLength>0&&qs.length>0?this.createTexture2D({flipY:!0,data:qs,format:G.LUMINANCE,type:G.FLOAT,width:Pu,height:iu}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:yC[w],u_dash_array:D,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Ot,u_borderColor:ke(nr),u_linearColor:An,u_sourceColor:Rn,u_targetColor:di,u_heightfixed:Number(Tr),u_vertexScale:tt,u_raisingHeight:Number(Gr)}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=a.depth,C=x===void 0?!1:x,w=this.getShaders(),R=w.frag,D=w.vert,V=w.type;return[this.layer.buildLayerModel({moduleName:"line_"+V,vertexShader:D,fragmentShader:R,triangulation:hy,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Pt(p,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,m=a.lineType;return m==="dash"?{frag:dC,vert:vC,type:"dash"}:s&&p?{frag:gC,vert:Sy,type:"linear"}:{frag:mC,vert:Sy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Dn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Dn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(p,m,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Dn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=a.iconService.getIconMap(),w=p.texture,R=C[w]||{x:0,y:0},D=R.x,V=R.y;return[D,V]}}})}}]),r}(jo);function _C(e){var i=xC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,EC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Ay=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,SC=function(e){(0,sn.Z)(r,e);var i=_C(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,g=a.vertexHeightScale,x=g===void 0?20:g,C=0,w=[0,0,0,0],R=[0,0,0,0];if(p&&m&&(w=ke(p),R=ke(m),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var D=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,D,this.cellProperties),J=V.data,te=V.width,Se=V.height;this.rowCount=Se,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:G.LUMINANCE,type:G.FLOAT,width:te,height:Se}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(s)?s:1,u_linearColor:C,u_sourceColor:w,u_targetColor:R,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor;return s&&p?{frag:bC,vert:Ay,type:"linear"}:{frag:EC,vert:Ay,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=this.getShaders(),C=x.frag,w=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+R,vertexShader:w,fragmentShader:C,triangulation:BE,primitive:G.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Pt(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Dn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Dn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,p,m,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,p,m,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Dn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){return[m[4]]}}})}}]),r}(jo);function CC(e){var i=AC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,TC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,MC=function(e){(0,sn.Z)(r,e);var i=CC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.heightfixed,w=C===void 0?!1:C,R=a.lineTexture,D=R===void 0?!1:R,V=a.iconStep,J=V===void 0?100:V,te=a.iconStepCount,Se=te===void 0?1:te;this.rendererService.getDirty()&&this.texture.bind();var He=0,tt=[0,0,0,0],at=[0,0,0,0];if(p&&m&&(tt=ke(p),at=ke(m),He=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ot=this.layer.getEncodedData(),kt=this.calDataFrame(this.cellLength,Ot,this.cellProperties),nr=kt.data,mr=kt.width,Gr=kt.height;this.rowCount=Gr,this.dataTexture=this.cellLength>0&&nr.length>0?this.createTexture2D({flipY:!0,data:nr,format:G.LUMINANCE,type:G.FLOAT,width:mr,height:Gr}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_heightfixed:Number(w),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:D?1:0,u_iconStepCount:Se,u_icon_step:J,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:He,u_sourceColor:tt,u_targetColor:at}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:TC,fragmentShader:wC,triangulation:hy,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.lineType,m=p===void 0?"solid":p;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Dn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(x,C,w,R){return[w[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Dn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(x,C,w,R){return[w[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(x,C,w,R){var D=x.size,V=D===void 0?1:D;return Array.isArray(V)?[V[0],V[1]]:[V,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(x,C,w,R,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Dn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(x,C,w,R){return[w[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(x,C,w,R){var D=a.iconService.getIconMap(),V=x.texture,J=D[V]||{x:0,y:0},te=J.x,Se=J.y;return[te,Se]}}})}}]),r}(jo),PC={arc:WS,arcmini:aC,arc3d:eC,greatcircle:fC,wall:MC,line:Cy,simple:SC},IC=PC;function OC(e){var i=RC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=function(e){(0,sn.Z)(r,e);var i=OC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"type","LineLayer"),n}return(0,Tt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new IC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(wh);function kC(e){var i=DC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,BC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,wy=function(e){(0,sn.Z)(r,e);var i=kC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"raiseCount",0),(0,I.Z)((0,de.Z)(n),"raiserepeat",0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,m=a.opacity,g=m===void 0?1:m,x=a.sourceColor,C=a.targetColor,w=a.pickLight,R=w===void 0?!1:w,D=a.heightfixed,V=D===void 0?!1:D,J=a.opacityLinear,te=J===void 0?{enable:!1,dir:"up"}:J,Se=a.lightEnable,He=Se===void 0?!0:Se;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var tt=this.layer.getEncodedData(),at=this.calDataFrame(this.cellLength,tt,this.cellProperties),Ot=at.data,kt=at.width,nr=at.height;this.rowCount=nr,this.dataTexture=this.cellLength>0&&Ot.length>0?this.createTexture2D({flipY:!0,data:Ot,format:G.LUMINANCE,type:G.FLOAT,width:kt,height:nr}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}var mr=0,Gr=[0,0,0,0],ln=[0,0,0,0];if(x&&C&&(Gr=ke(x),ln=ke(C),mr=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var Tr=p.speed,An=Tr===void 0?.01:Tr,Rn=p.repeat,di=Rn===void 0?!1:Rn;this.raiseCount+=An,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(R),u_heightfixed:Number(V),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(g)?g:1,u_linearColor:mr,u_sourceColor:Gr,u_targetColor:ln,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(He)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,m=a.animateOption.repeat,g=m===void 0?1:m;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:BC,fragmentShader:FC,triangulation:fy,blend:this.getBlend(),cull:{enable:!0,face:Or(this.mapService.version)},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(p,m,g,x){var C=p.size;if(C){var w=[];return Array.isArray(C)&&(w=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(w=[C,C,C]),w}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(p,m,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(p,m){var g=Th(p.coordinates);return a?ny([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(jo),Mu;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Mu||(Mu={}));function NC(e){var i=zC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function zC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ty=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    gl_FragColor = filterColorAnimate(gl_FragColor);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,UC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,N0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,My=function(e){(0,sn.Z)(r,e);var i=NC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"meter2coord",1),(0,I.Z)((0,de.Z)(n),"isMeter",!1),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.strokeOpacity,g=m===void 0?1:m,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,R=w===void 0?"rgba(0,0,0,0)":w,D=a.offsets,V=D===void 0?[0,0]:D,J=a.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:V})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:V});var te=this.layer.getEncodedData(),Se=this.calDataFrame(this.cellLength,te,this.cellProperties),He=Se.data,tt=Se.width,at=Se.height;this.rowCount=at,this.dataTexture=this.cellLength>0&&He.length>0?this.createTexture2D({flipY:!0,data:He,format:G.LUMINANCE,type:G.FLOAT,width:tt,height:at}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:J==="additive"?1:0,u_globel:this.mapService.version===Mu.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(p)?p:1,u_stroke_opacity:xa()(g)?g:1,u_stroke_width:xa()(C)?C:0,u_stroke_color:this.getStrokeColor(R),u_offsets:this.isOffsetStatic(V)?V:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),hd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,m=this.mapService.version;return p==="meter"&&m!==Mu.L7MAP&&m!==Mu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,$.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],m=a[2],g=a[3],x=[(s+m)/2,(p+g)/2],C=this.mapService.version;if(C===Mu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,D=R*w.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(w.x-D,w.y,w.z),J=V.toLngLat();this.meter2coord=x[0]-J.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[m===s?m+.1:m,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=a.animateOption,C=x===void 0?{enable:!1}:x,w=this.getShaders(C),R=w.frag,D=w.vert,V=w.type,J=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill_"+V,vertexShader:D,fragmentShader:R,triangulation:J?FE:hd,depth:{enable:J},blend:this.getBlend(),stencil:Pt(p,g),cull:{enable:!0,face:Or(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:Ty,vert:N0,type:"wave"};default:return{frag:Ty,vert:N0,type:"wave"}}else return{frag:UC,vert:N0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Dn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(m,g,x,C){var w;if(s){var R=(0,$.Z)(x,3),D=R[0],V=R[1],J=R[2],te=Ja.fromValues(0,0,1),Se=Ja.fromValues(D,0,J),He=D>=0?Ja.angle(te,Se):Math.PI*2-Ja.angle(te,Se),tt=Math.PI*2-Math.asin(V/100),at=Fr();Ar(at,at,He),Vr(at,at,tt);var Ot=Ja.fromValues(1,1,0);Ja.transformMat4(Ot,Ot,at),Ja.normalize(Ot,Ot);var kt=Ja.fromValues(-1,1,0);Ja.transformMat4(kt,kt,at),Ja.normalize(kt,kt);var nr=Ja.fromValues(-1,-1,0);Ja.transformMat4(nr,nr,at),Ja.normalize(nr,nr);var mr=Ja.fromValues(1,-1,0);Ja.transformMat4(mr,mr,at),Ja.normalize(mr,mr),w=[].concat((0,ar.Z)(Ot),(0,ar.Z)(kt),(0,ar.Z)(nr),(0,ar.Z)(mr))}else w=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Gr=C%4*3;return[w[Gr],w[Gr+1],w[Gr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(m,g,x,C){var w=m.size,R=w===void 0?5:w;return Array.isArray(R)?[R[0]*a.meter2coord]:[R*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Dn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(m,g,x,C){var w=m.shape,R=w===void 0?2:w,D=a.layer.getLayerConfig().shape2d,V=D.indexOf(R);return[V]}}})}}]),r}(jo);function ZC(e){var i=jC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,GC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,HC=function(e){(0,sn.Z)(r,e);var i=ZC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"meter2coord",1),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"isMeter",!1),(0,I.Z)((0,de.Z)(n),"radian",0),(0,I.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=m({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.strokeOpacity,g=m===void 0?1:m,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,R=w===void 0?"rgba(0,0,0,0)":w,D=a.offsets,V=D===void 0?[0,0]:D,J=a.blend,te=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var Se=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(Se=-1),this.radian=te!==void 0?Se*Math.PI*te/180:Se*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:V})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:V});var He=this.layer.getEncodedData(),tt=this.calDataFrame(this.cellLength,He,this.cellProperties),at=tt.data,Ot=tt.width,kt=tt.height;this.rowCount=kt,this.dataTexture=this.cellLength>0&&at.length>0?this.createTexture2D({flipY:!0,data:at,format:G.LUMINANCE,type:G.FLOAT,width:Ot,height:kt}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:J==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:xa()(p)?p:1,u_offsets:this.isOffsetStatic(V)?V:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),hd)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,m=this.mapService.version;return p==="meter"&&m!==Mu.L7MAP&&m!==Mu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,$.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],m=a[2],g=a[3],x=[(s+m)/2,(p+g)/2],C=this.mapService.version;if(C===Mu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,D=R*w.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(w.x-D,w.y,w.z),J=V.toLngLat();this.meter2coord=x[0]-J.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[m===s?m+.1:m,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=this.getShaders(),C=x.frag,w=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:w,fragmentShader:C,triangulation:hd,depth:{enable:!1},blend:this.getBlend(),stencil:Pt(p,g),cull:{enable:!0,face:Or(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:VC,vert:GC,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Dn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.rotate,w=C===void 0?0:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=a.iconService.getIconMap(),w=p.shape,R=C[w]||{x:0,y:0},D=R.x,V=R.y;return[D,V]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Dn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(p,m,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=x%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}})}}]),r}(jo);function WC(e){var i=XC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function XC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,qC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,KC=function(e){(0,sn.Z)(r,e);var i=WC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:qC,fragmentShader:YC,triangulation:py,primitive:G.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=a.fontService.mapping,w=p.shape,R=a.fontService.getGlyph(w),D=C[R],V=D.x,J=D.y;return[V,J]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:G.LINEAR,min:G.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,m=p===void 0?"normal":p,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),w=[];C.forEach(function(R){var D=R.shape,V=D===void 0?"":D;V=V.toString();var J=a.fontService.getGlyph(V);w.indexOf(J)===-1&&w.push(J)}),this.fontService.setFontOptions({characterSet:w,fontWeight:m,fontFamily:x,fontSize:48})}}]),r}(jo);function $C(e){var i=QC();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,eA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Py=function(e){(0,sn.Z)(r,e);var i=$C(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=m({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,m=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:m})){this.judgeStyleAttributes({opacity:s,offsets:m});var g=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,g,this.cellProperties),C=x.data,w=x.width,R=x.height;this.rowCount=R,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:G.LUMINANCE,type:G.FLOAT,width:w,height:R}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:xa()(s)?s:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:eA,fragmentShader:JC,triangulation:py,primitive:G.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(p,m,g,x){var C=a.iconService.getIconMap(),w=p.shape,R=C[w]||{x:0,y:0},D=R.x,V=R.y;return[D,V]}}})}}]),r}(jo);function tA(e){var i=rA();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function rA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,iA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function aA(e){var i=e.coordinates;return{vertices:(0,ar.Z)(i),indices:[0],size:i.length}}var Iy=function(e){(0,sn.Z)(r,e);var i=tA(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.offsets,g=m===void 0?[0,0]:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),w=C.data,R=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:G.LUMINANCE,type:G.FLOAT,width:R,height:D}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:iA,fragmentShader:nA,triangulation:aA,depth:{enable:!1},primitive:G.POINTS,blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:_c.additive}}}]),r}(jo);function oA(e){var i=sA();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function sA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,lA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,cA=function(e){(0,sn.Z)(r,e);var i=oA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"meter2coord",1),(0,I.Z)((0,de.Z)(n),"isMeter",!1),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.strokeOpacity,g=m===void 0?1:m,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,R=w===void 0?"rgba(0,0,0,0)":w,D=a.offsets,V=D===void 0?[0,0]:D,J=a.blend,te=a.speed,Se=te===void 0?1:te;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:V})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:V});var He=this.layer.getEncodedData(),tt=this.calDataFrame(this.cellLength,He,this.cellProperties),at=tt.data,Ot=tt.width,kt=tt.height;this.rowCount=kt,this.dataTexture=this.cellLength>0&&at.length>0?this.createTexture2D({flipY:!0,data:at,format:G.LUMINANCE,type:G.FLOAT,width:Ot,height:kt}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:Se,u_additive:J==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(p)?p:1,u_offsets:this.isOffsetStatic(V)?V:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),hd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,m=this.mapService.version;return p==="meter"&&m!==Mu.L7MAP&&m!==Mu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,$.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],m=a[2],g=a[3],x=[(s+m)/2,(p+g)/2],C=this.mapService.version;if(C===Mu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,D=R*w.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(w.x-D,w.y,w.z),J=V.toLngLat();this.meter2coord=x[0]-J.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[m===s?m+.1:m,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=this.getShaders(),C=x.frag,w=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:w,fragmentShader:C,triangulation:hd,depth:{enable:!1},blend:this.getBlend(),stencil:Pt(p,g),cull:{enable:!0,face:Or(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:uA,vert:lA,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Dn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(p,m,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var w=x%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Dn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(p,m,g,x){var C=p.shape,w=C===void 0?2:C,R=a.layer.getLayerConfig().shape2d,D=R.indexOf(w);return[D]}}})}}]),r}(jo);function fA(e){var i=pA();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function pA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,dA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function vA(e){var i=e.coordinates;return{vertices:(0,ar.Z)(i),indices:[0],size:i.length}}var mA=function(e){(0,sn.Z)(r,e);var i=fA(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.offsets,g=m===void 0?[0,0]:m,x=a.blend,C=a.strokeOpacity,w=C===void 0?1:C,R=a.strokeWidth,D=R===void 0?0:R,V=a.stroke,J=V===void 0?"#fff":V;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var te=this.layer.getEncodedData(),Se=this.calDataFrame(this.cellLength,te,this.cellProperties),He=Se.data,tt=Se.width,at=Se.height;this.rowCount=at,this.dataTexture=this.cellLength>0&&He.length>0?this.createTexture2D({flipY:!0,data:He,format:G.LUMINANCE,type:G.FLOAT,width:tt,height:at}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:xa()(w)?w:1,u_stroke_width:xa()(D)?D:0,u_stroke_color:this.getStrokeColor(J)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:dA,fragmentShader:hA,triangulation:vA,depth:{enable:!1},primitive:G.POINTS,blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:_c.additive}}}]),r}(jo);function gA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function yA(e,i){if(!!e){if(typeof e=="string")return Oy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Oy(e,i)}}function Oy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var _A=function(){function e(i,r,n){(0,ot.Z)(this,e),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Tt.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,m){this.boxCells[p].push(m)}},{key:"queryHitTest",value:function(r,n,a,s,p,m){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return m?g.filter(m):g}var C={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,m),p?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,p,m,g,x){var C=g.seenUids,w=this.boxCells[p];if(w!==null){var R=this.bboxes,D=gA(w),V;try{for(D.s();!(V=D.n()).done;){var J=V.value;if(!C.box[J]){C.box[J]=!0;var te=J*4;if(r<=R[te+2]&&n<=R[te+3]&&a>=R[te+0]&&s>=R[te+1]&&(!x||x(this.boxKeys[J]))){if(g.hitTest)return m.push(!0),!0;m.push({key:this.boxKeys[J],x1:R[te],y1:R[te+1],x2:R[te+2],y2:R[te+3]})}}}}catch(Se){D.e(Se)}finally{D.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,m,g,x){for(var C=this.convertToXCellCoord(r),w=this.convertToYCellCoord(n),R=this.convertToXCellCoord(a),D=this.convertToYCellCoord(s),V=C;V<=R;V++)for(var J=w;J<=D;J++){var te=this.xCellCount*J+V;if(p.call(this,r,n,a,s,te,m,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),xA=_A,bA=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new xA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Tt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=Cu(n,a,0,1),p=ws(),m=st.apply(le,(0,ar.Z)(r));return b(p,s,m),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function Ry(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=EA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function EA(e,i){if(!!e){if(typeof e=="string")return Ly(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ly(e,i)}}function Ly(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ky(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Dy(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var m=i[p].advance*s.scale,g=(e[n].x+m)*a,x=r;x<=n;x++)e[x].x-=g}}function Fy(e,i,r,n,a,s,p){var m=(i-r)*a,g=(-n*p+.5)*s,x=Ry(e),C;try{for(x.s();!(C=x.n()).done;){var w=C.value;w.x+=m,w.y+=g}}catch(R){x.e(R)}finally{x.f()}}function SA(e,i,r,n,a,s,p){var m=-8,g=0,x=m,C=0,w=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,D=w.length;r.forEach(function(He){if(He.split("").forEach(function(at){var Ot=i[at],kt=0;Ot&&(w.push({glyph:at,x:g,y:x+kt,vertical:!1,scale:1,metrics:Ot}),g+=Ot.advance+p)}),w.length!==D){var tt=g-p;C=Math.max(tt,C),Dy(w,i,D,w.length-1,R)}g=0,x-=n+5});var V=ky(a),J=V.horizontalAlign,te=V.verticalAlign;Fy(w,R,J,te,C,n,r.length);var Se=x-m;e.top+=-te*Se,e.bottom=e.top-Se,e.left+=-J*C,e.right=e.left+C}function CA(e,i,r,n,a,s,p){var m=-8,g=0,x=m,C=0,w=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,D=w.length;r.forEach(function(He){var tt=i[He],at=0;if(tt&&(w.push({glyph:He,x:tt.advance/2,y:x+at,vertical:!1,scale:1,metrics:tt}),g+=tt.advance+p),w.length!==D){var Ot=g-p;C=Math.max(Ot,C),Dy(w,i,D,w.length-1,R)}g=0,x-=n+5});var V=ky(a),J=V.horizontalAlign,te=V.verticalAlign;Fy(w,R,J,te,C,n,r.length);var Se=x-m;e.top+=-te*Se,e.bottom=e.top-Se,e.left+=-J*C,e.right=e.left+C}function AA(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],m=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:g.length,text:e};return m?CA(C,i,g,r,n,a,s):SA(C,i,g,r,n,a,s),x.length?C:!1}function wA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=Ry(a),m;try{for(p.s();!(m=p.n()).done;){var g=m.value,x=g.metrics,C=4,w=x.advance*g.scale/2,R=r?[g.x+w,g.y]:[0,0],D=r?[0,0]:[g.x+w+i[0],g.y+i[1]],V=(0-C)*g.scale-w+D[0],J=(0-C)*g.scale+D[1],te=V+x.width*g.scale,Se=J+x.height*g.scale,He={x:V,y:J},tt={x:te,y:J},at={x:V,y:Se},Ot={x:te,y:Se};s.push({tl:He,tr:tt,bl:at,br:Ot,tex:x,glyphOffset:R})}}catch(kt){p.e(kt)}finally{p.f()}return s}function TA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=MA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function MA(e,i){if(!!e){if(typeof e=="string")return By(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return By(e,i)}}function By(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function PA(e){var i=IA();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ny=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,zy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Uy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(m,g){n.push.apply(n,(0,ar.Z)(p).concat([m.tex.x,m.tex.y+m.tex.height,m.tl.x,m.tl.y],(0,ar.Z)(p),[m.tex.x+m.tex.width,m.tex.y+m.tex.height,m.tr.x,m.tr.y],(0,ar.Z)(p),[m.tex.x+m.tex.width,m.tex.y,m.br.x,m.br.y],(0,ar.Z)(p),[m.tex.x,m.tex.y,m.bl.x,m.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var Zy=function(e){(0,sn.Z)(r,e);var i=PA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"glyphInfo",void 0),(0,I.Z)((0,de.Z)(n),"glyphInfoMap",{}),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"currentZoom",-1),(0,I.Z)((0,de.Z)(n),"extent",void 0),(0,I.Z)((0,de.Z)(n),"textureHeight",0),(0,I.Z)((0,de.Z)(n),"textCount",0),(0,I.Z)((0,de.Z)(n),"preTextStyle",{}),(0,I.Z)((0,de.Z)(n),"buildModels",function(){var m=n.layer.getLayerConfig(),g=m.mask,x=g===void 0?!1:g,C=m.maskInside,w=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:zy,fragmentShader:Ny,triangulation:Uy.bind((0,de.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Pt(x,w)})]}),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.stroke,g=m===void 0?"#fff":m,x=a.strokeWidth,C=x===void 0?0:x,w=a.textAnchor,R=w===void 0?"center":w,D=a.textAllowOverlap,V=D===void 0?!1:D,J=a.halo,te=J===void 0?.5:J,Se=a.gamma,He=Se===void 0?2:Se,tt=a.raisingHeight,at=tt===void 0?0:tt,Ot=this.fontService,kt=Ot.canvas,nr=Ot.mapping;if(Object.keys(nr).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(nr).length),this.preTextStyle={textAnchor:R,textAllowOverlap:V},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:p,strokeWidth:C,stroke:g});var mr=this.layer.getEncodedData(),Gr=this.calDataFrame(this.cellLength,mr,this.cellProperties),ln=Gr.data,Tr=Gr.width,An=Gr.height;this.rowCount=An,this.dataTexture=this.cellLength>0&&ln.length>0?this.createTexture2D({flipY:!0,data:ln,format:G.LUMINANCE,type:G.FLOAT,width:Tr,height:An}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(at),u_opacity:xa()(p)?p:1,u_stroke_width:xa()(C)?C:0,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:He,u_sdf_map_size:[kt.width,kt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,m=a.textAllowOverlap,g=m===void 0?!0:m;return this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,m=this.mapService.getZoom(),g=this.mapService.getBounds(),x=c(this.extent,g);return!p&&(Math.abs(this.currentZoom-m)>1||!x)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Dn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Dn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,p,m,g){return[m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,p,m,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Dn.Attribute,descriptor:{name:"a_tex",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,p,m,g){return[m[3],m[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return f(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,m=a.fontFamily,g=m===void 0?"sans-serif":m,x=this.layer.getEncodedData(),C=[];x.forEach(function(w){var R=w.shape,D=R===void 0?"":R;D=D.toString();var V=TA(D),J;try{for(V.s();!(J=V.n()).done;){var te=J.value;C.indexOf(te)===-1&&C.push(te)}}catch(Se){V.e(Se)}finally{V.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,m=a.fontFamily,g=m===void 0?"sans-serif":m,x=this.layer.getEncodedData(),C=[];x.forEach(function(w){var R=w.shape,D=R===void 0?"":R;D="".concat(D),C.indexOf(D)===-1&&C.push(D)}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,m=this.layer.getLayerConfig(),g=m.spacing,x=g===void 0?2:g,C=m.textAnchor,w=C===void 0?"center":C,R=this.layer.getEncodedData();this.glyphInfo=R.map(function(D){var V=D.shape,J=V===void 0?"":V,te=D.id,Se=D.size,He=Se===void 0?1:Se,tt=D.textOffset,at=tt===void 0?[0,0]:tt,Ot=AA(J.toString(),p,He,w,"left",x,at,a),kt=wA(Ot,at,!1);return D.shaping=Ot,D.glyphQuads=kt,D.centroid=Th(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?Th(D.originCoordinates):D.originCentroid=D.centroid,s.glyphInfoMap[te]={shaping:Ot,glyphQuads:kt,centroid:Th(D.coordinates)},D})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,m=p===void 0?[4,4]:p,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),w=C.width,R=C.height,D=new bA(w,R),V=this.glyphInfo.filter(function(J){var te=J.shaping,Se=J.id,He=Se===void 0?0:Se,tt=J.version==="GAODE2.x"?J.originCentroid:J.centroid,at=J.size,Ot=at/24,kt=a.mapService.lngLatToContainer(tt),nr=D.placeCollisionBox({x1:te.left*Ot-m[0],x2:te.right*Ot+m[0],y1:te.top*Ot-m[1],y2:te.bottom*Ot+m[1],anchorPointX:kt.x,anchorPointY:kt.y}),mr=nr.box;return mr&&mr.length?(D.insertCollisionBox(mr,He),!0):!1});V.forEach(function(J){a.glyphInfoMap[J.id]=J})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:G.LINEAR,min:G.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:zy,fragmentShader:Ny,triangulation:Uy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Pt(p,g)})]}}]),r}(jo),OA={fillImage:HC,fill:My,radar:cA,image:Py,normal:Iy,simplePoint:mA,extrude:wy,text:Zy,icon:KC},RA=OA;function LA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,m=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function kA(e,i){if(!!e){if(typeof e=="string")return jy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jy(e,i)}}function jy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function DA(e){var i=FA();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function FA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BA=function(e){(0,sn.Z)(r,e);var i=DA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"type","PointLayer"),n}return(0,Tt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new RA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,p=a.values,m=this.getLayerConfig(),g=m.shape2d,x=m.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(p&&p instanceof Array){var w=LA(p),R;try{for(w.s();!(R=w.n()).done;){var D=R.value;if(typeof D=="string"&&C.hasOwnProperty(D))return"image"}}catch(V){w.e(V)}finally{w.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),p=this.getLayerConfig(),m=p.shape2d,g=p.shape3d,x=this.iconService.getIconMap(),C=s.find(function(R){return R.hasOwnProperty("shape")});if(C){var w=C.shape;return w==="dot"?"normal":w==="simple"?"simplePoint":w==="radar"?"radar":w==="fillImage"?"fillImage":(m==null?void 0:m.indexOf(w))!==-1?"fill":(g==null?void 0:g.indexOf(w))!==-1?"extrude":x.hasOwnProperty(w)?"image":this.fontService.getGlyph(w)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(wh);function NA(e){var i=zA();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function zA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ZA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,jA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
// varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    gl_FragColor = mix(u_targetColor, u_sourceColor, sidey);
  } else {
    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }

  // gl_FragColor = v_Color;
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,VA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  // float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  // v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,GA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,HA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,WA=function(e){(0,sn.Z)(r,e);var i=NA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.heightfixed,g=m===void 0?!1:m,x=a.raisingHeight,C=x===void 0?0:x,w=a.sourceColor,R=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var D=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,D,this.cellProperties),J=V.data,te=V.width,Se=V.height;this.rowCount=Se,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:G.LUMINANCE,type:G.FLOAT,width:te,height:Se}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}var He=[1,1,1,1],tt=[1,1,1,1];return w&&R&&(He=ke(w),tt=ke(R)),{u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:xa()(p)?p:1,u_sourceColor:He,u_targetColor:tt,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=this.getShaders(),C=x.frag,w=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:R,vertexShader:w,fragmentShader:C,triangulation:dy,stencil:Pt(p,g),cull:{enable:!0,face:G.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=a.mapTexture;return p?{frag:jA,vert:VA,type:"polygonExtrudeTexture"}:s?{frag:GA,vert:HA,type:"polygonExtrude"}:{frag:UA,vert:ZA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.mapTexture;if(s){var p=this.layer.getSource().extent,m=(0,$.Z)(p,4),g=m[0],x=m[1],C=m[2],w=m[3],R=C-g,D=w-x;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Dn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(J,te,Se,He,tt){var at=Se[0],Ot=Se[1];return[(at-g)/R,(Ot-x)/D,Se[4]]}}})}this.styleAttributeService.registerStyleAttribute({name:"normal",type:Dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(J,te,Se,He,tt){return tt}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(J,te,Se,He){var tt=J.size,at=tt===void 0?10:tt;return Array.isArray(at)?[at[0]]:[at]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mapTexture,m=this.rendererService.createTexture2D;if(this.texture=m({height:0,width:0}),p){var g=new Image;g.crossOrigin="",g.src=p,g.onload=function(){a.texture=m({data:g,width:g.width,height:g.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(jo);function XA(e){var i=YA();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,KA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$A=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,QA=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,JA=function(e){(0,sn.Z)(r,e);var i=XA(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.opacityLinear,g=m===void 0?{enable:!1,dir:"in"}:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),w=C.data,R=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:G.LUMINANCE,type:G.FLOAT,width:R,height:D}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(p)?p:1,u_opacitylinear:Number(g.enable),u_dir:g.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,m=a.mask,g=m===void 0?!1:m,x=a.maskInside,C=x===void 0?!0:x;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?$A:QA,fragmentShader:p.enable?KA:qA,triangulation:p.enable?NE:B0,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:G.BACK},stencil:Pt(g,C)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Dn.Attribute,descriptor:{name:"a_linear",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(g,x,C,w,R){return[C[3],C[4],C[5]]}}})}}]),r}(jo);function ew(e){var i=tw();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rw=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,nw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,iw=function(e){(0,sn.Z)(r,e);var i=ew(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture1",void 0),(0,I.Z)((0,de.Z)(n),"texture2",void 0),(0,I.Z)((0,de.Z)(n),"texture3",void 0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.watercolor,g=m===void 0?"#6D99A8":m,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var w=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,w,this.cellProperties),D=R.data,V=R.width,J=R.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:G.LUMINANCE,type:G.FLOAT,width:V,height:J}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:ke(g),u_watercolor2:ke(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:xa()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:nw,fragmentShader:rw,triangulation:B0,depth:{enable:!1},stencil:Pt(p,g)})]}},{key:"clearModels",value:function(){var a;this.texture1.destroy(),this.texture2.destroy(),this.texture3.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,$.Z)(a,4),p=s[0],m=s[1],g=s[2],x=s[3],C=g-p,w=x-m;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Dn.Attribute,descriptor:{name:"a_uv",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(D,V,J,te,Se){var He=(0,$.Z)(J,2),tt=He[0],at=He[1];return[(tt-p)/C,(at-m)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,p={height:0,width:0};this.texture1=s(p),this.texture2=s(p),this.texture3=s(p),m(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function m(x){var C=0,w=[],R=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];R.map(function(D){var V=new Image;V.crossOrigin="",V.src=D,w.push(V),V.onload=function(){C++,C===3&&x(w)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR})}}}]),r}(jo);function aw(e){var i=ow();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sw=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,uw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,lw=function(e){(0,sn.Z)(r,e);var i=aw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.speed,g=m===void 0?.5:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),w=C.data,R=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:G.LUMINANCE,type:G.FLOAT,width:R,height:D}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:xa()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:uw,fragmentShader:sw,triangulation:B0,depth:{enable:!1},stencil:Pt(p,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,$.Z)(a,4),p=s[0],m=s[1],g=s[2],x=s[3],C=g-p,w=x-m;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Dn.Attribute,descriptor:{name:"a_uv",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(D,V,J,te,Se){var He=(0,$.Z)(J,2),tt=He[0],at=He[1];return[(tt-p)/C,(at-m)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.waterTexture,m=this.rendererService.createTexture2D;this.texture=m({height:0,width:0});var g=new Image;g.crossOrigin="",p?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=p):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=m({data:g,width:g.width,height:g.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(jo),cw={fill:JA,line:Cy,extrude:WA,text:Zy,point_fill:My,point_image:Py,point_normal:Iy,point_extrude:wy,water:lw,ocean:iw},fw=cw;function pw(e){var i=hw();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vy=function(e){(0,sn.Z)(r,e);var i=pw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"type","PolygonLayer"),n}return(0,Tt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new fw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,m=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(w){return w.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(p==null?void 0:p.indexOf(C))!==-1?"point_fill":(m==null?void 0:m.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(wh);function dw(e){var i=vw();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,gw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Gy=function(e){(0,sn.Z)(r,e);var i=dw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"texture",void 0),(0,I.Z)((0,de.Z)(n),"colorTexture",void 0),n}return(0,Tt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.clampLow,g=m===void 0?!0:m,x=a.clampHigh,C=x===void 0?!0:x,w=a.noDataValue,R=w===void 0?-9999999:w,D=a.domain,V=D===void 0?[0,1]:D;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:V,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:R,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,g=m===void 0?!0:m,x=this.layer.getSource(),C=this.rendererService.createTexture2D,w=x.data.dataArray[0];this.texture=C({data:w.data,width:w.width,height:w.height,format:G.LUMINANCE,type:G.FLOAT});var R=this.layer.getLayerConfig(),D=R.rampColors,V=Je(D);return this.colorTexture=C({data:V.data,width:V.width,height:V.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:gw,fragmentShader:mw,triangulation:gy,primitive:G.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Pt(p,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,p,m,g){return[m[3],m[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,m=Je(p);this.colorTexture=a({data:m.data,width:m.width,height:m.height,flipY:!1})}}]),r}(jo),yw={raster:Gy,raster3d:Gy},_w=yw;function xw(e){var i=bw();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function bw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ew=function(e){(0,sn.Z)(r,e);var i=xw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,de.Z)(n),"type","RasterLayer"),n}return(0,Tt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new _w[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(wh),Hy,Wy,Xy,Yy,qy,ov,Ky,$y,Qy;function Jy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Cw=(Hy=(0,jr.b2)(),Wy=(0,jr.f3)(Ut.IGlobalConfigService),Xy=(0,jr.f3)(Ut.IMapService),Yy=(0,jr.f3)(Ut.IFontService),Hy(qy=(ov=function(){function e(){(0,ot.Z)(this,e),Sn(this,"configService",Ky,this),Sn(this,"mapService",$y,this),Sn(this,"fontService",Qy,this)}return(0,Tt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=m.filter(function(R){return R.needRemapping}),w=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(w=x.filter(function(R){return a.applyAttributeMapping(g,R,p)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(m,w,void 0,p)),g.needRemapping=!1):r.setEncodedData(a.mapping(C,w,r.getEncodedData(),p)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(w){return a.applyAttributeMapping(g,w,p)[0]})),r.setEncodedData(this.mapping(m,C,void 0,p)),r.emit("dataUpdate",null)}},{key:"mapping",value:function(r,n,a,s){var p=this,m=n.map(function(g,x){var C=a?a[x]:{},w=Sw({id:g._id,coordinates:g.coordinates},C);return r.filter(function(R){return R.scale!==void 0}).forEach(function(R){var D=p.applyAttributeMapping(R,g,s);R.needRemapping=!1,R.name==="color"&&(D=D.map(function(V){return ke(V)})),w[R.name]=Array.isArray(D)&&D.length===1?D[0]:D,R.name==="shape"&&(w.shape=p.fontService.getIconFontKey(w[R.name]))}),w});return this.adjustData2Amap2Coordinates(m),this.adjustData2SimpleCoordinates(m),m}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Mu["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Mu["GAODE2.x"],a.originCoordinates=Va()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Mu["GAODE2.x"],a.originCoordinates=Va()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Mu.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(p){var m=[];p.map(function(g){m.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(m)}),a}else{var s=[];return r.map(function(p){s.push(n.mapService.simpleMapCoord.unproject(p))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],m=[];p.forEach(function(x){var C,w=x.field;(n.hasOwnProperty(w)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&m.push(n[w])});var g=r.mapping?r.mapping(m):[];return r.name==="color"&&!Ie(g[0])?[a]:g}}]),e}(),Ky=oi(ov.prototype,"configService",[Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=oi(ov.prototype,"mapService",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=oi(ov.prototype,"fontService",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov))||qy),e_,t_,Aw=(e_=(0,jr.b2)(),e_(t_=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"mapService",void 0)}return(0,Tt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Ut.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Ad,options:wd},p=s.data,m=s.options;r.setSource(new du(p,m))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,m=p===void 0?0:p,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,w=r.dataState.dataSourceNeedUpdate;return a&&(w||Math.abs(r.clusterZoom-C)>=1)?(m!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||t_);function z0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function r_(e){return e.length===1&&(e=ww(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function ww(e){return function(i,r){return z0(e(i),r)}}var n_=r_(z0),Tw=n_.right,kP=n_.left,jv=Tw;function Mw(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var i_=Array.prototype,DP=i_.slice,FP=i_.map,U0=Math.sqrt(50),Z0=Math.sqrt(10),j0=Math.sqrt(2);function a_(e,i,r){var n,a=-1,s,p,m;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(m=Vv(e,i,r))===0||!isFinite(m))return[];if(m>0)for(e=Math.ceil(e/m),i=Math.floor(i/m),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*m;else for(e=Math.floor(e*m),i=Math.ceil(i*m),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/m;return n&&p.reverse(),p}function Vv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=U0?10:s>=Z0?5:s>=j0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=U0?10:s>=Z0?5:s>=j0?2:1)}function V0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=U0?a*=10:s>=Z0?a*=5:s>=j0&&(a*=2),i<e?-a:a}function BP(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,m,g=new Array(p);for(s=0;s<p;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],w=x[1],R=r(g,C,w);Array.isArray(R)||(R=tickStep(C,w,R),R=range(Math.ceil(C/R)*R,w,R));for(var D=R.length;R[0]<=C;)R.shift(),--D;for(;R[D-1]>w;)R.pop(),--D;var V=new Array(D+1),J;for(s=0;s<=D;++s)J=V[s]=[],J.x0=s>0?R[s-1]:C,J.x1=s<D?R[s]:w;for(s=0;s<p;++s)m=g[s],C<=m&&m<=w&&V[bisect(R,m,0,D)].push(a[s]);return V}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function NP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Pw(e){return e===null?NaN:+e}function Iw(e,i,r){if(r==null&&(r=Pw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),m=+r(e[s+1],s+1,e);return p+(m-p)*(a-s)}}var Ec="$";function Gv(){}Gv.prototype=o_.prototype={constructor:Gv,has:function(e){return Ec+e in this},get:function(e){return this[Ec+e]},set:function(e,i){return this[Ec+e]=i,this},remove:function(e){var i=Ec+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Ec&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Ec&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Ec&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Ec&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Ec&&++e;return e},empty:function(){for(var e in this)if(e[0]===Ec)return!1;return!0},each:function(e){for(var i in this)i[0]===Ec&&e(this[i],i.slice(1),this)}};function o_(e,i){var r=new Gv;if(e instanceof Gv)e.each(function(m,g){r.set(g,m)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var G0=o_;function zP(){var e=[],i=[],r,n,a;function s(m,g,x,C){if(g>=e.length)return r!=null&&m.sort(r),n!=null?n(m):m;for(var w=-1,R=m.length,D=e[g++],V,J,te=map(),Se,He=x();++w<R;)(Se=te.get(V=D(J=m[w])+""))?Se.push(J):te.set(V,[J]);return te.each(function(tt,at){C(He,at,s(tt,g,x,C))}),He}function p(m,g){if(++g>e.length)return m;var x,C=i[g-1];return n!=null&&g>=e.length?x=m.entries():(x=[],m.each(function(w,R){x.push({key:R,values:p(w,g)})})),C!=null?x.sort(function(w,R){return C(w.key,R.key)}):x}return a={object:function(m){return s(m,0,Ow,Rw)},map:function(m){return s(m,0,s_,u_)},entries:function(m){return p(s(m,0,s_,u_),0)},key:function(m){return e.push(m),a},sortKeys:function(m){return i[e.length-1]=m,a},sortValues:function(m){return r=m,a},rollup:function(m){return n=m,a}}}function Ow(){return{}}function Rw(e,i,r){e[i]=r}function s_(){return map()}function u_(e,i,r){e.set(i,r)}function Hv(){}var Ih=G0.prototype;Hv.prototype=Lw.prototype={constructor:Hv,has:Ih.has,add:function(e){return e+="",this[Ec+e]=e,this},remove:Ih.remove,clear:Ih.clear,values:Ih.keys,size:Ih.size,empty:Ih.empty,each:Ih.each};function Lw(e,i){var r=new Hv;if(e instanceof Hv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var UP=null,l_=Array.prototype,Wv=l_.map,Oh=l_.slice;function qp(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function ZP(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var c_={name:"implicit"};function Xv(){var e=G0(),i=[],r=[],n=c_;function a(s){var p=s+"",m=e.get(p);if(!m){if(n!==c_)return n;e.set(p,m=i.push(s))}return r[(m-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=G0();for(var p=-1,m=s.length,g,x;++p<m;)e.has(x=(g=s[p])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Oh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return Xv(i,r).unknown(n)},qp.apply(a,arguments),a}function f_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,m=0,g=0,x=.5;delete e.unknown;function C(){var w=i().length,R=n[1]<n[0],D=n[R-0],V=n[1-R];a=(V-D)/Math.max(1,w-m+g*2),p&&(a=Math.floor(a)),D+=(V-D-a*(w-m))*x,s=a*(1-m),p&&(D=Math.round(D),s=Math.round(s));var J=sequence(w).map(function(te){return D+a*te});return r(R?J.reverse():J)}return e.domain=function(w){return arguments.length?(i(w),C()):i()},e.range=function(w){return arguments.length?(n=[+w[0],+w[1]],C()):n.slice()},e.rangeRound=function(w){return n=[+w[0],+w[1]],p=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(w){return arguments.length?(p=!!w,C()):p},e.padding=function(w){return arguments.length?(m=Math.min(1,g=+w),C()):m},e.paddingInner=function(w){return arguments.length?(m=Math.min(1,w),C()):m},e.paddingOuter=function(w){return arguments.length?(g=+w,C()):g},e.align=function(w){return arguments.length?(x=Math.max(0,Math.min(1,w)),C()):x},e.copy=function(){return f_(i(),n).round(p).paddingInner(m).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function p_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return p_(i())},e}function jP(){return p_(f_.apply(null,arguments).paddingInner(1))}var kw=N(26257),Dw=N(73626);function Fw(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function Bw(e){return function(){return e}}function H0(e){return+e}var h_=[0,1];function Sc(e){return e}function W0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:Bw(isNaN(i)?NaN:.5)}function d_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function Nw(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=W0(a,n),s=r(p,s)):(n=W0(n,a),s=r(s,p)),function(m){return s(n(m))}}function zw(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=W0(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(m){var g=jv(e,m,1,n)-1;return s[g](a[g](m))}}function Yv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function X0(){var e=h_,i=h_,r=kw.Z,n,a,s,p=Sc,m,g,x;function C(){return m=Math.min(e.length,i.length)>2?zw:Nw,g=x=null,w}function w(R){return isNaN(R=+R)?s:(g||(g=m(e.map(n),i,r)))(n(p(R)))}return w.invert=function(R){return p(a((x||(x=m(i,e.map(n),Dw.Z)))(R)))},w.domain=function(R){return arguments.length?(e=Wv.call(R,H0),p===Sc||(p=d_(e)),C()):e.slice()},w.range=function(R){return arguments.length?(i=Oh.call(R),C()):i.slice()},w.rangeRound=function(R){return i=Oh.call(R),r=Fw,C()},w.clamp=function(R){return arguments.length?(p=R?d_(e):Sc,w):p!==Sc},w.interpolate=function(R){return arguments.length?(r=R,C()):r},w.unknown=function(R){return arguments.length?(s=R,w):s},function(R,D){return n=R,a=D,C()}}function v_(e,i){return X0()(e,i)}var Uw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function qv(e){if(!(i=Uw.exec(e)))throw new Error("invalid format: "+e);var i;return new Y0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}qv.prototype=Y0.prototype;function Y0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Y0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Zw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Kv(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function dd(e){return e=Kv(Math.abs(e)),e?e[1]:NaN}function jw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(dd(i)/3)))*3-dd(Math.abs(e)))}function Vw(e,i){return function(r,n){for(var a=r.length,s=[],p=0,m=e[0],g=0;a>0&&m>0&&(g+m+1>n&&(m=Math.max(1,n-g)),s.push(r.substring(a-=m,a+m)),!((g+=m+1)>n));)m=e[p=(p+1)%e.length];return s.reverse().join(i)}}function Gw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function Hw(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var m_;function Ww(e,i){var r=Kv(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(m_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Kv(e,Math.max(0,i+s-1))[0]}function g_(e,i){var r=Kv(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var y_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Zw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return g_(e*100,i)},r:g_,s:Ww,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function __(e){return e}var x_=Array.prototype.map,b_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Xw(e){var i=e.grouping===void 0||e.thousands===void 0?__:Vw(x_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?__:Gw(x_.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",m=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(w){w=qv(w);var R=w.fill,D=w.align,V=w.sign,J=w.symbol,te=w.zero,Se=w.width,He=w.comma,tt=w.precision,at=w.trim,Ot=w.type;Ot==="n"?(He=!0,Ot="g"):y_[Ot]||(tt===void 0&&(tt=12),at=!0,Ot="g"),(te||R==="0"&&D==="=")&&(te=!0,R="0",D="=");var kt=J==="$"?r:J==="#"&&/[boxX]/.test(Ot)?"0"+Ot.toLowerCase():"",nr=J==="$"?n:/[%p]/.test(Ot)?p:"",mr=y_[Ot],Gr=/[defgprs%]/.test(Ot);tt=tt===void 0?6:/[gprs]/.test(Ot)?Math.max(1,Math.min(21,tt)):Math.max(0,Math.min(20,tt));function ln(Tr){var An=kt,Rn=nr,di,mo,wo;if(Ot==="c")Rn=mr(Tr)+Rn,Tr="";else{Tr=+Tr;var qs=Tr<0||1/Tr<0;if(Tr=isNaN(Tr)?g:mr(Math.abs(Tr),tt),at&&(Tr=Hw(Tr)),qs&&+Tr==0&&V!=="+"&&(qs=!1),An=(qs?V==="("?V:m:V==="-"||V==="("?"":V)+An,Rn=(Ot==="s"?b_[8+m_/3]:"")+Rn+(qs&&V==="("?")":""),Gr){for(di=-1,mo=Tr.length;++di<mo;)if(wo=Tr.charCodeAt(di),48>wo||wo>57){Rn=(wo===46?a+Tr.slice(di+1):Tr.slice(di))+Rn,Tr=Tr.slice(0,di);break}}}He&&!te&&(Tr=i(Tr,Infinity));var Pu=An.length+Tr.length+Rn.length,iu=Pu<Se?new Array(Se-Pu+1).join(R):"";switch(He&&te&&(Tr=i(iu+Tr,iu.length?Se-Rn.length:Infinity),iu=""),D){case"<":Tr=An+Tr+Rn+iu;break;case"=":Tr=An+iu+Tr+Rn;break;case"^":Tr=iu.slice(0,Pu=iu.length>>1)+An+Tr+Rn+iu.slice(Pu);break;default:Tr=iu+An+Tr+Rn;break}return s(Tr)}return ln.toString=function(){return w+""},ln}function C(w,R){var D=x((w=qv(w),w.type="f",w)),V=Math.max(-8,Math.min(8,Math.floor(dd(R)/3)))*3,J=Math.pow(10,-V),te=b_[8+V/3];return function(Se){return D(J*Se)+te}}return{format:x,formatPrefix:C}}var $v,q0,E_;Yw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Yw(e){return $v=Xw(e),q0=$v.format,E_=$v.formatPrefix,$v}function qw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,dd(i)-dd(e))+1}function Kw(e){return Math.max(0,-dd(Math.abs(e)))}function $w(e,i,r,n){var a=V0(e,i,r),s;switch(n=qv(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=jw(a,p))&&(n.precision=s),E_(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=qw(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=Kw(a))&&(n.precision=s-(n.type==="%")*2);break}}return q0(n)}function Qv(e){var i=e.domain;return e.ticks=function(r){var n=i();return a_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return $w(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],m=n[s],g;return m<p&&(g=p,p=m,m=g,g=a,a=s,s=g),g=Vv(p,m,r),g>0?(p=Math.floor(p/g)*g,m=Math.ceil(m/g)*g,g=Vv(p,m,r)):g<0&&(p=Math.ceil(p*g)/g,m=Math.floor(m*g)/g,g=Vv(p,m,r)),g>0?(n[a]=Math.floor(p/g)*g,n[s]=Math.ceil(m/g)*g,i(n)):g<0&&(n[a]=Math.ceil(p*g)/g,n[s]=Math.floor(m*g)/g,i(n)),e},e}function S_(){var e=v_(Sc,Sc);return e.copy=function(){return Yv(e,S_())},qp.apply(e,arguments),Qv(e)}function C_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Wv.call(n,H0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return C_(e).unknown(i)},e=arguments.length?Wv.call(e,H0):[0,1],Qv(r)}function A_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function w_(e){return Math.log(e)}function T_(e){return Math.exp(e)}function Qw(e){return-Math.log(-e)}function Jw(e){return-Math.exp(-e)}function eT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function tT(e){return e===10?eT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function rT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function M_(e){return function(i){return-e(-i)}}function nT(e){var i=e(w_,T_),r=i.domain,n=10,a,s;function p(){return a=rT(n),s=tT(n),r()[0]<0?(a=M_(a),s=M_(s),e(Qw,Jw)):e(w_,T_),i}return i.base=function(m){return arguments.length?(n=+m,p()):n},i.domain=function(m){return arguments.length?(r(m),p()):r()},i.ticks=function(m){var g=r(),x=g[0],C=g[g.length-1],w;(w=C<x)&&(R=x,x=C,C=R);var R=a(x),D=a(C),V,J,te,Se=m==null?10:+m,He=[];if(!(n%1)&&D-R<Se){if(R=Math.round(R)-1,D=Math.round(D)+1,x>0){for(;R<D;++R)for(J=1,V=s(R);J<n;++J)if(te=V*J,!(te<x)){if(te>C)break;He.push(te)}}else for(;R<D;++R)for(J=n-1,V=s(R);J>=1;--J)if(te=V*J,!(te<x)){if(te>C)break;He.push(te)}}else He=a_(R,D,Math.min(D-R,Se)).map(s);return w?He.reverse():He},i.tickFormat=function(m,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=q0(g)),m===Infinity)return g;m==null&&(m=10);var x=Math.max(1,n*m/i.ticks().length);return function(C){var w=C/s(Math.round(a(C)));return w*n<n-.5&&(w*=n),w<=x?g(C):""}},i.nice=function(){return r(A_(r(),{floor:function(m){return s(Math.floor(a(m)))},ceil:function(m){return s(Math.ceil(a(m)))}}))},i}function P_(){var e=nT(X0()).domain([1,10]);return e.copy=function(){return Yv(e,P_()).base(e.base())},qp.apply(e,arguments),e}function I_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function O_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function iT(e){var i=1,r=e(I_(i),O_(i));return r.constant=function(n){return arguments.length?e(I_(i=+n),O_(i)):i},linearish(r)}function aT(){var e=iT(transformer());return e.copy=function(){return copy(e,aT()).constant(e.constant())},initRange.apply(e,arguments)}function R_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function oT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function sT(e){return e<0?-e*e:e*e}function uT(e){var i=e(Sc,Sc),r=1;function n(){return r===1?e(Sc,Sc):r===.5?e(oT,sT):e(R_(r),R_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},Qv(i)}function K0(){var e=uT(X0());return e.copy=function(){return Yv(e,K0()).exponent(e.exponent())},qp.apply(e,arguments),e}function VP(){return K0.apply(null,arguments).exponent(.5)}function L_(){var e=[],i=[],r=[],n;function a(){var p=0,m=Math.max(1,i.length);for(r=new Array(m-1);++p<m;)r[p-1]=Iw(e,p/m);return s}function s(p){return isNaN(p=+p)?n:i[jv(r,p)]}return s.invertExtent=function(p){var m=i.indexOf(p);return m<0?[NaN,NaN]:[m>0?r[m-1]:e[0],m<r.length?r[m]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var m=0,g=p.length,x;m<g;++m)x=p[m],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(z0),a()},s.range=function(p){return arguments.length?(i=Oh.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return L_().domain(e).range(i).unknown(n)},qp.apply(s,arguments)}function k_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(g){return g<=g?a[jv(n,g,0,r)]:s}function m(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return p}return p.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],m()):[e,i]},p.range=function(g){return arguments.length?(r=(a=Oh.call(g)).length-1,m()):a.slice()},p.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},p.unknown=function(g){return arguments.length&&(s=g),p},p.thresholds=function(){return n.slice()},p.copy=function(){return k_().domain([e,i]).range(a).unknown(s)},qp.apply(Qv(p),arguments)}function D_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[jv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Oh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Oh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return D_().domain(e).range(i).unknown(r)},qp.apply(a,arguments)}var $0=new Date,Q0=new Date;function ll(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),m=a.ceil(s);return s-p<m-s?p:m},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,m){var g=[],x;if(s=a.ceil(s),m=m==null?1:Math.floor(m),!(s<p)||!(m>0))return g;do g.push(x=new Date(+s)),i(s,m),e(s);while(x<s&&s<p);return g},a.filter=function(s){return ll(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,m){if(p>=p)if(m<0)for(;++m<=0;)for(;i(p,-1),!s(p););else for(;--m>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return $0.setTime(+s),Q0.setTime(+p),e($0),e(Q0),Math.floor(r($0,Q0))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var J0=ll(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});J0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ll(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var vd=J0,GP=J0.range,F_=ll(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),lT=F_,HP=F_.range,Jv=1e3,sv=6e4,B_=36e5,N_=864e5,z_=6048e5;function Rh(e){return ll(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*sv)/z_})}var em=Rh(0),e0=Rh(1),cT=Rh(2),fT=Rh(3),md=Rh(4),pT=Rh(5),hT=Rh(6),WP=em.range,XP=e0.range,YP=cT.range,qP=fT.range,KP=md.range,$P=pT.range,QP=hT.range,U_=ll(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*sv)/N_},function(e){return e.getDate()-1}),tm=U_,JP=U_.range,Z_=ll(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv-e.getMinutes()*sv)},function(e,i){e.setTime(+e+i*B_)},function(e,i){return(i-e)/B_},function(e){return e.getHours()}),dT=Z_,e4=Z_.range,j_=ll(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv)},function(e,i){e.setTime(+e+i*sv)},function(e,i){return(i-e)/sv},function(e){return e.getMinutes()}),vT=j_,t4=j_.range,V_=ll(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*Jv)},function(e,i){return(i-e)/Jv},function(e){return e.getUTCSeconds()}),mT=V_,r4=V_.range,t0=ll(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});t0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ll(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):t0};var gT=t0,n4=t0.range;function Lh(e){return ll(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/z_})}var G_=Lh(0),r0=Lh(1),yT=Lh(2),_T=Lh(3),gd=Lh(4),xT=Lh(5),bT=Lh(6),i4=G_.range,a4=r0.range,o4=yT.range,s4=_T.range,u4=gd.range,l4=xT.range,c4=bT.range,H_=ll(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/N_},function(e){return e.getUTCDate()-1}),W_=H_,f4=H_.range,rm=ll(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});rm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ll(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var uv=rm,p4=rm.range;function nm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function im(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function lv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function ET(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,m=e.months,g=e.shortMonths,x=cv(a),C=fv(a),w=cv(s),R=fv(s),D=cv(p),V=fv(p),J=cv(m),te=fv(m),Se=cv(g),He=fv(g),tt={a:qs,A:Pu,b:iu,B:bd,c:null,d:Q_,e:Q_,f:HT,g:t5,G:n5,H:jT,I:VT,j:GT,L:J_,m:WT,M:XT,p:J3,q:eP,Q:a1,s:o1,S:YT,u:qT,U:KT,V:$T,w:QT,W:JT,x:null,X:null,y:e5,Y:r5,Z:i5,"%":i1},at={a:tP,A:rP,b:nP,B:iP,c:null,d:t1,e:t1,f:u5,g:y5,G:x5,H:a5,I:o5,j:s5,L:r1,m:l5,M:c5,p:aP,q:oP,Q:a1,s:o1,S:f5,u:p5,U:h5,V:d5,w:v5,W:m5,x:null,X:null,y:g5,Y:_5,Z:b5,"%":i1},Ot={a:ln,A:Tr,b:An,B:Rn,c:di,d:K_,e:K_,f:NT,g:q_,G:Y_,H:$_,I:$_,j:kT,L:BT,m:LT,M:DT,p:Gr,q:RT,Q:UT,s:ZT,S:FT,u:TT,U:MT,V:PT,w:wT,W:IT,x:mo,X:wo,y:q_,Y:Y_,Z:OT,"%":zT};tt.x=kt(r,tt),tt.X=kt(n,tt),tt.c=kt(i,tt),at.x=kt(r,at),at.X=kt(n,at),at.c=kt(i,at);function kt(si,Ua){return function(so){var _n=[],wl=-1,Ko=0,Xl=si.length,Yl,Fh,$x;for(so instanceof Date||(so=new Date(+so));++wl<Xl;)si.charCodeAt(wl)===37&&(_n.push(si.slice(Ko,wl)),(Fh=X_[Yl=si.charAt(++wl)])!=null?Yl=si.charAt(++wl):Fh=Yl==="e"?" ":"0",($x=Ua[Yl])&&(Yl=$x(so,Fh)),_n.push(Yl),Ko=wl+1);return _n.push(si.slice(Ko,wl)),_n.join("")}}function nr(si,Ua){return function(so){var _n=lv(1900,void 0,1),wl=mr(_n,si,so+="",0),Ko,Xl;if(wl!=so.length)return null;if("Q"in _n)return new Date(_n.Q);if("s"in _n)return new Date(_n.s*1e3+("L"in _n?_n.L:0));if(Ua&&!("Z"in _n)&&(_n.Z=0),"p"in _n&&(_n.H=_n.H%12+_n.p*12),_n.m===void 0&&(_n.m="q"in _n?_n.q:0),"V"in _n){if(_n.V<1||_n.V>53)return null;"w"in _n||(_n.w=1),"Z"in _n?(Ko=im(lv(_n.y,0,1)),Xl=Ko.getUTCDay(),Ko=Xl>4||Xl===0?r0.ceil(Ko):r0(Ko),Ko=W_.offset(Ko,(_n.V-1)*7),_n.y=Ko.getUTCFullYear(),_n.m=Ko.getUTCMonth(),_n.d=Ko.getUTCDate()+(_n.w+6)%7):(Ko=nm(lv(_n.y,0,1)),Xl=Ko.getDay(),Ko=Xl>4||Xl===0?e0.ceil(Ko):e0(Ko),Ko=tm.offset(Ko,(_n.V-1)*7),_n.y=Ko.getFullYear(),_n.m=Ko.getMonth(),_n.d=Ko.getDate()+(_n.w+6)%7)}else("W"in _n||"U"in _n)&&("w"in _n||(_n.w="u"in _n?_n.u%7:"W"in _n?1:0),Xl="Z"in _n?im(lv(_n.y,0,1)).getUTCDay():nm(lv(_n.y,0,1)).getDay(),_n.m=0,_n.d="W"in _n?(_n.w+6)%7+_n.W*7-(Xl+5)%7:_n.w+_n.U*7-(Xl+6)%7);return"Z"in _n?(_n.H+=_n.Z/100|0,_n.M+=_n.Z%100,im(_n)):nm(_n)}}function mr(si,Ua,so,_n){for(var wl=0,Ko=Ua.length,Xl=so.length,Yl,Fh;wl<Ko;){if(_n>=Xl)return-1;if(Yl=Ua.charCodeAt(wl++),Yl===37){if(Yl=Ua.charAt(wl++),Fh=Ot[Yl in X_?Ua.charAt(wl++):Yl],!Fh||(_n=Fh(si,so,_n))<0)return-1}else if(Yl!=so.charCodeAt(_n++))return-1}return _n}function Gr(si,Ua,so){var _n=x.exec(Ua.slice(so));return _n?(si.p=C[_n[0].toLowerCase()],so+_n[0].length):-1}function ln(si,Ua,so){var _n=D.exec(Ua.slice(so));return _n?(si.w=V[_n[0].toLowerCase()],so+_n[0].length):-1}function Tr(si,Ua,so){var _n=w.exec(Ua.slice(so));return _n?(si.w=R[_n[0].toLowerCase()],so+_n[0].length):-1}function An(si,Ua,so){var _n=Se.exec(Ua.slice(so));return _n?(si.m=He[_n[0].toLowerCase()],so+_n[0].length):-1}function Rn(si,Ua,so){var _n=J.exec(Ua.slice(so));return _n?(si.m=te[_n[0].toLowerCase()],so+_n[0].length):-1}function di(si,Ua,so){return mr(si,i,Ua,so)}function mo(si,Ua,so){return mr(si,r,Ua,so)}function wo(si,Ua,so){return mr(si,n,Ua,so)}function qs(si){return p[si.getDay()]}function Pu(si){return s[si.getDay()]}function iu(si){return g[si.getMonth()]}function bd(si){return m[si.getMonth()]}function J3(si){return a[+(si.getHours()>=12)]}function eP(si){return 1+~~(si.getMonth()/3)}function tP(si){return p[si.getUTCDay()]}function rP(si){return s[si.getUTCDay()]}function nP(si){return g[si.getUTCMonth()]}function iP(si){return m[si.getUTCMonth()]}function aP(si){return a[+(si.getUTCHours()>=12)]}function oP(si){return 1+~~(si.getUTCMonth()/3)}return{format:function(si){var Ua=kt(si+="",tt);return Ua.toString=function(){return si},Ua},parse:function(si){var Ua=nr(si+="",!1);return Ua.toString=function(){return si},Ua},utcFormat:function(si){var Ua=kt(si+="",at);return Ua.toString=function(){return si},Ua},utcParse:function(si){var Ua=nr(si+="",!0);return Ua.toString=function(){return si},Ua}}}var X_={"-":"",_:" ","0":"0"},vu=/^\s*\d+/,ST=/^%/,CT=/[\\^$*+?|[\]().{}]/g;function oo(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function AT(e){return e.replace(CT,"\\$&")}function cv(e){return new RegExp("^(?:"+e.map(AT).join("|")+")","i")}function fv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function wT(e,i,r){var n=vu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function TT(e,i,r){var n=vu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function MT(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function PT(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function IT(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Y_(e,i,r){var n=vu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function q_(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function OT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function RT(e,i,r){var n=vu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function LT(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function K_(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function kT(e,i,r){var n=vu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function $_(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function DT(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function FT(e,i,r){var n=vu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function BT(e,i,r){var n=vu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function NT(e,i,r){var n=vu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function zT(e,i,r){var n=ST.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function UT(e,i,r){var n=vu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function ZT(e,i,r){var n=vu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Q_(e,i){return oo(e.getDate(),i,2)}function jT(e,i){return oo(e.getHours(),i,2)}function VT(e,i){return oo(e.getHours()%12||12,i,2)}function GT(e,i){return oo(1+tm.count(vd(e),e),i,3)}function J_(e,i){return oo(e.getMilliseconds(),i,3)}function HT(e,i){return J_(e,i)+"000"}function WT(e,i){return oo(e.getMonth()+1,i,2)}function XT(e,i){return oo(e.getMinutes(),i,2)}function YT(e,i){return oo(e.getSeconds(),i,2)}function qT(e){var i=e.getDay();return i===0?7:i}function KT(e,i){return oo(em.count(vd(e)-1,e),i,2)}function e1(e){var i=e.getDay();return i>=4||i===0?md(e):md.ceil(e)}function $T(e,i){return e=e1(e),oo(md.count(vd(e),e)+(vd(e).getDay()===4),i,2)}function QT(e){return e.getDay()}function JT(e,i){return oo(e0.count(vd(e)-1,e),i,2)}function e5(e,i){return oo(e.getFullYear()%100,i,2)}function t5(e,i){return e=e1(e),oo(e.getFullYear()%100,i,2)}function r5(e,i){return oo(e.getFullYear()%1e4,i,4)}function n5(e,i){var r=e.getDay();return e=r>=4||r===0?md(e):md.ceil(e),oo(e.getFullYear()%1e4,i,4)}function i5(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+oo(i/60|0,"0",2)+oo(i%60,"0",2)}function t1(e,i){return oo(e.getUTCDate(),i,2)}function a5(e,i){return oo(e.getUTCHours(),i,2)}function o5(e,i){return oo(e.getUTCHours()%12||12,i,2)}function s5(e,i){return oo(1+W_.count(uv(e),e),i,3)}function r1(e,i){return oo(e.getUTCMilliseconds(),i,3)}function u5(e,i){return r1(e,i)+"000"}function l5(e,i){return oo(e.getUTCMonth()+1,i,2)}function c5(e,i){return oo(e.getUTCMinutes(),i,2)}function f5(e,i){return oo(e.getUTCSeconds(),i,2)}function p5(e){var i=e.getUTCDay();return i===0?7:i}function h5(e,i){return oo(G_.count(uv(e)-1,e),i,2)}function n1(e){var i=e.getUTCDay();return i>=4||i===0?gd(e):gd.ceil(e)}function d5(e,i){return e=n1(e),oo(gd.count(uv(e),e)+(uv(e).getUTCDay()===4),i,2)}function v5(e){return e.getUTCDay()}function m5(e,i){return oo(r0.count(uv(e)-1,e),i,2)}function g5(e,i){return oo(e.getUTCFullYear()%100,i,2)}function y5(e,i){return e=n1(e),oo(e.getUTCFullYear()%100,i,2)}function _5(e,i){return oo(e.getUTCFullYear()%1e4,i,4)}function x5(e,i){var r=e.getUTCDay();return e=r>=4||r===0?gd(e):gd.ceil(e),oo(e.getUTCFullYear()%1e4,i,4)}function b5(){return"+0000"}function i1(){return"%"}function a1(e){return+e}function o1(e){return Math.floor(+e/1e3)}var yd,s1,E5,S5,C5;A5({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function A5(e){return yd=ET(e),s1=yd.format,E5=yd.parse,S5=yd.utcFormat,C5=yd.utcParse,yd}var pv=1e3,hv=pv*60,dv=hv*60,vv=dv*24,w5=vv*7,u1=vv*30,am=vv*365;function T5(e){return new Date(e)}function M5(e){return e instanceof Date?+e:+new Date(+e)}function l1(e,i,r,n,a,s,p,m,g){var x=v_(Sc,Sc),C=x.invert,w=x.domain,R=g(".%L"),D=g(":%S"),V=g("%I:%M"),J=g("%I %p"),te=g("%a %d"),Se=g("%b %d"),He=g("%B"),tt=g("%Y"),at=[[p,1,pv],[p,5,5*pv],[p,15,15*pv],[p,30,30*pv],[s,1,hv],[s,5,5*hv],[s,15,15*hv],[s,30,30*hv],[a,1,dv],[a,3,3*dv],[a,6,6*dv],[a,12,12*dv],[n,1,vv],[n,2,2*vv],[r,1,w5],[i,1,u1],[i,3,3*u1],[e,1,am]];function Ot(nr){return(p(nr)<nr?R:s(nr)<nr?D:a(nr)<nr?V:n(nr)<nr?J:i(nr)<nr?r(nr)<nr?te:Se:e(nr)<nr?He:tt)(nr)}function kt(nr,mr,Gr,ln){if(nr==null&&(nr=10),typeof nr=="number"){var Tr=Math.abs(Gr-mr)/nr,An=r_(function(Rn){return Rn[2]}).right(at,Tr);An===at.length?(ln=V0(mr/am,Gr/am,nr),nr=e):An?(An=at[Tr/at[An-1][2]<at[An][2]/Tr?An-1:An],ln=An[1],nr=An[0]):(ln=Math.max(V0(mr,Gr,nr),1),nr=m)}return ln==null?nr:nr.every(ln)}return x.invert=function(nr){return new Date(C(nr))},x.domain=function(nr){return arguments.length?w(Wv.call(nr,M5)):w().map(T5)},x.ticks=function(nr,mr){var Gr=w(),ln=Gr[0],Tr=Gr[Gr.length-1],An=Tr<ln,Rn;return An&&(Rn=ln,ln=Tr,Tr=Rn),Rn=kt(nr,ln,Tr,mr),Rn=Rn?Rn.range(ln,Tr+1):[],An?Rn.reverse():Rn},x.tickFormat=function(nr,mr){return mr==null?Ot:g(mr)},x.nice=function(nr,mr){var Gr=w();return(nr=kt(nr,Gr[0],Gr[Gr.length-1],mr))?w(A_(Gr,nr)):x},x.copy=function(){return Yv(x,l1(e,i,r,n,a,s,p,m,g))},x}function P5(){return qp.apply(l1(vd,lT,em,tm,dT,vT,mT,gT,s1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function h4(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function n0(){var e=0,i=1,r,n,a,s,p=identity,m=!1,g;function x(C){return isNaN(C=+C)?g:p(a===0?.5:(C=(s(C)-r)*a,m?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(m=!!C,x):m},x.interpolator=function(C){return arguments.length?(p=C,x):p},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function i0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function I5(){var e=linearish(n0()(identity));return e.copy=function(){return i0(e,I5())},initInterpolator.apply(e,arguments)}function O5(){var e=loggish(n0()).domain([1,10]);return e.copy=function(){return i0(e,O5()).base(e.base())},initInterpolator.apply(e,arguments)}function R5(){var e=symlogish(n0());return e.copy=function(){return i0(e,R5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function c1(){var e=powish(n0());return e.copy=function(){return i0(e,c1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function d4(){return c1.apply(null,arguments).exponent(.5)}function L5(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return L5(i).domain(e)},initInterpolator.apply(r,arguments)}function a0(){var e=0,i=.5,r=1,n,a,s,p,m,g=identity,x,C=!1,w;function R(D){return isNaN(D=+D)?w:(D=.5+((D=+x(D))-a)*(D<a?p:m),g(C?Math.max(0,Math.min(1,D)):D))}return R.domain=function(D){return arguments.length?(n=x(e=+D[0]),a=x(i=+D[1]),s=x(r=+D[2]),p=n===a?0:.5/(a-n),m=a===s?0:.5/(s-a),R):[e,i,r]},R.clamp=function(D){return arguments.length?(C=!!D,R):C},R.interpolator=function(D){return arguments.length?(g=D,R):g},R.unknown=function(D){return arguments.length?(w=D,R):w},function(D){return x=D,n=D(e),a=D(i),s=D(r),p=n===a?0:.5/(a-n),m=a===s?0:.5/(s-a),R}}function k5(){var e=linearish(a0()(identity));return e.copy=function(){return copy(e,k5())},initInterpolator.apply(e,arguments)}function D5(){var e=loggish(a0()).domain([.1,1,10]);return e.copy=function(){return copy(e,D5()).base(e.base())},initInterpolator.apply(e,arguments)}function F5(){var e=symlogish(a0());return e.copy=function(){return copy(e,F5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function f1(){var e=powish(a0());return e.copy=function(){return copy(e,f1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function v4(){return f1.apply(null,arguments).exponent(.5)}var Xc,p1,h1,d1,om,v1,B5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,N5=(Xc={},(0,I.Z)(Xc,nu.LINEAR,S_),(0,I.Z)(Xc,nu.POWER,K0),(0,I.Z)(Xc,nu.LOG,P_),(0,I.Z)(Xc,nu.IDENTITY,C_),(0,I.Z)(Xc,nu.TIME,P5),(0,I.Z)(Xc,nu.QUANTILE,L_),(0,I.Z)(Xc,nu.QUANTIZE,k_),(0,I.Z)(Xc,nu.THRESHOLD,D_),(0,I.Z)(Xc,nu.CAT,Xv),Xc),z5=(p1=(0,jr.b2)(),h1=(0,jr.f3)(Ut.IGlobalConfigService),p1(d1=(om=function(){function e(){(0,ot.Z)(this,e),Sn(this,"configService",v1,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,Tt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;m.length!==0&&a.caculateScalesForAttributes(p||[],m)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],m),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var m=r.getSource().data.dataArray;if(m.length===0)return;var g=p.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,m)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,m=s.name;p.names=a.parseFields(s.scale.field||[]);var g=[];p.names.forEach(function(x){g.push(a.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===Vp.VARIABLE})?(p.type=Vp.VARIABLE,g.forEach(function(x){if(!p.callback){var C;if(p.values&&p.values!=="text"){var w;if(((w=x.option)===null||w===void 0?void 0:w.type)==="linear"&&p.values.length>2){var R=x.scale.ticks(p.values.length);m==="color"&&x.scale.domain(R)}x.scale.range(p.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(p.type=Vp.CONSTANT,p.defaultValues=g.map(function(x,C){return x.scale(p.names[C])})),p.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),m=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(r,n.name,m,a);return g}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Pa()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,m,g=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:Vp.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=Xv([r]),x.type=Vp.CONSTANT),x;var C=(m=s.find(function(D){return!sl()(D[r])}))===null||m===void 0?void 0:m[r];if(this.isNumber(r)||sl()(C)&&!g)x.scale=Xv([r]),x.type=Vp.CONSTANT;else{var w=g&&g.type||this.getDefaultType(C);a==="text"&&(w=nu.CAT);var R=this.createDefaultScaleConfig(w,r,s);Object.assign(R,g),x.scale=this.createDefaultScale(R),x.option=R}return x}},{key:"getDefaultType",value:function(r){var n=nu.LINEAR;return typeof r=="string"&&(n=B5.test(r)?nu.TIME:nu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(m){return m[n]}))||[];return r!==nu.CAT&&r!==nu.QUANTILE?s.domain=Mw(p):r===nu.CAT?s.domain=Wd()(p):r===nu.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=N5[n]();return a&&s.domain(a),s}}]),e}(),v1=oi(om.prototype,"configService",[h1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om))||d1),m1,g1,y1,_1,o0,x1,b1;function E1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function U5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?E1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Z5=(m1=(0,jr.b2)(),g1=(0,jr.f3)(Ut.ICameraService),y1=(0,jr.f3)(Ut.IRendererService),m1(_1=(o0=function(){function e(){(0,ot.Z)(this,e),Sn(this,"cameraService",x1,this),Sn(this,"rendererService",b1,this)}return(0,Tt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(U5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),x1=oi(o0.prototype,"cameraService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b1=oi(o0.prototype,"rendererService",[y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o0))||_1),S1,C1,j5=(S1=(0,jr.b2)(),S1(C1=function(){function e(){(0,ot.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||C1),A1,w1,V5=(A1=(0,jr.b2)(),A1(w1=function(){function e(){(0,ot.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||w1),T1,M1,G5=["type"];function P1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?P1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var I1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},H5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},W5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},X5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},m4=null;function Y5(e){var i={u_DirectionalLights:new Array(3).fill(mv({},W5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(mv({},X5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[H5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,bf.Z)(r,G5),m=I1[s].lights,g=I1[s].num,x=i[g];i[m][x]=mv(mv({},i[m][x]),p),i[g]++}),i}var q5=(T1=(0,jr.b2)(),T1(M1=function(){function e(){(0,ot.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(mv({},Y5()))})})}}]),e}())||M1),O1,R1,L1,sm,k1,K5=(O1=(0,jr.b2)(),R1=(0,jr.f3)(Ut.IGlobalConfigService),O1(L1=(sm=function(){function e(){(0,ot.Z)(this,e),Sn(this,"configService",k1,this),(0,I.Z)(this,"enabled",void 0)}return(0,Tt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,m=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,w=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=Wg(r,w,p,m),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),k1=oi(sm.prototype,"configService",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm))||L1),D1,F1,s0={NONE:0,ENCODE:1,HIGHLIGHT:2},$5=(D1=(0,jr.b2)(),D1(F1=function(){function e(){(0,ot.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:Dn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:G.FLOAT},size:3,update:function(g,x){var C=g.id;return p?je(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),m=p.enablePicking;m&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:s0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),m=p.enablePicking;m&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:s0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var m=r.getLayerConfig(),g=m.highlightColor,x=m.activeMix,C=x===void 0?0:x,w=typeof g=="string"?ke(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ae(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:s0.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:w.map(function(D){return D*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var m=r.getLayerConfig(),g=m.selectColor,x=m.selectMix,C=x===void 0?0:x,w=typeof g=="string"?ke(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ae(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:s0.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:w.map(function(D){return D*255}),u_activeMix:C,u_CurrentSelectedId:p,u_SelectColor:w.map(function(D){return D*255}),u_EnableSelect:1})})})}}]),e}())||F1),B1,N1,Q5=(B1=(0,jr.b2)(),B1(N1=function(){function e(){(0,ot.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Dn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:G.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:Dn.Attribute,descriptor:{name:"filter",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Dn.Attribute,descriptor:{name:"a_Color",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:Dn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a,s,p,m){return[s]}}})}}]),e}())||N1),z1,U1,Z1,j1,V1,G1,_d,H1,W1,X1,Y1,J5=(z1=(0,jr.b2)(),U1=(0,jr.f3)(Ut.ICameraService),Z1=(0,jr.f3)(Ut.ICoordinateSystemService),j1=(0,jr.f3)(Ut.IRendererService),V1=(0,jr.f3)(Ut.IMapService),z1(G1=(_d=function(){function e(){(0,ot.Z)(this,e),Sn(this,"cameraService",H1,this),Sn(this,"coordinateSystemService",W1,this),Sn(this,"rendererService",X1,this),Sn(this,"mapService",Y1,this)}return(0,Tt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var m=n.rendererService.getViewportSize(),g=m.width,x=m.height;r.models.forEach(function(C){var w;C.addUniforms((w={},(0,I.Z)(w,Ch.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,I.Z)(w,Ch.ViewMatrix,n.cameraService.getViewMatrix()),(0,I.Z)(w,Ch.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,I.Z)(w,Ch.Zoom,n.cameraService.getZoom()),(0,I.Z)(w,Ch.ZoomScale,n.cameraService.getZoomScale()),(0,I.Z)(w,Ch.FocalDistance,n.cameraService.getFocalDistance()),(0,I.Z)(w,Ch.CameraPosition,n.cameraService.getCameraPosition()),(0,I.Z)(w,Nr.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(w,Nr.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,I.Z)(w,Nr.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(w,Nr.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(w,Nr.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(w,Nr.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(w,Nr.Mvp,s),(0,I.Z)(w,"u_SceneCenterMKT",p),(0,I.Z)(w,"u_ViewportSize",[g,x]),(0,I.Z)(w,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,I.Z)(w,"u_DevicePixelRatio",_a.devicePixelRatio),(0,I.Z)(w,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,I.Z)(w,"u_shaderPick",Number(r.getShaderPickStat())),w))})})}}]),e}(),H1=oi(_d.prototype,"cameraService",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=oi(_d.prototype,"coordinateSystemService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X1=oi(_d.prototype,"rendererService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y1=oi(_d.prototype,"mapService",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||G1),q1,K1,eM=(q1=(0,jr.b2)(),q1(K1=function(){function e(){(0,ot.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||K1),$1,Q1,tM=($1=(0,jr.b2)(),$1(Q1=function(){function e(){(0,ot.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),m=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||Q1);Wl.bind(Ut.ILayerPlugin).to(Aw).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(Q5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(z5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(Cw).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(V5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(tM).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(eM).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(K5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(J5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(Z5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(q5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to($5).inRequestScope(),Wl.bind(Ut.ILayerPlugin).to(j5).inRequestScope();var g4="2.8.24";function J1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function y4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J1(Object(r),!0).forEach(function(n){rM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function _4(e,i){return oM(e)||aM(e,i)||iM(e,i)||nM()}function nM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iM(e,i){if(!!e){if(typeof e=="string")return ex(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ex(e,i)}}function ex(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function aM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,m=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function oM(e){if(Array.isArray(e))return e}var x4=null,b4=null,tx,um,rx;function nx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ix(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?nx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var sM=(tx=I0(Ut.IGlobalConfigService),um=function(){function e(i){(0,ot.Z)(this,e),Sn(this,"configService",rx,this),(0,I.Z)(this,"config",void 0),this.config=i}return(0,Tt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Ut.MapConfig).toConstantValue(ix(ix({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Ut.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),rx=oi(um.prototype,"configService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um),uM=N(6158),gv=N.n(uM);function yv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function u0(e,i){var r=b([],i,e);return Pp(r,r,1/r[3]),r}function E4(e,i){var r=e%i;return r<0?i+r:r}function S4(e,i,r){return r*i+(1-r)*e}function kh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Yc=Math.PI,ax=Yc/4,sp=Yc/180,ox=180/Yc,lm=512,cm=4003e4,lM=1.5;function sx(e){return Math.pow(2,e)}function cM(e){return Math.log2(e)}function l0(e,i){var r=(0,$.Z)(e,2),n=r[0],a=r[1];kh(Number.isFinite(n)&&Number.isFinite(i)),kh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=lm;var s=n*sp,p=a*sp,m=i*(s+Yc)/(2*Yc),g=i*(Yc-Math.log(Math.tan(ax+p*.5)))/(2*Yc);return[m,g]}function fm(e,i){var r=(0,$.Z)(e,2),n=r[0],a=r[1];i*=lm;var s=n/i*(2*Yc)-Yc,p=2*(Math.atan(Math.exp(Yc-a/i*(2*Yc)))-ax);return[s*ox,p*ox]}function C4(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*sp);return cM(cm*r)-9}function ux(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:sx(n),kh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var m={},g=lm*a,x=Math.cos(i*sp),C=g/360,w=C/x,R=g/cm/x;if(m.pixelsPerMeter=[R,-R,R],m.metersPerPixel=[1/R,-1/R,1/R],m.pixelsPerDegree=[C,-w,R],m.degreesPerPixel=[1/C,-1/w,1/R],p){var D=sp*Math.tan(i*sp)/x,V=C*D/2,J=g/cm*D,te=J/w*R;m.pixelsPerDegree2=[0,-V,J],m.pixelsPerMeter2=[te,0,te]}return m}function A4(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),m=p[0],g=p[1],x=p[2],C=1,w=ux({longitude:n,latitude:a,scale:C,highPrecision:!0}),R=w.pixelsPerMeter,D=w.pixelsPerMeter2,V=l0(e,C);V[0]+=m*(R[0]+D[0]*g),V[1]+=g*(R[1]+D[1]*g);var J=fm(V,C),te=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[J[0],J[1],te]:J}function fM(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,m=e.flipY,g=m===void 0?!1:m,x=yv();return Qt(x,x,[0,0,-a]),rr(x,x,[1,1,1/i]),Vr(x,x,-r*sp),Wr(x,x,n*sp),g&&rr(x,x,[1,-1,1]),p&&Qt(x,x,Ja.negate([],p)),x}function pM(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?lM:n,s=e.pitch,p=s===void 0?0:s,m=e.nearZMultiplier,g=m===void 0?1:m,x=e.farZMultiplier,C=x===void 0?1:x,w=p*sp,R=Math.atan(.5/a),D=Math.sin(R)*a/Math.sin(Math.PI/2-w-R),V=Math.cos(Math.PI/2-w)*D+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:V*C}}function hM(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,m=pM({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),g=m.fov,x=m.aspect,C=m.near,w=m.far,R=zo([],g,x,C,w);return R}function dM(e,i){var r=(0,$.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return kh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),u0(i,[n,a,p,1])}function lx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,$.Z)(e,3),a=n[0],s=n[1],p=n[2];if(kh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var m=u0(i,[a,s,p,1]);return m}var g=u0(i,[a,s,0,1]),x=u0(i,[a,s,1,1]),C=g[2],w=x[2],R=C===w?0:((r||0)-C)/(w-C);return bi.t7([],g,x,R)}var cx=yv(),vM=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?cx:a,p=i.projectionMatrix,m=p===void 0?cx:p;(0,ot.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=m;var g=yv();Tn(g,g,this.projectionMatrix),Tn(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=yv();rr(x,x,[this.width/2,-this.height/2,1]),Qt(x,x,[1,-1,0]),Tn(x,x,this.viewProjectionMatrix);var C=fr(yv(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Tt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&pn(r.projectionMatrix,this.projectionMatrix)&&pn(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),m=dM(p,this.pixelProjectionMatrix),g=(0,$.Z)(m,2),x=g[0],C=g[1],w=s?C:this.height-C;return r.length===2?[x,w]:[x,w,m[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,m=(0,$.Z)(r,3),g=m[0],x=m[1],C=m[2],w=s?x:this.height-x,R=p&&p*this.pixelsPerMeter,D=lx([g,w,C],this.pixelUnprojectionMatrix,R),V=this.unprojectPosition(D),J=(0,$.Z)(V,3),te=J[0],Se=J[1],He=J[2];return Number.isFinite(C)?[te,Se,He]:Number.isFinite(p)?[te,Se,p]:[te,Se]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,$.Z)(n,2),s=a[0],p=a[1],m=(r[2]||0)*this.pixelsPerMeter;return[s,p,m]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,$.Z)(n,2),s=a[0],p=a[1],m=(r[2]||0)/this.pixelsPerMeter;return[s,p,m]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function mM(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,m=p===void 0?24:p,g=e.padding,x=g===void 0?0:g,C=e.offset,w=C===void 0?[0,0]:C,R=(0,$.Z)(n,2),D=(0,$.Z)(R[0],2),V=D[0],J=D[1],te=(0,$.Z)(R[1],2),Se=te[0],He=te[1];if(Number.isFinite(x)){var tt=x;x={top:tt,bottom:tt,left:tt,right:tt}}else kh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var at=new fx({width:i,height:r,longitude:0,latitude:0,zoom:0}),Ot=at.project([V,He]),kt=at.project([Se,J]),nr=[Math.max(Math.abs(kt[0]-Ot[0]),s),Math.max(Math.abs(kt[1]-Ot[1]),s)],mr=[i-x.left-x.right-Math.abs(w[0])*2,r-x.top-x.bottom-Math.abs(w[1])*2];kh(mr[0]>0&&mr[1]>0);var Gr=mr[0]/nr[0],ln=mr[1]/nr[1],Tr=(x.right-x.left)/2/Gr,An=(x.bottom-x.top)/2/ln,Rn=[(kt[0]+Ot[0])/2+Tr,(kt[1]+Ot[1])/2+An],di=at.unproject(Rn),mo=at.zoom+Math.log2(Math.abs(Math.min(Gr,ln)));return{longitude:di[0],latitude:di[1],zoom:Math.min(mo,m)}}var fx=function(e){(0,sn.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,m=p===void 0?0:p,g=n.longitude,x=g===void 0?0:g,C=n.zoom,w=C===void 0?0:C,R=n.pitch,D=R===void 0?0:R,V=n.bearing,J=V===void 0?0:V,te=n.altitude,Se=te===void 0?1.5:te,He=n.nearZMultiplier,tt=n.farZMultiplier;(0,ot.Z)(this,i),a=a||1,s=s||1;var at=sx(w);Se=Math.max(.75,Se);var Ot=l0([x,m],at);Ot[2]=0;var kt=hM({width:a,height:s,pitch:D,bearing:J,altitude:Se,nearZMultiplier:He||1/s,farZMultiplier:tt||1.01}),nr=fM({height:s,center:Ot,pitch:D,bearing:J,altitude:Se,flipY:!0});return r=(0,en.Z)(this,(0,Nt.Z)(i).call(this,{width:a,height:s,viewMatrix:nr,projectionMatrix:kt})),r.latitude=m,r.longitude=x,r.zoom=w,r.pitch=D,r.bearing=J,r.altitude=Se,r.scale=at,r.center=Ot,r.pixelsPerMeter=ux((0,de.Z)((0,de.Z)(r))).pixelsPerMeter[2],Object.freeze((0,de.Z)((0,de.Z)(r))),r}return(0,Tt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return l0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return fm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=lx(s,this.pixelUnprojectionMatrix),m=l0(a,this.scale),g=bi.IH([],m,bi.tk([],p)),x=bi.IH([],this.center,g);return fm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,m=mM(Object.assign({width:s,height:p,bounds:n},a)),g=m.longitude,x=m.latitude,C=m.zoom;return new i({width:s,height:p,longitude:g,latitude:x,zoom:C})}}]),i}(vM),gM=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"viewport",void 0)}return(0,Tt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,m=r.viewportHeight,g=r.viewportWidth;this.viewport=new fx({width:g,height:m,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),yM=function(){function e(i){(0,ot.Z)(this,e),(0,I.Z)(this,"size",1e4),this.size=i||1e4}return(0,Tt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),px={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},_M=["id","attributionControl","style","token","rotation","mapInstance"],hx,dx,vx,mx,gx,yx,xd,_x,xx,bx,Ex;function Sx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}bM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=gv();var Cx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},EM=0,SM=12,Ax="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",CM=(hx=(0,jr.b2)(),dx=(0,jr.f3)(Ut.MapConfig),vx=(0,jr.f3)(Ut.IGlobalConfigService),mx=(0,jr.f3)(Ut.ICoordinateSystemService),gx=(0,jr.f3)(Ut.IEventEmitter),hx(yx=(xd=function(){function e(){var i=this;(0,ot.Z)(this,e),(0,I.Z)(this,"version",Mu.MAPBOX),(0,I.Z)(this,"map",void 0),(0,I.Z)(this,"simpleMapCoord",new yM),(0,I.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Sn(this,"config",_x,this),Sn(this,"configService",xx,this),Sn(this,"coordinateSystemService",bx,this),Sn(this,"eventEmitter",Ex,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?SM:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(wr.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(wr.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Tt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=ha("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){T2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Cx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Cx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,m=a.y,g=m===void 0?0:m,x=a.z,C=x===void 0?0:x;return{x:p,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},m=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=m.meterInMercatorCoordinateUnits(),x=Fr();return Qt(x,x,Ja.fromValues(m.x-p.x,m.y-p.y,m.z||0-p.z)),rr(x,x,Ja.fromValues(g*s[0],-g*s[1],g*s[2])),Vr(x,x,a[0]),Ar(x,x,a[1]),Wr(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,za.Z)(Pi().mark(function n(){var a,s,p,m,g,x,C,w,R,D,V,J,te;return Pi().wrap(function(He){for(;;)switch(He.prev=He.next){case 0:a=this.config,s=a.id,p=s===void 0?"map":s,m=a.attributionControl,g=m===void 0?!1:m,x=a.style,C=x===void 0?"light":x,w=a.token,R=w===void 0?Ax:w,D=a.rotation,V=D===void 0?0:D,J=a.mapInstance,te=(0,bf.Z)(a,_M),this.viewport=new gM,!J&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),R===Ax&&C!=="blank"&&!window.mapboxgl.accessToken&&!J&&console.warn(this.configService.getSceneWarninfo("MapToken")),!J&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=R),J?(this.map=J,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(p),this.map=new window.mapboxgl.Map(xM({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:V},te))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return He.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(gv()).LngLat(r[0],r[1]),s=new(gv()).LngLat(n[0],n[1]),p=a.distanceTo(s),m=gv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=gv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=m.x,C=m.y,w=g.x,R=g.y,D=Math.sqrt(Math.pow(x-w,2)+Math.pow(C-R,2))*4194304*2;return D/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+EM++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:px[r]?px[r]:r}}]),e}(),_x=oi(xd.prototype,"config",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=oi(xd.prototype,"configService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bx=oi(xd.prototype,"coordinateSystemService",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=oi(xd.prototype,"eventEmitter",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||yx);function AM(e){var i=wM();return function(){var n=(0,Nt.Z)(e),a;if(i){var s=(0,Nt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,en.Z)(this,a)}}function wM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function TM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}TM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var MM=function(e){(0,sn.Z)(r,e);var i=AM(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,Tt.Z)(r,[{key:"getServiceConstructor",value:function(){return CM}}]),r}(sM);function Tx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Mx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Tx(Object(r),!0).forEach(function(n){PM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function IM(e,i){return kM(e)||LM(e,i)||RM(e,i)||OM()}function OM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RM(e,i){if(!!e){if(typeof e=="string")return Px(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Px(e,i)}}function Px(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function LM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,m=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function kM(e){if(Array.isArray(e))return e}var DM=Le.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,Le.createRef)(),m=(0,Le.useState)(),g=IM(m,2),x=g[0],C=g[1];return(0,Le.useEffect)(function(){var w=new hE(Mx(Mx({id:p.current},a),{},{map:new MM(n)}));return w.on("loaded",function(){C(w),s&&s(w)}),function(){w.destroy()}},[]),(0,Le.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Le.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,Le.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Le.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,Le.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),Le.createElement(Cr.Provider,{value:x},(0,Le.createElement)("div",{ref:p,style:i,className:r},x&&e.children))}),FM=DM;function Ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function w4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ix(Object(r),!0).forEach(function(n){BM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function T4(e,i){return ZM(e)||UM(e,i)||zM(e,i)||NM()}function NM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zM(e,i){if(!!e){if(typeof e=="string")return Ox(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ox(e,i)}}function Ox(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function UM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,m=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function ZM(e){if(Array.isArray(e))return e}var M4=null,P4=null;function Rx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function I4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rx(Object(r),!0).forEach(function(n){jM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function O4(e,i){return WM(e)||HM(e,i)||GM(e,i)||VM()}function VM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GM(e,i){if(!!e){if(typeof e=="string")return Lx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lx(e,i)}}function Lx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function HM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,m=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function WM(e){if(Array.isArray(e))return e}var R4=null,L4=null;function k4(e,i){return KM(e)||qM(e,i)||YM(e,i)||XM()}function XM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YM(e,i){if(!!e){if(typeof e=="string")return kx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kx(e,i)}}function kx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,m=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function KM(e){if(Array.isArray(e))return e}var D4=null,F4=null;function Dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function B4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dx(Object(r),!0).forEach(function(n){$M(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $M(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function N4(e,i){if(e==null)return{};var r=QM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function QM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var z4=null,Fx=N(73935);function Bx(e,i){return r3(e)||t3(e,i)||e3(e,i)||JM()}function JM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e3(e,i){if(!!e){if(typeof e=="string")return Nx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nx(e,i)}}function Nx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function t3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,m=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function r3(e){if(Array.isArray(e))return e}var zx=Le.useEffect,Ux=Le.useState,n3=/\B([A-Z])/g,i3=function(i){return i.replace(n3,"-$1").toLowerCase()};function U4(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Ux(),p=Bx(s,2),m=p[0],g=p[1],x=useSceneValue(),C=Ux(function(){return document.createElement("div")}),w=Bx(C,1),R=w[0];return zx(function(){var D=new Control({position:a});return D.onAdd=function(){if(i&&(R.className=i),r){var V=Object.keys(r).map(function(J){return"".concat(i3(J),":").concat(r[J])}).join(";");R.style.cssText=V}return R},D.onRemove=function(){},g(D),x.addControl(D),function(){x.removeControl(D)}},[]),zx(function(){m&&m.setPosition(a||"bottomleft")},[a]),createPortal(n,R)}var Zx=(0,Le.createContext)({});function Z4(){return useContext(Zx)}var Pf=N(96486),j4=Le.useEffect,a3=Le.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Pf.isEqual),V4=Le.useEffect,o3=Le.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Pf.isEqual),G4=Le.useEffect,s3=Le.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Pf.isEqual),u3=Le.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Pf.isEqual),l3=Le.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Pf.isEqual),H4=Le.useEffect,c3=Le.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Pf.isEqual),f3=Le.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Pf.isEqual),p3=Le.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Pf.isEqual),h3=["data"];function d3(e,i){if(e==null)return{};var r=v3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function v3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var m3=Le.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=d3(n,h3);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Pf.isEqual),W4=Le.useEffect,g3=Le.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Pf.isEqual);function y3(e,i){return E3(e)||b3(e,i)||x3(e,i)||_3()}function _3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x3(e,i){if(!!e){if(typeof e=="string")return jx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jx(e,i)}}function jx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function b3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,m=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function E3(e){if(Array.isArray(e))return e}var _v=Le.useEffect,S3=Le.useState;function Vx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,m=i.scale,g=i.active,x=i.select,C=i.filter,w=i.animate,R=i.options,D=i.onLayerLoaded,V=Yn(),J=S3(function(){var He;switch(e){case"polygonLayer":He=new Vy(R);break;case"lineLayer":He=new LC(R);break;case"pointLayer":He=new BA(R);break;case"heatmapLayer":He=new wS(R);break;case"rasterLayer":He=new Ew(R);break;case"imageLayer":He=new FS(R);break;case"citybuildingLayer":He=new $E(R);break;default:He=new Vy(R)}return He.on("inited",function(){D&&D(He,V)}),He}),te=y3(J,1),Se=te[0];return _v(function(){return V.addLayer(Se),function(){V.removeLayer(Se)}},[]),_v(function(){Se.inited&&R&&Se.updateLayerConfig(R)},[R==null?void 0:R.minZoom,R==null?void 0:R.maxZoom,R==null?void 0:R.visible]),_v(function(){Se.inited&&(R==null?void 0:R.zIndex)&&Se.setIndex(R.zIndex)},[R==null?void 0:R.zIndex]),_v(function(){Se.inited&&(R==null?void 0:R.blend)&&Se.setBlend(R.blend)},[R==null?void 0:R.blend]),_v(function(){V.render()}),Le.createElement(Zx.Provider,{value:Se},Le.createElement(m3,{layer:Se,source:r}),m&&Le.createElement(l3,{layer:Se,scale:m}),n&&Le.createElement(s3,{layer:Se,color:n}),p&&Le.createElement(p3,{layer:Se,size:p}),a&&Le.createElement(f3,{layer:Se,shape:a}),s&&Le.createElement(g3,{layer:Se,style:s}),g&&Le.createElement(a3,{layer:Se,active:g}),x&&Le.createElement(c3,{layer:Se,select:x}),C&&Le.createElement(u3,{layer:Se,filter:C}),w&&Le.createElement(o3,{layer:Se,animate:w}),i.children)}var X4=null,Y4=null,Gx=Le.memo(function(i){return Vx("pointLayer",i)}),C3=Le.memo(function(i){return Vx("heatmapLayer",i)}),q4=null,K4=null,$4=null,Q4=Le.useEffect,J4=null,eI=null;function c0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?c0=function(r){return typeof r}:c0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},c0(e)}function Hx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function f0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hx(Object(r),!0).forEach(function(n){A3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function A3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function w3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Wx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T3(e,i,r){return i&&Wx(e.prototype,i),r&&Wx(e,r),e}function M3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&pm(e,i)}function pm(e,i){return pm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},pm(e,i)}function P3(e){var i=R3();return function(){var n=p0(e),a;if(i){var s=p0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return I3(this,a)}}function I3(e,i){if(i&&(c0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O3(e)}function O3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p0(e){return p0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},p0(e)}var tI=function(e){M3(r,e);var i=P3(r);function r(n){var a;return w3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return T3(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,m=s.children,g=s.option,x=s.lngLat,C=new Lg(f0(f0({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&C.setLnglat(p),x&&C.setLnglat(x),m&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,p,m,g,x,C,w=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],R=Array.isArray(this.props.lnglat)?this.props.lnglat:[(m=this.props)===null||m===void 0||(g=m.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],D=w.toString()!==R.toString();if(D){var V;this.popup.remove(),this.popup=new Lg(f0(f0({},this.props.option),{},{stopPropagation:(V=this.props.option)===null||V===void 0?void 0:V.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return Le.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,Fx.createPortal)(a.props.children,a.el)})}}]),r}(Le.PureComponent);function h0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?h0=function(r){return typeof r}:h0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},h0(e)}function L3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Xx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k3(e,i,r){return i&&Xx(e.prototype,i),r&&Xx(e,r),e}function D3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&hm(e,i)}function hm(e,i){return hm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},hm(e,i)}function F3(e){var i=z3();return function(){var n=d0(e),a;if(i){var s=d0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return B3(this,a)}}function B3(e,i){if(i&&(h0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N3(e)}function N3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function d0(e){return d0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},d0(e)}var rI=function(e){D3(r,e);var i=F3(r);function r(n){var a;return L3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return k3(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,m=a.option,g=a.onMarkerLoaded,x=new Mg(m);s&&x.setLnglat(s),p&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return Le.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,Fx.createPortal)(a.props.children,a.el)})}}]),r}(Le.PureComponent),nI=Le.useEffect,iI=null,aI=null,oI=Le.useEffect,sI=null,U3=N(83832),mi=N(85893),Z3=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],j3=function(e){(0,St.Z)(r,e);var i=(0,vt.Z)(r);function r(){var n;(0,Xe.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return(0,De.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,we.Z)(qt().mark(function s(){var p,m,g,x;return qt().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(R){return R.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(R){return R.json()})]);case 2:p=w.sent,m=(0,Qr.Z)(p,2),g=m[0],x=m[1],this.setState({data:g,grid:x,loading:!0});case 7:case"end":return w.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"render",value:function(){var a=this.state,s=a.data,p=a.grid,m=a.loading;return m===!1?(0,mi.jsx)(U3.Z,{}):(0,mi.jsxs)(FM,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[p&&(0,mi.jsx)(C3,{source:{data:p,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),s&&[(0,mi.jsx)(Gx,{options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:Z3},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,mi.jsx)(Gx,{source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(x){return x>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(Le.Component),Yx=N(86582),V3=N(93343),G3=N(70499),Dh=N.n(G3);function H3(e){return e*1<10?"0".concat(e):e}function qx(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(H3(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var W3=function(e){(0,St.Z)(r,e);var i=(0,vt.Z)(r);function r(){var n;(0,Xe.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={activeData:qx()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:qx()},function(){n.loopData()})},1e3)})},n}return(0,De.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var a=this.state.activeData,s=a===void 0?[]:a;return(0,mi.jsxs)("div",{className:Dh().activeChart,children:[(0,mi.jsx)(ae.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,mi.jsx)("div",{style:{marginTop:32},children:(0,mi.jsx)(V3.Z,{autoFit:!0,data:s.map(function(p){return p.y}),height:84})}),s&&(0,mi.jsxs)("div",{children:[(0,mi.jsxs)("div",{className:Dh().activeChartGrid,children:[(0,mi.jsxs)("p",{children:[(0,Yx.Z)(s).sort()[s.length-1].y+200," \u4EBF\u5143"]}),(0,mi.jsxs)("p",{children:[(0,Yx.Z)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143"]})]}),(0,mi.jsx)("div",{className:Dh().dashedLine,children:(0,mi.jsx)("div",{className:Dh().line})}),(0,mi.jsx)("div",{className:Dh().dashedLine,children:(0,mi.jsx)("div",{className:Dh().line})})]}),s&&(0,mi.jsxs)("div",{className:Dh().activeChartLegend,children:[(0,mi.jsx)("span",{children:"00:00"}),(0,mi.jsx)("span",{children:s[Math.floor(s.length/2)].x}),(0,mi.jsx)("span",{children:s[s.length-1].x})]})]})}}]),r}(Le.Component);function X3(){return dm.apply(this,arguments)}function dm(){return dm=(0,we.Z)(qt().mark(function e(){return qt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,et.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),dm.apply(this,arguments)}var Y3=N(19134),Kx=N.n(Y3),q3=ae.Z.Countdown,K3=Date.now()+1e3*60*60*24*2+1e3*30,$3=function(){var i=(0,et.QT)(X3),r=i.loading,n=i.data,a=(n==null?void 0:n.list)||[];return(0,mi.jsx)(Kt.Z,{children:(0,mi.jsxs)(mi.Fragment,{children:[(0,mi.jsxs)(j.Z,{gutter:24,children:[(0,mi.jsx)(se.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,mi.jsxs)(v.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,mi.jsxs)(j.Z,{children:[(0,mi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,mi.jsx)(ae.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:kr()(124543233).format("0,0")})}),(0,mi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,mi.jsx)(ae.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,mi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,mi.jsx)(q3,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:K3,format:"HH:mm:ss:SSS"})}),(0,mi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,mi.jsx)(ae.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:kr()(234).format("0,0")})})]}),(0,mi.jsx)("div",{className:Kx().mapChart,children:(0,mi.jsx)(j3,{})})]})}),(0,mi.jsxs)(se.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,mi.jsx)(v.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,mi.jsx)(W3,{})}),(0,mi.jsx)(v.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,mi.jsx)(dt,{height:180,autoFit:!0,percent:.87,range:{ticks:[0,1/4,2/4,3/4,1]},axis:{label:{formatter:function(p){return Number(p)*100}}},statistic:{content:{content:"\u4F18",style:{color:"#30bf78"}}}})})]})]}),(0,mi.jsxs)(j.Z,{gutter:24,children:[(0,mi.jsx)(se.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,mi.jsx)(v.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:Kx().pieCard,children:(0,mi.jsxs)(j.Z,{style:{padding:"16px 0"},children:[(0,mi.jsx)(se.Z,{span:8,children:(0,mi.jsx)($e.Z,{autoFit:!0,height:128,percent:.28})}),(0,mi.jsx)(se.Z,{span:8,children:(0,mi.jsx)($e.Z,{color:"#5DDECF",autoFit:!0,height:128,percent:.22})}),(0,mi.jsx)(se.Z,{span:8,children:(0,mi.jsx)($e.Z,{color:"#2FC25B",autoFit:!0,height:128,percent:.32})})]})})}),(0,mi.jsx)(se.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,mi.jsx)(v.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,mi.jsx)($t,{data:a,autoFit:!0,wordField:"name",weightField:"value",colorField:"name",height:162,wordStyle:{fontSize:[10,20]}})})}),(0,mi.jsx)(se.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,mi.jsx)(v.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,mi.jsx)(xt,{height:161,percent:.35,autoFit:!0,outline:{border:2,distance:4},padding:[0,0,0,0],statistic:{content:{style:{fontSize:"16px"}}}})})})]})]})})},Q3=$3},9187:function(At){"use strict";At.exports=Q,At.exports.default=Q;function Q(we,Xe,De){De=De||2;var St=Xe&&Xe.length,vt=St?Xe[0]*De:we.length,zt=N(we,0,vt,De,!0),qt=[];if(!zt||zt.next===zt.prev)return qt;var Cr,Yn,vn,Qi,jn,Xn,gi;if(St&&(zt=se(we,Xe,zt,De)),we.length>80*De){Cr=vn=we[0],Yn=Qi=we[1];for(var qn=De;qn<vt;qn+=De)jn=we[qn],Xn=we[qn+1],jn<Cr&&(Cr=jn),Xn<Yn&&(Yn=Xn),jn>vn&&(vn=jn),Xn>Qi&&(Qi=Xn);gi=Math.max(vn-Cr,Qi-Yn),gi=gi!==0?1/gi:0}return ye(zt,qt,De,Cr,Yn,gi),qt}function N(we,Xe,De,St,vt){var zt,qt;if(vt===Qr(we,Xe,De,St)>0)for(zt=Xe;zt<De;zt+=St)qt=Kt(zt,we[zt],we[zt+1],qt);else for(zt=De-St;zt>=Xe;zt-=St)qt=Kt(zt,we[zt],we[zt+1],qt);return qt&&dt(qt,qt.next)&&(Sr(qt),qt=qt.next),qt}function le(we,Xe){if(!we)return we;Xe||(Xe=we);var De=we,St;do if(St=!1,!De.steiner&&(dt(De,De.next)||lt(De.prev,De,De.next)===0)){if(Sr(De),De=Xe=De.prev,De===De.next)break;St=!0}else De=De.next;while(St||De!==Xe);return Xe}function ye(we,Xe,De,St,vt,zt,qt){if(!!we){!qt&&zt&&it(we,St,vt,zt);for(var Cr=we,Yn,vn;we.prev!==we.next;){if(Yn=we.prev,vn=we.next,zt?ve(we,St,vt,zt):v(we)){Xe.push(Yn.i/De),Xe.push(we.i/De),Xe.push(vn.i/De),Sr(we),we=vn.next,Cr=vn.next;continue}if(we=vn,we===Cr){qt?qt===1?(we=j(le(we),Xe,De),ye(we,Xe,De,St,vt,zt,2)):qt===2&&ce(we,Xe,De,St,vt,zt):ye(le(we),Xe,De,St,vt,zt,1);break}}}}function v(we){var Xe=we.prev,De=we,St=we.next;if(lt(Xe,De,St)>=0)return!1;for(var vt=we.next.next;vt!==we.prev;){if(Jt(Xe.x,Xe.y,De.x,De.y,St.x,St.y,vt.x,vt.y)&&lt(vt.prev,vt,vt.next)>=0)return!1;vt=vt.next}return!0}function ve(we,Xe,De,St){var vt=we.prev,zt=we,qt=we.next;if(lt(vt,zt,qt)>=0)return!1;for(var Cr=vt.x<zt.x?vt.x<qt.x?vt.x:qt.x:zt.x<qt.x?zt.x:qt.x,Yn=vt.y<zt.y?vt.y<qt.y?vt.y:qt.y:zt.y<qt.y?zt.y:qt.y,vn=vt.x>zt.x?vt.x>qt.x?vt.x:qt.x:zt.x>qt.x?zt.x:qt.x,Qi=vt.y>zt.y?vt.y>qt.y?vt.y:qt.y:zt.y>qt.y?zt.y:qt.y,jn=sr(Cr,Yn,Xe,De,St),Xn=sr(vn,Qi,Xe,De,St),gi=we.prevZ,qn=we.nextZ;gi&&gi.z>=jn&&qn&&qn.z<=Xn;){if(gi!==we.prev&&gi!==we.next&&Jt(vt.x,vt.y,zt.x,zt.y,qt.x,qt.y,gi.x,gi.y)&&lt(gi.prev,gi,gi.next)>=0||(gi=gi.prevZ,qn!==we.prev&&qn!==we.next&&Jt(vt.x,vt.y,zt.x,zt.y,qt.x,qt.y,qn.x,qn.y)&&lt(qn.prev,qn,qn.next)>=0))return!1;qn=qn.nextZ}for(;gi&&gi.z>=jn;){if(gi!==we.prev&&gi!==we.next&&Jt(vt.x,vt.y,zt.x,zt.y,qt.x,qt.y,gi.x,gi.y)&&lt(gi.prev,gi,gi.next)>=0)return!1;gi=gi.prevZ}for(;qn&&qn.z<=Xn;){if(qn!==we.prev&&qn!==we.next&&Jt(vt.x,vt.y,zt.x,zt.y,qt.x,qt.y,qn.x,qn.y)&&lt(qn.prev,qn,qn.next)>=0)return!1;qn=qn.nextZ}return!0}function j(we,Xe,De){var St=we;do{var vt=St.prev,zt=St.next.next;!dt(vt,zt)&&er(vt,St,St.next,zt)&&Qe(vt,zt)&&Qe(zt,vt)&&(Xe.push(vt.i/De),Xe.push(St.i/De),Xe.push(zt.i/De),Sr(St),Sr(St.next),St=we=zt),St=St.next}while(St!==we);return le(St)}function ce(we,Xe,De,St,vt,zt){var qt=we;do{for(var Cr=qt.next.next;Cr!==qt.prev;){if(qt.i!==Cr.i&&Mt(qt,Cr)){var Yn=$e(qt,Cr);qt=le(qt,qt.next),Yn=le(Yn,Yn.next),ye(qt,Xe,De,St,vt,zt),ye(Yn,Xe,De,St,vt,zt);return}Cr=Cr.next}qt=qt.next}while(qt!==we)}function se(we,Xe,De,St){var vt=[],zt,qt,Cr,Yn,vn;for(zt=0,qt=Xe.length;zt<qt;zt++)Cr=Xe[zt]*St,Yn=zt<qt-1?Xe[zt+1]*St:we.length,vn=N(we,Cr,Yn,St,!1),vn===vn.next&&(vn.steiner=!0),vt.push(Ct(vn));for(vt.sort(Ne),zt=0;zt<vt.length;zt++)De=ae(vt[zt],De),De=le(De,De.next);return De}function Ne(we,Xe){return we.x-Xe.x}function ae(we,Xe){var De=et(we,Xe);if(!De)return Xe;var St=$e(De,we),vt=le(De,De.next);return le(St,St.next),Xe===De?vt:Xe}function et(we,Xe){var De=Xe,St=we.x,vt=we.y,zt=-Infinity,qt;do{if(vt<=De.y&&vt>=De.next.y&&De.next.y!==De.y){var Cr=De.x+(vt-De.y)*(De.next.x-De.x)/(De.next.y-De.y);if(Cr<=St&&Cr>zt){if(zt=Cr,Cr===St){if(vt===De.y)return De;if(vt===De.next.y)return De.next}qt=De.x<De.next.x?De:De.next}}De=De.next}while(De!==Xe);if(!qt)return null;if(St===zt)return qt;var Yn=qt,vn=qt.x,Qi=qt.y,jn=Infinity,Xn;De=qt;do St>=De.x&&De.x>=vn&&St!==De.x&&Jt(vt<Qi?St:zt,vt,vn,Qi,vt<Qi?zt:St,vt,De.x,De.y)&&(Xn=Math.abs(vt-De.y)/(St-De.x),Qe(De,we)&&(Xn<jn||Xn===jn&&(De.x>qt.x||De.x===qt.x&&Le(qt,De)))&&(qt=De,jn=Xn)),De=De.next;while(De!==Yn);return qt}function Le(we,Xe){return lt(we.prev,we,Xe.prev)<0&&lt(Xe.next,we,we.next)<0}function it(we,Xe,De,St){var vt=we;do vt.z===null&&(vt.z=sr(vt.x,vt.y,Xe,De,St)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next;while(vt!==we);vt.prevZ.nextZ=null,vt.prevZ=null,Ht(vt)}function Ht(we){var Xe,De,St,vt,zt,qt,Cr,Yn,vn=1;do{for(De=we,we=null,zt=null,qt=0;De;){for(qt++,St=De,Cr=0,Xe=0;Xe<vn&&(Cr++,St=St.nextZ,!!St);Xe++);for(Yn=vn;Cr>0||Yn>0&&St;)Cr!==0&&(Yn===0||!St||De.z<=St.z)?(vt=De,De=De.nextZ,Cr--):(vt=St,St=St.nextZ,Yn--),zt?zt.nextZ=vt:we=vt,vt.prevZ=zt,zt=vt;De=St}zt.nextZ=null,vn*=2}while(qt>1);return we}function sr(we,Xe,De,St,vt){return we=32767*(we-De)*vt,Xe=32767*(Xe-St)*vt,we=(we|we<<8)&16711935,we=(we|we<<4)&252645135,we=(we|we<<2)&858993459,we=(we|we<<1)&1431655765,Xe=(Xe|Xe<<8)&16711935,Xe=(Xe|Xe<<4)&252645135,Xe=(Xe|Xe<<2)&858993459,Xe=(Xe|Xe<<1)&1431655765,we|Xe<<1}function Ct(we){var Xe=we,De=we;do(Xe.x<De.x||Xe.x===De.x&&Xe.y<De.y)&&(De=Xe),Xe=Xe.next;while(Xe!==we);return De}function Jt(we,Xe,De,St,vt,zt,qt,Cr){return(vt-qt)*(Xe-Cr)-(we-qt)*(zt-Cr)>=0&&(we-qt)*(St-Cr)-(De-qt)*(Xe-Cr)>=0&&(De-qt)*(zt-Cr)-(vt-qt)*(St-Cr)>=0}function Mt(we,Xe){return we.next.i!==Xe.i&&we.prev.i!==Xe.i&&!gt(we,Xe)&&(Qe(we,Xe)&&Qe(Xe,we)&&xt(we,Xe)&&(lt(we.prev,we,Xe.prev)||lt(we,Xe.prev,Xe))||dt(we,Xe)&&lt(we.prev,we,we.next)>0&&lt(Xe.prev,Xe,Xe.next)>0)}function lt(we,Xe,De){return(Xe.y-we.y)*(De.x-Xe.x)-(Xe.x-we.x)*(De.y-Xe.y)}function dt(we,Xe){return we.x===Xe.x&&we.y===Xe.y}function er(we,Xe,De,St){var vt=$t(lt(we,Xe,De)),zt=$t(lt(we,Xe,St)),qt=$t(lt(De,St,we)),Cr=$t(lt(De,St,Xe));return!!(vt!==zt&&qt!==Cr||vt===0&&Y(we,De,Xe)||zt===0&&Y(we,St,Xe)||qt===0&&Y(De,we,St)||Cr===0&&Y(De,Xe,St))}function Y(we,Xe,De){return Xe.x<=Math.max(we.x,De.x)&&Xe.x>=Math.min(we.x,De.x)&&Xe.y<=Math.max(we.y,De.y)&&Xe.y>=Math.min(we.y,De.y)}function $t(we){return we>0?1:we<0?-1:0}function gt(we,Xe){var De=we;do{if(De.i!==we.i&&De.next.i!==we.i&&De.i!==Xe.i&&De.next.i!==Xe.i&&er(De,De.next,we,Xe))return!0;De=De.next}while(De!==we);return!1}function Qe(we,Xe){return lt(we.prev,we,we.next)<0?lt(we,Xe,we.next)>=0&&lt(we,we.prev,Xe)>=0:lt(we,Xe,we.prev)<0||lt(we,we.next,Xe)<0}function xt(we,Xe){var De=we,St=!1,vt=(we.x+Xe.x)/2,zt=(we.y+Xe.y)/2;do De.y>zt!=De.next.y>zt&&De.next.y!==De.y&&vt<(De.next.x-De.x)*(zt-De.y)/(De.next.y-De.y)+De.x&&(St=!St),De=De.next;while(De!==we);return St}function $e(we,Xe){var De=new kr(we.i,we.x,we.y),St=new kr(Xe.i,Xe.x,Xe.y),vt=we.next,zt=Xe.prev;return we.next=Xe,Xe.prev=we,De.next=vt,vt.prev=De,St.next=De,De.prev=St,zt.next=St,St.prev=zt,St}function Kt(we,Xe,De,St){var vt=new kr(we,Xe,De);return St?(vt.next=St.next,vt.prev=St,St.next.prev=vt,St.next=vt):(vt.prev=vt,vt.next=vt),vt}function Sr(we){we.next.prev=we.prev,we.prev.next=we.next,we.prevZ&&(we.prevZ.nextZ=we.nextZ),we.nextZ&&(we.nextZ.prevZ=we.prevZ)}function kr(we,Xe,De){this.i=we,this.x=Xe,this.y=De,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Q.deviation=function(we,Xe,De,St){var vt=Xe&&Xe.length,zt=vt?Xe[0]*De:we.length,qt=Math.abs(Qr(we,0,zt,De));if(vt)for(var Cr=0,Yn=Xe.length;Cr<Yn;Cr++){var vn=Xe[Cr]*De,Qi=Cr<Yn-1?Xe[Cr+1]*De:we.length;qt-=Math.abs(Qr(we,vn,Qi,De))}var jn=0;for(Cr=0;Cr<St.length;Cr+=3){var Xn=St[Cr]*De,gi=St[Cr+1]*De,qn=St[Cr+2]*De;jn+=Math.abs((we[Xn]-we[qn])*(we[gi+1]-we[Xn+1])-(we[Xn]-we[gi])*(we[qn+1]-we[Xn+1]))}return qt===0&&jn===0?0:Math.abs((jn-qt)/qt)};function Qr(we,Xe,De,St){for(var vt=0,zt=Xe,qt=De-St;zt<De;zt+=St)vt+=(we[qt]-we[zt])*(we[zt+1]+we[qt+1]),qt=zt;return vt}Q.flatten=function(we){for(var Xe=we[0][0].length,De={vertices:[],holes:[],dimensions:Xe},St=0,vt=0;vt<we.length;vt++){for(var zt=0;zt<we[vt].length;zt++)for(var qt=0;qt<Xe;qt++)De.vertices.push(we[vt][zt][qt]);vt>0&&(St+=we[vt-1].length,De.holes.push(St))}return De}},67709:function(At){function Q(le){var ye=le.target||le.srcElement;ye.__resizeRAF__&&cancelAnimationFrame(ye.__resizeRAF__),ye.__resizeRAF__=requestAnimationFrame(function(){var v=ye.__resizeTrigger__,ve=v&&v.__resizeListeners__;ve&&ve.forEach(function(j){j.call(v,le)})})}var N=function(ye,v){var ve=this,j=ve.document,ce,se=j.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ne(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Q)}if(!ye.__resizeListeners__)if(ye.__resizeListeners__=[],se)ye.__resizeTrigger__=ye,ye.attachEvent("onresize",Q);else{getComputedStyle(ye).position==="static"&&(ye.style.position="relative");var ae=ye.__resizeTrigger__=j.createElement("object");ae.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ae.setAttribute("class","resize-sensor"),ae.setAttribute("tabindex","-1"),ae.setAttribute("title",""),ae.__resizeElement__=ye,ae.onload=Ne,ae.type="text/html",ce&&ye.appendChild(ae),ae.data="about:blank",ce||ye.appendChild(ae)}ye.__resizeListeners__.push(v)};At.exports=typeof window=="undefined"?N:N.bind(window),At.exports.unbind=function(le,ye){var v=document.attachEvent,ve=le.__resizeListeners__||[];if(ye){var j=ve.indexOf(ye);j!==-1&&ve.splice(j,1)}else ve=le.__resizeListeners__=[];if(!ve.length){if(v)le.detachEvent("onresize",Q);else if(le.__resizeTrigger__){var ce=le.__resizeTrigger__.contentDocument,se=ce&&ce.defaultView;se&&(se.removeEventListener("resize",Q),delete se.__resizeTrigger__),le.__resizeTrigger__=!le.removeChild(le.__resizeTrigger__)}delete le.__resizeListeners__}}},26729:function(At){"use strict";var Q=Object.prototype.hasOwnProperty,N="~";function le(){}Object.create&&(le.prototype=Object.create(null),new le().__proto__||(N=!1));function ye(ce,se,Ne){this.fn=ce,this.context=se,this.once=Ne||!1}function v(ce,se,Ne,ae,et){if(typeof Ne!="function")throw new TypeError("The listener must be a function");var Le=new ye(Ne,ae||ce,et),it=N?N+se:se;return ce._events[it]?ce._events[it].fn?ce._events[it]=[ce._events[it],Le]:ce._events[it].push(Le):(ce._events[it]=Le,ce._eventsCount++),ce}function ve(ce,se){--ce._eventsCount==0?ce._events=new le:delete ce._events[se]}function j(){this._events=new le,this._eventsCount=0}j.prototype.eventNames=function(){var se=[],Ne,ae;if(this._eventsCount===0)return se;for(ae in Ne=this._events)Q.call(Ne,ae)&&se.push(N?ae.slice(1):ae);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(Ne)):se},j.prototype.listeners=function(se){var Ne=N?N+se:se,ae=this._events[Ne];if(!ae)return[];if(ae.fn)return[ae.fn];for(var et=0,Le=ae.length,it=new Array(Le);et<Le;et++)it[et]=ae[et].fn;return it},j.prototype.listenerCount=function(se){var Ne=N?N+se:se,ae=this._events[Ne];return ae?ae.fn?1:ae.length:0},j.prototype.emit=function(se,Ne,ae,et,Le,it){var Ht=N?N+se:se;if(!this._events[Ht])return!1;var sr=this._events[Ht],Ct=arguments.length,Jt,Mt;if(sr.fn){switch(sr.once&&this.removeListener(se,sr.fn,void 0,!0),Ct){case 1:return sr.fn.call(sr.context),!0;case 2:return sr.fn.call(sr.context,Ne),!0;case 3:return sr.fn.call(sr.context,Ne,ae),!0;case 4:return sr.fn.call(sr.context,Ne,ae,et),!0;case 5:return sr.fn.call(sr.context,Ne,ae,et,Le),!0;case 6:return sr.fn.call(sr.context,Ne,ae,et,Le,it),!0}for(Mt=1,Jt=new Array(Ct-1);Mt<Ct;Mt++)Jt[Mt-1]=arguments[Mt];sr.fn.apply(sr.context,Jt)}else{var lt=sr.length,dt;for(Mt=0;Mt<lt;Mt++)switch(sr[Mt].once&&this.removeListener(se,sr[Mt].fn,void 0,!0),Ct){case 1:sr[Mt].fn.call(sr[Mt].context);break;case 2:sr[Mt].fn.call(sr[Mt].context,Ne);break;case 3:sr[Mt].fn.call(sr[Mt].context,Ne,ae);break;case 4:sr[Mt].fn.call(sr[Mt].context,Ne,ae,et);break;default:if(!Jt)for(dt=1,Jt=new Array(Ct-1);dt<Ct;dt++)Jt[dt-1]=arguments[dt];sr[Mt].fn.apply(sr[Mt].context,Jt)}}return!0},j.prototype.on=function(se,Ne,ae){return v(this,se,Ne,ae,!1)},j.prototype.once=function(se,Ne,ae){return v(this,se,Ne,ae,!0)},j.prototype.removeListener=function(se,Ne,ae,et){var Le=N?N+se:se;if(!this._events[Le])return this;if(!Ne)return ve(this,Le),this;var it=this._events[Le];if(it.fn)it.fn===Ne&&(!et||it.once)&&(!ae||it.context===ae)&&ve(this,Le);else{for(var Ht=0,sr=[],Ct=it.length;Ht<Ct;Ht++)(it[Ht].fn!==Ne||et&&!it[Ht].once||ae&&it[Ht].context!==ae)&&sr.push(it[Ht]);sr.length?this._events[Le]=sr.length===1?sr[0]:sr:ve(this,Le)}return this},j.prototype.removeAllListeners=function(se){var Ne;return se?(Ne=N?N+se:se,this._events[Ne]&&ve(this,Ne)):(this._events=new le,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=N,j.EventEmitter=j,At.exports=j},7375:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var N=Symbol.for("INJECTION");function le(ce,se,Ne,ae){function et(){return ae&&!Reflect.hasMetadata(N,this,se)&&Reflect.defineMetadata(N,Ne(),this,se),Reflect.hasMetadata(N,this,se)?Reflect.getMetadata(N,this,se):Ne()}function Le(it){Reflect.defineMetadata(N,it,this,se)}Object.defineProperty(ce,se,{configurable:!0,enumerable:!0,get:et,set:Le})}function ye(ce,se){return function(Ne){return function(ae,et){var Le=function(){return ce.get(Ne)};le(ae,et,Le,se)}}}Q.makePropertyInjectDecorator=ye;function v(ce,se){return function(Ne,ae){return function(et,Le){var it=function(){return ce.getNamed(Ne,ae)};le(et,Le,it,se)}}}Q.makePropertyInjectNamedDecorator=v;function ve(ce,se){return function(Ne,ae,et){return function(Le,it){var Ht=function(){return ce.getTagged(Ne,ae,et)};le(Le,it,Ht,se)}}}Q.makePropertyInjectTaggedDecorator=ve;function j(ce,se){return function(Ne){return function(ae,et){var Le=function(){return ce.getAll(Ne)};le(ae,et,Le,se)}}}Q.makePropertyMultiInjectDecorator=j},84879:function(At,Q,N){"use strict";var le;le={value:!0};var ye=N(7375);function v(ve,j){j===void 0&&(j=!0);var ce=ye.makePropertyInjectDecorator(ve,j),se=ye.makePropertyInjectNamedDecorator(ve,j),Ne=ye.makePropertyInjectTaggedDecorator(ve,j),ae=ye.makePropertyMultiInjectDecorator(ve,j);return{lazyInject:ce,lazyInjectNamed:se,lazyInjectTagged:Ne,lazyMultiInject:ae}}Q.Z=v},99934:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagProperty=Q.tagParameter=Q.decorate=void 0;var le=N(16674),ye=N(6867);function v(ae,et,Le,it){var Ht=ye.TAGGED;j(Ht,ae,et,it,Le)}Q.tagParameter=v;function ve(ae,et,Le){var it=ye.TAGGED_PROP;j(it,ae.constructor,et,Le)}Q.tagProperty=ve;function j(ae,et,Le,it,Ht){var sr={},Ct=typeof Ht=="number",Jt=Ht!==void 0&&Ct?Ht.toString():Le;if(Ct&&Le!==void 0)throw new Error(le.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ae,et)&&(sr=Reflect.getMetadata(ae,et));var Mt=sr[Jt];if(!Array.isArray(Mt))Mt=[];else for(var lt=0,dt=Mt;lt<dt.length;lt++){var er=dt[lt];if(er.key===it.key)throw new Error(le.DUPLICATED_METADATA+" "+er.key.toString())}Mt.push(it),sr[Jt]=Mt,Reflect.defineMetadata(ae,sr,et)}function ce(ae,et){Reflect.decorate(ae,et)}function se(ae,et){return function(Le,it){et(Le,it,ae)}}function Ne(ae,et,Le){typeof Le=="number"?ce([se(Le,ae)],et):typeof Le=="string"?Reflect.decorate([ae],et,Le):ce([ae],et)}Q.decorate=Ne},5744:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.inject=Q.LazyServiceIdentifer=void 0;var le=N(16674),ye=N(6867),v=N(47738),ve=N(99934),j=function(){function se(Ne){this._cb=Ne}return se.prototype.unwrap=function(){return this._cb()},se}();Q.LazyServiceIdentifer=j;function ce(se){return function(Ne,ae,et){if(se===void 0)throw new Error(le.UNDEFINED_INJECT_ANNOTATION(Ne.name));var Le=new v.Metadata(ye.INJECT_TAG,se);typeof et=="number"?ve.tagParameter(Ne,ae,et,Le):ve.tagProperty(Ne,ae,Le)}}Q.inject=ce},64315:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.injectable=void 0;var le=N(16674),ye=N(6867);function v(){return function(ve){if(Reflect.hasOwnMetadata(ye.PARAM_TYPES,ve))throw new Error(le.DUPLICATED_INJECTABLE_DECORATOR);var j=Reflect.getMetadata(ye.DESIGN_PARAM_TYPES,ve)||[];return Reflect.defineMetadata(ye.PARAM_TYPES,j,ve),ve}}Q.injectable=v},71693:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiInject=void 0;var le=N(6867),ye=N(47738),v=N(99934);function ve(j){return function(ce,se,Ne){var ae=new ye.Metadata(le.MULTI_INJECT_TAG,j);typeof Ne=="number"?v.tagParameter(ce,se,Ne,ae):v.tagProperty(ce,se,ae)}}Q.multiInject=ve},38085:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.named=void 0;var le=N(6867),ye=N(47738),v=N(99934);function ve(j){return function(ce,se,Ne){var ae=new ye.Metadata(le.NAMED_TAG,j);typeof Ne=="number"?v.tagParameter(ce,se,Ne,ae):v.tagProperty(ce,se,ae)}}Q.named=ve},6515:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.optional=void 0;var le=N(6867),ye=N(47738),v=N(99934);function ve(){return function(j,ce,se){var Ne=new ye.Metadata(le.OPTIONAL_TAG,!0);typeof se=="number"?v.tagParameter(j,ce,se,Ne):v.tagProperty(j,ce,Ne)}}Q.optional=ve},7014:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.postConstruct=void 0;var le=N(16674),ye=N(6867),v=N(47738);function ve(){return function(j,ce,se){var Ne=new v.Metadata(ye.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(ye.POST_CONSTRUCT,j.constructor))throw new Error(le.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ye.POST_CONSTRUCT,Ne,j.constructor)}}Q.postConstruct=ve},32052:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagged=void 0;var le=N(47738),ye=N(99934);function v(ve,j){return function(ce,se,Ne){var ae=new le.Metadata(ve,j);typeof Ne=="number"?ye.tagParameter(ce,se,Ne,ae):ye.tagProperty(ce,se,ae)}}Q.tagged=v},55638:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.targetName=void 0;var le=N(6867),ye=N(47738),v=N(99934);function ve(j){return function(ce,se,Ne){var ae=new ye.Metadata(le.NAME_TAG,j);v.tagParameter(ce,se,Ne,ae)}}Q.targetName=ve},86757:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.unmanaged=void 0;var le=N(6867),ye=N(47738),v=N(99934);function ve(){return function(j,ce,se){var Ne=new ye.Metadata(le.UNMANAGED_TAG,!0);v.tagParameter(j,ce,se,Ne)}}Q.unmanaged=ve},44290:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Binding=void 0;var le=N(28421),ye=N(37791),v=function(){function ve(j,ce){this.id=ye.id(),this.activated=!1,this.serviceIdentifier=j,this.scope=ce,this.type=le.BindingTypeEnum.Invalid,this.constraint=function(se){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ve.prototype.clone=function(){var j=new ve(this.serviceIdentifier,this.scope);return j.activated=j.scope===le.BindingScopeEnum.Singleton?this.activated:!1,j.implementationType=this.implementationType,j.dynamicValue=this.dynamicValue,j.scope=this.scope,j.type=this.type,j.factory=this.factory,j.provider=this.provider,j.constraint=this.constraint,j.onActivation=this.onActivation,j.cache=this.cache,j},ve}();Q.Binding=v},23184:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingCount=void 0;var N={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Q.BindingCount=N},16674:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.STACK_OVERFLOW=Q.CIRCULAR_DEPENDENCY_IN_FACTORY=Q.POST_CONSTRUCT_ERROR=Q.MULTIPLE_POST_CONSTRUCT_METHODS=Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Q.ARGUMENTS_LENGTH_MISMATCH=Q.INVALID_DECORATOR_OPERATION=Q.INVALID_TO_SELF_VALUE=Q.INVALID_FUNCTION_BINDING=Q.INVALID_MIDDLEWARE_RETURN=Q.NO_MORE_SNAPSHOTS_AVAILABLE=Q.INVALID_BINDING_TYPE=Q.NOT_IMPLEMENTED=Q.CIRCULAR_DEPENDENCY=Q.UNDEFINED_INJECT_ANNOTATION=Q.MISSING_INJECT_ANNOTATION=Q.MISSING_INJECTABLE_ANNOTATION=Q.NOT_REGISTERED=Q.CANNOT_UNBIND=Q.AMBIGUOUS_MATCH=Q.KEY_NOT_FOUND=Q.NULL_ARGUMENT=Q.DUPLICATED_METADATA=Q.DUPLICATED_INJECTABLE_DECORATOR=void 0,Q.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Q.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Q.NULL_ARGUMENT="NULL argument",Q.KEY_NOT_FOUND="Key Not Found",Q.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Q.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Q.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Q.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Q.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var N=function(ve){return"@inject called with undefined this could mean that the class "+ve+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Q.UNDEFINED_INJECT_ANNOTATION=N,Q.CIRCULAR_DEPENDENCY="Circular dependency found:",Q.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Q.INVALID_BINDING_TYPE="Invalid binding type:",Q.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Q.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Q.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Q.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Q.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var le=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"The number of constructor arguments in the derived class "+(ve[0]+" must be >= than the number of constructor arguments of its base class.")};Q.ARGUMENTS_LENGTH_MISMATCH=le,Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Q.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ye=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"@postConstruct error in class "+ve[0]+": "+ve[1]};Q.POST_CONSTRUCT_ERROR=ye;var v=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"It looks like there is a circular dependency "+("in one of the '"+ve[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ve[1]+"'.")};Q.CIRCULAR_DEPENDENCY_IN_FACTORY=v,Q.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.TargetTypeEnum=Q.BindingTypeEnum=Q.BindingScopeEnum=void 0;var N={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Q.BindingScopeEnum=N;var le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Q.BindingTypeEnum=le;var ye={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Q.TargetTypeEnum=ye},6867:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.NON_CUSTOM_TAG_KEYS=Q.POST_CONSTRUCT=Q.DESIGN_PARAM_TYPES=Q.PARAM_TYPES=Q.TAGGED_PROP=Q.TAGGED=Q.MULTI_INJECT_TAG=Q.INJECT_TAG=Q.OPTIONAL_TAG=Q.UNMANAGED_TAG=Q.NAME_TAG=Q.NAMED_TAG=void 0,Q.NAMED_TAG="named",Q.NAME_TAG="name",Q.UNMANAGED_TAG="unmanaged",Q.OPTIONAL_TAG="optional",Q.INJECT_TAG="inject",Q.MULTI_INJECT_TAG="multi_inject",Q.TAGGED="inversify:tagged",Q.TAGGED_PROP="inversify:tagged_props",Q.PARAM_TYPES="inversify:paramtypes",Q.DESIGN_PARAM_TYPES="design:paramtypes",Q.POST_CONSTRUCT="post_construct";function N(){return[Q.INJECT_TAG,Q.MULTI_INJECT_TAG,Q.NAME_TAG,Q.UNMANAGED_TAG,Q.NAMED_TAG,Q.OPTIONAL_TAG]}Q.NON_CUSTOM_TAG_KEYS=N()},51389:function(At,Q,N){"use strict";var le=this&&this.__awaiter||function(Mt,lt,dt,er){function Y($t){return $t instanceof dt?$t:new dt(function(gt){gt($t)})}return new(dt||(dt=Promise))(function($t,gt){function Qe(Kt){try{$e(er.next(Kt))}catch(Sr){gt(Sr)}}function xt(Kt){try{$e(er.throw(Kt))}catch(Sr){gt(Sr)}}function $e(Kt){Kt.done?$t(Kt.value):Y(Kt.value).then(Qe,xt)}$e((er=er.apply(Mt,lt||[])).next())})},ye=this&&this.__generator||function(Mt,lt){var dt={label:0,sent:function(){if($t[0]&1)throw $t[1];return $t[1]},trys:[],ops:[]},er,Y,$t,gt;return gt={next:Qe(0),throw:Qe(1),return:Qe(2)},typeof Symbol=="function"&&(gt[Symbol.iterator]=function(){return this}),gt;function Qe($e){return function(Kt){return xt([$e,Kt])}}function xt($e){if(er)throw new TypeError("Generator is already executing.");for(;dt;)try{if(er=1,Y&&($t=$e[0]&2?Y.return:$e[0]?Y.throw||(($t=Y.return)&&$t.call(Y),0):Y.next)&&!($t=$t.call(Y,$e[1])).done)return $t;switch(Y=0,$t&&($e=[$e[0]&2,$t.value]),$e[0]){case 0:case 1:$t=$e;break;case 4:return dt.label++,{value:$e[1],done:!1};case 5:dt.label++,Y=$e[1],$e=[0];continue;case 7:$e=dt.ops.pop(),dt.trys.pop();continue;default:if($t=dt.trys,!($t=$t.length>0&&$t[$t.length-1])&&($e[0]===6||$e[0]===2)){dt=0;continue}if($e[0]===3&&(!$t||$e[1]>$t[0]&&$e[1]<$t[3])){dt.label=$e[1];break}if($e[0]===6&&dt.label<$t[1]){dt.label=$t[1],$t=$e;break}if($t&&dt.label<$t[2]){dt.label=$t[2],dt.ops.push($e);break}$t[2]&&dt.ops.pop(),dt.trys.pop();continue}$e=lt.call(Mt,dt)}catch(Kt){$e=[6,Kt],Y=0}finally{er=$t=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(Mt,lt){for(var dt=0,er=lt.length,Y=Mt.length;dt<er;dt++,Y++)Mt[Y]=lt[dt];return Mt};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Container=void 0;var ve=N(44290),j=N(16674),ce=N(28421),se=N(6867),Ne=N(51377),ae=N(86311),et=N(31927),Le=N(15451),it=N(37791),Ht=N(55800),sr=N(85700),Ct=N(80175),Jt=function(){function Mt(lt){this._appliedMiddleware=[];var dt=lt||{};if(typeof dt!="object")throw new Error(""+j.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(dt.defaultScope===void 0)dt.defaultScope=ce.BindingScopeEnum.Transient;else if(dt.defaultScope!==ce.BindingScopeEnum.Singleton&&dt.defaultScope!==ce.BindingScopeEnum.Transient&&dt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+j.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(dt.autoBindInjectable===void 0)dt.autoBindInjectable=!1;else if(typeof dt.autoBindInjectable!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(dt.skipBaseClassChecks===void 0)dt.skipBaseClassChecks=!1;else if(typeof dt.skipBaseClassChecks!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:dt.autoBindInjectable,defaultScope:dt.defaultScope,skipBaseClassChecks:dt.skipBaseClassChecks},this.id=it.id(),this._bindingDictionary=new Ct.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ne.MetadataReader}return Mt.merge=function(lt,dt){for(var er=[],Y=2;Y<arguments.length;Y++)er[Y-2]=arguments[Y];var $t=new Mt,gt=v([lt,dt],er).map(function($e){return ae.getBindingDictionary($e)}),Qe=ae.getBindingDictionary($t);function xt($e,Kt){$e.traverse(function(Sr,kr){kr.forEach(function(Qr){Kt.add(Qr.serviceIdentifier,Qr.clone())})})}return gt.forEach(function($e){xt($e,Qe)}),$t},Mt.prototype.load=function(){for(var lt=[],dt=0;dt<arguments.length;dt++)lt[dt]=arguments[dt];for(var er=this._getContainerModuleHelpersFactory(),Y=0,$t=lt;Y<$t.length;Y++){var gt=$t[Y],Qe=er(gt.id);gt.registry(Qe.bindFunction,Qe.unbindFunction,Qe.isboundFunction,Qe.rebindFunction)}},Mt.prototype.loadAsync=function(){for(var lt=[],dt=0;dt<arguments.length;dt++)lt[dt]=arguments[dt];return le(this,void 0,void 0,function(){var er,Y,$t,gt,Qe;return ye(this,function(xt){switch(xt.label){case 0:er=this._getContainerModuleHelpersFactory(),Y=0,$t=lt,xt.label=1;case 1:return Y<$t.length?(gt=$t[Y],Qe=er(gt.id),[4,gt.registry(Qe.bindFunction,Qe.unbindFunction,Qe.isboundFunction,Qe.rebindFunction)]):[3,4];case 2:xt.sent(),xt.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},Mt.prototype.unload=function(){for(var lt=this,dt=[],er=0;er<arguments.length;er++)dt[er]=arguments[er];var Y=function($t){return function(gt){return gt.moduleId===$t}};dt.forEach(function($t){var gt=Y($t.id);lt._bindingDictionary.removeByCondition(gt)})},Mt.prototype.bind=function(lt){var dt=this.options.defaultScope||ce.BindingScopeEnum.Transient,er=new ve.Binding(lt,dt);return this._bindingDictionary.add(lt,er),new Le.BindingToSyntax(er)},Mt.prototype.rebind=function(lt){return this.unbind(lt),this.bind(lt)},Mt.prototype.unbind=function(lt){try{this._bindingDictionary.remove(lt)}catch(dt){throw new Error(j.CANNOT_UNBIND+" "+Ht.getServiceIdentifierAsString(lt))}},Mt.prototype.unbindAll=function(){this._bindingDictionary=new Ct.Lookup},Mt.prototype.isBound=function(lt){var dt=this._bindingDictionary.hasKey(lt);return!dt&&this.parent&&(dt=this.parent.isBound(lt)),dt},Mt.prototype.isBoundNamed=function(lt,dt){return this.isBoundTagged(lt,se.NAMED_TAG,dt)},Mt.prototype.isBoundTagged=function(lt,dt,er){var Y=!1;if(this._bindingDictionary.hasKey(lt)){var $t=this._bindingDictionary.get(lt),gt=ae.createMockRequest(this,lt,dt,er);Y=$t.some(function(Qe){return Qe.constraint(gt)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(lt,dt,er)),Y},Mt.prototype.snapshot=function(){this._snapshots.push(sr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Mt.prototype.restore=function(){var lt=this._snapshots.pop();if(lt===void 0)throw new Error(j.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=lt.bindings,this._middleware=lt.middleware},Mt.prototype.createChild=function(lt){var dt=new Mt(lt||this.options);return dt.parent=this,dt},Mt.prototype.applyMiddleware=function(){for(var lt=[],dt=0;dt<arguments.length;dt++)lt[dt]=arguments[dt];this._appliedMiddleware=this._appliedMiddleware.concat(lt);var er=this._middleware?this._middleware:this._planAndResolve();this._middleware=lt.reduce(function(Y,$t){return $t(Y)},er)},Mt.prototype.applyCustomMetadataReader=function(lt){this._metadataReader=lt},Mt.prototype.get=function(lt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,lt)},Mt.prototype.getTagged=function(lt,dt,er){return this._get(!1,!1,ce.TargetTypeEnum.Variable,lt,dt,er)},Mt.prototype.getNamed=function(lt,dt){return this.getTagged(lt,se.NAMED_TAG,dt)},Mt.prototype.getAll=function(lt){return this._get(!0,!0,ce.TargetTypeEnum.Variable,lt)},Mt.prototype.getAllTagged=function(lt,dt,er){return this._get(!1,!0,ce.TargetTypeEnum.Variable,lt,dt,er)},Mt.prototype.getAllNamed=function(lt,dt){return this.getAllTagged(lt,se.NAMED_TAG,dt)},Mt.prototype.resolve=function(lt){var dt=this.createChild();return dt.bind(lt).toSelf(),this._appliedMiddleware.forEach(function(er){dt.applyMiddleware(er)}),dt.get(lt)},Mt.prototype._getContainerModuleHelpersFactory=function(){var lt=this,dt=function(Qe,xt){Qe._binding.moduleId=xt},er=function(Qe){return function(xt){var $e=lt.bind.bind(lt),Kt=$e(xt);return dt(Kt,Qe),Kt}},Y=function(Qe){return function(xt){var $e=lt.unbind.bind(lt);$e(xt)}},$t=function(Qe){return function(xt){var $e=lt.isBound.bind(lt);return $e(xt)}},gt=function(Qe){return function(xt){var $e=lt.rebind.bind(lt),Kt=$e(xt);return dt(Kt,Qe),Kt}};return function(Qe){return{bindFunction:er(Qe),isboundFunction:$t(Qe),rebindFunction:gt(Qe),unbindFunction:Y(Qe)}}},Mt.prototype._get=function(lt,dt,er,Y,$t,gt){var Qe=null,xt={avoidConstraints:lt,contextInterceptor:function($e){return $e},isMultiInject:dt,key:$t,serviceIdentifier:Y,targetType:er,value:gt};if(this._middleware){if(Qe=this._middleware(xt),Qe==null)throw new Error(j.INVALID_MIDDLEWARE_RETURN)}else Qe=this._planAndResolve()(xt);return Qe},Mt.prototype._planAndResolve=function(){var lt=this;return function(dt){var er=ae.plan(lt._metadataReader,lt,dt.isMultiInject,dt.targetType,dt.serviceIdentifier,dt.key,dt.value,dt.avoidConstraints);er=dt.contextInterceptor(er);var Y=et.resolve(er);return Y}},Mt}();Q.Container=Jt},33244:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.AsyncContainerModule=Q.ContainerModule=void 0;var le=N(37791),ye=function(){function ve(j){this.id=le.id(),this.registry=j}return ve}();Q.ContainerModule=ye;var v=function(){function ve(j){this.id=le.id(),this.registry=j}return ve}();Q.AsyncContainerModule=v},85700:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.ContainerSnapshot=void 0;var N=function(){function le(){}return le.of=function(ye,v){var ve=new le;return ve.bindings=ye,ve.middleware=v,ve},le}();Q.ContainerSnapshot=N},80175:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Lookup=void 0;var le=N(16674),ye=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(ve,j){if(ve==null)throw new Error(le.NULL_ARGUMENT);if(j==null)throw new Error(le.NULL_ARGUMENT);var ce=this._map.get(ve);ce!==void 0?(ce.push(j),this._map.set(ve,ce)):this._map.set(ve,[j])},v.prototype.get=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);var j=this._map.get(ve);if(j!==void 0)return j;throw new Error(le.KEY_NOT_FOUND)},v.prototype.remove=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);if(!this._map.delete(ve))throw new Error(le.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(ve){var j=this;this._map.forEach(function(ce,se){var Ne=ce.filter(function(ae){return!ve(ae)});Ne.length>0?j._map.set(se,Ne):j._map.delete(se)})},v.prototype.hasKey=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);return this._map.has(ve)},v.prototype.clone=function(){var ve=new v;return this._map.forEach(function(j,ce){j.forEach(function(se){return ve.add(ce,se.clone())})}),ve},v.prototype.traverse=function(ve){this._map.forEach(function(j,ce){ve(ce,j)})},v}();Q.Lookup=ye},86700:function(At,Q,N){"use strict";var le;le={value:!0},le=le=le=le=le=le=Q.GW=le=le=Q.zY=le=le=le=le=le=Q.f3=le=le=Q.b2=le=le=le=le=le=Q.W2=le=void 0;var ye=N(6867);le=ye;var v=N(51389);Object.defineProperty(Q,"W2",{enumerable:!0,get:function(){return v.Container}});var ve=N(28421);le={enumerable:!0,get:function(){return ve.BindingScopeEnum}},le={enumerable:!0,get:function(){return ve.BindingTypeEnum}},le={enumerable:!0,get:function(){return ve.TargetTypeEnum}};var j=N(33244);le={enumerable:!0,get:function(){return j.AsyncContainerModule}},le={enumerable:!0,get:function(){return j.ContainerModule}};var ce=N(64315);Object.defineProperty(Q,"b2",{enumerable:!0,get:function(){return ce.injectable}});var se=N(32052);le={enumerable:!0,get:function(){return se.tagged}};var Ne=N(38085);le={enumerable:!0,get:function(){return Ne.named}};var ae=N(5744);Object.defineProperty(Q,"f3",{enumerable:!0,get:function(){return ae.inject}}),le={enumerable:!0,get:function(){return ae.LazyServiceIdentifer}};var et=N(6515);le={enumerable:!0,get:function(){return et.optional}};var Le=N(86757);le={enumerable:!0,get:function(){return Le.unmanaged}};var it=N(71693);le={enumerable:!0,get:function(){return it.multiInject}};var Ht=N(55638);le={enumerable:!0,get:function(){return Ht.targetName}};var sr=N(7014);Object.defineProperty(Q,"zY",{enumerable:!0,get:function(){return sr.postConstruct}});var Ct=N(51377);le={enumerable:!0,get:function(){return Ct.MetadataReader}};var Jt=N(37791);le={enumerable:!0,get:function(){return Jt.id}};var Mt=N(99934);Object.defineProperty(Q,"GW",{enumerable:!0,get:function(){return Mt.decorate}});var lt=N(80758);le={enumerable:!0,get:function(){return lt.traverseAncerstors}},le={enumerable:!0,get:function(){return lt.taggedConstraint}},le={enumerable:!0,get:function(){return lt.namedConstraint}},le={enumerable:!0,get:function(){return lt.typeConstraint}};var dt=N(55800);le={enumerable:!0,get:function(){return dt.getServiceIdentifierAsString}};var er=N(70600);le={enumerable:!0,get:function(){return er.multiBindToService}}},95228:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Context=void 0;var le=N(37791),ye=function(){function v(ve){this.id=le.id(),this.container=ve}return v.prototype.addPlan=function(ve){this.plan=ve},v.prototype.setCurrentRequest=function(ve){this.currentRequest=ve},v}();Q.Context=ye},47738:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Metadata=void 0;var le=N(6867),ye=function(){function v(ve,j){this.key=ve,this.value=j}return v.prototype.toString=function(){return this.key===le.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();Q.Metadata=ye},51377:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.MetadataReader=void 0;var le=N(6867),ye=function(){function v(){}return v.prototype.getConstructorMetadata=function(ve){var j=Reflect.getMetadata(le.PARAM_TYPES,ve),ce=Reflect.getMetadata(le.TAGGED,ve);return{compilerGeneratedMetadata:j,userGeneratedMetadata:ce||{}}},v.prototype.getPropertiesMetadata=function(ve){var j=Reflect.getMetadata(le.TAGGED_PROP,ve)||[];return j},v}();Q.MetadataReader=ye},55314:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Plan=void 0;var N=function(){function le(ye,v){this.parentContext=ye,this.rootRequest=v}return le}();Q.Plan=N},86311:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.getBindingDictionary=Q.createMockRequest=Q.plan=void 0;var le=N(23184),ye=N(16674),v=N(28421),ve=N(6867),j=N(85265),ce=N(55800),se=N(95228),Ne=N(47738),ae=N(55314),et=N(6e3),Le=N(6748),it=N(18924);function Ht(Y){return Y._bindingDictionary}Q.getBindingDictionary=Ht;function sr(Y,$t,gt,Qe,xt,$e){var Kt=Y?ve.MULTI_INJECT_TAG:ve.INJECT_TAG,Sr=new Ne.Metadata(Kt,gt),kr=new it.Target($t,Qe,gt,Sr);if(xt!==void 0){var Qr=new Ne.Metadata(xt,$e);kr.metadata.push(Qr)}return kr}function Ct(Y,$t,gt,Qe,xt){var $e=lt(gt.container,xt.serviceIdentifier),Kt=[];return $e.length===le.BindingCount.NoBindingsAvailable&&gt.container.options.autoBindInjectable&&typeof xt.serviceIdentifier=="function"&&Y.getConstructorMetadata(xt.serviceIdentifier).compilerGeneratedMetadata&&(gt.container.bind(xt.serviceIdentifier).toSelf(),$e=lt(gt.container,xt.serviceIdentifier)),$t?Kt=$e:Kt=$e.filter(function(Sr){var kr=new Le.Request(Sr.serviceIdentifier,gt,Qe,Sr,xt);return Sr.constraint(kr)}),Jt(xt.serviceIdentifier,Kt,xt,gt.container),Kt}function Jt(Y,$t,gt,Qe){switch($t.length){case le.BindingCount.NoBindingsAvailable:if(gt.isOptional())return $t;var xt=ce.getServiceIdentifierAsString(Y),$e=ye.NOT_REGISTERED;throw $e+=ce.listMetadataForTarget(xt,gt),$e+=ce.listRegisteredBindingsForServiceIdentifier(Qe,xt,lt),new Error($e);case le.BindingCount.OnlyOneBindingAvailable:if(!gt.isArray())return $t;case le.BindingCount.MultipleBindingsAvailable:default:if(gt.isArray())return $t;var xt=ce.getServiceIdentifierAsString(Y),$e=ye.AMBIGUOUS_MATCH+" "+xt;throw $e+=ce.listRegisteredBindingsForServiceIdentifier(Qe,xt,lt),new Error($e)}}function Mt(Y,$t,gt,Qe,xt,$e){var Kt,Sr;if(xt===null){Kt=Ct(Y,$t,Qe,null,$e),Sr=new Le.Request(gt,Qe,null,Kt,$e);var kr=new ae.Plan(Qe,Sr);Qe.addPlan(kr)}else Kt=Ct(Y,$t,Qe,xt,$e),Sr=xt.addChildRequest($e.serviceIdentifier,Kt,$e);Kt.forEach(function(Qr){var we=null;if($e.isArray())we=Sr.addChildRequest(Qr.serviceIdentifier,Qr,$e);else{if(Qr.cache)return;we=Sr}if(Qr.type===v.BindingTypeEnum.Instance&&Qr.implementationType!==null){var Xe=et.getDependencies(Y,Qr.implementationType);if(!Qe.container.options.skipBaseClassChecks){var De=et.getBaseClassDependencyCount(Y,Qr.implementationType);if(Xe.length<De){var St=ye.ARGUMENTS_LENGTH_MISMATCH(et.getFunctionName(Qr.implementationType));throw new Error(St)}}Xe.forEach(function(vt){Mt(Y,!1,vt.serviceIdentifier,Qe,we,vt)})}})}function lt(Y,$t){var gt=[],Qe=Ht(Y);return Qe.hasKey($t)?gt=Qe.get($t):Y.parent!==null&&(gt=lt(Y.parent,$t)),gt}function dt(Y,$t,gt,Qe,xt,$e,Kt,Sr){Sr===void 0&&(Sr=!1);var kr=new se.Context($t),Qr=sr(gt,Qe,xt,"",$e,Kt);try{return Mt(Y,Sr,xt,kr,null,Qr),kr}catch(we){throw j.isStackOverflowExeption(we)&&kr.plan&&ce.circularDependencyToException(kr.plan.rootRequest),we}}Q.plan=dt;function er(Y,$t,gt,Qe){var xt=new it.Target(v.TargetTypeEnum.Variable,"",$t,new Ne.Metadata(gt,Qe)),$e=new se.Context(Y),Kt=new Le.Request($t,$e,null,[],xt);return Kt}Q.createMockRequest=er},88460:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.QueryableString=void 0;var N=function(){function le(ye){this.str=ye}return le.prototype.startsWith=function(ye){return this.str.indexOf(ye)===0},le.prototype.endsWith=function(ye){var v="",ve=ye.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},ve)},le.prototype.contains=function(ye){return this.str.indexOf(ye)!==-1},le.prototype.equals=function(ye){return this.str===ye},le.prototype.value=function(){return this.str},le}();Q.QueryableString=N},6e3:function(At,Q,N){"use strict";var le=this&&this.__spreadArray||function(Ct,Jt){for(var Mt=0,lt=Jt.length,dt=Ct.length;Mt<lt;Mt++,dt++)Ct[dt]=Jt[Mt];return Ct};Object.defineProperty(Q,"__esModule",{value:!0}),Q.getFunctionName=Q.getBaseClassDependencyCount=Q.getDependencies=void 0;var ye=N(5744),v=N(16674),ve=N(28421),j=N(6867),ce=N(55800);Object.defineProperty(Q,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var se=N(18924);function Ne(Ct,Jt){var Mt=ce.getFunctionName(Jt),lt=ae(Ct,Mt,Jt,!1);return lt}Q.getDependencies=Ne;function ae(Ct,Jt,Mt,lt){var dt=Ct.getConstructorMetadata(Mt),er=dt.compilerGeneratedMetadata;if(er===void 0){var Y=v.MISSING_INJECTABLE_ANNOTATION+" "+Jt+".";throw new Error(Y)}var $t=dt.userGeneratedMetadata,gt=Object.keys($t),Qe=Mt.length===0&&gt.length>0,xt=gt.length>Mt.length,$e=Qe||xt?gt.length:Mt.length,Kt=Le(lt,Jt,er,$t,$e),Sr=it(Ct,Mt),kr=le(le([],Kt),Sr);return kr}function et(Ct,Jt,Mt,lt,dt){var er=dt[Ct.toString()]||[],Y=sr(er),$t=Y.unmanaged!==!0,gt=lt[Ct],Qe=Y.inject||Y.multiInject;if(gt=Qe||gt,gt instanceof ye.LazyServiceIdentifer&&(gt=gt.unwrap()),$t){var xt=gt===Object,$e=gt===Function,Kt=gt===void 0,Sr=xt||$e||Kt;if(!Jt&&Sr){var kr=v.MISSING_INJECT_ANNOTATION+" argument "+Ct+" in class "+Mt+".";throw new Error(kr)}var Qr=new se.Target(ve.TargetTypeEnum.ConstructorArgument,Y.targetName,gt);return Qr.metadata=er,Qr}return null}function Le(Ct,Jt,Mt,lt,dt){for(var er=[],Y=0;Y<dt;Y++){var $t=Y,gt=et($t,Ct,Jt,Mt,lt);gt!==null&&er.push(gt)}return er}function it(Ct,Jt){for(var Mt=Ct.getPropertiesMetadata(Jt),lt=[],dt=Object.keys(Mt),er=0,Y=dt;er<Y.length;er++){var $t=Y[er],gt=Mt[$t],Qe=sr(Mt[$t]),xt=Qe.targetName||$t,$e=Qe.inject||Qe.multiInject,Kt=new se.Target(ve.TargetTypeEnum.ClassProperty,xt,$e);Kt.metadata=gt,lt.push(Kt)}var Sr=Object.getPrototypeOf(Jt.prototype).constructor;if(Sr!==Object){var kr=it(Ct,Sr);lt=le(le([],lt),kr)}return lt}function Ht(Ct,Jt){var Mt=Object.getPrototypeOf(Jt.prototype).constructor;if(Mt!==Object){var lt=ce.getFunctionName(Mt),dt=ae(Ct,lt,Mt,!0),er=dt.map(function(gt){return gt.metadata.filter(function(Qe){return Qe.key===j.UNMANAGED_TAG})}),Y=[].concat.apply([],er).length,$t=dt.length-Y;return $t>0?$t:Ht(Ct,Mt)}else return 0}Q.getBaseClassDependencyCount=Ht;function sr(Ct){var Jt={};return Ct.forEach(function(Mt){Jt[Mt.key.toString()]=Mt.value}),{inject:Jt[j.INJECT_TAG],multiInject:Jt[j.MULTI_INJECT_TAG],targetName:Jt[j.NAME_TAG],unmanaged:Jt[j.UNMANAGED_TAG]}}},6748:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Request=void 0;var le=N(37791),ye=function(){function v(ve,j,ce,se,Ne){this.id=le.id(),this.serviceIdentifier=ve,this.parentContext=j,this.parentRequest=ce,this.target=Ne,this.childRequests=[],this.bindings=Array.isArray(se)?se:[se],this.requestScope=ce===null?new Map:null}return v.prototype.addChildRequest=function(ve,j,ce){var se=new v(ve,this.parentContext,this,j,ce);return this.childRequests.push(se),se},v}();Q.Request=ye},18924:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Target=void 0;var le=N(6867),ye=N(37791),v=N(47738),ve=N(88460),j=function(){function ce(se,Ne,ae,et){this.id=ye.id(),this.type=se,this.serviceIdentifier=ae,this.name=new ve.QueryableString(Ne||""),this.metadata=new Array;var Le=null;typeof et=="string"?Le=new v.Metadata(le.NAMED_TAG,et):et instanceof v.Metadata&&(Le=et),Le!==null&&this.metadata.push(Le)}return ce.prototype.hasTag=function(se){for(var Ne=0,ae=this.metadata;Ne<ae.length;Ne++){var et=ae[Ne];if(et.key===se)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(le.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(se){return this.matchesTag(le.MULTI_INJECT_TAG)(se)},ce.prototype.isNamed=function(){return this.hasTag(le.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(se){return le.NON_CUSTOM_TAG_KEYS.every(function(Ne){return se.key!==Ne})})},ce.prototype.isOptional=function(){return this.matchesTag(le.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(se){return se.key===le.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(se){return le.NON_CUSTOM_TAG_KEYS.every(function(Ne){return se.key!==Ne})}):null},ce.prototype.matchesNamedTag=function(se){return this.matchesTag(le.NAMED_TAG)(se)},ce.prototype.matchesTag=function(se){var Ne=this;return function(ae){for(var et=0,Le=Ne.metadata;et<Le.length;et++){var it=Le[et];if(it.key===se&&it.value===ae)return!0}return!1}},ce}();Q.Target=j},52279:function(At,Q,N){"use strict";var le=this&&this.__spreadArray||function(ae,et){for(var Le=0,it=et.length,Ht=ae.length;Le<it;Le++,Ht++)ae[Ht]=et[Le];return ae};Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolveInstance=void 0;var ye=N(16674),v=N(28421),ve=N(6867);function j(ae,et,Le){var it=et.filter(function(sr){return sr.target!==null&&sr.target.type===v.TargetTypeEnum.ClassProperty}),Ht=it.map(Le);return it.forEach(function(sr,Ct){var Jt="";Jt=sr.target.name.value();var Mt=Ht[Ct];ae[Jt]=Mt}),ae}function ce(ae,et){return new(ae.bind.apply(ae,le([void 0],et)))}function se(ae,et){if(Reflect.hasMetadata(ve.POST_CONSTRUCT,ae)){var Le=Reflect.getMetadata(ve.POST_CONSTRUCT,ae);try{et[Le.value]()}catch(it){throw new Error(ye.POST_CONSTRUCT_ERROR(ae.name,it.message))}}}function Ne(ae,et,Le){var it=null;if(et.length>0){var Ht=et.filter(function(Ct){return Ct.target!==null&&Ct.target.type===v.TargetTypeEnum.ConstructorArgument}),sr=Ht.map(Le);it=ce(ae,sr),it=j(it,et,Le)}else it=new ae;return se(ae,it),it}Q.resolveInstance=Ne},31927:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolve=void 0;var le=N(16674),ye=N(28421),v=N(85265),ve=N(55800),j=N(52279),ce=function(ae,et,Le){try{return Le()}catch(it){throw v.isStackOverflowExeption(it)?new Error(le.CIRCULAR_DEPENDENCY_IN_FACTORY(ae,et.toString())):it}},se=function(ae){return function(et){et.parentContext.setCurrentRequest(et);var Le=et.bindings,it=et.childRequests,Ht=et.target&&et.target.isArray(),sr=!et.parentRequest||!et.parentRequest.target||!et.target||!et.parentRequest.target.matchesArray(et.target.serviceIdentifier);if(Ht&&sr)return it.map(function(er){var Y=se(ae);return Y(er)});var Ct=null;if(et.target.isOptional()&&Le.length===0)return;var Jt=Le[0],Mt=Jt.scope===ye.BindingScopeEnum.Singleton,lt=Jt.scope===ye.BindingScopeEnum.Request;if(Mt&&Jt.activated)return Jt.cache;if(lt&&ae!==null&&ae.has(Jt.id))return ae.get(Jt.id);if(Jt.type===ye.BindingTypeEnum.ConstantValue)Ct=Jt.cache,Jt.activated=!0;else if(Jt.type===ye.BindingTypeEnum.Function)Ct=Jt.cache,Jt.activated=!0;else if(Jt.type===ye.BindingTypeEnum.Constructor)Ct=Jt.implementationType;else if(Jt.type===ye.BindingTypeEnum.DynamicValue&&Jt.dynamicValue!==null)Ct=ce("toDynamicValue",Jt.serviceIdentifier,function(){return Jt.dynamicValue(et.parentContext)});else if(Jt.type===ye.BindingTypeEnum.Factory&&Jt.factory!==null)Ct=ce("toFactory",Jt.serviceIdentifier,function(){return Jt.factory(et.parentContext)});else if(Jt.type===ye.BindingTypeEnum.Provider&&Jt.provider!==null)Ct=ce("toProvider",Jt.serviceIdentifier,function(){return Jt.provider(et.parentContext)});else if(Jt.type===ye.BindingTypeEnum.Instance&&Jt.implementationType!==null)Ct=j.resolveInstance(Jt.implementationType,it,se(ae));else{var dt=ve.getServiceIdentifierAsString(et.serviceIdentifier);throw new Error(le.INVALID_BINDING_TYPE+" "+dt)}return typeof Jt.onActivation=="function"&&(Ct=Jt.onActivation(et.parentContext,Ct)),Mt&&(Jt.cache=Ct,Jt.activated=!0),lt&&ae!==null&&!ae.has(Jt.id)&&ae.set(Jt.id,Ct),Ct}};function Ne(ae){var et=se(ae.plan.rootRequest.requestScope);return et(ae.plan.rootRequest)}Q.resolve=Ne},83366:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInSyntax=void 0;var le=N(28421),ye=N(71325),v=function(){function ve(j){this._binding=j}return ve.prototype.inRequestScope=function(){return this._binding.scope=le.BindingScopeEnum.Request,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inSingletonScope=function(){return this._binding.scope=le.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inTransientScope=function(){return this._binding.scope=le.BindingScopeEnum.Transient,new ye.BindingWhenOnSyntax(this._binding)},ve}();Q.BindingInSyntax=v},74889:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInWhenOnSyntax=void 0;var le=N(83366),ye=N(51811),v=N(98370),ve=function(){function j(ce){this._binding=ce,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding),this._bindingInSyntax=new le.BindingInSyntax(ce)}return j.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},j.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},j.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},j.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},j.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},j.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},j.prototype.whenTargetTagged=function(ce,se){return this._bindingWhenSyntax.whenTargetTagged(ce,se)},j.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},j.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},j.prototype.whenParentTagged=function(ce,se){return this._bindingWhenSyntax.whenParentTagged(ce,se)},j.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},j.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},j.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},j.prototype.whenAnyAncestorTagged=function(ce,se){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,se)},j.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},j.prototype.whenNoAncestorTagged=function(ce,se){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,se)},j.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},j.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},j.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},j}();Q.BindingInWhenOnSyntax=ve},51811:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingOnSyntax=void 0;var le=N(98370),ye=function(){function v(ve){this._binding=ve}return v.prototype.onActivation=function(ve){return this._binding.onActivation=ve,new le.BindingWhenSyntax(this._binding)},v}();Q.BindingOnSyntax=ye},15451:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingToSyntax=void 0;var le=N(16674),ye=N(28421),v=N(74889),ve=N(71325),j=function(){function ce(se){this._binding=se}return ce.prototype.to=function(se){return this._binding.type=ye.BindingTypeEnum.Instance,this._binding.implementationType=se,new v.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+le.INVALID_TO_SELF_VALUE);var se=this._binding.serviceIdentifier;return this.to(se)},ce.prototype.toConstantValue=function(se){return this._binding.type=ye.BindingTypeEnum.ConstantValue,this._binding.cache=se,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(se){return this._binding.type=ye.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=se,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(se){return this._binding.type=ye.BindingTypeEnum.Constructor,this._binding.implementationType=se,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(se){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=se,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(se){if(typeof se!="function")throw new Error(le.INVALID_FUNCTION_BINDING);var Ne=this.toConstantValue(se);return this._binding.type=ye.BindingTypeEnum.Function,this._binding.scope=ye.BindingScopeEnum.Singleton,Ne},ce.prototype.toAutoFactory=function(se){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=function(Ne){var ae=function(){return Ne.container.get(se)};return ae},this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(se){return this._binding.type=ye.BindingTypeEnum.Provider,this._binding.provider=se,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(se){this.toDynamicValue(function(Ne){return Ne.container.get(se)})},ce}();Q.BindingToSyntax=j},71325:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenOnSyntax=void 0;var le=N(51811),ye=N(98370),v=function(){function ve(j){this._binding=j,this._bindingWhenSyntax=new ye.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new le.BindingOnSyntax(this._binding)}return ve.prototype.when=function(j){return this._bindingWhenSyntax.when(j)},ve.prototype.whenTargetNamed=function(j){return this._bindingWhenSyntax.whenTargetNamed(j)},ve.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ve.prototype.whenTargetTagged=function(j,ce){return this._bindingWhenSyntax.whenTargetTagged(j,ce)},ve.prototype.whenInjectedInto=function(j){return this._bindingWhenSyntax.whenInjectedInto(j)},ve.prototype.whenParentNamed=function(j){return this._bindingWhenSyntax.whenParentNamed(j)},ve.prototype.whenParentTagged=function(j,ce){return this._bindingWhenSyntax.whenParentTagged(j,ce)},ve.prototype.whenAnyAncestorIs=function(j){return this._bindingWhenSyntax.whenAnyAncestorIs(j)},ve.prototype.whenNoAncestorIs=function(j){return this._bindingWhenSyntax.whenNoAncestorIs(j)},ve.prototype.whenAnyAncestorNamed=function(j){return this._bindingWhenSyntax.whenAnyAncestorNamed(j)},ve.prototype.whenAnyAncestorTagged=function(j,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(j,ce)},ve.prototype.whenNoAncestorNamed=function(j){return this._bindingWhenSyntax.whenNoAncestorNamed(j)},ve.prototype.whenNoAncestorTagged=function(j,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(j,ce)},ve.prototype.whenAnyAncestorMatches=function(j){return this._bindingWhenSyntax.whenAnyAncestorMatches(j)},ve.prototype.whenNoAncestorMatches=function(j){return this._bindingWhenSyntax.whenNoAncestorMatches(j)},ve.prototype.onActivation=function(j){return this._bindingOnSyntax.onActivation(j)},ve}();Q.BindingWhenOnSyntax=v},98370:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenSyntax=void 0;var le=N(51811),ye=N(80758),v=function(){function ve(j){this._binding=j}return ve.prototype.when=function(j){return this._binding.constraint=j,new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetNamed=function(j){return this._binding.constraint=ye.namedConstraint(j),new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(j){var ce=j.target!==null&&!j.target.isNamed()&&!j.target.isTagged();return ce},new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetTagged=function(j,ce){return this._binding.constraint=ye.taggedConstraint(j)(ce),new le.BindingOnSyntax(this._binding)},ve.prototype.whenInjectedInto=function(j){return this._binding.constraint=function(ce){return ye.typeConstraint(j)(ce.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenParentNamed=function(j){return this._binding.constraint=function(ce){return ye.namedConstraint(j)(ce.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenParentTagged=function(j,ce){return this._binding.constraint=function(se){return ye.taggedConstraint(j)(ce)(se.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorIs=function(j){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,ye.typeConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorIs=function(j){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,ye.typeConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorNamed=function(j){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,ye.namedConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorNamed=function(j){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,ye.namedConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorTagged=function(j,ce){return this._binding.constraint=function(se){return ye.traverseAncerstors(se,ye.taggedConstraint(j)(ce))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorTagged=function(j,ce){return this._binding.constraint=function(se){return!ye.traverseAncerstors(se,ye.taggedConstraint(j)(ce))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorMatches=function(j){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,j)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorMatches=function(j){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,j)},new le.BindingOnSyntax(this._binding)},ve}();Q.BindingWhenSyntax=v},80758:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.typeConstraint=Q.namedConstraint=Q.taggedConstraint=Q.traverseAncerstors=void 0;var le=N(6867),ye=N(47738),v=function(se,Ne){var ae=se.parentRequest;return ae!==null?Ne(ae)?!0:v(ae,Ne):!1};Q.traverseAncerstors=v;var ve=function(se){return function(Ne){var ae=function(et){return et!==null&&et.target!==null&&et.target.matchesTag(se)(Ne)};return ae.metaData=new ye.Metadata(se,Ne),ae}};Q.taggedConstraint=ve;var j=ve(le.NAMED_TAG);Q.namedConstraint=j;var ce=function(se){return function(Ne){var ae=null;if(Ne!==null)if(ae=Ne.bindings[0],typeof se=="string"){var et=ae.serviceIdentifier;return et===se}else{var Le=Ne.bindings[0].implementationType;return se===Le}return!1}};Q.typeConstraint=ce},70600:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiBindToService=void 0;var N=function(le){return function(ye){return function(){for(var v=[],ve=0;ve<arguments.length;ve++)v[ve]=arguments[ve];return v.forEach(function(j){return le.bind(j).toService(ye)})}}};Q.multiBindToService=N},85265:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.isStackOverflowExeption=void 0;var le=N(16674);function ye(v){return v instanceof RangeError||v.message===le.STACK_OVERFLOW}Q.isStackOverflowExeption=ye},37791:function(At,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.id=void 0;var N=0;function le(){return N++}Q.id=le},55800:function(At,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.circularDependencyToException=Q.listMetadataForTarget=Q.listRegisteredBindingsForServiceIdentifier=Q.getServiceIdentifierAsString=Q.getFunctionName=void 0;var le=N(16674);function ye(ae){if(typeof ae=="function"){var et=ae;return et.name}else{if(typeof ae=="symbol")return ae.toString();var et=ae;return et}}Q.getServiceIdentifierAsString=ye;function v(ae,et,Le){var it="",Ht=Le(ae,et);return Ht.length!==0&&(it=`
Registered bindings:`,Ht.forEach(function(sr){var Ct="Object";sr.implementationType!==null&&(Ct=Ne(sr.implementationType)),it=it+`
 `+Ct,sr.constraint.metaData&&(it=it+" - "+sr.constraint.metaData)})),it}Q.listRegisteredBindingsForServiceIdentifier=v;function ve(ae,et){return ae.parentRequest===null?!1:ae.parentRequest.serviceIdentifier===et?!0:ve(ae.parentRequest,et)}function j(ae){function et(it,Ht){Ht===void 0&&(Ht=[]);var sr=ye(it.serviceIdentifier);return Ht.push(sr),it.parentRequest!==null?et(it.parentRequest,Ht):Ht}var Le=et(ae);return Le.reverse().join(" --> ")}function ce(ae){ae.childRequests.forEach(function(et){if(ve(et,et.serviceIdentifier)){var Le=j(et);throw new Error(le.CIRCULAR_DEPENDENCY+" "+Le)}else ce(et)})}Q.circularDependencyToException=ce;function se(ae,et){if(et.isTagged()||et.isNamed()){var Le="",it=et.getNamedTag(),Ht=et.getCustomTags();return it!==null&&(Le+=it.toString()+`
`),Ht!==null&&Ht.forEach(function(sr){Le+=sr.toString()+`
`})," "+ae+`
 `+ae+" - "+Le}else return" "+ae}Q.listMetadataForTarget=se;function Ne(ae){if(ae.name)return ae.name;var et=ae.toString(),Le=et.match(/^function\s*([^\s(]+)/);return Le?Le[1]:"Anonymous function: "+et}Q.getFunctionName=Ne},31745:function(At){"use strict";At.exports=N,At.exports.default=N;var Q=1e20;function N(j,ce,se,Ne,ae,et){this.fontSize=j||24,this.buffer=ce===void 0?3:ce,this.cutoff=Ne||.25,this.fontFamily=ae||"sans-serif",this.fontWeight=et||"normal",this.radius=se||8;var Le=this.size=this.fontSize+this.buffer*2,it=Le+this.buffer*2,Ht=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Ht?this.canvas=my.createOffscreenCanvas(Le,Le,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Le),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(it*it),this.gridInner=new Float64Array(it*it),this.f=new Float64Array(it),this.z=new Float64Array(it+1),this.v=new Uint16Array(it),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Ht?this.middle=Math.round(Le/2*1):this.middle=Math.round(Le/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function le(j,ce,se,Ne,ae,et,Le){et.fill(Q,0,ce*se),Le.fill(0,0,ce*se);for(var it=(ce-Ne)/2,Ht=0;Ht<ae;Ht++)for(var sr=0;sr<Ne;sr++){var Ct=(Ht+it)*ce+sr+it,Jt=j.data[4*(Ht*Ne+sr)+3]/255;if(Jt===1)et[Ct]=0,Le[Ct]=Q;else if(Jt===0)et[Ct]=Q,Le[Ct]=0;else{var Mt=Math.max(0,.5-Jt),lt=Math.max(0,Jt-.5);et[Ct]=Mt*Mt,Le[Ct]=lt*lt}}}function ye(j,ce,se,Ne,ae,et,Le){for(var it=0;it<ce*se;it++){var Ht=Math.sqrt(Ne[it])-Math.sqrt(ae[it]);j[it]=Math.round(255-255*(Ht/et+Le))}}N.prototype._draw=function(j,ce){var se=this.ctx.measureText(j),Ne=se.width,ae=2*this.buffer,et,Le,it,Ht,sr,Ct,Jt,Mt;ce&&this.useMetrics?(sr=Math.floor(se.actualBoundingBoxAscent),Mt=this.buffer+Math.ceil(se.actualBoundingBoxAscent),Ct=this.buffer,Jt=this.buffer,Le=Math.min(this.size,Math.ceil(se.actualBoundingBoxRight-se.actualBoundingBoxLeft)),Ht=Math.min(this.size-Ct,Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent)),et=Le+ae,it=Ht+ae,this.ctx.textBaseline="alphabetic"):(et=Le=this.size,it=Ht=this.size,sr=19*this.fontSize/24,Ct=Jt=0,Mt=this.middle,this.ctx.textBaseline="middle");var lt;Le&&Ht&&(this.ctx.clearRect(Jt,Ct,Le,Ht),this.ctx.fillText(j,this.buffer,Mt),lt=this.ctx.getImageData(Jt,Ct,Le,Ht));var dt=new Uint8ClampedArray(et*it);return le(lt,et,it,Le,Ht,this.gridOuter,this.gridInner),v(this.gridOuter,et,it,this.f,this.v,this.z),v(this.gridInner,et,it,this.f,this.v,this.z),ye(dt,et,it,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:dt,metrics:{width:Le,height:Ht,sdfWidth:et,sdfHeight:it,top:sr,left:0,advance:Ne}}},N.prototype.draw=function(j){return this._draw(j,!1).data},N.prototype.drawWithMetrics=function(j){return this._draw(j,!0)};function v(j,ce,se,Ne,ae,et){for(var Le=0;Le<ce;Le++)ve(j,Le,ce,se,Ne,ae,et);for(var it=0;it<se;it++)ve(j,it*ce,1,ce,Ne,ae,et)}function ve(j,ce,se,Ne,ae,et,Le){var it,Ht,sr,Ct;for(et[0]=0,Le[0]=-Q,Le[1]=Q,it=0;it<Ne;it++)ae[it]=j[ce+it*se];for(it=1,Ht=0,sr=0;it<Ne;it++){do Ct=et[Ht],sr=(ae[it]-ae[Ct]+it*it-Ct*Ct)/(it-Ct)/2;while(sr<=Le[Ht]&&--Ht>-1);Ht++,et[Ht]=it,Le[Ht]=sr,Le[Ht+1]=Q}for(it=0,Ht=0;it<Ne;it++){for(;Le[Ht+1]<it;)Ht++;Ct=et[Ht],j[ce+it*se]=ae[Ct]+(it-Ct)*(it-Ct)}}},18857:function(At,Q,N){"use strict";N.r(Q),N.d(Q,{Function:function(){return uu},Interpreter:function(){return Ao},default:function(){return Hu},evaluate:function(){return Gu},vm:function(){return le}});var le={};N.r(le),N.d(le,{Script:function(){return Tl},compileFunction:function(){return Ac},createContext:function(){return ql},runInContext:function(){return Vu},runInNewContext:function(){return wc}});var ye={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",ve={5:v,"5module":v+" export import",6:v+" const class extends export import super"},j=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",se="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ne=new RegExp("["+ce+"]"),ae=new RegExp("["+ce+se+"]");ce=se=null;var et=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Le=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function it(_,T){for(var F=65536,O=0;O<T.length;O+=2){if(F+=T[O],F>_)return!1;if(F+=T[O+1],F>=_)return!0}}function Ht(_,T){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Ne.test(String.fromCharCode(_)):T===!1?!1:it(_,et)}function sr(_,T){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ae.test(String.fromCharCode(_)):T===!1?!1:it(_,et)||it(_,Le)}var Ct=function(T,F){F===void 0&&(F={}),this.label=T,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function Jt(_,T){return new Ct(_,{beforeExpr:!0,binop:T})}var Mt={beforeExpr:!0},lt={startsExpr:!0},dt={};function er(_,T){return T===void 0&&(T={}),T.keyword=_,dt[_]=new Ct(_,T)}var Y={num:new Ct("num",lt),regexp:new Ct("regexp",lt),string:new Ct("string",lt),name:new Ct("name",lt),eof:new Ct("eof"),bracketL:new Ct("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ct("]"),braceL:new Ct("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ct("}"),parenL:new Ct("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ct(")"),comma:new Ct(",",Mt),semi:new Ct(";",Mt),colon:new Ct(":",Mt),dot:new Ct("."),question:new Ct("?",Mt),questionDot:new Ct("?."),arrow:new Ct("=>",Mt),template:new Ct("template"),invalidTemplate:new Ct("invalidTemplate"),ellipsis:new Ct("...",Mt),backQuote:new Ct("`",lt),dollarBraceL:new Ct("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ct("=",{beforeExpr:!0,isAssign:!0}),assign:new Ct("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ct("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ct("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Jt("||",1),logicalAND:Jt("&&",2),bitwiseOR:Jt("|",3),bitwiseXOR:Jt("^",4),bitwiseAND:Jt("&",5),equality:Jt("==/!=/===/!==",6),relational:Jt("</>/<=/>=",7),bitShift:Jt("<</>>/>>>",8),plusMin:new Ct("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Jt("%",10),star:Jt("*",10),slash:Jt("/",10),starstar:new Ct("**",{beforeExpr:!0}),coalesce:Jt("??",1),_break:er("break"),_case:er("case",Mt),_catch:er("catch"),_continue:er("continue"),_debugger:er("debugger"),_default:er("default",Mt),_do:er("do",{isLoop:!0,beforeExpr:!0}),_else:er("else",Mt),_finally:er("finally"),_for:er("for",{isLoop:!0}),_function:er("function",lt),_if:er("if"),_return:er("return",Mt),_switch:er("switch"),_throw:er("throw",Mt),_try:er("try"),_var:er("var"),_const:er("const"),_while:er("while",{isLoop:!0}),_with:er("with"),_new:er("new",{beforeExpr:!0,startsExpr:!0}),_this:er("this",lt),_super:er("super",lt),_class:er("class",lt),_extends:er("extends",Mt),_export:er("export"),_import:er("import",lt),_null:er("null",lt),_true:er("true",lt),_false:er("false",lt),_in:er("in",{beforeExpr:!0,binop:7}),_instanceof:er("instanceof",{beforeExpr:!0,binop:7}),_typeof:er("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:er("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:er("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},$t=/\r\n?|\n|\u2028|\u2029/,gt=new RegExp($t.source,"g");function Qe(_,T){return _===10||_===13||!T&&(_===8232||_===8233)}var xt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Kt=Object.prototype,Sr=Kt.hasOwnProperty,kr=Kt.toString;function Qr(_,T){return Sr.call(_,T)}var we=Array.isArray||function(_){return kr.call(_)==="[object Array]"};function Xe(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var De=function(T,F){this.line=T,this.column=F};De.prototype.offset=function(T){return new De(this.line,this.column+T)};var St=function(T,F,O){this.start=F,this.end=O,T.sourceFile!==null&&(this.source=T.sourceFile)};function vt(_,T){for(var F=1,O=0;;){gt.lastIndex=O;var q=gt.exec(_);if(q&&q.index<T)++F,O=q.index+q[0].length;else return new De(F,T-O)}}var zt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function qt(_){var T={};for(var F in zt)T[F]=_&&Qr(_,F)?_[F]:zt[F];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),we(T.onToken)){var O=T.onToken;T.onToken=function(q){return O.push(q)}}return we(T.onComment)&&(T.onComment=Cr(T,T.onComment)),T}function Cr(_,T){return function(F,O,q,xe,We,ct){var ht={type:F?"Block":"Line",value:O,start:q,end:xe};_.locations&&(ht.loc=new St(this,We,ct)),_.ranges&&(ht.range=[q,xe]),T.push(ht)}}var Yn=1,vn=2,Qi=Yn|vn,jn=4,Xn=8,gi=16,qn=32,ui=64,oa=128;function Fi(_,T){return vn|(_?jn:0)|(T?Xn:0)}var Ai=0,Gi=1,la=2,wi=3,ba=4,Mn=5,Si=function(T,F,O){this.options=T=qt(T),this.sourceFile=T.sourceFile,this.keywords=Xe(ve[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var q="";if(T.allowReserved!==!0){for(var xe=T.ecmaVersion;!(q=ye[xe]);xe--);T.sourceType==="module"&&(q+=" await")}this.reservedWords=Xe(q);var We=(q?q+" ":"")+ye.strict;this.reservedWordsStrict=Xe(We),this.reservedWordsStrictBind=Xe(We+" "+ye.strictBind),this.input=String(F),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split($t).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yn),this.regexpState=null},Ui={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Si.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},Ui.inFunction.get=function(){return(this.currentVarScope().flags&vn)>0},Ui.inGenerator.get=function(){return(this.currentVarScope().flags&Xn)>0},Ui.inAsync.get=function(){return(this.currentVarScope().flags&jn)>0},Ui.allowSuper.get=function(){return(this.currentThisScope().flags&ui)>0},Ui.allowDirectSuper.get=function(){return(this.currentThisScope().flags&oa)>0},Ui.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Si.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&vn)>0},Si.extend=function(){for(var T=[],F=arguments.length;F--;)T[F]=arguments[F];for(var O=this,q=0;q<T.length;q++)O=T[q](O);return O},Si.parse=function(T,F){return new this(F,T).parse()},Si.parseExpressionAt=function(T,F,O){var q=new this(O,T,F);return q.nextToken(),q.parseExpression()},Si.tokenizer=function(T,F){return new this(F,T)},Object.defineProperties(Si.prototype,Ui);var Ji=Si.prototype,Xa=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Ji.strictDirective=function(_){for(;;){$e.lastIndex=_,_+=$e.exec(this.input)[0].length;var T=Xa.exec(this.input.slice(_));if(!T)return!1;if((T[1]||T[2])==="use strict"){$e.lastIndex=_+T[0].length;var F=$e.exec(this.input),O=F.index+F[0].length,q=this.input.charAt(O);return q===";"||q==="}"||$t.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(q)||q==="!"&&this.input.charAt(O+1)==="=")}_+=T[0].length,$e.lastIndex=_,_+=$e.exec(this.input)[0].length,this.input[_]===";"&&_++}},Ji.eat=function(_){return this.type===_?(this.next(),!0):!1},Ji.isContextual=function(_){return this.type===Y.name&&this.value===_&&!this.containsEsc},Ji.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Ji.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Ji.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||$t.test(this.input.slice(this.lastTokEnd,this.start))},Ji.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Ji.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},Ji.afterTrailingComma=function(_,T){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},Ji.expect=function(_){this.eat(_)||this.unexpected()},Ji.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function he(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Ji.checkPatternErrors=function(_,T){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=T?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},Ji.checkExpressionErrors=function(_,T){if(!_)return!1;var F=_.shorthandAssign,O=_.doubleProto;if(!T)return F>=0||O>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Ji.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Ji.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Bn=Si.prototype;Bn.parseTopLevel=function(_){var T={};for(_.body||(_.body=[]);this.type!==Y.eof;){var F=this.parseStatement(null,!0,T);_.body.push(F)}if(this.inModule)for(var O=0,q=Object.keys(this.undefinedExports);O<q.length;O+=1){var xe=q[O];this.raiseRecoverable(this.undefinedExports[xe].start,"Export '"+xe+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Ya={kind:"loop"},ps={kind:"switch"};Bn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var T=$e.exec(this.input),F=this.pos+T[0].length,O=this.input.charCodeAt(F);if(O===91)return!0;if(_)return!1;if(O===123)return!0;if(Ht(O,!0)){for(var q=F+1;sr(this.input.charCodeAt(q),!0);)++q;var xe=this.input.slice(F,q);if(!j.test(xe))return!0}return!1},Bn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var _=$e.exec(this.input),T=this.pos+_[0].length;return!$t.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!sr(this.input.charAt(T+8)))},Bn.parseStatement=function(_,T,F){var O=this.type,q=this.startNode(),xe;switch(this.isLet(_)&&(O=Y._var,xe="let"),O){case Y._break:case Y._continue:return this.parseBreakContinueStatement(q,O.keyword);case Y._debugger:return this.parseDebuggerStatement(q);case Y._do:return this.parseDoStatement(q);case Y._for:return this.parseForStatement(q);case Y._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(q,!1,!_);case Y._class:return _&&this.unexpected(),this.parseClass(q,!0);case Y._if:return this.parseIfStatement(q);case Y._return:return this.parseReturnStatement(q);case Y._switch:return this.parseSwitchStatement(q);case Y._throw:return this.parseThrowStatement(q);case Y._try:return this.parseTryStatement(q);case Y._const:case Y._var:return xe=xe||this.value,_&&xe!=="var"&&this.unexpected(),this.parseVarStatement(q,xe);case Y._while:return this.parseWhileStatement(q);case Y._with:return this.parseWithStatement(q);case Y.braceL:return this.parseBlock(!0,q);case Y.semi:return this.parseEmptyStatement(q);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&O===Y._import){$e.lastIndex=this.pos;var We=$e.exec(this.input),ct=this.pos+We[0].length,ht=this.input.charCodeAt(ct);if(ht===40||ht===46)return this.parseExpressionStatement(q,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===Y._import?this.parseImport(q):this.parseExport(q,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(q,!0,!_);var cr=this.value,xr=this.parseExpression();return O===Y.name&&xr.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement(q,cr,xr,_):this.parseExpressionStatement(q,xr)}},Bn.parseBreakContinueStatement=function(_,T){var F=T==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.label=null:this.type!==Y.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var q=this.labels[O];if((_.label==null||q.name===_.label.name)&&(q.kind!=null&&(F||q.kind==="loop")||_.label&&F))break}return O===this.labels.length&&this.raise(_.start,"Unsyntactic "+T),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},Bn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Bn.parseDoStatement=function(_){return this.next(),this.labels.push(Ya),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Bn.parseForStatement=function(_){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ya),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return T>-1&&this.unexpected(T),this.parseFor(_,null);var F=this.isLet();if(this.type===Y._var||this.type===Y._const||F){var O=this.startNode(),q=F?"let":this.value;return this.next(),this.parseVar(O,!0,q),this.finishNode(O,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):_.await=T>-1),this.parseForIn(_,O)):(T>-1&&this.unexpected(T),this.parseFor(_,O))}var xe=new he,We=this.parseExpression(!0,xe);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):_.await=T>-1),this.toAssignable(We,!1,xe),this.checkLVal(We),this.parseForIn(_,We)):(this.checkExpressionErrors(xe,!0),T>-1&&this.unexpected(T),this.parseFor(_,We))},Bn.parseFunctionStatement=function(_,T,F){return this.next(),this.parseFunction(_,ir|(F?0:Mr),!1,T)},Bn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Bn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Bn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(Y.braceL),this.labels.push(ps),this.enterScope(0);for(var T,F=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var O=this.type===Y._case;T&&this.finishNode(T,"SwitchCase"),_.cases.push(T=this.startNode()),T.consequent=[],this.next(),O?T.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,T.test=null),this.expect(Y.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Bn.parseThrowStatement=function(_){return this.next(),$t.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var jt=[];Bn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===Y._catch){var T=this.startNode();if(this.next(),this.eat(Y.parenL)){T.param=this.parseBindingAtom();var F=T.param.type==="Identifier";this.enterScope(F?qn:0),this.checkLVal(T.param,F?ba:la),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(T,"CatchClause")}return _.finalizer=this.eat(Y._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Bn.parseVarStatement=function(_,T){return this.next(),this.parseVar(_,!1,T),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Bn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Ya),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Bn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Bn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Bn.parseLabeledStatement=function(_,T,F,O){for(var q=0,xe=this.labels;q<xe.length;q+=1){var We=xe[q];We.name===T&&this.raise(F.start,"Label '"+T+"' is already declared")}for(var ct=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,ht=this.labels.length-1;ht>=0;ht--){var cr=this.labels[ht];if(cr.statementStart===_.start)cr.statementStart=this.start,cr.kind=ct;else break}return this.labels.push({name:T,kind:ct,statementStart:this.start}),_.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},Bn.parseExpressionStatement=function(_,T){return _.expression=T,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Bn.parseBlock=function(_,T,F){for(_===void 0&&(_=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(Y.braceL),_&&this.enterScope(0);this.type!==Y.braceR;){var O=this.parseStatement(null);T.body.push(O)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(T,"BlockStatement")},Bn.parseFor=function(_,T){return _.init=T,this.expect(Y.semi),_.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),_.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Bn.parseForIn=function(_,T){var F=this.type===Y._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),_.left=T,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},Bn.parseVar=function(_,T,F){for(_.declarations=[],_.kind=F;;){var O=this.startNode();if(this.parseVarId(O,F),this.eat(Y.eq)?O.init=this.parseMaybeAssign(T):F==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(T&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,_.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(Y.comma))break}return _},Bn.parseVarId=function(_,T){_.id=this.parseBindingAtom(),this.checkLVal(_.id,T==="var"?Gi:la,!1)};var ir=1,Mr=2,I=4;Bn.parseFunction=function(_,T,F,O){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===Y.star&&T&Mr&&this.unexpected(),_.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(_.async=!!O),T&ir&&(_.id=T&I&&this.type!==Y.name?null:this.parseIdent(),_.id&&!(T&Mr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Gi:la:wi));var q=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Fi(_.async,_.generator)),T&ir||(_.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=q,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(_,T&ir?"FunctionDeclaration":"FunctionExpression")},Bn.parseFunctionParams=function(_){this.expect(Y.parenL),_.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Bn.parseClass=function(_,T){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,T),this.parseClassSuper(_);var O=this.startNode(),q=!1;for(O.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var xe=this.parseClassElement(_.superClass!==null);xe&&(O.body.push(xe),xe.type==="MethodDefinition"&&xe.kind==="constructor"&&(q&&this.raise(xe.start,"Duplicate constructor in the same class"),q=!0))}return this.strict=F,this.next(),_.body=this.finishNode(O,"ClassBody"),this.finishNode(_,T?"ClassDeclaration":"ClassExpression")},Bn.parseClassElement=function(_){var T=this;if(this.eat(Y.semi))return null;var F=this.startNode(),O=function(ht,cr){cr===void 0&&(cr=!1);var xr=T.start,In=T.startLoc;return T.eatContextual(ht)?T.type!==Y.parenL&&(!cr||!T.canInsertSemicolon())?!0:(F.key&&T.unexpected(),F.computed=!1,F.key=T.startNodeAt(xr,In),F.key.name=ht,T.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=O("static");var q=this.eat(Y.star),xe=!1;q||(this.options.ecmaVersion>=8&&O("async",!0)?(xe=!0,q=this.options.ecmaVersion>=9&&this.eat(Y.star)):O("get")?F.kind="get":O("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var We=F.key,ct=!1;return!F.computed&&!F.static&&(We.type==="Identifier"&&We.name==="constructor"||We.type==="Literal"&&We.value==="constructor")?(F.kind!=="method"&&this.raise(We.start,"Constructor can't have get/set modifier"),q&&this.raise(We.start,"Constructor can't be a generator"),xe&&this.raise(We.start,"Constructor can't be an async method"),F.kind="constructor",ct=_):F.static&&We.type==="Identifier"&&We.name==="prototype"&&this.raise(We.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,q,xe,ct),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},Bn.parseClassMethod=function(_,T,F,O){return _.value=this.parseMethod(T,F,O),this.finishNode(_,"MethodDefinition")},Bn.parseClassId=function(_,T){this.type===Y.name?(_.id=this.parseIdent(),T&&this.checkLVal(_.id,la,!1)):(T===!0&&this.unexpected(),_.id=null)},Bn.parseClassSuper=function(_){_.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},Bn.parseExport=function(_,T){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(T,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(T,"default",this.lastTokStart);var F;if(this.type===Y._function||(F=this.isAsyncFunction())){var O=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(O,ir|I,!1,F)}else if(this.type===Y._class){var q=this.startNode();_.declaration=this.parseClass(q,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,_.declaration.declarations):this.checkExport(T,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var xe=0,We=_.specifiers;xe<We.length;xe+=1){var ct=We[xe];this.checkUnreserved(ct.local),this.checkLocalExport(ct.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Bn.checkExport=function(_,T,F){!_||(Qr(_,T)&&this.raiseRecoverable(F,"Duplicate export '"+T+"'"),_[T]=!0)},Bn.checkPatternExport=function(_,T){var F=T.type;if(F==="Identifier")this.checkExport(_,T.name,T.start);else if(F==="ObjectPattern")for(var O=0,q=T.properties;O<q.length;O+=1){var xe=q[O];this.checkPatternExport(_,xe)}else if(F==="ArrayPattern")for(var We=0,ct=T.elements;We<ct.length;We+=1){var ht=ct[We];ht&&this.checkPatternExport(_,ht)}else F==="Property"?this.checkPatternExport(_,T.value):F==="AssignmentPattern"?this.checkPatternExport(_,T.left):F==="RestElement"?this.checkPatternExport(_,T.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,T.expression)},Bn.checkVariableExport=function(_,T){if(!!_)for(var F=0,O=T;F<O.length;F+=1){var q=O[F];this.checkPatternExport(_,q.id)}},Bn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Bn.parseExportSpecifiers=function(_){var T=[],F=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(F)F=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(_,O.exported.name,O.exported.start),T.push(this.finishNode(O,"ExportSpecifier"))}return T},Bn.parseImport=function(_){return this.next(),this.type===Y.string?(_.specifiers=jt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Bn.parseImportSpecifiers=function(){var _=[],T=!0;if(this.type===Y.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,la),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(Y.comma))return _}if(this.type===Y.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,la),_.push(this.finishNode(O,"ImportNamespaceSpecifier")),_}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(T)T=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var q=this.startNode();q.imported=this.parseIdent(!0),this.eatContextual("as")?q.local=this.parseIdent():(this.checkUnreserved(q.imported),q.local=q.imported),this.checkLVal(q.local,la),_.push(this.finishNode(q,"ImportSpecifier"))}return _},Bn.adaptDirectivePrologue=function(_){for(var T=0;T<_.length&&this.isDirectiveCandidate(_[T]);++T)_[T].directive=_[T].expression.raw.slice(1,-1)},Bn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var ar=Si.prototype;ar.toAssignable=function(_,T,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var O=0,q=_.properties;O<q.length;O+=1){var xe=q[O];this.toAssignable(xe,T),xe.type==="RestElement"&&(xe.argument.type==="ArrayPattern"||xe.argument.type==="ObjectPattern")&&this.raise(xe.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,T);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,T);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,T),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,T,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},ar.toAssignableList=function(_,T){for(var F=_.length,O=0;O<F;O++){var q=_[O];q&&this.toAssignable(q,T)}if(F){var xe=_[F-1];this.options.ecmaVersion===6&&T&&xe&&xe.type==="RestElement"&&xe.argument.type!=="Identifier"&&this.unexpected(xe.argument.start)}return _},ar.parseSpread=function(_){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,_),this.finishNode(T,"SpreadElement")},ar.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},ar.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},ar.parseBindingList=function(_,T,F){for(var O=[],q=!0;!this.eat(_);)if(q?q=!1:this.expect(Y.comma),T&&this.type===Y.comma)O.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===Y.ellipsis){var xe=this.parseRestBinding();this.parseBindingListItem(xe),O.push(xe),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var We=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(We),O.push(We)}}return O},ar.parseBindingListItem=function(_){return _},ar.parseMaybeDefault=function(_,T,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return F;var O=this.startNodeAt(_,T);return O.left=F,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},ar.checkLVal=function(_,T,F){switch(T===void 0&&(T=Ai),_.type){case"Identifier":T===la&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(T?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(Qr(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),T!==Ai&&T!==Mn&&this.declareName(_.name,T,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,q=_.properties;O<q.length;O+=1){var xe=q[O];this.checkLVal(xe,T,F)}break;case"Property":this.checkLVal(_.value,T,F);break;case"ArrayPattern":for(var We=0,ct=_.elements;We<ct.length;We+=1){var ht=ct[We];ht&&this.checkLVal(ht,T,F)}break;case"AssignmentPattern":this.checkLVal(_.left,T,F);break;case"RestElement":this.checkLVal(_.argument,T,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,T,F);break;default:this.raise(_.start,(T?"Binding":"Assigning to")+" rvalue")}};var Ln=Si.prototype;Ln.checkPropClash=function(_,T,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var O=_.key,q;switch(O.type){case"Identifier":q=O.name;break;case"Literal":q=String(O.value);break;default:return}var xe=_.kind;if(this.options.ecmaVersion>=6){q==="__proto__"&&xe==="init"&&(T.proto&&(F?F.doubleProto<0&&(F.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),T.proto=!0);return}q="$"+q;var We=T[q];if(We){var ct;xe==="init"?ct=this.strict&&We.init||We.get||We.set:ct=We.init||We[xe],ct&&this.raiseRecoverable(O.start,"Redefinition of property")}else We=T[q]={init:!1,get:!1,set:!1};We[xe]=!0}},Ln.parseExpression=function(_,T){var F=this.start,O=this.startLoc,q=this.parseMaybeAssign(_,T);if(this.type===Y.comma){var xe=this.startNodeAt(F,O);for(xe.expressions=[q];this.eat(Y.comma);)xe.expressions.push(this.parseMaybeAssign(_,T));return this.finishNode(xe,"SequenceExpression")}return q},Ln.parseMaybeAssign=function(_,T,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var O=!1,q=-1,xe=-1;T?(q=T.parenthesizedAssign,xe=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new he,O=!0);var We=this.start,ct=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var ht=this.parseMaybeConditional(_,T);if(F&&(ht=F.call(this,ht,We,ct)),this.type.isAssign){var cr=this.startNodeAt(We,ct);return cr.operator=this.value,cr.left=this.type===Y.eq?this.toAssignable(ht,!1,T):ht,O||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=cr.left.start&&(T.shorthandAssign=-1),this.checkLVal(ht),this.next(),cr.right=this.parseMaybeAssign(_),this.finishNode(cr,"AssignmentExpression")}else O&&this.checkExpressionErrors(T,!0);return q>-1&&(T.parenthesizedAssign=q),xe>-1&&(T.trailingComma=xe),ht},Ln.parseMaybeConditional=function(_,T){var F=this.start,O=this.startLoc,q=this.parseExprOps(_,T);if(this.checkExpressionErrors(T))return q;if(this.eat(Y.question)){var xe=this.startNodeAt(F,O);return xe.test=q,xe.consequent=this.parseMaybeAssign(),this.expect(Y.colon),xe.alternate=this.parseMaybeAssign(_),this.finishNode(xe,"ConditionalExpression")}return q},Ln.parseExprOps=function(_,T){var F=this.start,O=this.startLoc,q=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||q.start===F&&q.type==="ArrowFunctionExpression"?q:this.parseExprOp(q,F,O,-1,_)},Ln.parseExprOp=function(_,T,F,O,q){var xe=this.type.binop;if(xe!=null&&(!q||this.type!==Y._in)&&xe>O){var We=this.type===Y.logicalOR||this.type===Y.logicalAND,ct=this.type===Y.coalesce;ct&&(xe=Y.logicalAND.binop);var ht=this.value;this.next();var cr=this.start,xr=this.startLoc,In=this.parseExprOp(this.parseMaybeUnary(null,!1),cr,xr,xe,q),ci=this.buildBinary(T,F,_,In,ht,We||ct);return(We&&this.type===Y.coalesce||ct&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ci,T,F,O,q)}return _},Ln.buildBinary=function(_,T,F,O,q,xe){var We=this.startNodeAt(_,T);return We.left=F,We.operator=q,We.right=O,this.finishNode(We,xe?"LogicalExpression":"BinaryExpression")},Ln.parseMaybeUnary=function(_,T){var F=this.start,O=this.startLoc,q;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))q=this.parseAwait(),T=!0;else if(this.type.prefix){var xe=this.startNode(),We=this.type===Y.incDec;xe.operator=this.value,xe.prefix=!0,this.next(),xe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),We?this.checkLVal(xe.argument):this.strict&&xe.operator==="delete"&&xe.argument.type==="Identifier"?this.raiseRecoverable(xe.start,"Deleting local variable in strict mode"):T=!0,q=this.finishNode(xe,We?"UpdateExpression":"UnaryExpression")}else{if(q=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return q;for(;this.type.postfix&&!this.canInsertSemicolon();){var ct=this.startNodeAt(F,O);ct.operator=this.value,ct.prefix=!1,ct.argument=q,this.checkLVal(q),this.next(),q=this.finishNode(ct,"UpdateExpression")}}return!T&&this.eat(Y.starstar)?this.buildBinary(F,O,q,this.parseMaybeUnary(null,!1),"**",!1):q},Ln.parseExprSubscripts=function(_){var T=this.start,F=this.startLoc,O=this.parseExprAtom(_);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var q=this.parseSubscripts(O,T,F);return _&&q.type==="MemberExpression"&&(_.parenthesizedAssign>=q.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=q.start&&(_.parenthesizedBind=-1)),q},Ln.parseSubscripts=function(_,T,F,O){for(var q=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,xe=!1;;){var We=this.parseSubscript(_,T,F,O,q,xe);if(We.optional&&(xe=!0),We===_||We.type==="ArrowFunctionExpression"){if(xe){var ct=this.startNodeAt(T,F);ct.expression=We,We=this.finishNode(ct,"ChainExpression")}return We}_=We}},Ln.parseSubscript=function(_,T,F,O,q,xe){var We=this.options.ecmaVersion>=11,ct=We&&this.eat(Y.questionDot);O&&ct&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var ht=this.eat(Y.bracketL);if(ht||ct&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var cr=this.startNodeAt(T,F);cr.object=_,cr.property=ht?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),cr.computed=!!ht,ht&&this.expect(Y.bracketR),We&&(cr.optional=ct),_=this.finishNode(cr,"MemberExpression")}else if(!O&&this.eat(Y.parenL)){var xr=new he,In=this.yieldPos,ci=this.awaitPos,Qn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var qi=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,xr);if(q&&!ct&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(xr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=In,this.awaitPos=ci,this.awaitIdentPos=Qn,this.parseArrowExpression(this.startNodeAt(T,F),qi,!0);this.checkExpressionErrors(xr,!0),this.yieldPos=In||this.yieldPos,this.awaitPos=ci||this.awaitPos,this.awaitIdentPos=Qn||this.awaitIdentPos;var fa=this.startNodeAt(T,F);fa.callee=_,fa.arguments=qi,We&&(fa.optional=ct),_=this.finishNode(fa,"CallExpression")}else if(this.type===Y.backQuote){(ct||xe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var La=this.startNodeAt(T,F);La.tag=_,La.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(La,"TaggedTemplateExpression")}return _},Ln.parseExprAtom=function(_){this.type===Y.slash&&this.readRegexp();var T,F=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(T,"Super");case Y._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case Y.name:var O=this.start,q=this.startLoc,xe=this.containsEsc,We=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!xe&&We.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(O,q),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(O,q),[We],!1);if(this.options.ecmaVersion>=8&&We.name==="async"&&this.type===Y.name&&!xe)return We=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,q),[We],!0)}return We;case Y.regexp:var ct=this.value;return T=this.parseLiteral(ct.value),T.regex={pattern:ct.pattern,flags:ct.flags},T;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return T=this.startNode(),T.value=this.type===Y._null?null:this.type===Y._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case Y.parenL:var ht=this.start,cr=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(cr)&&(_.parenthesizedAssign=ht),_.parenthesizedBind<0&&(_.parenthesizedBind=ht)),cr;case Y.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(Y.bracketR,!0,!0,_),this.finishNode(T,"ArrayExpression");case Y.braceL:return this.parseObj(!1,_);case Y._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ln.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(_);case Y.dot:return _.meta=T,this.parseImportMeta(_);default:this.unexpected()}},Ln.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var T=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(_,"ImportExpression")},Ln.parseImportMeta=function(_){this.next();var T=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Ln.parseLiteral=function(_){var T=this.startNode();return T.value=_,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},Ln.parseParenExpression=function(){this.expect(Y.parenL);var _=this.parseExpression();return this.expect(Y.parenR),_},Ln.parseParenAndDistinguishExpression=function(_){var T=this.start,F=this.startLoc,O,q=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var xe=this.start,We=this.startLoc,ct=[],ht=!0,cr=!1,xr=new he,In=this.yieldPos,ci=this.awaitPos,Qn;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(ht?ht=!1:this.expect(Y.comma),q&&this.afterTrailingComma(Y.parenR,!0)){cr=!0;break}else if(this.type===Y.ellipsis){Qn=this.start,ct.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ct.push(this.parseMaybeAssign(!1,xr,this.parseParenItem));var qi=this.start,fa=this.startLoc;if(this.expect(Y.parenR),_&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(xr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=In,this.awaitPos=ci,this.parseParenArrowList(T,F,ct);(!ct.length||cr)&&this.unexpected(this.lastTokStart),Qn&&this.unexpected(Qn),this.checkExpressionErrors(xr,!0),this.yieldPos=In||this.yieldPos,this.awaitPos=ci||this.awaitPos,ct.length>1?(O=this.startNodeAt(xe,We),O.expressions=ct,this.finishNodeAt(O,"SequenceExpression",qi,fa)):O=ct[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var La=this.startNodeAt(T,F);return La.expression=O,this.finishNode(La,"ParenthesizedExpression")}else return O},Ln.parseParenItem=function(_){return _},Ln.parseParenArrowList=function(_,T,F){return this.parseArrowExpression(this.startNodeAt(_,T),F)};var li=[];Ln.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){_.meta=T;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var O=this.start,q=this.startLoc,xe=this.type===Y._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),O,q,!0),xe&&_.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(Y.parenL)?_.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):_.arguments=li,this.finishNode(_,"NewExpression")},Ln.parseTemplateElement=function(_){var T=_.isTagged,F=this.startNode();return this.type===Y.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===Y.backQuote,this.finishNode(F,"TemplateElement")},Ln.parseTemplate=function(_){_===void 0&&(_={});var T=_.isTagged;T===void 0&&(T=!1);var F=this.startNode();this.next(),F.expressions=[];var O=this.parseTemplateElement({isTagged:T});for(F.quasis=[O];!O.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(Y.braceR),F.quasis.push(O=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(F,"TemplateLiteral")},Ln.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!$t.test(this.input.slice(this.lastTokEnd,this.start))},Ln.parseObj=function(_,T){var F=this.startNode(),O=!0,q={};for(F.properties=[],this.next();!this.eat(Y.braceR);){if(O)O=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var xe=this.parseProperty(_,T);_||this.checkPropClash(xe,q,T),F.properties.push(xe)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},Ln.parseProperty=function(_,T){var F=this.startNode(),O,q,xe,We;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===Y.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,T),this.type===Y.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||T)&&(xe=this.start,We=this.startLoc),_||(O=this.eat(Y.star)));var ct=this.containsEsc;return this.parsePropertyName(F),!_&&!ct&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(F)?(q=!0,O=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(F,T)):q=!1,this.parsePropertyValue(F,_,O,q,xe,We,T,ct),this.finishNode(F,"Property")},Ln.parsePropertyValue=function(_,T,F,O,q,xe,We,ct){if((F||O)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))_.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,We),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)T&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,O);else if(!T&&!ct&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(F||O)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var ht=_.kind==="get"?0:1;if(_.value.params.length!==ht){var cr=_.value.start;_.kind==="get"?this.raiseRecoverable(cr,"getter should have no params"):this.raiseRecoverable(cr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||O)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=q),_.kind="init",T?_.value=this.parseMaybeDefault(q,xe,_.key):this.type===Y.eq&&We?(We.shorthandAssign<0&&(We.shorthandAssign=this.start),_.value=this.parseMaybeDefault(q,xe,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Ln.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(Y.bracketR),_.key;_.computed=!1}return _.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Ln.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Ln.parseMethod=function(_,T,F){var O=this.startNode(),q=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=_),this.options.ecmaVersion>=8&&(O.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Fi(T,O.generator)|ui|(F?oa:0)),this.expect(Y.parenL),O.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=q,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(O,"FunctionExpression")},Ln.parseArrowExpression=function(_,T,F){var O=this.yieldPos,q=this.awaitPos,xe=this.awaitIdentPos;return this.enterScope(Fi(F,!1)|gi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(T,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=O,this.awaitPos=q,this.awaitIdentPos=xe,this.finishNode(_,"ArrowFunctionExpression")},Ln.parseFunctionBody=function(_,T,F){var O=T&&this.type!==Y.braceL,q=this.strict,xe=!1;if(O)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var We=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!q||We)&&(xe=this.strictDirective(this.end),xe&&We&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ct=this.labels;this.labels=[],xe&&(this.strict=!0),this.checkParams(_,!q&&!xe&&!T&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,Mn),_.body=this.parseBlock(!1,void 0,xe&&!q),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ct}this.exitScope()},Ln.isSimpleParamList=function(_){for(var T=0,F=_;T<F.length;T+=1){var O=F[T];if(O.type!=="Identifier")return!1}return!0},Ln.checkParams=function(_,T){for(var F={},O=0,q=_.params;O<q.length;O+=1){var xe=q[O];this.checkLVal(xe,Gi,T?null:F)}},Ln.parseExprList=function(_,T,F,O){for(var q=[],xe=!0;!this.eat(_);){if(xe)xe=!1;else if(this.expect(Y.comma),T&&this.afterTrailingComma(_))break;var We=void 0;F&&this.type===Y.comma?We=null:this.type===Y.ellipsis?(We=this.parseSpread(O),O&&this.type===Y.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):We=this.parseMaybeAssign(!1,O),q.push(We)}return q},Ln.checkUnreserved=function(_){var T=_.start,F=_.end,O=_.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(T,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,F).indexOf("\\")!==-1)){var q=this.strict?this.reservedWordsStrict:this.reservedWords;q.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+O+"' is reserved"))}},Ln.parseIdent=function(_,T){var F=this.startNode();return this.type===Y.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},Ln.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(Y.star),T.argument=this.parseMaybeAssign(_)),this.finishNode(T,"YieldExpression")},Ln.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var Vn=Si.prototype;Vn.raise=function(_,T){var F=vt(this.input,_);T+=" ("+F.line+":"+F.column+")";var O=new SyntaxError(T);throw O.pos=_,O.loc=F,O.raisedAt=this.pos,O},Vn.raiseRecoverable=Vn.raise,Vn.curPosition=function(){if(this.options.locations)return new De(this.curLine,this.pos-this.lineStart)};var rn=Si.prototype,Ii=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};rn.enterScope=function(_){this.scopeStack.push(new Ii(_))},rn.exitScope=function(){this.scopeStack.pop()},rn.treatFunctionsAsVarInScope=function(_){return _.flags&vn||!this.inModule&&_.flags&Yn},rn.declareName=function(_,T,F){var O=!1;if(T===la){var q=this.currentScope();O=q.lexical.indexOf(_)>-1||q.functions.indexOf(_)>-1||q.var.indexOf(_)>-1,q.lexical.push(_),this.inModule&&q.flags&Yn&&delete this.undefinedExports[_]}else if(T===ba){var xe=this.currentScope();xe.lexical.push(_)}else if(T===wi){var We=this.currentScope();this.treatFunctionsAsVar?O=We.lexical.indexOf(_)>-1:O=We.lexical.indexOf(_)>-1||We.var.indexOf(_)>-1,We.functions.push(_)}else for(var ct=this.scopeStack.length-1;ct>=0;--ct){var ht=this.scopeStack[ct];if(ht.lexical.indexOf(_)>-1&&!(ht.flags&qn&&ht.lexical[0]===_)||!this.treatFunctionsAsVarInScope(ht)&&ht.functions.indexOf(_)>-1){O=!0;break}if(ht.var.push(_),this.inModule&&ht.flags&Yn&&delete this.undefinedExports[_],ht.flags&Qi)break}O&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},rn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},rn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},rn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Qi)return T}},rn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Qi&&!(T.flags&gi))return T}};var Oi=function(T,F,O){this.type="",this.start=F,this.end=0,T.options.locations&&(this.loc=new St(T,O)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[F,0])},eo=Si.prototype;eo.startNode=function(){return new Oi(this,this.start,this.startLoc)},eo.startNodeAt=function(_,T){return new Oi(this,_,T)};function hs(_,T,F,O){return _.type=T,_.end=F,this.options.locations&&(_.loc.end=O),this.options.ranges&&(_.range[1]=F),_}eo.finishNode=function(_,T){return hs.call(this,_,T,this.lastTokEnd,this.lastTokEndLoc)},eo.finishNodeAt=function(_,T,F,O){return hs.call(this,_,T,F,O)};var ga=function(T,F,O,q,xe){this.token=T,this.isExpr=!!F,this.preserveSpace=!!O,this.override=q,this.generator=!!xe},Fa={b_stat:new ga("{",!1),b_expr:new ga("{",!0),b_tmpl:new ga("${",!1),p_stat:new ga("(",!1),p_expr:new ga("(",!0),q_tmpl:new ga("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new ga("function",!1),f_expr:new ga("function",!0),f_expr_gen:new ga("function",!0,!1,null,!0),f_gen:new ga("function",!1,!1,null,!0)},Aa=Si.prototype;Aa.initialContext=function(){return[Fa.b_stat]},Aa.braceIsBlock=function(_){var T=this.curContext();return T===Fa.f_expr||T===Fa.f_stat?!0:_===Y.colon&&(T===Fa.b_stat||T===Fa.b_expr)?!T.isExpr:_===Y._return||_===Y.name&&this.exprAllowed?$t.test(this.input.slice(this.lastTokEnd,this.start)):_===Y._else||_===Y.semi||_===Y.eof||_===Y.parenR||_===Y.arrow?!0:_===Y.braceL?T===Fa.b_stat:_===Y._var||_===Y._const||_===Y.name?!1:!this.exprAllowed},Aa.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var T=this.context[_];if(T.token==="function")return T.generator}return!1},Aa.updateContext=function(_){var T,F=this.type;F.keyword&&_===Y.dot?this.exprAllowed=!1:(T=F.updateContext)?T.call(this,_):this.exprAllowed=F.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Fa.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},Y.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Fa.b_stat:Fa.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(Fa.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(_){var T=_===Y._if||_===Y._for||_===Y._with||_===Y._while;this.context.push(T?Fa.p_stat:Fa.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(_){_.beforeExpr&&_!==Y.semi&&_!==Y._else&&!(_===Y._return&&$t.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===Y.colon||_===Y.braceL)&&this.curContext()===Fa.b_stat)?this.context.push(Fa.f_expr):this.context.push(Fa.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===Fa.q_tmpl?this.context.pop():this.context.push(Fa.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(_){if(_===Y._function){var T=this.context.length-1;this.context[T]===Fa.f_expr?this.context[T]=Fa.f_expr_gen:this.context[T]=Fa.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(_){var T=!1;this.options.ecmaVersion>=6&&_!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var H="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",K=H+" Extended_Pictographic",re=K,ge={9:H,10:K,11:re},Pe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",rt=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",fe=rt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Fe={9:Ge,10:rt,11:fe},mt={};function vr(_){var T=mt[_]={binary:Xe(ge[_]+" "+Pe),nonBinary:{General_Category:Xe(Pe),Script:Xe(Fe[_])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}vr(9),vr(10),vr(11);var Ft=Si.prototype,Bt=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=mt[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Bt.prototype.reset=function(T,F,O){var q=O.indexOf("u")!==-1;this.start=T|0,this.source=F+"",this.flags=O,this.switchU=q&&this.parser.options.ecmaVersion>=6,this.switchN=q&&this.parser.options.ecmaVersion>=9},Bt.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Bt.prototype.at=function(T,F){F===void 0&&(F=!1);var O=this.source,q=O.length;if(T>=q)return-1;var xe=O.charCodeAt(T);if(!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=q)return xe;var We=O.charCodeAt(T+1);return We>=56320&&We<=57343?(xe<<10)+We-56613888:xe},Bt.prototype.nextIndex=function(T,F){F===void 0&&(F=!1);var O=this.source,q=O.length;if(T>=q)return q;var xe=O.charCodeAt(T),We;return!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=q||(We=O.charCodeAt(T+1))<56320||We>57343?T+1:T+2},Bt.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Bt.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Bt.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Bt.prototype.eat=function(T,F){return F===void 0&&(F=!1),this.current(F)===T?(this.advance(F),!0):!1};function gr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Ft.validateRegExpFlags=function(_){for(var T=_.validFlags,F=_.flags,O=0;O<F.length;O++){var q=F.charAt(O);T.indexOf(q)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(q,O+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Ft.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Ft.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var T=0,F=_.backReferenceNames;T<F.length;T+=1){var O=F[T];_.groupNames.indexOf(O)===-1&&_.raise("Invalid named capture referenced")}},Ft.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Ft.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Ft.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Ft.regexp_eatAssertion=function(_){var T=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=T}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=T,!1},Ft.regexp_eatQuantifier=function(_,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(_,T)?(_.eat(63),!0):!1},Ft.regexp_eatQuantifierPrefix=function(_,T){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,T)},Ft.regexp_eatBracedQuantifier=function(_,T){var F=_.pos;if(_.eat(123)){var O=0,q=-1;if(this.regexp_eatDecimalDigits(_)&&(O=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(q=_.lastIntValue),_.eat(125)))return q!==-1&&q<O&&!T&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!T&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Ft.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Ft.regexp_eatReverseSolidusAtomEscape=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=T}return!1},Ft.regexp_eatUncapturingGroup=function(_){var T=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=T}return!1},Ft.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Ft.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Ft.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Ft.regexp_eatSyntaxCharacter=function(_){var T=_.current();return bn(T)?(_.lastIntValue=T,_.advance(),!0):!1};function bn(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Ft.regexp_eatPatternCharacters=function(_){for(var T=_.pos,F=0;(F=_.current())!==-1&&!bn(F);)_.advance();return _.pos!==T},Ft.regexp_eatExtendedPatternCharacter=function(_){var T=_.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(_.advance(),!0):!1},Ft.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Ft.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Ft.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=gr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=gr(_.lastIntValue);return!0}return!1},Ft.regexp_eatRegExpIdentifierStart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,O=_.current(F);return _.advance(F),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(O=_.lastIntValue),cn(O)?(_.lastIntValue=O,!0):(_.pos=T,!1)};function cn(_){return Ht(_,!0)||_===36||_===95}Ft.regexp_eatRegExpIdentifierPart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,O=_.current(F);return _.advance(F),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(O=_.lastIntValue),wt(O)?(_.lastIntValue=O,!0):(_.pos=T,!1)};function wt(_){return sr(_,!0)||_===36||_===95||_===8204||_===8205}Ft.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Ft.regexp_eatBackReference=function(_){var T=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=T}return!1},Ft.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Ft.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Ft.regexp_eatCControlLetter=function(_){var T=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=T}return!1},Ft.regexp_eatZero=function(_){return _.current()===48&&!Ti(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Ft.regexp_eatControlEscape=function(_){var T=_.current();return T===116?(_.lastIntValue=9,_.advance(),!0):T===110?(_.lastIntValue=10,_.advance(),!0):T===118?(_.lastIntValue=11,_.advance(),!0):T===102?(_.lastIntValue=12,_.advance(),!0):T===114?(_.lastIntValue=13,_.advance(),!0):!1},Ft.regexp_eatControlLetter=function(_){var T=_.current();return on(T)?(_.lastIntValue=T%32,_.advance(),!0):!1};function on(_){return _>=65&&_<=90||_>=97&&_<=122}Ft.regexp_eatRegExpUnicodeEscapeSequence=function(_,T){T===void 0&&(T=!1);var F=_.pos,O=T||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var q=_.lastIntValue;if(O&&q>=55296&&q<=56319){var xe=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var We=_.lastIntValue;if(We>=56320&&We<=57343)return _.lastIntValue=(q-55296)*1024+(We-56320)+65536,!0}_.pos=xe,_.lastIntValue=q}return!0}if(O&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Hr(_.lastIntValue))return!0;O&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function Hr(_){return _>=0&&_<=1114111}Ft.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var T=_.current();return T!==99&&(!_.switchN||T!==107)?(_.lastIntValue=T,_.advance(),!0):!1},Ft.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var T=_.current();if(T>=49&&T<=57){do _.lastIntValue=10*_.lastIntValue+(T-48),_.advance();while((T=_.current())>=48&&T<=57);return!0}return!1},Ft.regexp_eatCharacterClassEscape=function(_){var T=_.current();if(Xr(T))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Xr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Ft.regexp_eatUnicodePropertyValueExpression=function(_){var T=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var O=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,O),!0}}if(_.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var q=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,q),!0}return!1},Ft.regexp_validateUnicodePropertyNameAndValue=function(_,T,F){Qr(_.unicodeProperties.nonBinary,T)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[T].test(F)||_.raise("Invalid property value")},Ft.regexp_validateUnicodePropertyNameOrValue=function(_,T){_.unicodeProperties.binary.test(T)||_.raise("Invalid property name")},Ft.regexp_eatUnicodePropertyName=function(_){var T=0;for(_.lastStringValue="";ii(T=_.current());)_.lastStringValue+=gr(T),_.advance();return _.lastStringValue!==""};function ii(_){return on(_)||_===95}Ft.regexp_eatUnicodePropertyValue=function(_){var T=0;for(_.lastStringValue="";Jr(T=_.current());)_.lastStringValue+=gr(T),_.advance();return _.lastStringValue!==""};function Jr(_){return ii(_)||Ti(_)}Ft.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Ft.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Ft.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var T=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(T===-1||F===-1)&&_.raise("Invalid character class"),T!==-1&&F!==-1&&T>F&&_.raise("Range out of order in character class")}}},Ft.regexp_eatClassAtom=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Ri(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=T}var O=_.current();return O!==93?(_.lastIntValue=O,_.advance(),!0):!1},Ft.regexp_eatClassEscape=function(_){var T=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=T}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Ft.regexp_eatClassControlLetter=function(_){var T=_.current();return Ti(T)||T===95?(_.lastIntValue=T%32,_.advance(),!0):!1},Ft.regexp_eatHexEscapeSequence=function(_){var T=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=T}return!1},Ft.regexp_eatDecimalDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;Ti(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==T};function Ti(_){return _>=48&&_<=57}Ft.regexp_eatHexDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;ra(F=_.current());)_.lastIntValue=16*_.lastIntValue+Ei(F),_.advance();return _.pos!==T};function ra(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function Ei(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Ft.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var T=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;T<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=T*64+F*8+_.lastIntValue:_.lastIntValue=T*8+F}else _.lastIntValue=T;return!0}return!1},Ft.regexp_eatOctalDigit=function(_){var T=_.current();return Ri(T)?(_.lastIntValue=T-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Ri(_){return _>=48&&_<=55}Ft.regexp_eatFixedHexDigits=function(_,T){var F=_.pos;_.lastIntValue=0;for(var O=0;O<T;++O){var q=_.current();if(!ra(q))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+Ei(q),_.advance()}return!0};var Ci=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new St(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},Jn=Si.prototype;Jn.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ci(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Jn.getToken=function(){return this.next(),new Ci(this)},typeof Symbol!="undefined"&&(Jn[Symbol.iterator]=function(){var _=this;return{next:function(){var T=_.getToken();return{done:T.type===Y.eof,value:T}}}}),Jn.curContext=function(){return this.context[this.context.length-1]},Jn.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},Jn.readToken=function(_){return Ht(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},Jn.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var T=this.input.charCodeAt(this.pos+1);return(_<<10)+T-56613888},Jn.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),T=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){gt.lastIndex=T;for(var O;(O=gt.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,F),T,this.pos,_,this.curPosition())},Jn.skipLineComment=function(_){for(var T=this.pos,F=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Qe(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+_,this.pos),T,this.pos,F,this.curPosition())},Jn.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&xt.test(String.fromCharCode(_)))++this.pos;else break e}}},Jn.finishToken=function(_,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=T,this.updateContext(F)},Jn.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&T===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},Jn.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},Jn.readToken_mult_modulo_exp=function(_){var T=this.input.charCodeAt(this.pos+1),F=1,O=_===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&_===42&&T===42&&(++F,O=Y.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(Y.assign,F+1):this.finishOp(O,F)},Jn.readToken_pipe_amp=function(_){var T=this.input.charCodeAt(this.pos+1);if(T===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(Y.assign,3)}return this.finishOp(_===124?Y.logicalOR:Y.logicalAND,2)}return T===61?this.finishOp(Y.assign,2):this.finishOp(_===124?Y.bitwiseOR:Y.bitwiseAND,1)},Jn.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},Jn.readToken_plus_min=function(_){var T=this.input.charCodeAt(this.pos+1);return T===_?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||$t.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):T===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},Jn.readToken_lt_gt=function(_){var T=this.input.charCodeAt(this.pos+1),F=1;return T===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(Y.assign,F+1):this.finishOp(Y.bitShift,F)):T===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(F=2),this.finishOp(Y.relational,F))},Jn.readToken_eq_excl=function(_){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(_===61?Y.eq:Y.prefix,1)},Jn.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(Y.questionDot,2)}if(T===63){if(_>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},Jn.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+sa(_)+"'")},Jn.finishOp=function(_,T){var F=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(_,F)},Jn.readRegexp=function(){for(var _,T,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var O=this.input.charAt(this.pos);if($t.test(O)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(O==="[")T=!0;else if(O==="]"&&T)T=!1;else if(O==="/"&&!T)break;_=O==="\\"}++this.pos}var q=this.input.slice(F,this.pos);++this.pos;var xe=this.pos,We=this.readWord1();this.containsEsc&&this.unexpected(xe);var ct=this.regexpState||(this.regexpState=new Bt(this));ct.reset(F,q,We),this.validateRegExpFlags(ct),this.validateRegExpPattern(ct);var ht=null;try{ht=new RegExp(q,We)}catch(cr){}return this.finishToken(Y.regexp,{pattern:q,flags:We,value:ht})},Jn.readInt=function(_,T,F){for(var O=this.options.ecmaVersion>=12&&T===void 0,q=F&&this.input.charCodeAt(this.pos)===48,xe=this.pos,We=0,ct=0,ht=0,cr=T==null?Infinity:T;ht<cr;++ht,++this.pos){var xr=this.input.charCodeAt(this.pos),In=void 0;if(O&&xr===95){q&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ct===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),ht===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ct=xr;continue}if(xr>=97?In=xr-97+10:xr>=65?In=xr-65+10:xr>=48&&xr<=57?In=xr-48:In=Infinity,In>=_)break;ct=xr,We=We*_+In}return O&&ct===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===xe||T!=null&&this.pos-xe!==T?null:We};function Yi(_,T){return T?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ba(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}Jn.readRadixNumber=function(_){var T=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Ba(this.input.slice(T,this.pos)),++this.pos):Ht(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,F)},Jn.readNumber=function(_){var T=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var F=this.pos-T>=2&&this.input.charCodeAt(T)===48;F&&this.strict&&this.raise(T,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&O===110){var q=Ba(this.input.slice(T,this.pos));return++this.pos,Ht(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,q)}F&&/[89]/.test(this.input.slice(T,this.pos))&&(F=!1),O===46&&!F&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!F&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),Ht(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var xe=Yi(this.input.slice(T,this.pos),F);return this.finishToken(Y.num,xe)},Jn.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),T;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else T=this.readHexChar(4);return T};function sa(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Jn.readString=function(_){for(var T="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===_)break;O===92?(T+=this.input.slice(F,this.pos),T+=this.readEscapedChar(!1),F=this.pos):(Qe(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(F,this.pos++),this.finishToken(Y.string,T)};var Li={};Jn.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Li)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},Jn.invalidStringToken=function(_,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Li;this.raise(_,T)},Jn.readTmplToken=function(){for(var _="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(_+=this.input.slice(T,this.pos),this.finishToken(Y.template,_));if(F===92)_+=this.input.slice(T,this.pos),_+=this.readEscapedChar(!0),T=this.pos;else if(Qe(F)){switch(_+=this.input.slice(T,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},Jn.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Jn.readEscapedChar=function(_){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return sa(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],q=parseInt(O,8);return q>255&&(O=O.slice(0,-1),q=parseInt(O,8)),this.pos+=O.length-1,T=this.input.charCodeAt(this.pos),(O!=="0"||T===56||T===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-O.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(q)}return Qe(T)?"":String.fromCharCode(T)}},Jn.readHexChar=function(_){var T=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(T,"Bad character escape sequence"),F},Jn.readWord1=function(){this.containsEsc=!1;for(var _="",T=!0,F=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var q=this.fullCharCodeAtPos();if(sr(q,O))this.pos+=q<=65535?1:2;else if(q===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var xe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var We=this.readCodePoint();(T?Ht:sr)(We,O)||this.invalidStringToken(xe,"Invalid Unicode escape"),_+=sa(We),F=this.pos}else break;T=!1}return _+this.input.slice(F,this.pos)},Jn.readWord=function(){var _=this.readWord1(),T=Y.name;return this.keywords.test(_)&&(T=dt[_]),this.finishToken(T,_)};var Hi="7.4.1";Si.acorn={Parser:Si,version:Hi,defaultOptions:zt,Position:De,SourceLocation:St,getLineInfo:vt,Node:Oi,TokenType:Ct,tokTypes:Y,keywordTypes:dt,TokContext:ga,tokContexts:Fa,isIdentifierChar:sr,isIdentifierStart:Ht,Token:Ci,isNewLine:Qe,lineBreak:$t,lineBreakG:gt,nonASCIIwhitespace:xt};function Za(_,T){return Si.parse(_,T)}function au(_,T,F){return Si.parseExpressionAt(_,T,F)}function wa(_,T){return Si.tokenizer(_,T)}function Ta(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,_.__proto__=T}function Ss(_){var T=typeof Map=="function"?new Map:void 0;return Ss=function(O){if(O===null||!Zu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(O))return T.get(O);T.set(O,q)}function q(){return na(O,arguments,ja(this).constructor)}return q.prototype=Object.create(O.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),So(q,O)},Ss(_)}function ds(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function na(_,T,F){return ds()?na=Reflect.construct:na=function(q,xe,We){var ct=[null];ct.push.apply(ct,xe);var ht=Function.bind.apply(q,ct),cr=new ht;return We&&So(cr,We.prototype),cr},na.apply(null,arguments)}function Zu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function So(_,T){return So=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},So(_,T)}function ja(_){return ja=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},ja(_)}var uo=function(_){Ta(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ss(Error)),ea=function(_){Ta(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ss(SyntaxError)),$o=function(_){Ta(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ss(ReferenceError)),Qo=function(_){Ta(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ss(TypeError)),ju=function(_){Ta(T,_);function T(){return _.apply(this,arguments)||this}return T}(uo),To=function(_){Ta(T,_);function T(){return _.apply(this,arguments)||this}return T}(ea),Jo=function(_){Ta(T,_);function T(){return _.apply(this,arguments)||this}return T}($o),ya={UnknownError:[3001,"%0",ju],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",ju],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Jo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Jo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Jo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Jo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Jo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Jo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Jo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Jo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Jo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Jo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",$o],VariableUndefinedReferenceError:[2002,"%0 is not defined",$o],IsNotConstructor:[2003,"%0 is not a constructor",Qo]};function Co(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function es(_,T,F){return Co()?es=Reflect.construct:es=function(q,xe,We){var ct=[null];ct.push.apply(ct,xe);var ht=Function.bind.apply(q,ct),cr=new ht;return We&&lo(cr,We.prototype),cr},es.apply(null,arguments)}function lo(_,T){return lo=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},lo(_,T)}var ou="0.0.3";function Cc(_,T){Object.defineProperty(_,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var ks=Object.prototype.hasOwnProperty,$=Symbol("Break"),be=Symbol("Continue"),Ke=Symbol("DefaultCase"),Rt=Symbol("EmptyStatementReturn"),Rr=Symbol("WithScopeName"),ot=Symbol("SuperScopeName"),Tt=Symbol("RootScopeName"),co=Symbol("GlobalScopeName");function ta(_){return typeof _=="function"}var qa=function(){function _(F){this.interpreter=F}var T=_.prototype;return T.generator=function(){var O=this.interpreter;function q(){return this.getCurrentScope()}function xe(){return this.getGlobalScope()}function We(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:q.bind(O),getGlobalScope:xe.bind(O),getCurrentContext:We.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},_}();function ts(_,T,F){if(F===void 0&&(F=!0),!(_ instanceof qa))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var O=_.generator(),q=O.getOptions(),xe={timeout:q.timeout,_initEnv:function(){F||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},We=F?O.getGlobalScope():O.getCurrentScope(),ct=new Ao(We,xe);return ct.evaluate(T)}}Object.defineProperty(ts,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function sn(_){if(!(_ instanceof qa))throw new Error("Illegal call");for(var T=_.generator(),F=arguments.length,O=new Array(F>1?F-1:0),q=1;q<F;q++)O[q-1]=arguments[q];var xe=O.pop(),We=new Ao(T.getGlobalScope(),T.getOptions()),ct=`
		    (function anonymous(`+O.join(",")+`){
		        `+xe+`
		    });
		    `;return We.evaluate(ct)}Object.defineProperty(sn,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var en=function(T){this.value=T},Nt=function(T){this.value=T},Vo=function(T){this.value=T},de=function(T,F,O){F===void 0&&(F=null),this.name=O,this.parent=F,this.data=T,this.labelStack=[]};function Ks(){}function su(_,T){return _===void 0&&(_=null),new de(Object.create(null),_,T)}function vs(_){return Object.create(_)}var ua={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:ts,Function:sn};typeof JSON!="undefined"&&(ua.JSON=JSON),typeof Promise!="undefined"&&(ua.Promise=Promise),typeof Set!="undefined"&&(ua.Set=Set),typeof Map!="undefined"&&(ua.Map=Map),typeof Symbol!="undefined"&&(ua.Symbol=Symbol),typeof Proxy!="undefined"&&(ua.Proxy=Proxy),typeof WeakMap!="undefined"&&(ua.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ua.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ua.Reflect=Reflect);var Ao=function(){function _(F,O){F===void 0&&(F=_.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||_.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?_.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=_.prototype;return T.initEnvironment=function(O){var q;if(O instanceof de)q=O;else{var xe=null,We=this.createSuperScope(O);this.options.rootContext&&(xe=new de(vs(this.options.rootContext),We,Tt)),q=new de(O,xe||We,co)}this.globalScope=q,this.currentScope=this.globalScope,this.globalContext=q.data,this.currentContext=q.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ct=this.options._initEnv;ct&&ct.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(O){return O instanceof ju||O instanceof Jo||O instanceof To},T.createSuperScope=function(O){var q=Object.assign({},ua),xe=Object.keys(q);return xe.forEach(function(We){We in O&&delete q[We]}),new de(q,null,ot)},T.setCurrentContext=function(O){this.currentContext=O},T.setCurrentScope=function(O){this.currentScope=O},T.evaluate=function(O){O===void 0&&(O="");var q;if(!!O)return q=Za(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(q,O)},T.appendCode=function(O){return this.evaluate(O)},T.evaluateNode=function(O,q){var xe=this;q===void 0&&(q=""),this.value=void 0,this.source=q,this.sourceList.push(q),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var We=this.getCurrentScope(),ct=this.getCurrentContext(),ht=We.labelStack.concat([]),cr=this.callStack.concat([]),xr=function(){xe.setCurrentScope(We),xe.setCurrentContext(ct),We.labelStack=ht,xe.callStack=cr};try{var In=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),In()}catch(ci){throw ci}finally{xr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(O,q,xe){var We=O[1].replace("%0",String(q));return xe!==null&&(We+=this.getNodePosition(xe||this.lastExecNode)),We},T.createError=function(O,q){return new q(O)},T.createThrowError=function(O,q){return this.createError(O,q)},T.createInternalThrowError=function(O,q,xe){return this.createError(this.createErrorMessage(O,q,xe),O[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,q=Date.now();return q-this.execStartTime>O},T.getNodePosition=function(O){if(O){var q="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+q:""}return""},T.createClosure=function(O){var q=this,xe;switch(O.type){case"BinaryExpression":xe=this.binaryExpressionHandler(O);break;case"LogicalExpression":xe=this.logicalExpressionHandler(O);break;case"UnaryExpression":xe=this.unaryExpressionHandler(O);break;case"UpdateExpression":xe=this.updateExpressionHandler(O);break;case"ObjectExpression":xe=this.objectExpressionHandler(O);break;case"ArrayExpression":xe=this.arrayExpressionHandler(O);break;case"CallExpression":xe=this.callExpressionHandler(O);break;case"NewExpression":xe=this.newExpressionHandler(O);break;case"MemberExpression":xe=this.memberExpressionHandler(O);break;case"ThisExpression":xe=this.thisExpressionHandler(O);break;case"SequenceExpression":xe=this.sequenceExpressionHandler(O);break;case"Literal":xe=this.literalHandler(O);break;case"Identifier":xe=this.identifierHandler(O);break;case"AssignmentExpression":xe=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":xe=this.functionDeclarationHandler(O);break;case"VariableDeclaration":xe=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":xe=this.programHandler(O);break;case"ExpressionStatement":xe=this.expressionStatementHandler(O);break;case"EmptyStatement":xe=this.emptyStatementHandler(O);break;case"ReturnStatement":xe=this.returnStatementHandler(O);break;case"FunctionExpression":xe=this.functionExpressionHandler(O);break;case"IfStatement":xe=this.ifStatementHandler(O);break;case"ConditionalExpression":xe=this.conditionalExpressionHandler(O);break;case"ForStatement":xe=this.forStatementHandler(O);break;case"WhileStatement":xe=this.whileStatementHandler(O);break;case"DoWhileStatement":xe=this.doWhileStatementHandler(O);break;case"ForInStatement":xe=this.forInStatementHandler(O);break;case"WithStatement":xe=this.withStatementHandler(O);break;case"ThrowStatement":xe=this.throwStatementHandler(O);break;case"TryStatement":xe=this.tryStatementHandler(O);break;case"ContinueStatement":xe=this.continueStatementHandler(O);break;case"BreakStatement":xe=this.breakStatementHandler(O);break;case"SwitchStatement":xe=this.switchStatementHandler(O);break;case"LabeledStatement":xe=this.labeledStatementHandler(O);break;case"DebuggerStatement":xe=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(ya.NodeTypeSyntaxError,O.type,O)}return function(){var We=q.options.timeout;if(We&&We>0&&q.checkTimeout())throw q.createInternalThrowError(ya.ExecutionTimeOutError,We,null);return q.lastExecNode=O,xe.apply(void 0,arguments)}},T.binaryExpressionHandler=function(O){var q=this,xe=this.createClosure(O.left),We=this.createClosure(O.right);return function(){var ct=xe(),ht=We();switch(O.operator){case"==":return ct==ht;case"!=":return ct!=ht;case"===":return ct===ht;case"!==":return ct!==ht;case"<":return ct<ht;case"<=":return ct<=ht;case">":return ct>ht;case">=":return ct>=ht;case"<<":return ct<<ht;case">>":return ct>>ht;case">>>":return ct>>>ht;case"+":return ct+ht;case"-":return ct-ht;case"*":return ct*ht;case"**":return Math.pow(ct,ht);case"/":return ct/ht;case"%":return ct%ht;case"|":return ct|ht;case"^":return ct^ht;case"&":return ct&ht;case"in":return ct in ht;case"instanceof":return ct instanceof ht;default:throw q.createInternalThrowError(ya.BinaryOperatorSyntaxError,O.operator,O)}}},T.logicalExpressionHandler=function(O){var q=this,xe=this.createClosure(O.left),We=this.createClosure(O.right);return function(){switch(O.operator){case"||":return xe()||We();case"&&":return xe()&&We();default:throw q.createInternalThrowError(ya.LogicalOperatorSyntaxError,O.operator,O)}}},T.unaryExpressionHandler=function(O){var q=this;switch(O.operator){case"delete":var xe=this.createObjectGetter(O.argument),We=this.createNameGetter(O.argument);return function(){var xr=xe(),In=We();return delete xr[In]};default:var ct;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var ht=this.createObjectGetter(O.argument),cr=this.createNameGetter(O.argument);ct=function(){return ht()[cr()]}}else ct=this.createClosure(O.argument);return function(){var xr=ct();switch(O.operator){case"-":return-xr;case"+":return+xr;case"!":return!xr;case"~":return~xr;case"void":return;case"typeof":return typeof xr;default:throw q.createInternalThrowError(ya.UnaryOperatorSyntaxError,O.operator,O)}}}},T.updateExpressionHandler=function(O){var q=this,xe=this.createObjectGetter(O.argument),We=this.createNameGetter(O.argument);return function(){var ct=xe(),ht=We();switch(q.assertVariable(ct,ht,O),O.operator){case"++":return O.prefix?++ct[ht]:ct[ht]++;case"--":return O.prefix?--ct[ht]:ct[ht]--;default:throw q.createInternalThrowError(ya.UpdateOperatorSyntaxError,O.operator,O)}}},T.objectExpressionHandler=function(O){var q=this,xe=[];function We(ht){return ht.type==="Identifier"?ht.name:ht.type==="Literal"?ht.value:this.throwError(ya.ObjectStructureSyntaxError,ht.type,ht)}var ct=Object.create(null);return O.properties.forEach(function(ht){var cr=ht.kind,xr=We(ht.key);(!ct[xr]||cr==="init")&&(ct[xr]={}),ct[xr][cr]=q.createClosure(ht.value),xe.push({key:xr,property:ht})}),function(){for(var ht={},cr=xe.length,xr=0;xr<cr;xr++){var In=xe[xr],ci=In.key,Qn=ct[ci],qi=Qn.init?Qn.init():void 0,fa=Qn.get?Qn.get():function(){},La=Qn.set?Qn.set():function(cl){};if("set"in Qn||"get"in Qn){var Wi={configurable:!0,enumerable:!0,get:fa,set:La};Object.defineProperty(ht,ci,Wi)}else{var Fo=In.property,Cs=Fo.kind;Fo.key.type==="Identifier"&&Fo.value.type==="FunctionExpression"&&Cs==="init"&&!Fo.value.id&&Cc(qi,Fo.key.name),ht[ci]=qi}}return ht}},T.arrayExpressionHandler=function(O){var q=this,xe=O.elements.map(function(We){return We&&q.createClosure(We)});return function(){for(var We=xe.length,ct=Array(We),ht=0;ht<We;ht++){var cr=xe[ht];cr&&(ct[ht]=cr())}return ct}},T.safeObjectGet=function(O,q,xe){return O[q]},T.createCallFunctionGetter=function(O){var q=this;switch(O.type){case"MemberExpression":var xe=this.createClosure(O.object),We=this.createMemberKeyGetter(O),ct=this.source;return function(){var cr=xe(),xr=We(),In=q.safeObjectGet(cr,xr,O);if(!In||!ta(In)){var ci=ct.slice(O.start,O.end);throw q.createInternalThrowError(ya.FunctionUndefinedReferenceError,ci,O)}return In.__IS_EVAL_FUNC?function(Qn){return In(new qa(q),Qn,!0)}:In.__IS_FUNCTION_FUNC?function(){for(var Qn=arguments.length,qi=new Array(Qn),fa=0;fa<Qn;fa++)qi[fa]=arguments[fa];return In.apply(void 0,[new qa(q)].concat(qi))}:In.bind(cr)};default:var ht=this.createClosure(O);return function(){var cr="";O.type==="Identifier"&&(cr=O.name);var xr=ht();if(!xr||!ta(xr))throw q.createInternalThrowError(ya.FunctionUndefinedReferenceError,cr,O);if(O.type==="Identifier"&&xr.__IS_EVAL_FUNC&&cr==="eval")return function(Qn){var qi=q.getScopeFromName(cr,q.getCurrentScope()),fa=qi.name===ot||qi.name===co||qi.name===Tt;return xr(new qa(q),Qn,!fa)};if(xr.__IS_EVAL_FUNC)return function(Qn){return xr(new qa(q),Qn,!0)};if(xr.__IS_FUNCTION_FUNC)return function(){for(var Qn=arguments.length,qi=new Array(Qn),fa=0;fa<Qn;fa++)qi[fa]=arguments[fa];return xr.apply(void 0,[new qa(q)].concat(qi))};var In=q.options.globalContextInFunction;if(O.type==="Identifier"){var ci=q.getIdentifierScope(O);ci.name===Rr&&(In=ci.data)}return xr.bind(In)}}},T.callExpressionHandler=function(O){var q=this,xe=this.createCallFunctionGetter(O.callee),We=O.arguments.map(function(ct){return q.createClosure(ct)});return function(){return xe().apply(void 0,We.map(function(ct){return ct()}))}},T.functionExpressionHandler=function(O){var q=this,xe=this,We=this.source,ct=this.collectDeclVars,ht=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var cr=O.id?O.id.name:"",xr=O.params.length,In=O.params.map(function(fa){return q.createParamNameGetter(fa)}),ci=this.createClosure(O.body),Qn=this.collectDeclVars,qi=this.collectDeclFuncs;return this.collectDeclVars=ct,this.collectDeclFuncs=ht,function(){var fa=xe.getCurrentScope(),La=function Wi(){for(var Fo=arguments.length,Cs=new Array(Fo),cl=0;cl<Fo;cl++)Cs[cl]=arguments[cl];xe.callStack.push(""+cr);var qc=xe.getCurrentScope(),Wu=su(fa,"FunctionScope("+cr+")");xe.setCurrentScope(Wu),xe.addDeclarationsToScope(Qn,qi,Wu),cr&&(Wu.data[cr]=Wi),Wu.data.arguments=arguments,In.forEach(function(mu,Mo){Wu.data[mu()]=Cs[Mo]});var Tc=xe.getCurrentContext();xe.setCurrentContext(this);var Iu=ci();if(xe.setCurrentContext(Tc),xe.setCurrentScope(qc),xe.callStack.pop(),Iu instanceof en)return Iu.value};return Cc(La,cr),Object.defineProperty(La,"length",{value:xr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(La,"toString",{value:function(){return We.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(La,"valueOf",{value:function(){return We.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),La}},T.newExpressionHandler=function(O){var q=this,xe=this.source,We=this.createClosure(O.callee),ct=O.arguments.map(function(ht){return q.createClosure(ht)});return function(){var ht=We();if(!ta(ht)||ht.__IS_EVAL_FUNC){var cr=O.callee,xr=xe.slice(cr.start,cr.end);throw q.createInternalThrowError(ya.IsNotConstructor,xr,O)}return ht.__IS_FUNCTION_FUNC?ht.apply(void 0,[new qa(q)].concat(ct.map(function(In){return In()}))):es(ht,ct.map(function(In){return In()}))}},T.memberExpressionHandler=function(O){var q=this.createClosure(O.object),xe=this.createMemberKeyGetter(O);return function(){var We=q(),ct=xe();return We[ct]}},T.thisExpressionHandler=function(O){var q=this;return function(){return q.getCurrentContext()}},T.sequenceExpressionHandler=function(O){var q=this,xe=O.expressions.map(function(We){return q.createClosure(We)});return function(){for(var We,ct=xe.length,ht=0;ht<ct;ht++){var cr=xe[ht];We=cr()}return We}},T.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},T.identifierHandler=function(O){var q=this;return function(){var xe=q.getCurrentScope(),We=q.getScopeDataFromName(O.name,xe);return q.assertVariable(We,O.name,O),We[O.name]}},T.getIdentifierScope=function(O){var q=this.getCurrentScope(),xe=this.getScopeFromName(O.name,q);return xe},T.assignmentExpressionHandler=function(O){var q=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var xe=this.createObjectGetter(O.left),We=this.createNameGetter(O.left),ct=this.createClosure(O.right);return function(){var ht=xe(),cr=We(),xr=ct();switch(O.operator!=="="&&q.assertVariable(ht,cr,O),O.operator){case"=":return ht[cr]=xr;case"+=":return ht[cr]+=xr;case"-=":return ht[cr]-=xr;case"*=":return ht[cr]*=xr;case"**=":return ht[cr]=Math.pow(ht[cr],xr);case"/=":return ht[cr]/=xr;case"%=":return ht[cr]%=xr;case"<<=":return ht[cr]<<=xr;case">>=":return ht[cr]>>=xr;case">>>=":return ht[cr]>>>=xr;case"&=":return ht[cr]&=xr;case"^=":return ht[cr]^=xr;case"|=":return ht[cr]|=xr;default:throw q.createInternalThrowError(ya.AssignmentExpressionSyntaxError,O.type,O)}}},T.functionDeclarationHandler=function(O){if(O.id){var q=this.functionExpressionHandler(O);Object.defineProperty(q,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,q)}return function(){return Rt}},T.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(ya.VariableTypeSyntaxError,O.type,O)},T.variableDeclarationHandler=function(O){for(var q=this,xe,We=[],ct=0;ct<O.declarations.length;ct++){var ht=O.declarations[ct];this.varDeclaration(this.getVariableName(ht.id)),ht.init&&We.push({type:"AssignmentExpression",operator:"=",left:ht.id,right:ht.init})}return We.length&&(xe=this.createClosure({type:"BlockStatement",body:We})),function(){if(xe){var cr=q.isVarDeclMode;q.isVarDeclMode=!0,xe(),q.isVarDeclMode=cr}return Rt}},T.assertVariable=function(O,q,xe){if(O===this.globalScope.data&&!(q in O))throw this.createInternalThrowError(ya.VariableUndefinedReferenceError,q,xe)},T.programHandler=function(O){var q=this,xe=O.body.map(function(We){return q.createClosure(We)});return function(){for(var We=Rt,ct=0;ct<xe.length;ct++){var ht=xe[ct],cr=q.setValue(ht());if(cr!==Rt&&(We=cr,We instanceof en||We instanceof Nt||We instanceof Vo||We===$||We===be))break}return We}},T.expressionStatementHandler=function(O){return this.createClosure(O.expression)},T.emptyStatementHandler=function(O){return function(){return Rt}},T.returnStatementHandler=function(O){var q=O.argument?this.createClosure(O.argument):Ks;return function(){return new en(q())}},T.ifStatementHandler=function(O){var q=this.createClosure(O.test),xe=this.createClosure(O.consequent),We=O.alternate?this.createClosure(O.alternate):function(){return Rt};return function(){return q()?xe():We()}},T.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},T.forStatementHandler=function(O){var q=this,xe=Ks,We=O.test?this.createClosure(O.test):function(){return!0},ct=Ks,ht=this.createClosure(O.body);return O.type==="ForStatement"&&(xe=O.init?this.createClosure(O.init):xe,ct=O.update?this.createClosure(O.update):Ks),function(cr){var xr,In=Rt,ci=O.type==="DoWhileStatement";for(cr&&cr.type==="LabeledStatement"&&(xr=cr.label.name),xe();ci||We();ct()){ci=!1;var Qn=q.setValue(ht());if(!(Qn===Rt||Qn===be)){if(Qn===$)break;if(In=Qn,In instanceof Vo&&In.value===xr){In=Rt;continue}if(In instanceof en||In instanceof Nt||In instanceof Vo)break}}return In}},T.whileStatementHandler=function(O){return this.forStatementHandler(O)},T.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},T.forInStatementHandler=function(O){var q=this,xe=O.left,We=this.createClosure(O.right),ct=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),xe=O.left.declarations[0].id),function(ht){var cr,xr=Rt,In;ht&&ht.type==="LabeledStatement"&&(cr=ht.label.name);var ci=We();for(In in ci){q.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:xe,right:{type:"Literal",value:In}})();var Qn=q.setValue(ct());if(!(Qn===Rt||Qn===be)){if(Qn===$)break;if(xr=Qn,xr instanceof Vo&&xr.value===cr){xr=Rt;continue}if(xr instanceof en||xr instanceof Nt||xr instanceof Vo)break}}return xr}},T.withStatementHandler=function(O){var q=this,xe=this.createClosure(O.object),We=this.createClosure(O.body);return function(){var ct=xe(),ht=q.getCurrentScope(),cr=new de(ct,ht,Rr);q.setCurrentScope(cr);var xr=q.setValue(We());return q.setCurrentScope(ht),xr}},T.throwStatementHandler=function(O){var q=this,xe=this.createClosure(O.argument);return function(){throw q.setValue(void 0),xe()}},T.tryStatementHandler=function(O){var q=this,xe=this.createClosure(O.block),We=O.handler?this.catchClauseHandler(O.handler):null,ct=O.finalizer?this.createClosure(O.finalizer):null;return function(){var ht=q.getCurrentScope(),cr=q.getCurrentContext(),xr=ht.labelStack.concat([]),In=q.callStack.concat([]),ci=Rt,Qn,qi,fa=function(){q.setCurrentScope(ht),q.setCurrentContext(cr),ht.labelStack=xr,q.callStack=In};try{ci=q.setValue(xe()),ci instanceof en&&(Qn=ci)}catch(La){if(fa(),q.isInterruptThrow(La))throw La;if(We)try{ci=q.setValue(We(La)),ci instanceof en&&(Qn=ci)}catch(Wi){if(fa(),q.isInterruptThrow(Wi))throw Wi;qi=Wi}}if(ct)try{ci=ct(),ci instanceof en&&(Qn=ci)}catch(La){if(fa(),q.isInterruptThrow(La))throw La;qi=La}if(qi)throw qi;return Qn||ci}},T.catchClauseHandler=function(O){var q=this,xe=this.createParamNameGetter(O.param),We=this.createClosure(O.body);return function(ct){var ht,cr=q.getCurrentScope(),xr=cr.data,In=xe(),ci=ks.call(xr,In),Qn=xr[In];return xr[In]=ct,ht=We(),ci?xr[In]=Qn:delete xr[In],ht}},T.continueStatementHandler=function(O){return function(){return O.label?new Vo(O.label.name):be}},T.breakStatementHandler=function(O){return function(){return O.label?new Nt(O.label.name):$}},T.switchStatementHandler=function(O){var q=this,xe=this.createClosure(O.discriminant),We=O.cases.map(function(ct){return q.switchCaseHandler(ct)});return function(){for(var ct=xe(),ht=!1,cr,xr,In,ci=0;ci<We.length;ci++){var Qn=We[ci](),qi=Qn.testClosure();if(qi===Ke){In=Qn;continue}if(ht||qi===ct){if(ht=!0,xr=q.setValue(Qn.bodyClosure()),xr===Rt)continue;if(xr===$||(cr=xr,cr instanceof en||cr instanceof Nt||cr instanceof Vo||cr===be))break}}if(!ht&&In){xr=q.setValue(In.bodyClosure());var fa=xr===Rt||xr===$||xr===be;fa||(cr=xr)}return cr}},T.switchCaseHandler=function(O){var q=O.test?this.createClosure(O.test):function(){return Ke},xe=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:q,bodyClosure:xe}}},T.labeledStatementHandler=function(O){var q=this,xe=O.label.name,We=this.createClosure(O.body);return function(){var ct,ht=q.getCurrentScope();return ht.labelStack.push(xe),ct=We(O),ct instanceof Nt&&ct.value===xe&&(ct=Rt),ht.labelStack.pop(),ct}},T.debuggerStatementHandler=function(O){return function(){debugger;return Rt}},T.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(ya.ParamTypeSyntaxError,O.type,O)},T.createObjectKeyGetter=function(O){var q;return O.type==="Identifier"?q=function(){return O.name}:q=this.createClosure(O),function(){return q()}},T.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},T.createObjectGetter=function(O){var q=this;switch(O.type){case"Identifier":return function(){return q.getScopeDataFromName(O.name,q.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(ya.AssignmentTypeSyntaxError,O.type,O)}},T.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(ya.AssignmentTypeSyntaxError,O.type,O)}},T.varDeclaration=function(O){var q=this.collectDeclVars;q[O]=void 0},T.funcDeclaration=function(O,q){var xe=this.collectDeclFuncs;xe[O]=q},T.addDeclarationsToScope=function(O,q,xe){var We=xe.data;for(var ct in q){var ht=q[ct];We[ct]=ht&&ht()}for(var cr in O)cr in We||(We[cr]=void 0)},T.getScopeValue=function(O,q){var xe=this.getScopeFromName(O,q);return xe.data[O]},T.getScopeDataFromName=function(O,q){return this.getScopeFromName(O,q).data},T.getScopeFromName=function(O,q){var xe=q;do if(O in xe.data)return xe;while(xe=xe.parent);return this.globalScope},T.setValue=function(O){var q=this.callStack.length;return this.isVarDeclMode||q||O===Rt||O===$||O===be||O instanceof Nt||O instanceof Vo||(this.value=O instanceof en?O.value:O),O},T.getValue=function(){return this.value},_}();Ao.version=ou,Ao.eval=ts,Ao.Function=sn,Ao.ecmaVersion=5,Ao.globalContextInFunction=void 0,Ao.global=Object.create(null);function ql(_){return _===void 0&&(_=Object.create(null)),_}function Ac(_,T,F){T===void 0&&(T=[]),F===void 0&&(F={});var O=F.parsingContext,q=F.timeout===void 0?0:F.timeout,xe=`
    (function anonymous(`+T.join(",")+`){
         `+_+`
    });
    `,We=new Ao(O,{ecmaVersion:F.ecmaVersion,timeout:q,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return We.evaluate(xe)}function Vu(_,T,F){var O=new Ao(T,F);return O.evaluate(_)}var wc=Vu,Tl=function(){function _(F){this._code=F}var T=_.prototype;return T.runInContext=function(O){return Vu(this._code,O)},T.runInNewContext=function(O){return Vu(this._code,O)},_}(),Gu=function(_,T,F){return Vu(_,T,F)};function uu(){for(var _=arguments.length,T=new Array(_),F=0;F<_;F++)T[F]=arguments[F];var O=T.pop();return Ac(O||"",T)}var Hu=Gu},20396:function(At,Q,N){var le;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ye,v,ve,j){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,se=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ne=ce||se,ae=["","webkit","Moz","MS","ms","o"],et=Ne?"":v.createElement("div"),Le="function",it=Math.round,Ht=Math.abs,sr=Date.now;function Ct($,be,Ke){return setTimeout(gt($,Ke),be)}function Jt($,be,Ke){return Array.isArray($)?(Mt($,Ke[be],Ke),!0):!1}function Mt($,be,Ke){var Rt;if(!!$)if($.forEach)$.forEach(be,Ke);else if($.length!==j)for(Rt=0;Rt<$.length;)be.call(Ke,$[Rt],Rt,$),Rt++;else for(Rt in $)$.hasOwnProperty(Rt)&&be.call(Ke,$[Rt],Rt,$)}function lt($,be,Ke){var Rt="DEPRECATED METHOD: "+be+`
`+Ke+` AT 
`;return function(){var Rr=new Error("get-stack-trace"),ot=Rr&&Rr.stack?Rr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Tt=ye.console&&(ye.console.warn||ye.console.log);return Tt&&Tt.call(ye.console,Rt,ot),$.apply(this,arguments)}}var dt;typeof Object.assign!="function"?dt=function(be){if(be===j||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(be),Rt=1;Rt<arguments.length;Rt++){var Rr=arguments[Rt];if(Rr!==j&&Rr!==null)for(var ot in Rr)Rr.hasOwnProperty(ot)&&(Ke[ot]=Rr[ot])}return Ke}:dt=Object.assign;var er=lt(function(be,Ke,Rt){for(var Rr=Object.keys(Ke),ot=0;ot<Rr.length;)(!Rt||Rt&&be[Rr[ot]]===j)&&(be[Rr[ot]]=Ke[Rr[ot]]),ot++;return be},"extend","Use `assign`."),Y=lt(function(be,Ke){return er(be,Ke,!0)},"merge","Use `assign`.");function $t($,be,Ke){var Rt=be.prototype,Rr;Rr=$.prototype=Object.create(Rt),Rr.constructor=$,Rr._super=Rt,Ke&&dt(Rr,Ke)}function gt($,be){return function(){return $.apply(be,arguments)}}function Qe($,be){return typeof $==Le?$.apply(be&&be[0]||j,be):$}function xt($,be){return $===j?be:$}function $e($,be,Ke){Mt(Qr(be),function(Rt){$.addEventListener(Rt,Ke,!1)})}function Kt($,be,Ke){Mt(Qr(be),function(Rt){$.removeEventListener(Rt,Ke,!1)})}function Sr($,be){for(;$;){if($==be)return!0;$=$.parentNode}return!1}function kr($,be){return $.indexOf(be)>-1}function Qr($){return $.trim().split(/\s+/g)}function we($,be,Ke){if($.indexOf&&!Ke)return $.indexOf(be);for(var Rt=0;Rt<$.length;){if(Ke&&$[Rt][Ke]==be||!Ke&&$[Rt]===be)return Rt;Rt++}return-1}function Xe($){return Array.prototype.slice.call($,0)}function De($,be,Ke){for(var Rt=[],Rr=[],ot=0;ot<$.length;){var Tt=be?$[ot][be]:$[ot];we(Rr,Tt)<0&&Rt.push($[ot]),Rr[ot]=Tt,ot++}return Ke&&(be?Rt=Rt.sort(function(ta,qa){return ta[be]>qa[be]}):Rt=Rt.sort()),Rt}function St($,be){for(var Ke,Rt,Rr=be[0].toUpperCase()+be.slice(1),ot=0;ot<ae.length;){if(Ke=ae[ot],Rt=Ke?Ke+Rr:be,Rt in $)return Rt;ot++}return j}var vt=1;function zt(){return vt++}function qt($){var be=$.ownerDocument||$;return be.defaultView||be.parentWindow||ye}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,Yn="ontouchstart"in ye,vn=St(ye,"PointerEvent")!==j,Qi=Yn&&Cr.test(navigator.userAgent),jn="touch",Xn="pen",gi="mouse",qn="kinect",ui=25,oa=1,Fi=2,Ai=4,Gi=8,la=1,wi=2,ba=4,Mn=8,Si=16,Ui=wi|ba,Ji=Mn|Si,Xa=Ui|Ji,he=["x","y"],Bn=["clientX","clientY"];function Ya($,be){var Ke=this;this.manager=$,this.callback=be,this.element=$.element,this.target=$.options.inputTarget,this.domHandler=function(Rt){Qe($.options.enable,[$])&&Ke.handler(Rt)},this.init()}Ya.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(qt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Kt(this.element,this.evEl,this.domHandler),this.evTarget&&Kt(this.target,this.evTarget,this.domHandler),this.evWin&&Kt(qt(this.element),this.evWin,this.domHandler)}};function ps($){var be,Ke=$.options.inputClass;return Ke?be=Ke:vn?be=Pe:Qi?be=Bt:Yn?be=wt:be=Aa,new be($,jt)}function jt($,be,Ke){var Rt=Ke.pointers.length,Rr=Ke.changedPointers.length,ot=be&oa&&Rt-Rr==0,Tt=be&(Ai|Gi)&&Rt-Rr==0;Ke.isFirst=!!ot,Ke.isFinal=!!Tt,ot&&($.session={}),Ke.eventType=be,ir($,Ke),$.emit("hammer.input",Ke),$.recognize(Ke),$.session.prevInput=Ke}function ir($,be){var Ke=$.session,Rt=be.pointers,Rr=Rt.length;Ke.firstInput||(Ke.firstInput=ar(be)),Rr>1&&!Ke.firstMultiple?Ke.firstMultiple=ar(be):Rr===1&&(Ke.firstMultiple=!1);var ot=Ke.firstInput,Tt=Ke.firstMultiple,co=Tt?Tt.center:ot.center,ta=be.center=Ln(Rt);be.timeStamp=sr(),be.deltaTime=be.timeStamp-ot.timeStamp,be.angle=Ii(co,ta),be.distance=rn(co,ta),Mr(Ke,be),be.offsetDirection=Vn(be.deltaX,be.deltaY);var qa=li(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=qa.x,be.overallVelocityY=qa.y,be.overallVelocity=Ht(qa.x)>Ht(qa.y)?qa.x:qa.y,be.scale=Tt?eo(Tt.pointers,Rt):1,be.rotation=Tt?Oi(Tt.pointers,Rt):0,be.maxPointers=Ke.prevInput?be.pointers.length>Ke.prevInput.maxPointers?be.pointers.length:Ke.prevInput.maxPointers:be.pointers.length,I(Ke,be);var ts=$.element;Sr(be.srcEvent.target,ts)&&(ts=be.srcEvent.target),be.target=ts}function Mr($,be){var Ke=be.center,Rt=$.offsetDelta||{},Rr=$.prevDelta||{},ot=$.prevInput||{};(be.eventType===oa||ot.eventType===Ai)&&(Rr=$.prevDelta={x:ot.deltaX||0,y:ot.deltaY||0},Rt=$.offsetDelta={x:Ke.x,y:Ke.y}),be.deltaX=Rr.x+(Ke.x-Rt.x),be.deltaY=Rr.y+(Ke.y-Rt.y)}function I($,be){var Ke=$.lastInterval||be,Rt=be.timeStamp-Ke.timeStamp,Rr,ot,Tt,co;if(be.eventType!=Gi&&(Rt>ui||Ke.velocity===j)){var ta=be.deltaX-Ke.deltaX,qa=be.deltaY-Ke.deltaY,ts=li(Rt,ta,qa);ot=ts.x,Tt=ts.y,Rr=Ht(ts.x)>Ht(ts.y)?ts.x:ts.y,co=Vn(ta,qa),$.lastInterval=be}else Rr=Ke.velocity,ot=Ke.velocityX,Tt=Ke.velocityY,co=Ke.direction;be.velocity=Rr,be.velocityX=ot,be.velocityY=Tt,be.direction=co}function ar($){for(var be=[],Ke=0;Ke<$.pointers.length;)be[Ke]={clientX:it($.pointers[Ke].clientX),clientY:it($.pointers[Ke].clientY)},Ke++;return{timeStamp:sr(),pointers:be,center:Ln(be),deltaX:$.deltaX,deltaY:$.deltaY}}function Ln($){var be=$.length;if(be===1)return{x:it($[0].clientX),y:it($[0].clientY)};for(var Ke=0,Rt=0,Rr=0;Rr<be;)Ke+=$[Rr].clientX,Rt+=$[Rr].clientY,Rr++;return{x:it(Ke/be),y:it(Rt/be)}}function li($,be,Ke){return{x:be/$||0,y:Ke/$||0}}function Vn($,be){return $===be?la:Ht($)>=Ht(be)?$<0?wi:ba:be<0?Mn:Si}function rn($,be,Ke){Ke||(Ke=he);var Rt=be[Ke[0]]-$[Ke[0]],Rr=be[Ke[1]]-$[Ke[1]];return Math.sqrt(Rt*Rt+Rr*Rr)}function Ii($,be,Ke){Ke||(Ke=he);var Rt=be[Ke[0]]-$[Ke[0]],Rr=be[Ke[1]]-$[Ke[1]];return Math.atan2(Rr,Rt)*180/Math.PI}function Oi($,be){return Ii(be[1],be[0],Bn)+Ii($[1],$[0],Bn)}function eo($,be){return rn(be[0],be[1],Bn)/rn($[0],$[1],Bn)}var hs={mousedown:oa,mousemove:Fi,mouseup:Ai},ga="mousedown",Fa="mousemove mouseup";function Aa(){this.evEl=ga,this.evWin=Fa,this.pressed=!1,Ya.apply(this,arguments)}$t(Aa,Ya,{handler:function(be){var Ke=hs[be.type];Ke&oa&&be.button===0&&(this.pressed=!0),Ke&Fi&&be.which!==1&&(Ke=Ai),!!this.pressed&&(Ke&Ai&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[be],changedPointers:[be],pointerType:gi,srcEvent:be}))}});var H={pointerdown:oa,pointermove:Fi,pointerup:Ai,pointercancel:Gi,pointerout:Gi},K={2:jn,3:Xn,4:gi,5:qn},re="pointerdown",ge="pointermove pointerup pointercancel";!Ne&&ye.MSPointerEvent&&!ye.PointerEvent&&(re="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Pe(){this.evEl=re,this.evWin=ge,Ya.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$t(Pe,Ya,{handler:function(be){var Ke=this.store,Rt=!1,Rr=be.type.toLowerCase().replace("ms",""),ot=H[Rr],Tt=K[be.pointerType]||be.pointerType,co=Tt==jn,ta=we(Ke,be.pointerId,"pointerId");ot&oa&&(be.button===0||co)?ta<0&&(Ke.push(be),ta=Ke.length-1):ot&(Ai|Gi)&&(Rt=!0),!(ta<0)&&(Ke[ta]=be,this.callback(this.manager,ot,{pointers:Ke,changedPointers:[be],pointerType:Tt,srcEvent:be}),Rt&&Ke.splice(ta,1))}});var Ge={touchstart:oa,touchmove:Fi,touchend:Ai,touchcancel:Gi},rt="touchstart",fe="touchstart touchmove touchend touchcancel";function Fe(){this.evTarget=rt,this.evWin=fe,this.started=!1,Ya.apply(this,arguments)}$t(Fe,Ya,{handler:function(be){var Ke=Ge[be.type];if(Ke===oa&&(this.started=!0),!!this.started){var Rt=mt.call(this,be,Ke);Ke&(Ai|Gi)&&Rt[0].length-Rt[1].length==0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:Rt[0],changedPointers:Rt[1],pointerType:jn,srcEvent:be})}}});function mt($,be){var Ke=Xe($.touches),Rt=Xe($.changedTouches);return be&(Ai|Gi)&&(Ke=De(Ke.concat(Rt),"identifier",!0)),[Ke,Rt]}var vr={touchstart:oa,touchmove:Fi,touchend:Ai,touchcancel:Gi},Ft="touchstart touchmove touchend touchcancel";function Bt(){this.evTarget=Ft,this.targetIds={},Ya.apply(this,arguments)}$t(Bt,Ya,{handler:function(be){var Ke=vr[be.type],Rt=gr.call(this,be,Ke);!Rt||this.callback(this.manager,Ke,{pointers:Rt[0],changedPointers:Rt[1],pointerType:jn,srcEvent:be})}});function gr($,be){var Ke=Xe($.touches),Rt=this.targetIds;if(be&(oa|Fi)&&Ke.length===1)return Rt[Ke[0].identifier]=!0,[Ke,Ke];var Rr,ot,Tt=Xe($.changedTouches),co=[],ta=this.target;if(ot=Ke.filter(function(qa){return Sr(qa.target,ta)}),be===oa)for(Rr=0;Rr<ot.length;)Rt[ot[Rr].identifier]=!0,Rr++;for(Rr=0;Rr<Tt.length;)Rt[Tt[Rr].identifier]&&co.push(Tt[Rr]),be&(Ai|Gi)&&delete Rt[Tt[Rr].identifier],Rr++;if(!!co.length)return[De(ot.concat(co),"identifier",!0),co]}var bn=2500,cn=25;function wt(){Ya.apply(this,arguments);var $=gt(this.handler,this);this.touch=new Bt(this.manager,$),this.mouse=new Aa(this.manager,$),this.primaryTouch=null,this.lastTouches=[]}$t(wt,Ya,{handler:function(be,Ke,Rt){var Rr=Rt.pointerType==jn,ot=Rt.pointerType==gi;if(!(ot&&Rt.sourceCapabilities&&Rt.sourceCapabilities.firesTouchEvents)){if(Rr)on.call(this,Ke,Rt);else if(ot&&Xr.call(this,Rt))return;this.callback(be,Ke,Rt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function on($,be){$&oa?(this.primaryTouch=be.changedPointers[0].identifier,Hr.call(this,be)):$&(Ai|Gi)&&Hr.call(this,be)}function Hr($){var be=$.changedPointers[0];if(be.identifier===this.primaryTouch){var Ke={x:be.clientX,y:be.clientY};this.lastTouches.push(Ke);var Rt=this.lastTouches,Rr=function(){var ot=Rt.indexOf(Ke);ot>-1&&Rt.splice(ot,1)};setTimeout(Rr,bn)}}function Xr($){for(var be=$.srcEvent.clientX,Ke=$.srcEvent.clientY,Rt=0;Rt<this.lastTouches.length;Rt++){var Rr=this.lastTouches[Rt],ot=Math.abs(be-Rr.x),Tt=Math.abs(Ke-Rr.y);if(ot<=cn&&Tt<=cn)return!0}return!1}var ii=Ne?j:St(et.style,"touchAction"),Jr=ii!==j,Ti="compute",ra="auto",Ei="manipulation",Ri="none",Ci="pan-x",Jn="pan-y",Yi=Li();function Ba($,be){this.manager=$,this.set(be)}Ba.prototype={set:function($){$==Ti&&($=this.compute()),Jr&&this.manager.element.style&&Yi[$]&&(this.manager.element.style[ii]=$),this.actions=$.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var $=[];return Mt(this.manager.recognizers,function(be){Qe(be.options.enable,[be])&&($=$.concat(be.getTouchAction()))}),sa($.join(" "))},preventDefaults:function($){var be=$.srcEvent,Ke=$.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Rt=this.actions,Rr=kr(Rt,Ri)&&!Yi[Ri],ot=kr(Rt,Jn)&&!Yi[Jn],Tt=kr(Rt,Ci)&&!Yi[Ci];if(Rr){var co=$.pointers.length===1,ta=$.distance<2,qa=$.deltaTime<250;if(co&&ta&&qa)return}if(!(Tt&&ot)&&(Rr||ot&&Ke&Ui||Tt&&Ke&Ji))return this.preventSrc(be)},preventSrc:function($){this.manager.session.prevented=!0,$.preventDefault()}};function sa($){if(kr($,Ri))return Ri;var be=kr($,Ci),Ke=kr($,Jn);return be&&Ke?Ri:be||Ke?be?Ci:Jn:kr($,Ei)?Ei:ra}function Li(){if(!Jr)return!1;var $={};if(Ne)return $;var be=ye.CSS&&ye.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){$[Ke]=be?ye.CSS.supports("touch-action",Ke):!0}),$}var Hi=1,Za=2,au=4,wa=8,Ta=wa,Ss=16,ds=32;function na($){this.options=dt({},this.defaults,$||{}),this.id=zt(),this.manager=null,this.options.enable=xt(this.options.enable,!0),this.state=Hi,this.simultaneous={},this.requireFail=[]}na.prototype={defaults:{},set:function($){return dt(this.options,$),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function($){if(Jt($,"recognizeWith",this))return this;var be=this.simultaneous;return $=ja($,this),be[$.id]||(be[$.id]=$,$.recognizeWith(this)),this},dropRecognizeWith:function($){return Jt($,"dropRecognizeWith",this)?this:($=ja($,this),delete this.simultaneous[$.id],this)},requireFailure:function($){if(Jt($,"requireFailure",this))return this;var be=this.requireFail;return $=ja($,this),we(be,$)===-1&&(be.push($),$.requireFailure(this)),this},dropRequireFailure:function($){if(Jt($,"dropRequireFailure",this))return this;$=ja($,this);var be=we(this.requireFail,$);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function($){return!!this.simultaneous[$.id]},emit:function($){var be=this,Ke=this.state;function Rt(Rr){be.manager.emit(Rr,$)}Ke<wa&&Rt(be.options.event+Zu(Ke)),Rt(be.options.event),$.additionalEvent&&Rt($.additionalEvent),Ke>=wa&&Rt(be.options.event+Zu(Ke))},tryEmit:function($){if(this.canEmit())return this.emit($);this.state=ds},canEmit:function(){for(var $=0;$<this.requireFail.length;){if(!(this.requireFail[$].state&(ds|Hi)))return!1;$++}return!0},recognize:function($){var be=dt({},$);if(!Qe(this.options.enable,[this,be])){this.reset(),this.state=ds;return}this.state&(Ta|Ss|ds)&&(this.state=Hi),this.state=this.process(be),this.state&(Za|au|wa|Ss)&&this.tryEmit(be)},process:function($){},getTouchAction:function(){},reset:function(){}};function Zu($){return $&Ss?"cancel":$&wa?"end":$&au?"move":$&Za?"start":""}function So($){return $==Si?"down":$==Mn?"up":$==wi?"left":$==ba?"right":""}function ja($,be){var Ke=be.manager;return Ke?Ke.get($):$}function uo(){na.apply(this,arguments)}$t(uo,na,{defaults:{pointers:1},attrTest:function($){var be=this.options.pointers;return be===0||$.pointers.length===be},process:function($){var be=this.state,Ke=$.eventType,Rt=be&(Za|au),Rr=this.attrTest($);return Rt&&(Ke&Gi||!Rr)?be|Ss:Rt||Rr?Ke&Ai?be|wa:be&Za?be|au:Za:ds}});function ea(){uo.apply(this,arguments),this.pX=null,this.pY=null}$t(ea,uo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Xa},getTouchAction:function(){var $=this.options.direction,be=[];return $&Ui&&be.push(Jn),$&Ji&&be.push(Ci),be},directionTest:function($){var be=this.options,Ke=!0,Rt=$.distance,Rr=$.direction,ot=$.deltaX,Tt=$.deltaY;return Rr&be.direction||(be.direction&Ui?(Rr=ot===0?la:ot<0?wi:ba,Ke=ot!=this.pX,Rt=Math.abs($.deltaX)):(Rr=Tt===0?la:Tt<0?Mn:Si,Ke=Tt!=this.pY,Rt=Math.abs($.deltaY))),$.direction=Rr,Ke&&Rt>be.threshold&&Rr&be.direction},attrTest:function($){return uo.prototype.attrTest.call(this,$)&&(this.state&Za||!(this.state&Za)&&this.directionTest($))},emit:function($){this.pX=$.deltaX,this.pY=$.deltaY;var be=So($.direction);be&&($.additionalEvent=this.options.event+be),this._super.emit.call(this,$)}});function $o(){uo.apply(this,arguments)}$t($o,uo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ri]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.scale-1)>this.options.threshold||this.state&Za)},emit:function($){if($.scale!==1){var be=$.scale<1?"in":"out";$.additionalEvent=this.options.event+be}this._super.emit.call(this,$)}});function Qo(){na.apply(this,arguments),this._timer=null,this._input=null}$t(Qo,na,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ra]},process:function($){var be=this.options,Ke=$.pointers.length===be.pointers,Rt=$.distance<be.threshold,Rr=$.deltaTime>be.time;if(this._input=$,!Rt||!Ke||$.eventType&(Ai|Gi)&&!Rr)this.reset();else if($.eventType&oa)this.reset(),this._timer=Ct(function(){this.state=Ta,this.tryEmit()},be.time,this);else if($.eventType&Ai)return Ta;return ds},reset:function(){clearTimeout(this._timer)},emit:function($){this.state===Ta&&($&&$.eventType&Ai?this.manager.emit(this.options.event+"up",$):(this._input.timeStamp=sr(),this.manager.emit(this.options.event,this._input)))}});function ju(){uo.apply(this,arguments)}$t(ju,uo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ri]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.rotation)>this.options.threshold||this.state&Za)}});function To(){uo.apply(this,arguments)}$t(To,uo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ui|Ji,pointers:1},getTouchAction:function(){return ea.prototype.getTouchAction.call(this)},attrTest:function($){var be=this.options.direction,Ke;return be&(Ui|Ji)?Ke=$.overallVelocity:be&Ui?Ke=$.overallVelocityX:be&Ji&&(Ke=$.overallVelocityY),this._super.attrTest.call(this,$)&&be&$.offsetDirection&&$.distance>this.options.threshold&&$.maxPointers==this.options.pointers&&Ht(Ke)>this.options.velocity&&$.eventType&Ai},emit:function($){var be=So($.offsetDirection);be&&this.manager.emit(this.options.event+be,$),this.manager.emit(this.options.event,$)}});function Jo(){na.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$t(Jo,na,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ei]},process:function($){var be=this.options,Ke=$.pointers.length===be.pointers,Rt=$.distance<be.threshold,Rr=$.deltaTime<be.time;if(this.reset(),$.eventType&oa&&this.count===0)return this.failTimeout();if(Rt&&Rr&&Ke){if($.eventType!=Ai)return this.failTimeout();var ot=this.pTime?$.timeStamp-this.pTime<be.interval:!0,Tt=!this.pCenter||rn(this.pCenter,$.center)<be.posThreshold;this.pTime=$.timeStamp,this.pCenter=$.center,!Tt||!ot?this.count=1:this.count+=1,this._input=$;var co=this.count%be.taps;if(co===0)return this.hasRequireFailures()?(this._timer=Ct(function(){this.state=Ta,this.tryEmit()},be.interval,this),Za):Ta}return ds},failTimeout:function(){return this._timer=Ct(function(){this.state=ds},this.options.interval,this),ds},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ta&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ya($,be){return be=be||{},be.recognizers=xt(be.recognizers,ya.defaults.preset),new lo($,be)}ya.VERSION="2.0.7",ya.defaults={domEvents:!1,touchAction:Ti,enable:!0,inputTarget:null,inputClass:null,preset:[[ju,{enable:!1}],[$o,{enable:!1},["rotate"]],[To,{direction:Ui}],[ea,{direction:Ui},["swipe"]],[Jo],[Jo,{event:"doubletap",taps:2},["tap"]],[Qo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Co=1,es=2;function lo($,be){this.options=dt({},ya.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||$,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=$,this.input=ps(this),this.touchAction=new Ba(this,this.options.touchAction),ou(this,!0),Mt(this.options.recognizers,function(Ke){var Rt=this.add(new Ke[0](Ke[1]));Ke[2]&&Rt.recognizeWith(Ke[2]),Ke[3]&&Rt.requireFailure(Ke[3])},this)}lo.prototype={set:function($){return dt(this.options,$),$.touchAction&&this.touchAction.update(),$.inputTarget&&(this.input.destroy(),this.input.target=$.inputTarget,this.input.init()),this},stop:function($){this.session.stopped=$?es:Co},recognize:function($){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults($);var Ke,Rt=this.recognizers,Rr=be.curRecognizer;(!Rr||Rr&&Rr.state&Ta)&&(Rr=be.curRecognizer=null);for(var ot=0;ot<Rt.length;)Ke=Rt[ot],be.stopped!==es&&(!Rr||Ke==Rr||Ke.canRecognizeWith(Rr))?Ke.recognize($):Ke.reset(),!Rr&&Ke.state&(Za|au|wa)&&(Rr=be.curRecognizer=Ke),ot++}},get:function($){if($ instanceof na)return $;for(var be=this.recognizers,Ke=0;Ke<be.length;Ke++)if(be[Ke].options.event==$)return be[Ke];return null},add:function($){if(Jt($,"add",this))return this;var be=this.get($.options.event);return be&&this.remove(be),this.recognizers.push($),$.manager=this,this.touchAction.update(),$},remove:function($){if(Jt($,"remove",this))return this;if($=this.get($),$){var be=this.recognizers,Ke=we(be,$);Ke!==-1&&(be.splice(Ke,1),this.touchAction.update())}return this},on:function($,be){if($!==j&&be!==j){var Ke=this.handlers;return Mt(Qr($),function(Rt){Ke[Rt]=Ke[Rt]||[],Ke[Rt].push(be)}),this}},off:function($,be){if($!==j){var Ke=this.handlers;return Mt(Qr($),function(Rt){be?Ke[Rt]&&Ke[Rt].splice(we(Ke[Rt],be),1):delete Ke[Rt]}),this}},emit:function($,be){this.options.domEvents&&Cc($,be);var Ke=this.handlers[$]&&this.handlers[$].slice();if(!(!Ke||!Ke.length)){be.type=$,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Rt=0;Rt<Ke.length;)Ke[Rt](be),Rt++}},destroy:function(){this.element&&ou(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ou($,be){var Ke=$.element;if(!!Ke.style){var Rt;Mt($.options.cssProps,function(Rr,ot){Rt=St(Ke.style,ot),be?($.oldCssProps[Rt]=Ke.style[Rt],Ke.style[Rt]=Rr):Ke.style[Rt]=$.oldCssProps[Rt]||""}),be||($.oldCssProps={})}}function Cc($,be){if(!Ne){var Ke=v.createEvent("Event");Ke.initEvent($,!0,!0),Ke.gesture=be,be.target.dispatchEvent(Ke)}}if(!Ne){dt(ya,{INPUT_START:oa,INPUT_MOVE:Fi,INPUT_END:Ai,INPUT_CANCEL:Gi,STATE_POSSIBLE:Hi,STATE_BEGAN:Za,STATE_CHANGED:au,STATE_ENDED:wa,STATE_RECOGNIZED:Ta,STATE_CANCELLED:Ss,STATE_FAILED:ds,DIRECTION_NONE:la,DIRECTION_LEFT:wi,DIRECTION_RIGHT:ba,DIRECTION_UP:Mn,DIRECTION_DOWN:Si,DIRECTION_HORIZONTAL:Ui,DIRECTION_VERTICAL:Ji,DIRECTION_ALL:Xa,Manager:lo,Input:Ya,TouchAction:Ba,TouchInput:Bt,MouseInput:Aa,PointerEventInput:Pe,TouchMouseInput:wt,SingleTouchInput:Fe,Recognizer:na,AttrRecognizer:uo,Tap:Jo,Pan:ea,Swipe:To,Pinch:$o,Rotate:ju,Press:Qo,on:$e,off:Kt,each:Mt,merge:Y,extend:er,assign:dt,inherit:$t,bindFn:gt,prefixed:St});var ks=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ks.Hammer=ya,le=function(){return ya}.call(Q,N,Q,At),le!==j&&(At.exports=le)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(At,Q,N){(function(le,ye){At.exports=ye(N(18857))})(this,function(le){"use strict";var ye=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},v=function(B,me){for(var ze=Object.keys(me),Dt=0;Dt<ze.length;++Dt)B[ze[Dt]]=me[ze[Dt]];return B},ve=`
`;function j(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function ce(B){var me=new Error("(regl) "+B);throw console.error(me),me}function se(B,me){B||ce(me)}function Ne(B){return B?": "+B:""}function ae(B,me,ze){B in me||ce("unknown parameter ("+B+")"+Ne(ze)+". possible values: "+Object.keys(me).join())}function et(B,me){ye(B)||ce("invalid parameter type"+Ne(me)+". must be a typed array")}function Le(B,me){switch(me){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function it(B,me,ze){Le(B,me)||ce("invalid parameter type"+Ne(ze)+". expected "+me+", got "+typeof B)}function Ht(B,me){B>=0&&(B|0)===B||ce("invalid parameter type, ("+B+")"+Ne(me)+". must be a nonnegative integer")}function sr(B,me,ze){me.indexOf(B)<0&&ce("invalid value"+Ne(ze)+". must be one of: "+me)}var Ct=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Jt(B){Object.keys(B).forEach(function(me){Ct.indexOf(me)<0&&ce('invalid regl constructor argument "'+me+'". must be one of '+Ct)})}function Mt(B,me){for(B=B+"";B.length<me;)B=" "+B;return B}function lt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function dt(B,me){this.number=B,this.line=me,this.errors=[]}function er(B,me,ze){this.file=B,this.line=me,this.message=ze}function Y(){var B=new Error,me=(B.stack||B).toString(),ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(me);if(ze)return ze[1];var Dt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(me);return Dt?Dt[1]:"unknown"}function $t(){var B=new Error,me=(B.stack||B).toString(),ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(me);if(ze)return ze[1];var Dt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(me);return Dt?Dt[1]:"unknown"}function gt(B,me){var ze=B.split(`
`),Dt=1,ur=0,Lt={unknown:new lt,0:new lt};Lt.unknown.name=Lt[0].name=me||Y(),Lt.unknown.lines.push(new dt(0,""));for(var tr=0;tr<ze.length;++tr){var dr=ze[tr],yr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(dr);if(yr)switch(yr[1]){case"line":var _r=/(\d+)(\s+\d+)?/.exec(yr[2]);_r&&(Dt=_r[1]|0,_r[2]&&(ur=_r[2]|0,ur in Lt||(Lt[ur]=new lt)));break;case"define":var Ir=/SHADER_NAME(_B64)?\s+(.*)$/.exec(yr[2]);Ir&&(Lt[ur].name=Ir[1]?j(Ir[2]):Ir[2]);break}Lt[ur].lines.push(new dt(Dt++,dr))}return Object.keys(Lt).forEach(function(or){var Fr=Lt[or];Fr.lines.forEach(function(br){Fr.index[br.number]=br})}),Lt}function Qe(B){var me=[];return B.split(`
`).forEach(function(ze){if(!(ze.length<5)){var Dt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ze);Dt?me.push(new er(Dt[1]|0,Dt[2]|0,Dt[3].trim())):ze.length>0&&me.push(new er("unknown",0,ze))}}),me}function xt(B,me){me.forEach(function(ze){var Dt=B[ze.file];if(Dt){var ur=Dt.index[ze.line];if(ur){ur.errors.push(ze),Dt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(ze)})}function $e(B,me,ze,Dt,ur){if(!B.getShaderParameter(me,B.COMPILE_STATUS)){var Lt=B.getShaderInfoLog(me),tr=Dt===B.FRAGMENT_SHADER?"fragment":"vertex";De(ze,"string",tr+" shader source must be a string",ur);var dr=gt(ze,ur),yr=Qe(Lt);xt(dr,yr),Object.keys(dr).forEach(function(_r){var Ir=dr[_r];if(!Ir.hasErrors)return;var or=[""],Fr=[""];function br(Pr,st){or.push(Pr),Fr.push(st||"")}br("file number "+_r+": "+Ir.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Ir.lines.forEach(function(Pr){if(Pr.errors.length>0){br(Mt(Pr.number,4)+"|  ","background-color:yellow; font-weight:bold"),br(Pr.line+ve,"color:red; background-color:yellow; font-weight:bold");var st=0;Pr.errors.forEach(function(Xt){var Er=Xt.message,Ur=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Er);if(Ur){var fr=Ur[1];switch(Er=Ur[2],fr){case"assign":fr="=";break}st=Math.max(Pr.line.indexOf(fr,st),0)}else st=0;br(Mt("| ",6)),br(Mt("^^^",st+3)+ve,"font-weight:bold"),br(Mt("| ",6)),br(Er+ve,"font-weight:bold")}),br(Mt("| ",6)+ve)}else br(Mt(Pr.number,4)+"|  "),br(Pr.line+ve,"color:red")}),typeof document!="undefined"&&!window.chrome?(Fr[0]=or.join("%c"),console.log.apply(console,Fr)):console.log(or.join(""))}),se.raise("Error compiling "+tr+" shader, "+dr[0].name)}}function Kt(B,me,ze,Dt,ur){if(!B.getProgramParameter(me,B.LINK_STATUS)){var Lt=B.getProgramInfoLog(me),tr=gt(ze,ur),dr=gt(Dt,ur),yr='Error linking program with vertex shader, "'+dr[0].name+'", and fragment shader "'+tr[0].name+'"';typeof document!="undefined"?console.log("%c"+yr+ve+"%c"+Lt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(yr+ve+Lt),se.raise(yr)}}function Sr(B){B._commandRef=Y()}function kr(B,me,ze,Dt){Sr(B);function ur(yr){return yr?Dt.id(yr):0}B._fragId=ur(B.static.frag),B._vertId=ur(B.static.vert);function Lt(yr,_r){Object.keys(_r).forEach(function(Ir){yr[Dt.id(Ir)]=!0})}var tr=B._uniformSet={};Lt(tr,me.static),Lt(tr,me.dynamic);var dr=B._attributeSet={};Lt(dr,ze.static),Lt(dr,ze.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function Qr(B,me){var ze=$t();ce(B+" in command "+(me||Y())+(ze==="unknown"?"":" called from "+ze))}function we(B,me,ze){B||Qr(me,ze||Y())}function Xe(B,me,ze,Dt){B in me||Qr("unknown parameter ("+B+")"+Ne(ze)+". possible values: "+Object.keys(me).join(),Dt||Y())}function De(B,me,ze,Dt){Le(B,me)||Qr("invalid parameter type"+Ne(ze)+". expected "+me+", got "+typeof B,Dt||Y())}function St(B){B()}function vt(B,me,ze){B.texture?sr(B.texture._texture.internalformat,me,"unsupported texture format for attachment"):sr(B.renderbuffer._renderbuffer.format,ze,"unsupported renderbuffer format for attachment")}var zt=33071,qt=9728,Cr=9984,Yn=9985,vn=9986,Qi=9987,jn=5120,Xn=5121,gi=5122,qn=5123,ui=5124,oa=5125,Fi=5126,Ai=32819,Gi=32820,la=33635,wi=34042,ba=36193,Mn={};Mn[jn]=Mn[Xn]=1,Mn[gi]=Mn[qn]=Mn[ba]=Mn[la]=Mn[Ai]=Mn[Gi]=2,Mn[ui]=Mn[oa]=Mn[Fi]=Mn[wi]=4;function Si(B,me){return B===Gi||B===Ai||B===la?2:B===wi?4:Mn[B]*me}function Ui(B){return!(B&B-1)&&!!B}function Ji(B,me,ze){var Dt,ur=me.width,Lt=me.height,tr=me.channels;se(ur>0&&ur<=ze.maxTextureSize&&Lt>0&&Lt<=ze.maxTextureSize,"invalid texture shape"),(B.wrapS!==zt||B.wrapT!==zt)&&se(Ui(ur)&&Ui(Lt),"incompatible wrap mode for texture, both width and height must be power of 2"),me.mipmask===1?ur!==1&&Lt!==1&&se(B.minFilter!==Cr&&B.minFilter!==vn&&B.minFilter!==Yn&&B.minFilter!==Qi,"min filter requires mipmap"):(se(Ui(ur)&&Ui(Lt),"texture must be a square power of 2 to support mipmapping"),se(me.mipmask===(ur<<1)-1,"missing or incomplete mipmap data")),me.type===Fi&&(ze.extensions.indexOf("oes_texture_float_linear")<0&&se(B.minFilter===qt&&B.magFilter===qt,"filter not supported, must enable oes_texture_float_linear"),se(!B.genMipmaps,"mipmap generation not supported with float textures"));var dr=me.images;for(Dt=0;Dt<16;++Dt)if(dr[Dt]){var yr=ur>>Dt,_r=Lt>>Dt;se(me.mipmask&1<<Dt,"missing mipmap data");var Ir=dr[Dt];if(se(Ir.width===yr&&Ir.height===_r,"invalid shape for mip images"),se(Ir.format===me.format&&Ir.internalformat===me.internalformat&&Ir.type===me.type,"incompatible type for mip image"),!Ir.compressed)if(Ir.data){var or=Math.ceil(Si(Ir.type,tr)*yr/Ir.unpackAlignment)*Ir.unpackAlignment;se(Ir.data.byteLength===or*_r,"invalid data for image, buffer size is inconsistent with image format")}else Ir.element||Ir.copy}else B.genMipmaps||se((me.mipmask&1<<Dt)==0,"extra mipmap data");me.compressed&&se(!B.genMipmaps,"mipmap generation for compressed images not supported")}function Xa(B,me,ze,Dt){var ur=B.width,Lt=B.height,tr=B.channels;se(ur>0&&ur<=Dt.maxTextureSize&&Lt>0&&Lt<=Dt.maxTextureSize,"invalid texture shape"),se(ur===Lt,"cube map must be square"),se(me.wrapS===zt&&me.wrapT===zt,"wrap mode not supported by cube map");for(var dr=0;dr<ze.length;++dr){var yr=ze[dr];se(yr.width===ur&&yr.height===Lt,"inconsistent cube map face shape"),me.genMipmaps&&(se(!yr.compressed,"can not generate mipmap for compressed textures"),se(yr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var _r=yr.images,Ir=0;Ir<16;++Ir){var or=_r[Ir];if(or){var Fr=ur>>Ir,br=Lt>>Ir;se(yr.mipmask&1<<Ir,"missing mipmap data"),se(or.width===Fr&&or.height===br,"invalid shape for mip images"),se(or.format===B.format&&or.internalformat===B.internalformat&&or.type===B.type,"incompatible type for mip image"),or.compressed||(or.data?se(or.data.byteLength===Fr*br*Math.max(Si(or.type,tr),or.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):or.element||or.copy)}}}}var he=v(se,{optional:St,raise:ce,commandRaise:Qr,command:we,parameter:ae,commandParameter:Xe,constructor:Jt,type:it,commandType:De,isTypedArray:et,nni:Ht,oneOf:sr,shaderError:$e,linkError:Kt,callSite:$t,saveCommandRef:Sr,saveDrawInfo:kr,framebufferFormat:vt,guessCommand:Y,texture2D:Ji,textureCube:Xa}),Bn=0,Ya=0,ps=5,jt=6;function ir(B,me){this.id=Bn++,this.type=B,this.data=me}function Mr(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(B){if(B.length===0)return[];var me=B.charAt(0),ze=B.charAt(B.length-1);if(B.length>1&&me===ze&&(me==='"'||me==="'"))return['"'+Mr(B.substr(1,B.length-2))+'"'];var Dt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(Dt)return I(B.substr(0,Dt.index)).concat(I(Dt[1])).concat(I(B.substr(Dt.index+Dt[0].length)));var ur=B.split(".");if(ur.length===1)return['"'+Mr(B)+'"'];for(var Lt=[],tr=0;tr<ur.length;++tr)Lt=Lt.concat(I(ur[tr]));return Lt}function ar(B){return"["+I(B).join("][")+"]"}function Ln(B,me){return new ir(B,ar(me+""))}function li(B){return typeof B=="function"&&!B._reglType||B instanceof ir}function Vn(B,me){if(typeof B=="function")return new ir(Ya,B);if(typeof B=="number"||typeof B=="boolean")return new ir(ps,B);if(Array.isArray(B))return new ir(jt,B.map(function(ze,Dt){return Vn(ze,me+"["+Dt+"]")}));if(B instanceof ir)return B;he(!1,"invalid option type in uniform "+me)}var rn={DynamicVariable:ir,define:Ln,isDynamic:li,unbox:Vn,accessor:ar},Ii={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Oi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,eo=Oi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function hs(){var B={"":0},me=[""];return{id:function(ze){var Dt=B[ze];return Dt||(Dt=B[ze]=me.length,me.push(ze),Dt)},str:function(ze){return me[ze]}}}function ga(B,me,ze){var Dt=document.createElement("canvas");v(Dt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(Dt),B===document.body&&(Dt.style.position="absolute",v(B.style,{margin:0,padding:0}));function ur(){var dr=window.innerWidth,yr=window.innerHeight;if(B!==document.body){var _r=Dt.getBoundingClientRect();dr=_r.right-_r.left,yr=_r.bottom-_r.top}Dt.width=ze*dr,Dt.height=ze*yr}var Lt;B!==document.body&&typeof ResizeObserver=="function"?(Lt=new ResizeObserver(function(){setTimeout(ur)}),Lt.observe(B)):window.addEventListener("resize",ur,!1);function tr(){Lt?Lt.disconnect():window.removeEventListener("resize",ur),B.removeChild(Dt)}return ur(),{canvas:Dt,onDestroy:tr}}function Fa(B,me){function ze(Dt){try{return B.getContext(Dt,me)}catch(ur){return null}}return ze("webgl")||ze("experimental-webgl")||ze("webgl-experimental")}function Aa(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function H(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function K(B){return typeof B=="string"?B.split():(he(Array.isArray(B),"invalid extension array"),B)}function re(B){return typeof B=="string"?(he(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ge(B){var me=B||{},ze,Dt,ur,Lt,tr={},dr=[],yr=[],_r=typeof window=="undefined"?1:window.devicePixelRatio,Ir=!1,or=function(Pr){Pr&&he.raise(Pr)},Fr=function(){};if(typeof me=="string"?(he(typeof document!="undefined","selector queries only supported in DOM environments"),ze=document.querySelector(me),he(ze,"invalid query string for element")):typeof me=="object"?Aa(me)?ze=me:H(me)?(Lt=me,ur=Lt.canvas):(he.constructor(me),"gl"in me?Lt=me.gl:"canvas"in me?ur=re(me.canvas):"container"in me&&(Dt=re(me.container)),"attributes"in me&&(tr=me.attributes,he.type(tr,"object","invalid context attributes")),"extensions"in me&&(dr=K(me.extensions)),"optionalExtensions"in me&&(yr=K(me.optionalExtensions)),"onDone"in me&&(he.type(me.onDone,"function","invalid or missing onDone callback"),or=me.onDone),"profile"in me&&(Ir=!!me.profile),"pixelRatio"in me&&(_r=+me.pixelRatio,he(_r>0,"invalid pixel ratio"))):he.raise("invalid arguments to regl"),ze&&(ze.nodeName.toLowerCase()==="canvas"?ur=ze:Dt=ze),!Lt){if(!ur){he(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var br=ga(Dt||document.body,or,_r);if(!br)return null;ur=br.canvas,Fr=br.onDestroy}tr.premultipliedAlpha===void 0&&(tr.premultipliedAlpha=!0),Lt=Fa(ur,tr)}return Lt?{gl:Lt,canvas:ur,container:Dt,extensions:dr,optionalExtensions:yr,pixelRatio:_r,profile:Ir,onDone:or,onDestroy:Fr}:(Fr(),or("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pe(B,me){var ze={};function Dt(dr){he.type(dr,"string","extension name must be string");var yr=dr.toLowerCase(),_r;try{_r=ze[yr]=ur(dr)}catch(Ir){}return!!_r}function ur(dr){return B.getExtension(dr)?B.getExtension(dr):B.getExtension(dr.toLowerCase())?B.getExtension(dr.toLowerCase()):null}for(var Lt=0;Lt<me.extensions.length;++Lt){var tr=me.extensions[Lt];if(!Dt(tr))return me.onDestroy(),me.onDone('"'+tr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return me.optionalExtensions.forEach(Dt),{extensions:ze,restore:function(){Object.keys(ze).forEach(function(dr){if(ze[dr]&&!Dt(dr))throw new Error("(regl): error restoring extension "+dr)})}}}function Ge(B,me){for(var ze=Array(B),Dt=0;Dt<B;++Dt)ze[Dt]=me(Dt);return ze}var rt=5120,fe=5121,Fe=5122,mt=5123,vr=5124,Ft=5125,Bt=5126;function gr(B){for(var me=16;me<=1<<28;me*=16)if(B<=me)return me;return 0}function bn(B){var me,ze;return me=(B>65535)<<4,B>>>=me,ze=(B>255)<<3,B>>>=ze,me|=ze,ze=(B>15)<<2,B>>>=ze,me|=ze,ze=(B>3)<<1,B>>>=ze,me|=ze,me|B>>1}function cn(){var B=Ge(8,function(){return[]});function me(Lt){var tr=gr(Lt),dr=B[bn(tr)>>2];return dr.length>0?dr.pop():new ArrayBuffer(tr)}function ze(Lt){B[bn(Lt.byteLength)>>2].push(Lt)}function Dt(Lt,tr){var dr=null;switch(Lt){case rt:dr=new Int8Array(me(tr),0,tr);break;case fe:dr=new Uint8Array(me(tr),0,tr);break;case Fe:dr=new Int16Array(me(2*tr),0,tr);break;case mt:dr=new Uint16Array(me(2*tr),0,tr);break;case vr:dr=new Int32Array(me(4*tr),0,tr);break;case Ft:dr=new Uint32Array(me(4*tr),0,tr);break;case Bt:dr=new Float32Array(me(4*tr),0,tr);break;default:return null}return dr.length!==tr?dr.subarray(0,tr):dr}function ur(Lt){ze(Lt.buffer)}return{alloc:me,free:ze,allocType:Dt,freeType:ur}}var wt=cn();wt.zero=cn();var on=3408,Hr=3410,Xr=3411,ii=3412,Jr=3413,Ti=3414,ra=3415,Ei=33901,Ri=33902,Ci=3379,Jn=3386,Yi=34921,Ba=36347,sa=36348,Li=35661,Hi=35660,Za=34930,au=36349,wa=34076,Ta=34024,Ss=7936,ds=7937,na=7938,Zu=35724,So=34047,ja=36063,uo=34852,ea=3553,$o=34067,Qo=34069,ju=33984,To=6408,Jo=5126,ya=5121,Co=36160,es=36053,lo=36064,ou=16384,Cc=function(B,me){var ze=1;me.ext_texture_filter_anisotropic&&(ze=B.getParameter(So));var Dt=1,ur=1;me.webgl_draw_buffers&&(Dt=B.getParameter(uo),ur=B.getParameter(ja));var Lt=!!me.oes_texture_float;if(Lt){var tr=B.createTexture();B.bindTexture(ea,tr),B.texImage2D(ea,0,To,1,1,0,To,Jo,null);var dr=B.createFramebuffer();if(B.bindFramebuffer(Co,dr),B.framebufferTexture2D(Co,lo,ea,tr,0),B.bindTexture(ea,null),B.checkFramebufferStatus(Co)!==es)Lt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(ou);var yr=wt.allocType(Jo,4);B.readPixels(0,0,1,1,To,Jo,yr),B.getError()?Lt=!1:(B.deleteFramebuffer(dr),B.deleteTexture(tr),Lt=yr[0]===1),wt.freeType(yr)}}var _r=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Ir=!0;if(!_r){var or=B.createTexture(),Fr=wt.allocType(ya,36);B.activeTexture(ju),B.bindTexture($o,or),B.texImage2D(Qo,0,To,3,3,0,To,ya,Fr),wt.freeType(Fr),B.bindTexture($o,null),B.deleteTexture(or),Ir=!B.getError()}return{colorBits:[B.getParameter(Hr),B.getParameter(Xr),B.getParameter(ii),B.getParameter(Jr)],depthBits:B.getParameter(Ti),stencilBits:B.getParameter(ra),subpixelBits:B.getParameter(on),extensions:Object.keys(me).filter(function(br){return!!me[br]}),maxAnisotropic:ze,maxDrawbuffers:Dt,maxColorAttachments:ur,pointSizeDims:B.getParameter(Ei),lineWidthDims:B.getParameter(Ri),maxViewportDims:B.getParameter(Jn),maxCombinedTextureUnits:B.getParameter(Li),maxCubeMapSize:B.getParameter(wa),maxRenderbufferSize:B.getParameter(Ta),maxTextureUnits:B.getParameter(Za),maxTextureSize:B.getParameter(Ci),maxAttributes:B.getParameter(Yi),maxVertexUniforms:B.getParameter(Ba),maxVertexTextureUnits:B.getParameter(Hi),maxVaryingVectors:B.getParameter(sa),maxFragmentUniforms:B.getParameter(au),glsl:B.getParameter(Zu),renderer:B.getParameter(ds),vendor:B.getParameter(Ss),version:B.getParameter(na),readFloat:Lt,npotTextureCube:Ir}};function ks(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||ye(B.data))}var $=function(B){return Object.keys(B).map(function(me){return B[me]})},be={shape:co,flatten:Tt};function Ke(B,me,ze){for(var Dt=0;Dt<me;++Dt)ze[Dt]=B[Dt]}function Rt(B,me,ze,Dt){for(var ur=0,Lt=0;Lt<me;++Lt)for(var tr=B[Lt],dr=0;dr<ze;++dr)Dt[ur++]=tr[dr]}function Rr(B,me,ze,Dt,ur,Lt){for(var tr=Lt,dr=0;dr<me;++dr)for(var yr=B[dr],_r=0;_r<ze;++_r)for(var Ir=yr[_r],or=0;or<Dt;++or)ur[tr++]=Ir[or]}function ot(B,me,ze,Dt,ur){for(var Lt=1,tr=ze+1;tr<me.length;++tr)Lt*=me[tr];var dr=me[ze];if(me.length-ze==4){var yr=me[ze+1],_r=me[ze+2],Ir=me[ze+3];for(tr=0;tr<dr;++tr)Rr(B[tr],yr,_r,Ir,Dt,ur),ur+=Lt}else for(tr=0;tr<dr;++tr)ot(B[tr],me,ze+1,Dt,ur),ur+=Lt}function Tt(B,me,ze,Dt){var ur=1;if(me.length)for(var Lt=0;Lt<me.length;++Lt)ur*=me[Lt];else ur=0;var tr=Dt||wt.allocType(ze,ur);switch(me.length){case 0:break;case 1:Ke(B,me[0],tr);break;case 2:Rt(B,me[0],me[1],tr);break;case 3:Rr(B,me[0],me[1],me[2],tr,0);break;default:ot(B,me,0,tr,0)}return tr}function co(B){for(var me=[],ze=B;ze.length;ze=ze[0])me.push(ze.length);return me}var ta={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},qa=5120,ts=5122,sn=5124,en=5121,Nt=5123,Vo=5125,de=5126,Ks=5126,su={int8:qa,int16:ts,int32:sn,uint8:en,uint16:Nt,uint32:Vo,float:de,float32:Ks},vs=35048,ua=35040,Ao={dynamic:vs,stream:ua,static:35044},ql=be.flatten,Ac=be.shape,Vu=35044,wc=35040,Tl=5121,Gu=5126,uu=[];uu[5120]=1,uu[5122]=2,uu[5124]=4,uu[5121]=1,uu[5123]=2,uu[5125]=4,uu[5126]=4;function Hu(B){return ta[Object.prototype.toString.call(B)]|0}function _(B,me){for(var ze=0;ze<me.length;++ze)B[ze]=me[ze]}function T(B,me,ze,Dt,ur,Lt,tr){for(var dr=0,yr=0;yr<ze;++yr)for(var _r=0;_r<Dt;++_r)B[dr++]=me[ur*yr+Lt*_r+tr]}function F(B,me,ze,Dt){var ur=0,Lt={};function tr(st){this.id=ur++,this.buffer=B.createBuffer(),this.type=st,this.usage=Vu,this.byteLength=0,this.dimension=1,this.dtype=Tl,this.persistentData=null,ze.profile&&(this.stats={size:0})}tr.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},tr.prototype.destroy=function(){Fr(this)};var dr=[];function yr(st,Xt){var Er=dr.pop();return Er||(Er=new tr(st)),Er.bind(),or(Er,Xt,wc,0,1,!1),Er}function _r(st){dr.push(st)}function Ir(st,Xt,Er){st.byteLength=Xt.byteLength,B.bufferData(st.type,Xt,Er)}function or(st,Xt,Er,Ur,fr,Lr){var $r;if(st.usage=Er,Array.isArray(Xt)){if(st.dtype=Ur||Gu,Xt.length>0){var Tn;if(Array.isArray(Xt[0])){$r=Ac(Xt);for(var Qt=1,rr=1;rr<$r.length;++rr)Qt*=$r[rr];st.dimension=Qt,Tn=ql(Xt,$r,st.dtype),Ir(st,Tn,Er),Lr?st.persistentData=Tn:wt.freeType(Tn)}else if(typeof Xt[0]=="number"){st.dimension=fr;var En=wt.allocType(st.dtype,Xt.length);_(En,Xt),Ir(st,En,Er),Lr?st.persistentData=En:wt.freeType(En)}else ye(Xt[0])?(st.dimension=Xt[0].length,st.dtype=Ur||Hu(Xt[0])||Gu,Tn=ql(Xt,[Xt.length,Xt[0].length],st.dtype),Ir(st,Tn,Er),Lr?st.persistentData=Tn:wt.freeType(Tn)):he.raise("invalid buffer data")}}else if(ye(Xt))st.dtype=Ur||Hu(Xt),st.dimension=fr,Ir(st,Xt,Er),Lr&&(st.persistentData=new Uint8Array(new Uint8Array(Xt.buffer)));else if(ks(Xt)){$r=Xt.shape;var Vr=Xt.stride,Ar=Xt.offset,Wr=0,Kr=0,xi=0,ni=0;$r.length===1?(Wr=$r[0],Kr=1,xi=Vr[0],ni=0):$r.length===2?(Wr=$r[0],Kr=$r[1],xi=Vr[0],ni=Vr[1]):he.raise("invalid shape"),st.dtype=Ur||Hu(Xt.data)||Gu,st.dimension=Kr;var Yr=wt.allocType(st.dtype,Wr*Kr);T(Yr,Xt.data,Wr,Kr,xi,ni,Ar),Ir(st,Yr,Er),Lr?st.persistentData=Yr:wt.freeType(Yr)}else Xt instanceof ArrayBuffer?(st.dtype=Tl,st.dimension=fr,Ir(st,Xt,Er),Lr&&(st.persistentData=new Uint8Array(new Uint8Array(Xt)))):he.raise("invalid buffer data")}function Fr(st){me.bufferCount--,Dt(st);var Xt=st.buffer;he(Xt,"buffer must not be deleted already"),B.deleteBuffer(Xt),st.buffer=null,delete Lt[st.id]}function br(st,Xt,Er,Ur){me.bufferCount++;var fr=new tr(Xt);Lt[fr.id]=fr;function Lr(Qt){var rr=Vu,En=null,Vr=0,Ar=0,Wr=1;return Array.isArray(Qt)||ye(Qt)||ks(Qt)||Qt instanceof ArrayBuffer?En=Qt:typeof Qt=="number"?Vr=Qt|0:Qt&&(he.type(Qt,"object","buffer arguments must be an object, a number or an array"),"data"in Qt&&(he(En===null||Array.isArray(En)||ye(En)||ks(En),"invalid data for buffer"),En=Qt.data),"usage"in Qt&&(he.parameter(Qt.usage,Ao,"invalid buffer usage"),rr=Ao[Qt.usage]),"type"in Qt&&(he.parameter(Qt.type,su,"invalid buffer type"),Ar=su[Qt.type]),"dimension"in Qt&&(he.type(Qt.dimension,"number","invalid dimension"),Wr=Qt.dimension|0),"length"in Qt&&(he.nni(Vr,"buffer length must be a nonnegative integer"),Vr=Qt.length|0)),fr.bind(),En?or(fr,En,rr,Ar,Wr,Ur):(Vr&&B.bufferData(fr.type,Vr,rr),fr.dtype=Ar||Tl,fr.usage=rr,fr.dimension=Wr,fr.byteLength=Vr),ze.profile&&(fr.stats.size=fr.byteLength*uu[fr.dtype]),Lr}function $r(Qt,rr){he(rr+Qt.byteLength<=fr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Qt.byteLength+" starting from offset "+rr+" to a buffer of size "+fr.byteLength),B.bufferSubData(fr.type,rr,Qt)}function Tn(Qt,rr){var En=(rr||0)|0,Vr;if(fr.bind(),ye(Qt)||Qt instanceof ArrayBuffer)$r(Qt,En);else if(Array.isArray(Qt)){if(Qt.length>0)if(typeof Qt[0]=="number"){var Ar=wt.allocType(fr.dtype,Qt.length);_(Ar,Qt),$r(Ar,En),wt.freeType(Ar)}else if(Array.isArray(Qt[0])||ye(Qt[0])){Vr=Ac(Qt);var Wr=ql(Qt,Vr,fr.dtype);$r(Wr,En),wt.freeType(Wr)}else he.raise("invalid buffer data")}else if(ks(Qt)){Vr=Qt.shape;var Kr=Qt.stride,xi=0,ni=0,Yr=0,an=0;Vr.length===1?(xi=Vr[0],ni=1,Yr=Kr[0],an=0):Vr.length===2?(xi=Vr[0],ni=Vr[1],Yr=Kr[0],an=Kr[1]):he.raise("invalid shape");var $n=Array.isArray(Qt.data)?fr.dtype:Hu(Qt.data),pi=wt.allocType($n,xi*ni);T(pi,Qt.data,xi,ni,Yr,an,Qt.offset),$r(pi,En),wt.freeType(pi)}else he.raise("invalid data for buffer subdata");return Lr}return Er||Lr(st),Lr._reglType="buffer",Lr._buffer=fr,Lr.subdata=Tn,ze.profile&&(Lr.stats=fr.stats),Lr.destroy=function(){Fr(fr)},Lr}function Pr(){$(Lt).forEach(function(st){st.buffer=B.createBuffer(),B.bindBuffer(st.type,st.buffer),B.bufferData(st.type,st.persistentData||st.byteLength,st.usage)})}return ze.profile&&(me.getTotalBufferSize=function(){var st=0;return Object.keys(Lt).forEach(function(Xt){st+=Lt[Xt].stats.size}),st}),{create:br,createStream:yr,destroyStream:_r,clear:function(){$(Lt).forEach(Fr),dr.forEach(Fr)},getBuffer:function(st){return st&&st._buffer instanceof tr?st._buffer:null},restore:Pr,_initBuffer:or}}var O=0,q=0,xe=1,We=1,ct=4,ht=4,cr={points:O,point:q,lines:xe,line:We,triangles:ct,triangle:ht,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},xr=0,In=1,ci=4,Qn=5120,qi=5121,fa=5122,La=5123,Wi=5124,Fo=5125,Cs=34963,cl=35040,qc=35044;function Wu(B,me,ze,Dt){var ur={},Lt=0,tr={uint8:qi,uint16:La};me.oes_element_index_uint&&(tr.uint32=Fo);function dr(Pr){this.id=Lt++,ur[this.id]=this,this.buffer=Pr,this.primType=ci,this.vertCount=0,this.type=0}dr.prototype.bind=function(){this.buffer.bind()};var yr=[];function _r(Pr){var st=yr.pop();return st||(st=new dr(ze.create(null,Cs,!0,!1)._buffer)),or(st,Pr,cl,-1,-1,0,0),st}function Ir(Pr){yr.push(Pr)}function or(Pr,st,Xt,Er,Ur,fr,Lr){Pr.buffer.bind();var $r;if(st){var Tn=Lr;!Lr&&(!ye(st)||ks(st)&&!ye(st.data))&&(Tn=me.oes_element_index_uint?Fo:La),ze._initBuffer(Pr.buffer,st,Xt,Tn,3)}else B.bufferData(Cs,fr,Xt),Pr.buffer.dtype=$r||qi,Pr.buffer.usage=Xt,Pr.buffer.dimension=3,Pr.buffer.byteLength=fr;if($r=Lr,!Lr){switch(Pr.buffer.dtype){case qi:case Qn:$r=qi;break;case La:case fa:$r=La;break;case Fo:case Wi:$r=Fo;break;default:he.raise("unsupported type for element array")}Pr.buffer.dtype=$r}Pr.type=$r,he($r!==Fo||!!me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Qt=Ur;Qt<0&&(Qt=Pr.buffer.byteLength,$r===La?Qt>>=1:$r===Fo&&(Qt>>=2)),Pr.vertCount=Qt;var rr=Er;if(Er<0){rr=ci;var En=Pr.buffer.dimension;En===1&&(rr=xr),En===2&&(rr=In),En===3&&(rr=ci)}Pr.primType=rr}function Fr(Pr){Dt.elementsCount--,he(Pr.buffer!==null,"must not double destroy elements"),delete ur[Pr.id],Pr.buffer.destroy(),Pr.buffer=null}function br(Pr,st){var Xt=ze.create(null,Cs,!0),Er=new dr(Xt._buffer);Dt.elementsCount++;function Ur(fr){if(!fr)Xt(),Er.primType=ci,Er.vertCount=0,Er.type=qi;else if(typeof fr=="number")Xt(fr),Er.primType=ci,Er.vertCount=fr|0,Er.type=qi;else{var Lr=null,$r=qc,Tn=-1,Qt=-1,rr=0,En=0;Array.isArray(fr)||ye(fr)||ks(fr)?Lr=fr:(he.type(fr,"object","invalid arguments for elements"),"data"in fr&&(Lr=fr.data,he(Array.isArray(Lr)||ye(Lr)||ks(Lr),"invalid data for element buffer")),"usage"in fr&&(he.parameter(fr.usage,Ao,"invalid element buffer usage"),$r=Ao[fr.usage]),"primitive"in fr&&(he.parameter(fr.primitive,cr,"invalid element buffer primitive"),Tn=cr[fr.primitive]),"count"in fr&&(he(typeof fr.count=="number"&&fr.count>=0,"invalid vertex count for elements"),Qt=fr.count|0),"type"in fr&&(he.parameter(fr.type,tr,"invalid buffer type"),En=tr[fr.type]),"length"in fr?rr=fr.length|0:(rr=Qt,En===La||En===fa?rr*=2:(En===Fo||En===Wi)&&(rr*=4))),or(Er,Lr,$r,Tn,Qt,rr,En)}return Ur}return Ur(Pr),Ur._reglType="elements",Ur._elements=Er,Ur.subdata=function(fr,Lr){return Xt.subdata(fr,Lr),Ur},Ur.destroy=function(){Fr(Er)},Ur}return{create:br,createStream:_r,destroyStream:Ir,getElements:function(Pr){return typeof Pr=="function"&&Pr._elements instanceof dr?Pr._elements:null},clear:function(){$(ur).forEach(Fr)}}}var Tc=new Float32Array(1),Iu=new Uint32Array(Tc.buffer),mu=5123;function Mo(B){for(var me=wt.allocType(mu,B.length),ze=0;ze<B.length;++ze)if(isNaN(B[ze]))me[ze]=65535;else if(B[ze]===Infinity)me[ze]=31744;else if(B[ze]===-Infinity)me[ze]=64512;else{Tc[0]=B[ze];var Dt=Iu[0],ur=Dt>>>31<<15,Lt=(Dt<<1>>>24)-127,tr=Dt>>13&(1<<10)-1;if(Lt<-24)me[ze]=ur;else if(Lt<-14){var dr=-14-Lt;me[ze]=ur+(tr+(1<<10)>>dr)}else Lt>15?me[ze]=ur+31744:me[ze]=ur+(Lt+15<<10)+tr}return me}function pa(B){return Array.isArray(B)||ye(B)}var up=function(B){return!(B&B-1)&&!!B},lp=34467,go=3553,If=34067,gu=34069,Ds=6408,Mc=6406,fl=6407,Ea=6409,Ml=6410,Kl=32854,is=32855,Of=36194,cp=32819,fp=32820,Kc=33635,pl=34042,Go=6402,Ou=34041,Xu=35904,Ho=35906,Pl=36193,Yu=33776,$s=33777,$c=33778,Qc=33779,Jc=35986,qu=35987,$l=34798,Pc=35840,ef=35841,Ic=35842,pp=35843,Oc=36196,hl=5121,tf=5123,rf=5125,Ru=5126,nf=10242,Rf=10243,hp=10497,Il=33071,Kp=33648,as=10240,Ka=10241,Ql=9728,Ol=9729,lu=9984,Bi=9985,Na=9986,Fs=9987,af=33170,dl=4352,of=4353,$p=4354,Qp=34046,Rc=3317,Jl=37440,Ku=37441,Bo=37443,ec=37444,tc=33984,to=[lu,Na,Bi,Fs],gn=[0,Ea,Ml,fl,Ds],fo={};fo[Ea]=fo[Mc]=fo[Go]=1,fo[Ou]=fo[Ml]=2,fo[fl]=fo[Xu]=3,fo[Ds]=fo[Ho]=4;function $u(B){return"[object "+B+"]"}var Qu=$u("HTMLCanvasElement"),yu=$u("OffscreenCanvas"),Bs=$u("CanvasRenderingContext2D"),Lf=$u("ImageBitmap"),qr=$u("HTMLImageElement"),sf=$u("HTMLVideoElement"),kf=Object.keys(ta).concat([Qu,yu,Bs,Lf,qr,sf]),Lu=[];Lu[hl]=1,Lu[Ru]=4,Lu[Pl]=2,Lu[tf]=2,Lu[rf]=4;var Wa=[];Wa[Kl]=2,Wa[is]=2,Wa[Of]=2,Wa[Ou]=4,Wa[Yu]=.5,Wa[$s]=.5,Wa[$c]=1,Wa[Qc]=1,Wa[Jc]=.5,Wa[qu]=1,Wa[$l]=1,Wa[Pc]=.5,Wa[ef]=.25,Wa[Ic]=.5,Wa[pp]=.25,Wa[Oc]=.5;function Ns(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function uf(B){if(!Array.isArray(B))return!1;var me=B.length;return!(me===0||!pa(B[0]))}function ku(B){return Object.prototype.toString.call(B)}function Is(B){return ku(B)===Qu}function Po(B){return ku(B)===yu}function dp(B){return ku(B)===Bs}function _a(B){return ku(B)===Lf}function Df(B){return ku(B)===qr}function vp(B){return ku(B)===sf}function Qs(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&B.getContext)}function Os(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&"src"in B&&"crossOrigin"in B)}function ki(B){if(!B)return!1;if(Qs(B)||Os(B))return!0;var me=ku(B);return kf.indexOf(me)>=0?!0:Ns(B)||uf(B)||ks(B)}function _u(B){return ta[Object.prototype.toString.call(B)]|0}function ha(B,me){var ze=me.length;switch(B.type){case hl:case tf:case rf:case Ru:var Dt=wt.allocType(B.type,ze);Dt.set(me),B.data=Dt;break;case Pl:B.data=Mo(me);break;default:he.raise("unsupported texture type, must specify a typed array")}}function yo(B,me){return wt.allocType(B.type===Pl?Ru:B.type,me)}function zs(B,me){B.type===Pl?(B.data=Mo(me),wt.freeType(me)):B.data=me}function cu(B,me,ze,Dt,ur,Lt){for(var tr=B.width,dr=B.height,yr=B.channels,_r=tr*dr*yr,Ir=yo(B,_r),or=0,Fr=0;Fr<dr;++Fr)for(var br=0;br<tr;++br)for(var Pr=0;Pr<yr;++Pr)Ir[or++]=me[ze*br+Dt*Fr+ur*Pr+Lt];zs(B,Ir)}function Us(B,me,ze,Dt,ur,Lt){var tr;if(typeof Wa[B]!="undefined"?tr=Wa[B]:tr=fo[B]*Lu[me],Lt&&(tr*=6),ur){for(var dr=0,yr=ze;yr>=1;)dr+=tr*yr*yr,yr/=2;return dr}else return tr*ze*Dt}function ms(B,me,ze,Dt,ur,Lt,tr){var dr={"don't care":dl,"dont care":dl,nice:$p,fast:of},yr={repeat:hp,clamp:Il,mirror:Kp},_r={nearest:Ql,linear:Ol},Ir=v({mipmap:Fs,"nearest mipmap nearest":lu,"linear mipmap nearest":Bi,"nearest mipmap linear":Na,"linear mipmap linear":Fs},_r),or={none:0,browser:ec},Fr={uint8:hl,rgba4:cp,rgb565:Kc,"rgb5 a1":fp},br={alpha:Mc,luminance:Ea,"luminance alpha":Ml,rgb:fl,rgba:Ds,rgba4:Kl,"rgb5 a1":is,rgb565:Of},Pr={};me.ext_srgb&&(br.srgb=Xu,br.srgba=Ho),me.oes_texture_float&&(Fr.float32=Fr.float=Ru),me.oes_texture_half_float&&(Fr.float16=Fr["half float"]=Pl),me.webgl_depth_texture&&(v(br,{depth:Go,"depth stencil":Ou}),v(Fr,{uint16:tf,uint32:rf,"depth stencil":pl})),me.webgl_compressed_texture_s3tc&&v(Pr,{"rgb s3tc dxt1":Yu,"rgba s3tc dxt1":$s,"rgba s3tc dxt3":$c,"rgba s3tc dxt5":Qc}),me.webgl_compressed_texture_atc&&v(Pr,{"rgb atc":Jc,"rgba atc explicit alpha":qu,"rgba atc interpolated alpha":$l}),me.webgl_compressed_texture_pvrtc&&v(Pr,{"rgb pvrtc 4bppv1":Pc,"rgb pvrtc 2bppv1":ef,"rgba pvrtc 4bppv1":Ic,"rgba pvrtc 2bppv1":pp}),me.webgl_compressed_texture_etc1&&(Pr["rgb etc1"]=Oc);var st=Array.prototype.slice.call(B.getParameter(lp)||new Uint32Array(0));Object.keys(Pr).forEach(function(Te){var Zt=Pr[Te];st.indexOf(Zt)>=0&&(br[Te]=Zt)});var Xt=Object.keys(br);ze.textureFormats=Xt;var Er=[];Object.keys(br).forEach(function(Te){var Zt=br[Te];Er[Zt]=Te});var Ur=[];Object.keys(Fr).forEach(function(Te){var Zt=Fr[Te];Ur[Zt]=Te});var fr=[];Object.keys(_r).forEach(function(Te){var Zt=_r[Te];fr[Zt]=Te});var Lr=[];Object.keys(Ir).forEach(function(Te){var Zt=Ir[Te];Lr[Zt]=Te});var $r=[];Object.keys(yr).forEach(function(Te){var Zt=yr[Te];$r[Zt]=Te});var Tn=Xt.reduce(function(Te,Zt){var bt=br[Zt];return bt===Ea||bt===Mc||bt===Ea||bt===Ml||bt===Go||bt===Ou||me.ext_srgb&&(bt===Xu||bt===Ho)?Te[bt]=bt:bt===is||Zt.indexOf("rgba")>=0?Te[bt]=Ds:Te[bt]=fl,Te},{});function Qt(){this.internalformat=Ds,this.format=Ds,this.type=hl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ec,this.width=0,this.height=0,this.channels=0}function rr(Te,Zt){Te.internalformat=Zt.internalformat,Te.format=Zt.format,Te.type=Zt.type,Te.compressed=Zt.compressed,Te.premultiplyAlpha=Zt.premultiplyAlpha,Te.flipY=Zt.flipY,Te.unpackAlignment=Zt.unpackAlignment,Te.colorSpace=Zt.colorSpace,Te.width=Zt.width,Te.height=Zt.height,Te.channels=Zt.channels}function En(Te,Zt){if(!(typeof Zt!="object"||!Zt)){if("premultiplyAlpha"in Zt&&(he.type(Zt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Te.premultiplyAlpha=Zt.premultiplyAlpha),"flipY"in Zt&&(he.type(Zt.flipY,"boolean","invalid texture flip"),Te.flipY=Zt.flipY),"alignment"in Zt&&(he.oneOf(Zt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Te.unpackAlignment=Zt.alignment),"colorSpace"in Zt&&(he.parameter(Zt.colorSpace,or,"invalid colorSpace"),Te.colorSpace=or[Zt.colorSpace]),"type"in Zt){var bt=Zt.type;he(me.oes_texture_float||!(bt==="float"||bt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),he(me.oes_texture_half_float||!(bt==="half float"||bt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),he(me.webgl_depth_texture||!(bt==="uint16"||bt==="uint32"||bt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(bt,Fr,"invalid texture type"),Te.type=Fr[bt]}var pn=Te.width,ji=Te.height,Ee=Te.channels,ne=!1;"shape"in Zt?(he(Array.isArray(Zt.shape)&&Zt.shape.length>=2,"shape must be an array"),pn=Zt.shape[0],ji=Zt.shape[1],Zt.shape.length===3&&(Ee=Zt.shape[2],he(Ee>0&&Ee<=4,"invalid number of channels"),ne=!0),he(pn>=0&&pn<=ze.maxTextureSize,"invalid width"),he(ji>=0&&ji<=ze.maxTextureSize,"invalid height")):("radius"in Zt&&(pn=ji=Zt.radius,he(pn>=0&&pn<=ze.maxTextureSize,"invalid radius")),"width"in Zt&&(pn=Zt.width,he(pn>=0&&pn<=ze.maxTextureSize,"invalid width")),"height"in Zt&&(ji=Zt.height,he(ji>=0&&ji<=ze.maxTextureSize,"invalid height")),"channels"in Zt&&(Ee=Zt.channels,he(Ee>0&&Ee<=4,"invalid number of channels"),ne=!0)),Te.width=pn|0,Te.height=ji|0,Te.channels=Ee|0;var Ve=!1;if("format"in Zt){var pt=Zt.format;he(me.webgl_depth_texture||!(pt==="depth"||pt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(pt,br,"invalid texture format");var It=Te.internalformat=br[pt];Te.format=Tn[It],pt in Fr&&("type"in Zt||(Te.type=Fr[pt])),pt in Pr&&(Te.compressed=!0),Ve=!0}!ne&&Ve?Te.channels=fo[Te.format]:ne&&!Ve?Te.channels!==gn[Te.format]&&(Te.format=Te.internalformat=gn[Te.channels]):Ve&&ne&&he(Te.channels===fo[Te.format],"number of channels inconsistent with specified format")}}function Vr(Te){B.pixelStorei(Jl,Te.flipY),B.pixelStorei(Ku,Te.premultiplyAlpha),B.pixelStorei(Bo,Te.colorSpace),B.pixelStorei(Rc,Te.unpackAlignment)}function Ar(){Qt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Wr(Te,Zt){var bt=null;if(ki(Zt)?bt=Zt:Zt&&(he.type(Zt,"object","invalid pixel data type"),En(Te,Zt),"x"in Zt&&(Te.xOffset=Zt.x|0),"y"in Zt&&(Te.yOffset=Zt.y|0),ki(Zt.data)&&(bt=Zt.data)),he(!Te.compressed||bt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Zt.copy){he(!bt,"can not specify copy and data field for the same texture");var pn=ur.viewportWidth,ji=ur.viewportHeight;Te.width=Te.width||pn-Te.xOffset,Te.height=Te.height||ji-Te.yOffset,Te.needsCopy=!0,he(Te.xOffset>=0&&Te.xOffset<pn&&Te.yOffset>=0&&Te.yOffset<ji&&Te.width>0&&Te.width<=pn&&Te.height>0&&Te.height<=ji,"copy texture read out of bounds")}else if(!bt)Te.width=Te.width||1,Te.height=Te.height||1,Te.channels=Te.channels||4;else if(ye(bt))Te.channels=Te.channels||4,Te.data=bt,!("type"in Zt)&&Te.type===hl&&(Te.type=_u(bt));else if(Ns(bt))Te.channels=Te.channels||4,ha(Te,bt),Te.alignment=1,Te.needsFree=!0;else if(ks(bt)){var Ee=bt.data;!Array.isArray(Ee)&&Te.type===hl&&(Te.type=_u(Ee));var ne=bt.shape,Ve=bt.stride,pt,It,qe,Be,nt,_e;ne.length===3?(qe=ne[2],_e=Ve[2]):(he(ne.length===2,"invalid ndarray pixel data, must be 2 or 3D"),qe=1,_e=1),pt=ne[0],It=ne[1],Be=Ve[0],nt=Ve[1],Te.alignment=1,Te.width=pt,Te.height=It,Te.channels=qe,Te.format=Te.internalformat=gn[qe],Te.needsFree=!0,cu(Te,Ee,Be,nt,_e,bt.offset)}else if(Qs(bt)||Is(bt)||Po(bt)||dp(bt))Qs(bt)||Is(bt)||Po(bt)?Te.element=bt:Te.element=bt.canvas,Te.width=Te.element.width,Te.height=Te.element.height,Te.channels=4;else if(_a(bt))Te.element=bt,Te.width=bt.width,Te.height=bt.height,Te.channels=4;else if(Df(bt))Te.element=bt,Te.width=bt.naturalWidth,Te.height=bt.naturalHeight,Te.channels=4;else if(Os(bt))Te.element=bt,Te.width=bt.width,Te.height=bt.height,Te.channels=4;else if(vp(bt))Te.element=bt,Te.width=bt.videoWidth,Te.height=bt.videoHeight,Te.channels=4;else if(uf(bt)){var Ze=Te.width||bt[0].length,Ce=Te.height||bt.length,ft=Te.channels;pa(bt[0][0])?ft=ft||bt[0][0].length:ft=ft||1;for(var Et=be.shape(bt),hr=1,zr=0;zr<Et.length;++zr)hr*=Et[zr];var Zr=yo(Te,hr);be.flatten(bt,Et,"",Zr),zs(Te,Zr),Te.alignment=1,Te.width=Ze,Te.height=Ce,Te.channels=ft,Te.format=Te.internalformat=gn[ft],Te.needsFree=!0}Te.type===Ru?he(ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Te.type===Pl&&he(ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Kr(Te,Zt,bt){var pn=Te.element,ji=Te.data,Ee=Te.internalformat,ne=Te.format,Ve=Te.type,pt=Te.width,It=Te.height;Vr(Te),pn?B.texImage2D(Zt,bt,ne,ne,Ve,pn):Te.compressed?B.compressedTexImage2D(Zt,bt,Ee,pt,It,0,ji):Te.needsCopy?(Dt(),B.copyTexImage2D(Zt,bt,ne,Te.xOffset,Te.yOffset,pt,It,0)):B.texImage2D(Zt,bt,ne,pt,It,0,ne,Ve,ji||null)}function xi(Te,Zt,bt,pn,ji){var Ee=Te.element,ne=Te.data,Ve=Te.internalformat,pt=Te.format,It=Te.type,qe=Te.width,Be=Te.height;Vr(Te),Ee?B.texSubImage2D(Zt,ji,bt,pn,pt,It,Ee):Te.compressed?B.compressedTexSubImage2D(Zt,ji,bt,pn,Ve,qe,Be,ne):Te.needsCopy?(Dt(),B.copyTexSubImage2D(Zt,ji,bt,pn,Te.xOffset,Te.yOffset,qe,Be)):B.texSubImage2D(Zt,ji,bt,pn,qe,Be,pt,It,ne)}var ni=[];function Yr(){return ni.pop()||new Ar}function an(Te){Te.needsFree&&wt.freeType(Te.data),Ar.call(Te),ni.push(Te)}function $n(){Qt.call(this),this.genMipmaps=!1,this.mipmapHint=dl,this.mipmask=0,this.images=Array(16)}function pi(Te,Zt,bt){var pn=Te.images[0]=Yr();Te.mipmask=1,pn.width=Te.width=Zt,pn.height=Te.height=bt,pn.channels=Te.channels=4}function Zi(Te,Zt){var bt=null;if(ki(Zt))bt=Te.images[0]=Yr(),rr(bt,Te),Wr(bt,Zt),Te.mipmask=1;else if(En(Te,Zt),Array.isArray(Zt.mipmap))for(var pn=Zt.mipmap,ji=0;ji<pn.length;++ji)bt=Te.images[ji]=Yr(),rr(bt,Te),bt.width>>=ji,bt.height>>=ji,Wr(bt,pn[ji]),Te.mipmask|=1<<ji;else bt=Te.images[0]=Yr(),rr(bt,Te),Wr(bt,Zt),Te.mipmask=1;rr(Te,Te.images[0]),Te.compressed&&(Te.internalformat===Yu||Te.internalformat===$s||Te.internalformat===$c||Te.internalformat===Qc)&&he(Te.width%4==0&&Te.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function po(Te,Zt){for(var bt=Te.images,pn=0;pn<bt.length;++pn){if(!bt[pn])return;Kr(bt[pn],Zt,pn)}}var ho=[];function Ni(){var Te=ho.pop()||new $n;Qt.call(Te),Te.mipmask=0;for(var Zt=0;Zt<16;++Zt)Te.images[Zt]=null;return Te}function os(Te){for(var Zt=Te.images,bt=0;bt<Zt.length;++bt)Zt[bt]&&an(Zt[bt]),Zt[bt]=null;ho.push(Te)}function $a(){this.minFilter=Ql,this.magFilter=Ql,this.wrapS=Il,this.wrapT=Il,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=dl}function ns(Te,Zt){if("min"in Zt){var bt=Zt.min;he.parameter(bt,Ir),Te.minFilter=Ir[bt],to.indexOf(Te.minFilter)>=0&&!("faces"in Zt)&&(Te.genMipmaps=!0)}if("mag"in Zt){var pn=Zt.mag;he.parameter(pn,_r),Te.magFilter=_r[pn]}var ji=Te.wrapS,Ee=Te.wrapT;if("wrap"in Zt){var ne=Zt.wrap;typeof ne=="string"?(he.parameter(ne,yr),ji=Ee=yr[ne]):Array.isArray(ne)&&(he.parameter(ne[0],yr),he.parameter(ne[1],yr),ji=yr[ne[0]],Ee=yr[ne[1]])}else{if("wrapS"in Zt){var Ve=Zt.wrapS;he.parameter(Ve,yr),ji=yr[Ve]}if("wrapT"in Zt){var pt=Zt.wrapT;he.parameter(pt,yr),Ee=yr[pt]}}if(Te.wrapS=ji,Te.wrapT=Ee,"anisotropic"in Zt){var It=Zt.anisotropic;he(typeof It=="number"&&It>=1&&It<=ze.maxAnisotropic,"aniso samples must be between 1 and "),Te.anisotropic=Zt.anisotropic}if("mipmap"in Zt){var qe=!1;switch(typeof Zt.mipmap){case"string":he.parameter(Zt.mipmap,dr,"invalid mipmap hint"),Te.mipmapHint=dr[Zt.mipmap],Te.genMipmaps=!0,qe=!0;break;case"boolean":qe=Te.genMipmaps=Zt.mipmap;break;case"object":he(Array.isArray(Zt.mipmap),"invalid mipmap type"),Te.genMipmaps=!1,qe=!0;break;default:he.raise("invalid mipmap type")}qe&&!("min"in Zt)&&(Te.minFilter=lu)}}function Oo(Te,Zt){B.texParameteri(Zt,Ka,Te.minFilter),B.texParameteri(Zt,as,Te.magFilter),B.texParameteri(Zt,nf,Te.wrapS),B.texParameteri(Zt,Rf,Te.wrapT),me.ext_texture_filter_anisotropic&&B.texParameteri(Zt,Qp,Te.anisotropic),Te.genMipmaps&&(B.hint(af,Te.mipmapHint),B.generateMipmap(Zt))}var Yo=0,zo={},xs=ze.maxTextureUnits,xo=Array(xs).map(function(){return null});function _i(Te){Qt.call(this),this.mipmask=0,this.internalformat=Ds,this.id=Yo++,this.refCount=1,this.target=Te,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new $a,tr.profile&&(this.stats={size:0})}function qo(Te){B.activeTexture(tc),B.bindTexture(Te.target,Te.texture)}function ia(){var Te=xo[0];Te?B.bindTexture(Te.target,Te.texture):B.bindTexture(go,null)}function ss(Te){var Zt=Te.texture;he(Zt,"must not double destroy texture");var bt=Te.unit,pn=Te.target;bt>=0&&(B.activeTexture(tc+bt),B.bindTexture(pn,null),xo[bt]=null),B.deleteTexture(Zt),Te.texture=null,Te.params=null,Te.pixels=null,Te.refCount=0,delete zo[Te.id],Lt.textureCount--}v(_i.prototype,{bind:function(){var Te=this;Te.bindCount+=1;var Zt=Te.unit;if(Zt<0){for(var bt=0;bt<xs;++bt){var pn=xo[bt];if(pn){if(pn.bindCount>0)continue;pn.unit=-1}xo[bt]=Te,Zt=bt;break}Zt>=xs&&he.raise("insufficient number of texture units"),tr.profile&&Lt.maxTextureUnits<Zt+1&&(Lt.maxTextureUnits=Zt+1),Te.unit=Zt,B.activeTexture(tc+Zt),B.bindTexture(Te.target,Te.texture)}return Zt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ss(this)}});function ti(Te,Zt){var bt=new _i(go);zo[bt.id]=bt,Lt.textureCount++;function pn(ne,Ve){var pt=bt.texInfo;$a.call(pt);var It=Ni();return typeof ne=="number"?typeof Ve=="number"?pi(It,ne|0,Ve|0):pi(It,ne|0,ne|0):ne?(he.type(ne,"object","invalid arguments to regl.texture"),ns(pt,ne),Zi(It,ne)):pi(It,1,1),pt.genMipmaps&&(It.mipmask=(It.width<<1)-1),bt.mipmask=It.mipmask,rr(bt,It),he.texture2D(pt,It,ze),bt.internalformat=It.internalformat,pn.width=It.width,pn.height=It.height,qo(bt),po(It,go),Oo(pt,go),ia(),os(It),tr.profile&&(bt.stats.size=Us(bt.internalformat,bt.type,It.width,It.height,pt.genMipmaps,!1)),pn.format=Er[bt.internalformat],pn.type=Ur[bt.type],pn.mag=fr[pt.magFilter],pn.min=Lr[pt.minFilter],pn.wrapS=$r[pt.wrapS],pn.wrapT=$r[pt.wrapT],pn}function ji(ne,Ve,pt,It){he(!!ne,"must specify image data");var qe=Ve|0,Be=pt|0,nt=It|0,_e=Yr();return rr(_e,bt),_e.width=0,_e.height=0,Wr(_e,ne),_e.width=_e.width||(bt.width>>nt)-qe,_e.height=_e.height||(bt.height>>nt)-Be,he(bt.type===_e.type&&bt.format===_e.format&&bt.internalformat===_e.internalformat,"incompatible format for texture.subimage"),he(qe>=0&&Be>=0&&qe+_e.width<=bt.width&&Be+_e.height<=bt.height,"texture.subimage write out of bounds"),he(bt.mipmask&1<<nt,"missing mipmap data"),he(_e.data||_e.element||_e.needsCopy,"missing image data"),qo(bt),xi(_e,go,qe,Be,nt),ia(),an(_e),pn}function Ee(ne,Ve){var pt=ne|0,It=Ve|0||pt;if(pt===bt.width&&It===bt.height)return pn;pn.width=bt.width=pt,pn.height=bt.height=It,qo(bt);for(var qe=0;bt.mipmask>>qe;++qe){var Be=pt>>qe,nt=It>>qe;if(!Be||!nt)break;B.texImage2D(go,qe,bt.format,Be,nt,0,bt.format,bt.type,null)}return ia(),tr.profile&&(bt.stats.size=Us(bt.internalformat,bt.type,pt,It,!1,!1)),pn}return pn(Te,Zt),pn.subimage=ji,pn.resize=Ee,pn._reglType="texture2d",pn._texture=bt,tr.profile&&(pn.stats=bt.stats),pn.destroy=function(){bt.decRef()},pn}function zi(Te,Zt,bt,pn,ji,Ee){var ne=new _i(If);zo[ne.id]=ne,Lt.cubeCount++;var Ve=new Array(6);function pt(Be,nt,_e,Ze,Ce,ft){var Et,hr=ne.texInfo;for($a.call(hr),Et=0;Et<6;++Et)Ve[Et]=Ni();if(typeof Be=="number"||!Be){var zr=Be|0||1;for(Et=0;Et<6;++Et)pi(Ve[Et],zr,zr)}else if(typeof Be=="object")if(nt)Zi(Ve[0],Be),Zi(Ve[1],nt),Zi(Ve[2],_e),Zi(Ve[3],Ze),Zi(Ve[4],Ce),Zi(Ve[5],ft);else if(ns(hr,Be),En(ne,Be),"faces"in Be){var Zr=Be.faces;for(he(Array.isArray(Zr)&&Zr.length===6,"cube faces must be a length 6 array"),Et=0;Et<6;++Et)he(typeof Zr[Et]=="object"&&!!Zr[Et],"invalid input for cube map face"),rr(Ve[Et],ne),Zi(Ve[Et],Zr[Et])}else for(Et=0;Et<6;++Et)Zi(Ve[Et],Be);else he.raise("invalid arguments to cube map");for(rr(ne,Ve[0]),he.optional(function(){ze.npotTextureCube||he(up(ne.width)&&up(ne.height),"your browser does not support non power or two texture dimensions")}),hr.genMipmaps?ne.mipmask=(Ve[0].width<<1)-1:ne.mipmask=Ve[0].mipmask,he.textureCube(ne,hr,Ve,ze),ne.internalformat=Ve[0].internalformat,pt.width=Ve[0].width,pt.height=Ve[0].height,qo(ne),Et=0;Et<6;++Et)po(Ve[Et],gu+Et);for(Oo(hr,If),ia(),tr.profile&&(ne.stats.size=Us(ne.internalformat,ne.type,pt.width,pt.height,hr.genMipmaps,!0)),pt.format=Er[ne.internalformat],pt.type=Ur[ne.type],pt.mag=fr[hr.magFilter],pt.min=Lr[hr.minFilter],pt.wrapS=$r[hr.wrapS],pt.wrapT=$r[hr.wrapT],Et=0;Et<6;++Et)os(Ve[Et]);return pt}function It(Be,nt,_e,Ze,Ce){he(!!nt,"must specify image data"),he(typeof Be=="number"&&Be===(Be|0)&&Be>=0&&Be<6,"invalid face");var ft=_e|0,Et=Ze|0,hr=Ce|0,zr=Yr();return rr(zr,ne),zr.width=0,zr.height=0,Wr(zr,nt),zr.width=zr.width||(ne.width>>hr)-ft,zr.height=zr.height||(ne.height>>hr)-Et,he(ne.type===zr.type&&ne.format===zr.format&&ne.internalformat===zr.internalformat,"incompatible format for texture.subimage"),he(ft>=0&&Et>=0&&ft+zr.width<=ne.width&&Et+zr.height<=ne.height,"texture.subimage write out of bounds"),he(ne.mipmask&1<<hr,"missing mipmap data"),he(zr.data||zr.element||zr.needsCopy,"missing image data"),qo(ne),xi(zr,gu+Be,ft,Et,hr),ia(),an(zr),pt}function qe(Be){var nt=Be|0;if(nt!==ne.width){pt.width=ne.width=nt,pt.height=ne.height=nt,qo(ne);for(var _e=0;_e<6;++_e)for(var Ze=0;ne.mipmask>>Ze;++Ze)B.texImage2D(gu+_e,Ze,ne.format,nt>>Ze,nt>>Ze,0,ne.format,ne.type,null);return ia(),tr.profile&&(ne.stats.size=Us(ne.internalformat,ne.type,pt.width,pt.height,!1,!0)),pt}}return pt(Te,Zt,bt,pn,ji,Ee),pt.subimage=It,pt.resize=qe,pt._reglType="textureCube",pt._texture=ne,tr.profile&&(pt.stats=ne.stats),pt.destroy=function(){ne.decRef()},pt}function ma(){for(var Te=0;Te<xs;++Te)B.activeTexture(tc+Te),B.bindTexture(go,null),xo[Te]=null;$(zo).forEach(ss),Lt.cubeCount=0,Lt.textureCount=0}tr.profile&&(Lt.getTotalTextureSize=function(){var Te=0;return Object.keys(zo).forEach(function(Zt){Te+=zo[Zt].stats.size}),Te});function Ro(){for(var Te=0;Te<xs;++Te){var Zt=xo[Te];Zt&&(Zt.bindCount=0,Zt.unit=-1,xo[Te]=null)}$(zo).forEach(function(bt){bt.texture=B.createTexture(),B.bindTexture(bt.target,bt.texture);for(var pn=0;pn<32;++pn)if((bt.mipmask&1<<pn)!=0)if(bt.target===go)B.texImage2D(go,pn,bt.internalformat,bt.width>>pn,bt.height>>pn,0,bt.internalformat,bt.type,null);else for(var ji=0;ji<6;++ji)B.texImage2D(gu+ji,pn,bt.internalformat,bt.width>>pn,bt.height>>pn,0,bt.internalformat,bt.type,null);Oo(bt.texInfo,bt.target)})}function al(){for(var Te=0;Te<xs;++Te){var Zt=xo[Te];Zt&&(Zt.bindCount=0,Zt.unit=-1,xo[Te]=null),B.activeTexture(tc+Te),B.bindTexture(go,null),B.bindTexture(If,null)}}return{create2D:ti,createCube:zi,clear:ma,getTexture:function(Te){return null},restore:Ro,refresh:al}}var Zs=36161,On=32854,wn=32855,rc=36194,gs=33189,xu=36168,rs=34041,Sa=35907,Lc=34836,kc=34842,da=34843,Ma=[];Ma[On]=2,Ma[wn]=2,Ma[rc]=2,Ma[gs]=2,Ma[xu]=1,Ma[rs]=4,Ma[Sa]=4,Ma[Lc]=16,Ma[kc]=8,Ma[da]=6;function Dc(B,me,ze){return Ma[B]*me*ze}var Rl=function(B,me,ze,Dt,ur){var Lt={rgba4:On,rgb565:rc,"rgb5 a1":wn,depth:gs,stencil:xu,"depth stencil":rs};me.ext_srgb&&(Lt.srgba=Sa),me.ext_color_buffer_half_float&&(Lt.rgba16f=kc,Lt.rgb16f=da),me.webgl_color_buffer_float&&(Lt.rgba32f=Lc);var tr=[];Object.keys(Lt).forEach(function(br){var Pr=Lt[br];tr[Pr]=br});var dr=0,yr={};function _r(br){this.id=dr++,this.refCount=1,this.renderbuffer=br,this.format=On,this.width=0,this.height=0,ur.profile&&(this.stats={size:0})}_r.prototype.decRef=function(){--this.refCount<=0&&Ir(this)};function Ir(br){var Pr=br.renderbuffer;he(Pr,"must not double destroy renderbuffer"),B.bindRenderbuffer(Zs,null),B.deleteRenderbuffer(Pr),br.renderbuffer=null,br.refCount=0,delete yr[br.id],Dt.renderbufferCount--}function or(br,Pr){var st=new _r(B.createRenderbuffer());yr[st.id]=st,Dt.renderbufferCount++;function Xt(Ur,fr){var Lr=0,$r=0,Tn=On;if(typeof Ur=="object"&&Ur){var Qt=Ur;if("shape"in Qt){var rr=Qt.shape;he(Array.isArray(rr)&&rr.length>=2,"invalid renderbuffer shape"),Lr=rr[0]|0,$r=rr[1]|0}else"radius"in Qt&&(Lr=$r=Qt.radius|0),"width"in Qt&&(Lr=Qt.width|0),"height"in Qt&&($r=Qt.height|0);"format"in Qt&&(he.parameter(Qt.format,Lt,"invalid renderbuffer format"),Tn=Lt[Qt.format])}else typeof Ur=="number"?(Lr=Ur|0,typeof fr=="number"?$r=fr|0:$r=Lr):Ur?he.raise("invalid arguments to renderbuffer constructor"):Lr=$r=1;if(he(Lr>0&&$r>0&&Lr<=ze.maxRenderbufferSize&&$r<=ze.maxRenderbufferSize,"invalid renderbuffer size"),!(Lr===st.width&&$r===st.height&&Tn===st.format))return Xt.width=st.width=Lr,Xt.height=st.height=$r,st.format=Tn,B.bindRenderbuffer(Zs,st.renderbuffer),B.renderbufferStorage(Zs,Tn,Lr,$r),he(B.getError()===0,"invalid render buffer format"),ur.profile&&(st.stats.size=Dc(st.format,st.width,st.height)),Xt.format=tr[st.format],Xt}function Er(Ur,fr){var Lr=Ur|0,$r=fr|0||Lr;return Lr===st.width&&$r===st.height||(he(Lr>0&&$r>0&&Lr<=ze.maxRenderbufferSize&&$r<=ze.maxRenderbufferSize,"invalid renderbuffer size"),Xt.width=st.width=Lr,Xt.height=st.height=$r,B.bindRenderbuffer(Zs,st.renderbuffer),B.renderbufferStorage(Zs,st.format,Lr,$r),he(B.getError()===0,"invalid render buffer format"),ur.profile&&(st.stats.size=Dc(st.format,st.width,st.height))),Xt}return Xt(br,Pr),Xt.resize=Er,Xt._reglType="renderbuffer",Xt._renderbuffer=st,ur.profile&&(Xt.stats=st.stats),Xt.destroy=function(){st.decRef()},Xt}ur.profile&&(Dt.getTotalRenderbufferSize=function(){var br=0;return Object.keys(yr).forEach(function(Pr){br+=yr[Pr].stats.size}),br});function Fr(){$(yr).forEach(function(br){br.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(Zs,br.renderbuffer),B.renderbufferStorage(Zs,br.format,br.width,br.height)}),B.bindRenderbuffer(Zs,null)}return{create:or,clear:function(){$(yr).forEach(Ir)},restore:Fr}},bu=36160,Js=36161,No=3553,vl=34069,Eu=36064,lf=36096,Ll=36128,kl=33306,Dl=36053,nc=36054,ml=36055,mp=36057,Ju=36061,Du=36193,Ff=5121,gl=5126,eu=6407,cf=6408,js=6402,gp=[eu,cf],ic=[];ic[cf]=4,ic[eu]=3;var l=[];l[Ff]=1,l[gl]=4,l[Du]=2;var f=32854,c=32855,d=36194,E=33189,A=36168,M=34041,L=35907,U=34836,X=34842,oe=34843,ue=[f,c,d,L,X,oe,U],pe={};pe[Dl]="complete",pe[nc]="incomplete attachment",pe[mp]="incomplete dimensions",pe[ml]="incomplete, missing attachment",pe[Ju]="unsupported";function Oe(B,me,ze,Dt,ur,Lt){var tr={cur:null,next:null,dirty:!1,setFBO:null},dr=["rgba"],yr=["rgba4","rgb565","rgb5 a1"];me.ext_srgb&&yr.push("srgba"),me.ext_color_buffer_half_float&&yr.push("rgba16f","rgb16f"),me.webgl_color_buffer_float&&yr.push("rgba32f");var _r=["uint8"];me.oes_texture_half_float&&_r.push("half float","float16"),me.oes_texture_float&&_r.push("float","float32");function Ir(Ar,Wr,Kr){this.target=Ar,this.texture=Wr,this.renderbuffer=Kr;var xi=0,ni=0;Wr?(xi=Wr.width,ni=Wr.height):Kr&&(xi=Kr.width,ni=Kr.height),this.width=xi,this.height=ni}function or(Ar){Ar&&(Ar.texture&&Ar.texture._texture.decRef(),Ar.renderbuffer&&Ar.renderbuffer._renderbuffer.decRef())}function Fr(Ar,Wr,Kr){if(!!Ar)if(Ar.texture){var xi=Ar.texture._texture,ni=Math.max(1,xi.width),Yr=Math.max(1,xi.height);he(ni===Wr&&Yr===Kr,"inconsistent width/height for supplied texture"),xi.refCount+=1}else{var an=Ar.renderbuffer._renderbuffer;he(an.width===Wr&&an.height===Kr,"inconsistent width/height for renderbuffer"),an.refCount+=1}}function br(Ar,Wr){Wr&&(Wr.texture?B.framebufferTexture2D(bu,Ar,Wr.target,Wr.texture._texture.texture,0):B.framebufferRenderbuffer(bu,Ar,Js,Wr.renderbuffer._renderbuffer.renderbuffer))}function Pr(Ar){var Wr=No,Kr=null,xi=null,ni=Ar;typeof Ar=="object"&&(ni=Ar.data,"target"in Ar&&(Wr=Ar.target|0)),he.type(ni,"function","invalid attachment data");var Yr=ni._reglType;return Yr==="texture2d"?(Kr=ni,he(Wr===No)):Yr==="textureCube"?(Kr=ni,he(Wr>=vl&&Wr<vl+6,"invalid cube map target")):Yr==="renderbuffer"?(xi=ni,Wr=Js):he.raise("invalid regl object for attachment"),new Ir(Wr,Kr,xi)}function st(Ar,Wr,Kr,xi,ni){if(Kr){var Yr=Dt.create2D({width:Ar,height:Wr,format:xi,type:ni});return Yr._texture.refCount=0,new Ir(No,Yr,null)}else{var an=ur.create({width:Ar,height:Wr,format:xi});return an._renderbuffer.refCount=0,new Ir(Js,null,an)}}function Xt(Ar){return Ar&&(Ar.texture||Ar.renderbuffer)}function Er(Ar,Wr,Kr){Ar&&(Ar.texture?Ar.texture.resize(Wr,Kr):Ar.renderbuffer&&Ar.renderbuffer.resize(Wr,Kr),Ar.width=Wr,Ar.height=Kr)}var Ur=0,fr={};function Lr(){this.id=Ur++,fr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $r(Ar){Ar.colorAttachments.forEach(or),or(Ar.depthAttachment),or(Ar.stencilAttachment),or(Ar.depthStencilAttachment)}function Tn(Ar){var Wr=Ar.framebuffer;he(Wr,"must not double destroy framebuffer"),B.deleteFramebuffer(Wr),Ar.framebuffer=null,Lt.framebufferCount--,delete fr[Ar.id]}function Qt(Ar){var Wr;B.bindFramebuffer(bu,Ar.framebuffer);var Kr=Ar.colorAttachments;for(Wr=0;Wr<Kr.length;++Wr)br(Eu+Wr,Kr[Wr]);for(Wr=Kr.length;Wr<ze.maxColorAttachments;++Wr)B.framebufferTexture2D(bu,Eu+Wr,No,null,0);B.framebufferTexture2D(bu,kl,No,null,0),B.framebufferTexture2D(bu,lf,No,null,0),B.framebufferTexture2D(bu,Ll,No,null,0),br(lf,Ar.depthAttachment),br(Ll,Ar.stencilAttachment),br(kl,Ar.depthStencilAttachment);var xi=B.checkFramebufferStatus(bu);!B.isContextLost()&&xi!==Dl&&he.raise("framebuffer configuration not supported, status = "+pe[xi]),B.bindFramebuffer(bu,tr.next?tr.next.framebuffer:null),tr.cur=tr.next,B.getError()}function rr(Ar,Wr){var Kr=new Lr;Lt.framebufferCount++;function xi(Yr,an){var $n;he(tr.next!==Kr,"can not update framebuffer which is currently in use");var pi=0,Zi=0,po=!0,ho=!0,Ni=null,os=!0,$a="rgba",ns="uint8",Oo=1,Yo=null,zo=null,xs=null,xo=!1;if(typeof Yr=="number")pi=Yr|0,Zi=an|0||pi;else if(!Yr)pi=Zi=1;else{he.type(Yr,"object","invalid arguments for framebuffer");var _i=Yr;if("shape"in _i){var qo=_i.shape;he(Array.isArray(qo)&&qo.length>=2,"invalid shape for framebuffer"),pi=qo[0],Zi=qo[1]}else"radius"in _i&&(pi=Zi=_i.radius),"width"in _i&&(pi=_i.width),"height"in _i&&(Zi=_i.height);("color"in _i||"colors"in _i)&&(Ni=_i.color||_i.colors,Array.isArray(Ni)&&he(Ni.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),Ni||("colorCount"in _i&&(Oo=_i.colorCount|0,he(Oo>0,"invalid color buffer count")),"colorTexture"in _i&&(os=!!_i.colorTexture,$a="rgba4"),"colorType"in _i&&(ns=_i.colorType,os?(he(me.oes_texture_float||!(ns==="float"||ns==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),he(me.oes_texture_half_float||!(ns==="half float"||ns==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ns==="half float"||ns==="float16"?(he(me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),$a="rgba16f"):(ns==="float"||ns==="float32")&&(he(me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),$a="rgba32f"),he.oneOf(ns,_r,"invalid color type")),"colorFormat"in _i&&($a=_i.colorFormat,dr.indexOf($a)>=0?os=!0:yr.indexOf($a)>=0?os=!1:he.optional(function(){os?he.oneOf(_i.colorFormat,dr,"invalid color format for texture"):he.oneOf(_i.colorFormat,yr,"invalid color format for renderbuffer")}))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(xo=!!(_i.depthTexture||_i.depthStencilTexture),he(!xo||me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?po=_i.depth:(Yo=_i.depth,ho=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?ho=_i.stencil:(zo=_i.stencil,po=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?po=ho=_i.depthStencil:(xs=_i.depthStencil,po=!1,ho=!1))}var ia=null,ss=null,ti=null,zi=null;if(Array.isArray(Ni))ia=Ni.map(Pr);else if(Ni)ia=[Pr(Ni)];else for(ia=new Array(Oo),$n=0;$n<Oo;++$n)ia[$n]=st(pi,Zi,os,$a,ns);he(me.webgl_draw_buffers||ia.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),he(ia.length<=ze.maxColorAttachments,"too many color attachments, not supported"),pi=pi||ia[0].width,Zi=Zi||ia[0].height,Yo?ss=Pr(Yo):po&&!ho&&(ss=st(pi,Zi,xo,"depth","uint32")),zo?ti=Pr(zo):ho&&!po&&(ti=st(pi,Zi,!1,"stencil","uint8")),xs?zi=Pr(xs):!Yo&&!zo&&ho&&po&&(zi=st(pi,Zi,xo,"depth stencil","depth stencil")),he(!!Yo+!!zo+!!xs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ma=null;for($n=0;$n<ia.length;++$n)if(Fr(ia[$n],pi,Zi),he(!ia[$n]||ia[$n].texture&&gp.indexOf(ia[$n].texture._texture.format)>=0||ia[$n].renderbuffer&&ue.indexOf(ia[$n].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+$n+" is invalid"),ia[$n]&&ia[$n].texture){var Ro=ic[ia[$n].texture._texture.format]*l[ia[$n].texture._texture.type];ma===null?ma=Ro:he(ma===Ro,"all color attachments much have the same number of bits per pixel.")}return Fr(ss,pi,Zi),he(!ss||ss.texture&&ss.texture._texture.format===js||ss.renderbuffer&&ss.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Fr(ti,pi,Zi),he(!ti||ti.renderbuffer&&ti.renderbuffer._renderbuffer.format===A,"invalid stencil attachment for framebuffer object"),Fr(zi,pi,Zi),he(!zi||zi.texture&&zi.texture._texture.format===M||zi.renderbuffer&&zi.renderbuffer._renderbuffer.format===M,"invalid depth-stencil attachment for framebuffer object"),$r(Kr),Kr.width=pi,Kr.height=Zi,Kr.colorAttachments=ia,Kr.depthAttachment=ss,Kr.stencilAttachment=ti,Kr.depthStencilAttachment=zi,xi.color=ia.map(Xt),xi.depth=Xt(ss),xi.stencil=Xt(ti),xi.depthStencil=Xt(zi),xi.width=Kr.width,xi.height=Kr.height,Qt(Kr),xi}function ni(Yr,an){he(tr.next!==Kr,"can not resize a framebuffer which is currently in use");var $n=Math.max(Yr|0,1),pi=Math.max(an|0||$n,1);if($n===Kr.width&&pi===Kr.height)return xi;for(var Zi=Kr.colorAttachments,po=0;po<Zi.length;++po)Er(Zi[po],$n,pi);return Er(Kr.depthAttachment,$n,pi),Er(Kr.stencilAttachment,$n,pi),Er(Kr.depthStencilAttachment,$n,pi),Kr.width=xi.width=$n,Kr.height=xi.height=pi,Qt(Kr),xi}return xi(Ar,Wr),v(xi,{resize:ni,_reglType:"framebuffer",_framebuffer:Kr,destroy:function(){Tn(Kr),$r(Kr)},use:function(Yr){tr.setFBO({framebuffer:xi},Yr)}})}function En(Ar){var Wr=Array(6);function Kr(ni){var Yr;he(Wr.indexOf(tr.next)<0,"can not update framebuffer which is currently in use");var an={color:null},$n=0,pi=null,Zi="rgba",po="uint8",ho=1;if(typeof ni=="number")$n=ni|0;else if(!ni)$n=1;else{he.type(ni,"object","invalid arguments for framebuffer");var Ni=ni;if("shape"in Ni){var os=Ni.shape;he(Array.isArray(os)&&os.length>=2,"invalid shape for framebuffer"),he(os[0]===os[1],"cube framebuffer must be square"),$n=os[0]}else"radius"in Ni&&($n=Ni.radius|0),"width"in Ni?($n=Ni.width|0,"height"in Ni&&he(Ni.height===$n,"must be square")):"height"in Ni&&($n=Ni.height|0);("color"in Ni||"colors"in Ni)&&(pi=Ni.color||Ni.colors,Array.isArray(pi)&&he(pi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),pi||("colorCount"in Ni&&(ho=Ni.colorCount|0,he(ho>0,"invalid color buffer count")),"colorType"in Ni&&(he.oneOf(Ni.colorType,_r,"invalid color type"),po=Ni.colorType),"colorFormat"in Ni&&(Zi=Ni.colorFormat,he.oneOf(Ni.colorFormat,dr,"invalid color format for texture"))),"depth"in Ni&&(an.depth=Ni.depth),"stencil"in Ni&&(an.stencil=Ni.stencil),"depthStencil"in Ni&&(an.depthStencil=Ni.depthStencil)}var $a;if(pi)if(Array.isArray(pi))for($a=[],Yr=0;Yr<pi.length;++Yr)$a[Yr]=pi[Yr];else $a=[pi];else{$a=Array(ho);var ns={radius:$n,format:Zi,type:po};for(Yr=0;Yr<ho;++Yr)$a[Yr]=Dt.createCube(ns)}for(an.color=Array($a.length),Yr=0;Yr<$a.length;++Yr){var Oo=$a[Yr];he(typeof Oo=="function"&&Oo._reglType==="textureCube","invalid cube map"),$n=$n||Oo.width,he(Oo.width===$n&&Oo.height===$n,"invalid cube map shape"),an.color[Yr]={target:vl,data:$a[Yr]}}for(Yr=0;Yr<6;++Yr){for(var Yo=0;Yo<$a.length;++Yo)an.color[Yo].target=vl+Yr;Yr>0&&(an.depth=Wr[0].depth,an.stencil=Wr[0].stencil,an.depthStencil=Wr[0].depthStencil),Wr[Yr]?Wr[Yr](an):Wr[Yr]=rr(an)}return v(Kr,{width:$n,height:$n,color:$a})}function xi(ni){var Yr,an=ni|0;if(he(an>0&&an<=ze.maxCubeMapSize,"invalid radius for cube fbo"),an===Kr.width)return Kr;var $n=Kr.color;for(Yr=0;Yr<$n.length;++Yr)$n[Yr].resize(an);for(Yr=0;Yr<6;++Yr)Wr[Yr].resize(an);return Kr.width=Kr.height=an,Kr}return Kr(Ar),v(Kr,{faces:Wr,resize:xi,_reglType:"framebufferCube",destroy:function(){Wr.forEach(function(ni){ni.destroy()})}})}function Vr(){tr.cur=null,tr.next=null,tr.dirty=!0,$(fr).forEach(function(Ar){Ar.framebuffer=B.createFramebuffer(),Qt(Ar)})}return v(tr,{getFramebuffer:function(Ar){if(typeof Ar=="function"&&Ar._reglType==="framebuffer"){var Wr=Ar._framebuffer;if(Wr instanceof Lr)return Wr}return null},create:rr,createCube:En,clear:function(){$(fr).forEach(Tn)},restore:Vr})}var Ie=5126,ke=34962,Ae=34963,je=["attributes","elements","offset","count","primitive","instances"];function Je(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ie,this.offset=0,this.stride=0,this.divisor=0}function yt(B,me,ze,Dt,ur,Lt,tr){for(var dr=ze.maxAttributes,yr=new Array(dr),_r=0;_r<dr;++_r)yr[_r]=new Je;var Ir=0,or={},Fr={Record:Je,scope:{},state:yr,currentVAO:null,targetVAO:null,restore:Pr()?$r:function(){},createVAO:Tn,getVAO:Xt,destroyBuffer:br,setVAO:Pr()?Er:Ur,clear:Pr()?fr:function(){}};function br(Qt){for(var rr=0;rr<yr.length;++rr){var En=yr[rr];En.buffer===Qt&&(B.disableVertexAttribArray(rr),En.buffer=null)}}function Pr(){return me.oes_vertex_array_object}function st(){return me.angle_instanced_arrays}function Xt(Qt){return typeof Qt=="function"&&Qt._vao?Qt._vao:null}function Er(Qt){if(Qt!==Fr.currentVAO){var rr=Pr();Qt?rr.bindVertexArrayOES(Qt.vao):rr.bindVertexArrayOES(null),Fr.currentVAO=Qt}}function Ur(Qt){if(Qt!==Fr.currentVAO){if(Qt)Qt.bindAttrs();else{for(var rr=st(),En=0;En<yr.length;++En){var Vr=yr[En];Vr.buffer?(B.enableVertexAttribArray(En),Vr.buffer.bind(),B.vertexAttribPointer(En,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),rr&&Vr.divisor&&rr.vertexAttribDivisorANGLE(En,Vr.divisor)):(B.disableVertexAttribArray(En),B.vertexAttrib4f(En,Vr.x,Vr.y,Vr.z,Vr.w))}tr.elements?B.bindBuffer(Ae,tr.elements.buffer.buffer):B.bindBuffer(Ae,null)}Fr.currentVAO=Qt}}function fr(){$(or).forEach(function(Qt){Qt.destroy()})}function Lr(){this.id=++Ir,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Qt=Pr();Qt?this.vao=Qt.createVertexArrayOES():this.vao=null,or[this.id]=this,this.buffers=[]}Lr.prototype.bindAttrs=function(){for(var Qt=st(),rr=this.attributes,En=0;En<rr.length;++En){var Vr=rr[En];Vr.buffer?(B.enableVertexAttribArray(En),B.bindBuffer(ke,Vr.buffer.buffer),B.vertexAttribPointer(En,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),Qt&&Vr.divisor&&Qt.vertexAttribDivisorANGLE(En,Vr.divisor)):(B.disableVertexAttribArray(En),B.vertexAttrib4f(En,Vr.x,Vr.y,Vr.z,Vr.w))}for(var Ar=rr.length;Ar<dr;++Ar)B.disableVertexAttribArray(Ar);var Wr=Lt.getElements(this.elements);Wr?B.bindBuffer(Ae,Wr.buffer.buffer):B.bindBuffer(Ae,null)},Lr.prototype.refresh=function(){var Qt=Pr();Qt&&(Qt.bindVertexArrayOES(this.vao),this.bindAttrs(),Fr.currentVAO=null,Qt.bindVertexArrayOES(null))},Lr.prototype.destroy=function(){if(this.vao){var Qt=Pr();this===Fr.currentVAO&&(Fr.currentVAO=null,Qt.bindVertexArrayOES(null)),Qt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),or[this.id]&&(delete or[this.id],Dt.vaoCount-=1)};function $r(){var Qt=Pr();Qt&&$(or).forEach(function(rr){rr.refresh()})}function Tn(Qt){var rr=new Lr;Dt.vaoCount+=1;function En(Vr){var Ar;if(Array.isArray(Vr))Ar=Vr,rr.elements&&rr.ownsElements&&rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1,rr.offset=0,rr.count=0,rr.instances=-1,rr.primitive=4;else{if(he(typeof Vr=="object","invalid arguments for create vao"),he("attributes"in Vr,"must specify attributes for vao"),Vr.elements){var Wr=Vr.elements;rr.ownsElements?typeof Wr=="function"&&Wr._reglType==="elements"?(rr.elements.destroy(),rr.ownsElements=!1):(rr.elements(Wr),rr.ownsElements=!1):Lt.getElements(Vr.elements)?(rr.elements=Vr.elements,rr.ownsElements=!1):(rr.elements=Lt.create(Vr.elements),rr.ownsElements=!0)}else rr.elements=null,rr.ownsElements=!1;Ar=Vr.attributes,rr.offset=0,rr.count=-1,rr.instances=-1,rr.primitive=4,rr.elements&&(rr.count=rr.elements._elements.vertCount,rr.primitive=rr.elements._elements.primType),"offset"in Vr&&(rr.offset=Vr.offset|0),"count"in Vr&&(rr.count=Vr.count|0),"instances"in Vr&&(rr.instances=Vr.instances|0),"primitive"in Vr&&(he(Vr.primitive in cr,"bad primitive type: "+Vr.primitive),rr.primitive=cr[Vr.primitive]),he.optional(function(){for(var po=Object.keys(Vr),ho=0;ho<po.length;++ho)he(je.indexOf(po[ho])>=0,'invalid option for vao: "'+po[ho]+'" valid options are '+je)}),he(Array.isArray(Ar),"attributes must be an array")}he(Ar.length<dr,"too many attributes"),he(Ar.length>0,"must specify at least one attribute");var Kr={},xi=rr.attributes;xi.length=Ar.length;for(var ni=0;ni<Ar.length;++ni){var Yr=Ar[ni],an=xi[ni]=new Je,$n=Yr.data||Yr;if(Array.isArray($n)||ye($n)||ks($n)){var pi;rr.buffers[ni]&&(pi=rr.buffers[ni],ye($n)&&pi._buffer.byteLength>=$n.byteLength?pi.subdata($n):(pi.destroy(),rr.buffers[ni]=null)),rr.buffers[ni]||(pi=rr.buffers[ni]=ur.create(Yr,ke,!1,!0)),an.buffer=ur.getBuffer(pi),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1,Kr[ni]=1}else ur.getBuffer(Yr)?(an.buffer=ur.getBuffer(Yr),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1):ur.getBuffer(Yr.buffer)?(an.buffer=ur.getBuffer(Yr.buffer),an.size=(+Yr.size||an.buffer.dimension)|0,an.normalized=!!Yr.normalized||!1,"type"in Yr?(he.parameter(Yr.type,su,"invalid buffer type"),an.type=su[Yr.type]):an.type=an.buffer.dtype,an.offset=(Yr.offset||0)|0,an.stride=(Yr.stride||0)|0,an.divisor=(Yr.divisor||0)|0,an.state=1,he(an.size>=1&&an.size<=4,"size must be between 1 and 4"),he(an.offset>=0,"invalid offset"),he(an.stride>=0&&an.stride<=255,"stride must be between 0 and 255"),he(an.divisor>=0,"divisor must be positive"),he(!an.divisor||!!me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Yr?(he(ni>0,"first attribute must not be a constant"),an.x=+Yr.x||0,an.y=+Yr.y||0,an.z=+Yr.z||0,an.w=+Yr.w||0,an.state=2):he(!1,"invalid attribute spec for location "+ni)}for(var Zi=0;Zi<rr.buffers.length;++Zi)!Kr[Zi]&&rr.buffers[Zi]&&(rr.buffers[Zi].destroy(),rr.buffers[Zi]=null);return rr.refresh(),En}return En.destroy=function(){for(var Vr=0;Vr<rr.buffers.length;++Vr)rr.buffers[Vr]&&rr.buffers[Vr].destroy();rr.buffers.length=0,rr.ownsElements&&(rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1),rr.destroy()},En._vao=rr,En._reglType="vao",En(Qt)}return Fr}var Wt=35632,Vt=35633,Pt=35718,pr=35721;function Or(B,me,ze,Dt){var ur={},Lt={};function tr(st,Xt,Er,Ur){this.name=st,this.id=Xt,this.location=Er,this.info=Ur}function dr(st,Xt){for(var Er=0;Er<st.length;++Er)if(st[Er].id===Xt.id){st[Er].location=Xt.location;return}st.push(Xt)}function yr(st,Xt,Er){var Ur=st===Wt?ur:Lt,fr=Ur[Xt];if(!fr){var Lr=me.str(Xt);fr=B.createShader(st),B.shaderSource(fr,Lr),B.compileShader(fr),he.shaderError(B,fr,Lr,st,Er),Ur[Xt]=fr}return fr}var _r={},Ir=[],or=0;function Fr(st,Xt){this.id=or++,this.fragId=st,this.vertId=Xt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Dt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function br(st,Xt,Er){var Ur,fr,Lr=yr(Wt,st.fragId),$r=yr(Vt,st.vertId),Tn=st.program=B.createProgram();if(B.attachShader(Tn,Lr),B.attachShader(Tn,$r),Er)for(Ur=0;Ur<Er.length;++Ur){var Qt=Er[Ur];B.bindAttribLocation(Tn,Qt[0],Qt[1])}B.linkProgram(Tn),he.linkError(B,Tn,me.str(st.fragId),me.str(st.vertId),Xt);var rr=B.getProgramParameter(Tn,Pt);Dt.profile&&(st.stats.uniformsCount=rr);var En=st.uniforms;for(Ur=0;Ur<rr;++Ur)if(fr=B.getActiveUniform(Tn,Ur),fr)if(fr.size>1)for(var Vr=0;Vr<fr.size;++Vr){var Ar=fr.name.replace("[0]","["+Vr+"]");dr(En,new tr(Ar,me.id(Ar),B.getUniformLocation(Tn,Ar),fr))}else dr(En,new tr(fr.name,me.id(fr.name),B.getUniformLocation(Tn,fr.name),fr));var Wr=B.getProgramParameter(Tn,pr);Dt.profile&&(st.stats.attributesCount=Wr);var Kr=st.attributes;for(Ur=0;Ur<Wr;++Ur)fr=B.getActiveAttrib(Tn,Ur),fr&&dr(Kr,new tr(fr.name,me.id(fr.name),B.getAttribLocation(Tn,fr.name),fr))}Dt.profile&&(ze.getMaxUniformsCount=function(){var st=0;return Ir.forEach(function(Xt){Xt.stats.uniformsCount>st&&(st=Xt.stats.uniformsCount)}),st},ze.getMaxAttributesCount=function(){var st=0;return Ir.forEach(function(Xt){Xt.stats.attributesCount>st&&(st=Xt.stats.attributesCount)}),st});function Pr(){ur={},Lt={};for(var st=0;st<Ir.length;++st)br(Ir[st],null,Ir[st].attributes.map(function(Xt){return[Xt.location,Xt.name]}))}return{clear:function(){var st=B.deleteShader.bind(B);$(ur).forEach(st),ur={},$(Lt).forEach(st),Lt={},Ir.forEach(function(Xt){B.deleteProgram(Xt.program)}),Ir.length=0,_r={},ze.shaderCount=0},program:function(st,Xt,Er,Ur){he.command(st>=0,"missing vertex shader",Er),he.command(Xt>=0,"missing fragment shader",Er);var fr=_r[Xt];fr||(fr=_r[Xt]={});var Lr=fr[st];if(Lr&&(Lr.refCount++,!Ur))return Lr;var $r=new Fr(Xt,st);return ze.shaderCount++,br($r,Er,Ur),Lr||(fr[st]=$r),Ir.push($r),v($r,{destroy:function(){if($r.refCount--,$r.refCount<=0){B.deleteProgram($r.program);var Tn=Ir.indexOf($r);Ir.splice(Tn,1),ze.shaderCount--}fr[$r.vertId].refCount<=0&&(B.deleteShader(Lt[$r.vertId]),delete Lt[$r.vertId],delete _r[$r.fragId][$r.vertId]),Object.keys(_r[$r.fragId]).length||(B.deleteShader(ur[$r.fragId]),delete ur[$r.fragId],delete _r[$r.fragId])}})},restore:Pr,shader:yr,frag:-1,vert:-1}}var Dr=6408,un=5121,Fn=3333,Nn=5126;function Un(B,me,ze,Dt,ur,Lt,tr){function dr(Ir){var or;me.next===null?(he(ur.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),or=un):(he(me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),or=me.next.colorAttachments[0].texture._texture.type,he.optional(function(){Lt.oes_texture_float?(he(or===un||or===Nn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),or===Nn&&he(tr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):he(or===un,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Fr=0,br=0,Pr=Dt.framebufferWidth,st=Dt.framebufferHeight,Xt=null;ye(Ir)?Xt=Ir:Ir&&(he.type(Ir,"object","invalid arguments to regl.read()"),Fr=Ir.x|0,br=Ir.y|0,he(Fr>=0&&Fr<Dt.framebufferWidth,"invalid x offset for regl.read"),he(br>=0&&br<Dt.framebufferHeight,"invalid y offset for regl.read"),Pr=(Ir.width||Dt.framebufferWidth-Fr)|0,st=(Ir.height||Dt.framebufferHeight-br)|0,Xt=Ir.data||null),Xt&&(or===un?he(Xt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):or===Nn&&he(Xt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),he(Pr>0&&Pr+Fr<=Dt.framebufferWidth,"invalid width for read pixels"),he(st>0&&st+br<=Dt.framebufferHeight,"invalid height for read pixels"),ze();var Er=Pr*st*4;return Xt||(or===un?Xt=new Uint8Array(Er):or===Nn&&(Xt=Xt||new Float32Array(Er))),he.isTypedArray(Xt,"data buffer for regl.read() must be a typedarray"),he(Xt.byteLength>=Er,"data buffer for regl.read() too small"),B.pixelStorei(Fn,4),B.readPixels(Fr,br,Pr,st,Dr,or,Xt),Xt}function yr(Ir){var or;return me.setFBO({framebuffer:Ir.framebuffer},function(){or=dr(Ir)}),or}function _r(Ir){return!Ir||!("framebuffer"in Ir)?dr(Ir):yr(Ir)}return _r}function Di(B){return Array.prototype.slice.call(B)}function nn(B){return Di(B).join("")}function ai(){var B=0,me=[],ze=[];function Dt(or){for(var Fr=0;Fr<ze.length;++Fr)if(ze[Fr]===or)return me[Fr];var br="g"+B++;return me.push(br),ze.push(or),br}function ur(){var or=[];function Fr(){or.push.apply(or,Di(arguments))}var br=[];function Pr(){var st="v"+B++;return br.push(st),arguments.length>0&&(or.push(st,"="),or.push.apply(or,Di(arguments)),or.push(";")),st}return v(Fr,{def:Pr,toString:function(){return nn([br.length>0?"var "+br.join(",")+";":"",nn(or)])}})}function Lt(){var or=ur(),Fr=ur(),br=or.toString,Pr=Fr.toString;function st(Xt,Er){Fr(Xt,Er,"=",or.def(Xt,Er),";")}return v(function(){or.apply(or,Di(arguments))},{def:or.def,entry:or,exit:Fr,save:st,set:function(Xt,Er,Ur){st(Xt,Er),or(Xt,Er,"=",Ur,";")},toString:function(){return br()+Pr()}})}function tr(){var or=nn(arguments),Fr=Lt(),br=Lt(),Pr=Fr.toString,st=br.toString;return v(Fr,{then:function(){return Fr.apply(Fr,Di(arguments)),this},else:function(){return br.apply(br,Di(arguments)),this},toString:function(){var Xt=st();return Xt&&(Xt="else{"+Xt+"}"),nn(["if(",or,"){",Pr(),"}",Xt])}})}var dr=ur(),yr={};function _r(or,Fr){var br=[];function Pr(){var fr="a"+br.length;return br.push(fr),fr}Fr=Fr||0;for(var st=0;st<Fr;++st)Pr();var Xt=Lt(),Er=Xt.toString,Ur=yr[or]=v(Xt,{arg:Pr,toString:function(){return nn(["function(",br.join(),"){",Er(),"}"])}});return Ur}function Ir(){var or=['"use strict";',dr,"return {"];Object.keys(yr).forEach(function(st){or.push('"',st,'":',yr[st].toString(),",")}),or.push("}");var Fr=nn(or).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),br=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Pr=br?le.Function.apply(null,me.concat(Fr)):Function.apply(null,me.concat(Fr));return Pr.apply(null,ze)}return{global:dr,link:Dt,block:ur,proc:_r,scope:Lt,cond:tr,compile:Ir}}var fi="xyzw".split(""),ei=5121,Gn=1,yi=2,Kn=0,Hn=1,Pa=2,ro=3,no=4,Wo=5,Va=6,io="dither",Rs="blend.enable",ys="blend.color",Fu="blend.equation",_s="blend.func",ka="depth.enable",Ia="depth.func",el="depth.range",yl="depth.mask",Ls="colorMask",ac="cull.enable",Fc="cull.face",Su="frontFace",oc="lineWidth",fu="polygonOffset.enable",Oa="polygonOffset.offset",tl="sample.alpha",_l="sample.enable",xl="sample.coverage",Xi="stencil.enable",As="stencil.mask",Xo="stencil.func",Bu="stencil.opFront",sc="stencil.opBack",bl="scissor.enable",Fl="scissor.box",Vs="viewport",Bl="profile",Gs="framebuffer",rl="vert",Bc="frag",pu="elements",Ga="primitive",uc="count",Bf="offset",yp="instances",Nf="vao",Jp="Width",eh="Height",lc=Gs+Jp,cc=Gs+eh,hu=Vs+Jp,Bh=Vs+eh,Nl="drawingBuffer",Nc=Nl+Jp,th=Nl+eh,Nh=[_s,Fu,Xo,Bu,sc,xl,Vs,Fl,Oa],zc=34962,rh=34963,Ed=35632,Sd=35633,nh=3553,ih=34067,Cd=2884,ff=3042,zh=3024,_o=2960,_p=2929,Uh=3089,xp=32823,bp=32926,zf=32928,Uf=5126,Zf=35664,zl=35665,fc=35666,jf=5124,Ep=35667,pc=35668,Sp=35669,Vf=35670,Cp=35671,nl=35672,pf=35673,tu=35674,Gf=35675,Hf=35676,hf=35678,df=35680,Ap=4,El=1028,hc=1029,ah=2304,wp=2305,Zh=32775,Ad=32776,wd=519,du=7680,Td=0,jr=1,vf=32774,Ut=513,jh=36160,Md=36064,il={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Uc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],dc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},vc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},oh={frag:Ed,vert:Sd},Zc={cw:ah,ccw:wp};function Tp(B){return Array.isArray(B)||ye(B)||ks(B)}function sh(B){return B.sort(function(me,ze){return me===Vs?-1:ze===Vs?1:me<ze?-1:1})}function va(B,me,ze,Dt){this.thisDep=B,this.contextDep=me,this.propDep=ze,this.append=Dt}function Ul(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Io(B){return new va(!1,!1,!1,B)}function Hs(B,me){var ze=B.type;if(ze===Kn){var Dt=B.data.length;return new va(!0,Dt>=1,Dt>=2,me)}else if(ze===no){var ur=B.data;return new va(ur.thisDep,ur.contextDep,ur.propDep,me)}else{if(ze===Wo)return new va(!1,!1,!1,me);if(ze===Va){for(var Lt=!1,tr=!1,dr=!1,yr=0;yr<B.data.length;++yr){var _r=B.data[yr];if(_r.type===Hn)dr=!0;else if(_r.type===Pa)tr=!0;else if(_r.type===ro)Lt=!0;else if(_r.type===Kn){Lt=!0;var Ir=_r.data;Ir>=1&&(tr=!0),Ir>=2&&(dr=!0)}else _r.type===no&&(Lt=Lt||_r.data.thisDep,tr=tr||_r.data.contextDep,dr=dr||_r.data.propDep)}return new va(Lt,tr,dr,me)}else return new va(ze===ro,ze===Pa,ze===Hn,me)}}var uh=new va(!1,!1,!1,function(){});function Vh(B,me,ze,Dt,ur,Lt,tr,dr,yr,_r,Ir,or,Fr,br,Pr){var st=_r.Record,Xt={add:32774,subtract:32778,"reverse subtract":32779};ze.ext_blend_minmax&&(Xt.min=Zh,Xt.max=Ad);var Er=ze.angle_instanced_arrays,Ur=ze.webgl_draw_buffers,fr=ze.oes_vertex_array_object,Lr={dirty:!0,profile:Pr.profile},$r={},Tn=[],Qt={},rr={};function En(Ee){return Ee.replace(".","_")}function Vr(Ee,ne,Ve){var pt=En(Ee);Tn.push(Ee),$r[pt]=Lr[pt]=!!Ve,Qt[pt]=ne}function Ar(Ee,ne,Ve){var pt=En(Ee);Tn.push(Ee),Array.isArray(Ve)?(Lr[pt]=Ve.slice(),$r[pt]=Ve.slice()):Lr[pt]=$r[pt]=Ve,rr[pt]=ne}Vr(io,zh),Vr(Rs,ff),Ar(ys,"blendColor",[0,0,0,0]),Ar(Fu,"blendEquationSeparate",[vf,vf]),Ar(_s,"blendFuncSeparate",[jr,Td,jr,Td]),Vr(ka,_p,!0),Ar(Ia,"depthFunc",Ut),Ar(el,"depthRange",[0,1]),Ar(yl,"depthMask",!0),Ar(Ls,Ls,[!0,!0,!0,!0]),Vr(ac,Cd),Ar(Fc,"cullFace",hc),Ar(Su,Su,wp),Ar(oc,oc,1),Vr(fu,xp),Ar(Oa,"polygonOffset",[0,0]),Vr(tl,bp),Vr(_l,zf),Ar(xl,"sampleCoverage",[1,!1]),Vr(Xi,_o),Ar(As,"stencilMask",-1),Ar(Xo,"stencilFunc",[wd,0,-1]),Ar(Bu,"stencilOpSeparate",[El,du,du,du]),Ar(sc,"stencilOpSeparate",[hc,du,du,du]),Vr(bl,Uh),Ar(Fl,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Ar(Vs,Vs,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Wr={gl:B,context:Fr,strings:me,next:$r,current:Lr,draw:or,elements:Lt,buffer:ur,shader:Ir,attributes:_r.state,vao:_r,uniforms:yr,framebuffer:dr,extensions:ze,timer:br,isBufferArgs:Tp},Kr={primTypes:cr,compareFuncs:dc,blendFuncs:il,blendEquations:Xt,stencilOps:vc,glTypes:su,orientationType:Zc};he.optional(function(){Wr.isArrayLike=pa}),Ur&&(Kr.backBuffer=[hc],Kr.drawBuffer=Ge(Dt.maxDrawbuffers,function(Ee){return Ee===0?[0]:Ge(Ee,function(ne){return Md+ne})}));var xi=0;function ni(){var Ee=ai(),ne=Ee.link,Ve=Ee.global;Ee.id=xi++,Ee.batchId="0";var pt=ne(Wr),It=Ee.shared={props:"a0"};Object.keys(Wr).forEach(function(Ze){It[Ze]=Ve.def(pt,".",Ze)}),he.optional(function(){Ee.CHECK=ne(he),Ee.commandStr=he.guessCommand(),Ee.command=ne(Ee.commandStr),Ee.assert=function(Ze,Ce,ft){Ze("if(!(",Ce,"))",this.CHECK,".commandRaise(",ne(ft),",",this.command,");")},Kr.invalidBlendCombinations=Uc});var qe=Ee.next={},Be=Ee.current={};Object.keys(rr).forEach(function(Ze){Array.isArray(Lr[Ze])&&(qe[Ze]=Ve.def(It.next,".",Ze),Be[Ze]=Ve.def(It.current,".",Ze))});var nt=Ee.constants={};Object.keys(Kr).forEach(function(Ze){nt[Ze]=Ve.def(JSON.stringify(Kr[Ze]))}),Ee.invoke=function(Ze,Ce){switch(Ce.type){case Kn:var ft=["this",It.context,It.props,Ee.batchId];return Ze.def(ne(Ce.data),".call(",ft.slice(0,Math.max(Ce.data.length+1,4)),")");case Hn:return Ze.def(It.props,Ce.data);case Pa:return Ze.def(It.context,Ce.data);case ro:return Ze.def("this",Ce.data);case no:return Ce.data.append(Ee,Ze),Ce.data.ref;case Wo:return Ce.data.toString();case Va:return Ce.data.map(function(Et){return Ee.invoke(Ze,Et)})}},Ee.attribCache={};var _e={};return Ee.scopeAttrib=function(Ze){var Ce=me.id(Ze);if(Ce in _e)return _e[Ce];var ft=_r.scope[Ce];ft||(ft=_r.scope[Ce]=new st);var Et=_e[Ce]=ne(ft);return Et},Ee}function Yr(Ee){var ne=Ee.static,Ve=Ee.dynamic,pt;if(Bl in ne){var It=!!ne[Bl];pt=Io(function(Be,nt){return It}),pt.enable=It}else if(Bl in Ve){var qe=Ve[Bl];pt=Hs(qe,function(Be,nt){return Be.invoke(nt,qe)})}return pt}function an(Ee,ne){var Ve=Ee.static,pt=Ee.dynamic;if(Gs in Ve){var It=Ve[Gs];return It?(It=dr.getFramebuffer(It),he.command(It,"invalid framebuffer object"),Io(function(Be,nt){var _e=Be.link(It),Ze=Be.shared;nt.set(Ze.framebuffer,".next",_e);var Ce=Ze.context;return nt.set(Ce,"."+lc,_e+".width"),nt.set(Ce,"."+cc,_e+".height"),_e})):Io(function(Be,nt){var _e=Be.shared;nt.set(_e.framebuffer,".next","null");var Ze=_e.context;return nt.set(Ze,"."+lc,Ze+"."+Nc),nt.set(Ze,"."+cc,Ze+"."+th),"null"})}else if(Gs in pt){var qe=pt[Gs];return Hs(qe,function(Be,nt){var _e=Be.invoke(nt,qe),Ze=Be.shared,Ce=Ze.framebuffer,ft=nt.def(Ce,".getFramebuffer(",_e,")");he.optional(function(){Be.assert(nt,"!"+_e+"||"+ft,"invalid framebuffer object")}),nt.set(Ce,".next",ft);var Et=Ze.context;return nt.set(Et,"."+lc,ft+"?"+ft+".width:"+Et+"."+Nc),nt.set(Et,"."+cc,ft+"?"+ft+".height:"+Et+"."+th),ft})}else return null}function $n(Ee,ne,Ve){var pt=Ee.static,It=Ee.dynamic;function qe(_e){if(_e in pt){var Ze=pt[_e];he.commandType(Ze,"object","invalid "+_e,Ve.commandStr);var Ce=!0,ft=Ze.x|0,Et=Ze.y|0,hr,zr;return"width"in Ze?(hr=Ze.width|0,he.command(hr>=0,"invalid "+_e,Ve.commandStr)):Ce=!1,"height"in Ze?(zr=Ze.height|0,he.command(zr>=0,"invalid "+_e,Ve.commandStr)):Ce=!1,new va(!Ce&&ne&&ne.thisDep,!Ce&&ne&&ne.contextDep,!Ce&&ne&&ne.propDep,function(Br,Cn){var fn=Br.shared.context,xn=hr;"width"in Ze||(xn=Cn.def(fn,".",lc,"-",ft));var yn=zr;return"height"in Ze||(yn=Cn.def(fn,".",cc,"-",Et)),[ft,Et,xn,yn]})}else if(_e in It){var Zr=It[_e],tn=Hs(Zr,function(Br,Cn){var fn=Br.invoke(Cn,Zr);he.optional(function(){Br.assert(Cn,fn+"&&typeof "+fn+'==="object"',"invalid "+_e)});var xn=Br.shared.context,yn=Cn.def(fn,".x|0"),mn=Cn.def(fn,".y|0"),Wn=Cn.def('"width" in ',fn,"?",fn,".width|0:","(",xn,".",lc,"-",yn,")"),Ca=Cn.def('"height" in ',fn,"?",fn,".height|0:","(",xn,".",cc,"-",mn,")");return he.optional(function(){Br.assert(Cn,Wn+">=0&&"+Ca+">=0","invalid "+_e)}),[yn,mn,Wn,Ca]});return ne&&(tn.thisDep=tn.thisDep||ne.thisDep,tn.contextDep=tn.contextDep||ne.contextDep,tn.propDep=tn.propDep||ne.propDep),tn}else return ne?new va(ne.thisDep,ne.contextDep,ne.propDep,function(Br,Cn){var fn=Br.shared.context;return[0,0,Cn.def(fn,".",lc),Cn.def(fn,".",cc)]}):null}var Be=qe(Vs);if(Be){var nt=Be;Be=new va(Be.thisDep,Be.contextDep,Be.propDep,function(_e,Ze){var Ce=nt.append(_e,Ze),ft=_e.shared.context;return Ze.set(ft,"."+hu,Ce[2]),Ze.set(ft,"."+Bh,Ce[3]),Ce})}return{viewport:Be,scissor_box:qe(Fl)}}function pi(Ee,ne){var Ve=Ee.static,pt=typeof Ve[Bc]=="string"&&typeof Ve[rl]=="string";if(pt){if(Object.keys(ne.dynamic).length>0)return null;var It=ne.static,qe=Object.keys(It);if(qe.length>0&&typeof It[qe[0]]=="number"){for(var Be=[],nt=0;nt<qe.length;++nt)he(typeof It[qe[nt]]=="number","must specify all vertex attribute locations when using vaos"),Be.push([It[qe[nt]]|0,qe[nt]]);return Be}}return null}function Zi(Ee,ne,Ve){var pt=Ee.static,It=Ee.dynamic;function qe(Ce){if(Ce in pt){var ft=me.id(pt[Ce]);he.optional(function(){Ir.shader(oh[Ce],ft,he.guessCommand())});var Et=Io(function(){return ft});return Et.id=ft,Et}else if(Ce in It){var hr=It[Ce];return Hs(hr,function(zr,Zr){var tn=zr.invoke(Zr,hr),Br=Zr.def(zr.shared.strings,".id(",tn,")");return he.optional(function(){Zr(zr.shared.shader,".shader(",oh[Ce],",",Br,",",zr.command,");")}),Br})}return null}var Be=qe(Bc),nt=qe(rl),_e=null,Ze;return Ul(Be)&&Ul(nt)?(_e=Ir.program(nt.id,Be.id,null,Ve),Ze=Io(function(Ce,ft){return Ce.link(_e)})):Ze=new va(Be&&Be.thisDep||nt&&nt.thisDep,Be&&Be.contextDep||nt&&nt.contextDep,Be&&Be.propDep||nt&&nt.propDep,function(Ce,ft){var Et=Ce.shared.shader,hr;Be?hr=Be.append(Ce,ft):hr=ft.def(Et,".",Bc);var zr;nt?zr=nt.append(Ce,ft):zr=ft.def(Et,".",rl);var Zr=Et+".program("+zr+","+hr;return he.optional(function(){Zr+=","+Ce.command}),ft.def(Zr+")")}),{frag:Be,vert:nt,progVar:Ze,program:_e}}function po(Ee,ne){var Ve=Ee.static,pt=Ee.dynamic,It={},qe=!1;function Be(){if(Nf in Ve){var Cn=Ve[Nf];return Cn!==null&&_r.getVAO(Cn)===null&&(Cn=_r.createVAO(Cn)),qe=!0,It.vao=Cn,Io(function(xn){var yn=_r.getVAO(Cn);return yn?xn.link(yn):"null"})}else if(Nf in pt){qe=!0;var fn=pt[Nf];return Hs(fn,function(xn,yn){var mn=xn.invoke(yn,fn);return yn.def(xn.shared.vao+".getVAO("+mn+")")})}return null}var nt=Be(),_e=!1;function Ze(){if(pu in Ve){var Cn=Ve[pu];if(It.elements=Cn,Tp(Cn)){var fn=It.elements=Lt.create(Cn,!0);Cn=Lt.getElements(fn),_e=!0}else Cn&&(Cn=Lt.getElements(Cn),_e=!0,he.command(Cn,"invalid elements",ne.commandStr));var xn=Io(function(mn,Wn){if(Cn){var Ca=mn.link(Cn);return mn.ELEMENTS=Ca,Ca}return mn.ELEMENTS=null,null});return xn.value=Cn,xn}else if(pu in pt){_e=!0;var yn=pt[pu];return Hs(yn,function(mn,Wn){var Ca=mn.shared,us=Ca.isBufferArgs,Ha=Ca.elements,Sn=mn.invoke(Wn,yn),oi=Wn.def("null"),ws=Wn.def(us,"(",Sn,")"),Cl=mn.cond(ws).then(oi,"=",Ha,".createStream(",Sn,");").else(oi,"=",Ha,".getElements(",Sn,");");return he.optional(function(){mn.assert(Cl.else,"!"+Sn+"||"+oi,"invalid elements")}),Wn.entry(Cl),Wn.exit(mn.cond(ws).then(Ha,".destroyStream(",oi,");")),mn.ELEMENTS=oi,oi})}else if(qe)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(mn,Wn){return Wn.def(mn.shared.vao+".currentVAO?"+mn.shared.elements+".getElements("+mn.shared.vao+".currentVAO.elements):null")});return null}var Ce=Ze();function ft(){if(Ga in Ve){var Cn=Ve[Ga];return It.primitive=Cn,he.commandParameter(Cn,cr,"invalid primitve",ne.commandStr),Io(function(xn,yn){return cr[Cn]})}else if(Ga in pt){var fn=pt[Ga];return Hs(fn,function(xn,yn){var mn=xn.constants.primTypes,Wn=xn.invoke(yn,fn);return he.optional(function(){xn.assert(yn,Wn+" in "+mn,"invalid primitive, must be one of "+Object.keys(cr))}),yn.def(mn,"[",Wn,"]")})}else{if(_e)return Ul(Ce)?Ce.value?Io(function(xn,yn){return yn.def(xn.ELEMENTS,".primType")}):Io(function(){return Ap}):new va(Ce.thisDep,Ce.contextDep,Ce.propDep,function(xn,yn){var mn=xn.ELEMENTS;return yn.def(mn,"?",mn,".primType:",Ap)});if(qe)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(xn,yn){return yn.def(xn.shared.vao+".currentVAO?"+xn.shared.vao+".currentVAO.primitive:"+Ap)})}return null}function Et(Cn,fn){if(Cn in Ve){var xn=Ve[Cn]|0;return fn?It.offset=xn:It.instances=xn,he.command(!fn||xn>=0,"invalid "+Cn,ne.commandStr),Io(function(mn,Wn){return fn&&(mn.OFFSET=xn),xn})}else if(Cn in pt){var yn=pt[Cn];return Hs(yn,function(mn,Wn){var Ca=mn.invoke(Wn,yn);return fn&&(mn.OFFSET=Ca,he.optional(function(){mn.assert(Wn,Ca+">=0","invalid "+Cn)})),Ca})}else if(fn){if(_e)return Io(function(mn,Wn){return mn.OFFSET=0,0});if(qe)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(mn,Wn){return Wn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.offset:0")})}else if(qe)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(mn,Wn){return Wn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.instances:-1")});return null}var hr=Et(Bf,!0);function zr(){if(uc in Ve){var Cn=Ve[uc]|0;return It.count=Cn,he.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",ne.commandStr),Io(function(){return Cn})}else if(uc in pt){var fn=pt[uc];return Hs(fn,function(Wn,Ca){var us=Wn.invoke(Ca,fn);return he.optional(function(){Wn.assert(Ca,"typeof "+us+'==="number"&&'+us+">=0&&"+us+"===("+us+"|0)","invalid vertex count")}),us})}else if(_e)if(Ul(Ce)){if(Ce)return hr?new va(hr.thisDep,hr.contextDep,hr.propDep,function(Wn,Ca){var us=Ca.def(Wn.ELEMENTS,".vertCount-",Wn.OFFSET);return he.optional(function(){Wn.assert(Ca,us+">=0","invalid vertex offset/element buffer too small")}),us}):Io(function(Wn,Ca){return Ca.def(Wn.ELEMENTS,".vertCount")});var xn=Io(function(){return-1});return he.optional(function(){xn.MISSING=!0}),xn}else{var yn=new va(Ce.thisDep||hr.thisDep,Ce.contextDep||hr.contextDep,Ce.propDep||hr.propDep,function(Wn,Ca){var us=Wn.ELEMENTS;return Wn.OFFSET?Ca.def(us,"?",us,".vertCount-",Wn.OFFSET,":-1"):Ca.def(us,"?",us,".vertCount:-1")});return he.optional(function(){yn.DYNAMIC=!0}),yn}else if(qe){var mn=new va(nt.thisDep,nt.contextDep,nt.propDep,function(Wn,Ca){return Ca.def(Wn.shared.vao,".currentVAO?",Wn.shared.vao,".currentVAO.count:-1")});return mn}return null}var Zr=ft(),tn=zr(),Br=Et(yp,!1);return{elements:Ce,primitive:Zr,count:tn,instances:Br,offset:hr,vao:nt,vaoActive:qe,elementsActive:_e,static:It}}function ho(Ee,ne){var Ve=Ee.static,pt=Ee.dynamic,It={};return Tn.forEach(function(qe){var Be=En(qe);function nt(_e,Ze){if(qe in Ve){var Ce=_e(Ve[qe]);It[Be]=Io(function(){return Ce})}else if(qe in pt){var ft=pt[qe];It[Be]=Hs(ft,function(Et,hr){return Ze(Et,hr,Et.invoke(hr,ft))})}}switch(qe){case ac:case Rs:case io:case Xi:case ka:case bl:case fu:case tl:case _l:case yl:return nt(function(_e){return he.commandType(_e,"boolean",qe,ne.commandStr),_e},function(_e,Ze,Ce){return he.optional(function(){_e.assert(Ze,"typeof "+Ce+'==="boolean"',"invalid flag "+qe,_e.commandStr)}),Ce});case Ia:return nt(function(_e){return he.commandParameter(_e,dc,"invalid "+qe,ne.commandStr),dc[_e]},function(_e,Ze,Ce){var ft=_e.constants.compareFuncs;return he.optional(function(){_e.assert(Ze,Ce+" in "+ft,"invalid "+qe+", must be one of "+Object.keys(dc))}),Ze.def(ft,"[",Ce,"]")});case el:return nt(function(_e){return he.command(pa(_e)&&_e.length===2&&typeof _e[0]=="number"&&typeof _e[1]=="number"&&_e[0]<=_e[1],"depth range is 2d array",ne.commandStr),_e},function(_e,Ze,Ce){he.optional(function(){_e.assert(Ze,_e.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===2&&typeof "+Ce+'[0]==="number"&&typeof '+Ce+'[1]==="number"&&'+Ce+"[0]<="+Ce+"[1]","depth range must be a 2d array")});var ft=Ze.def("+",Ce,"[0]"),Et=Ze.def("+",Ce,"[1]");return[ft,Et]});case _s:return nt(function(_e){he.commandType(_e,"object","blend.func",ne.commandStr);var Ze="srcRGB"in _e?_e.srcRGB:_e.src,Ce="srcAlpha"in _e?_e.srcAlpha:_e.src,ft="dstRGB"in _e?_e.dstRGB:_e.dst,Et="dstAlpha"in _e?_e.dstAlpha:_e.dst;return he.commandParameter(Ze,il,Be+".srcRGB",ne.commandStr),he.commandParameter(Ce,il,Be+".srcAlpha",ne.commandStr),he.commandParameter(ft,il,Be+".dstRGB",ne.commandStr),he.commandParameter(Et,il,Be+".dstAlpha",ne.commandStr),he.command(Uc.indexOf(Ze+", "+ft)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+ft+")",ne.commandStr),[il[Ze],il[ft],il[Ce],il[Et]]},function(_e,Ze,Ce){var ft=_e.constants.blendFuncs;he.optional(function(){_e.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid blend func, must be an object")});function Et(fn,xn){var yn=Ze.def('"',fn,xn,'" in ',Ce,"?",Ce,".",fn,xn,":",Ce,".",fn);return he.optional(function(){_e.assert(Ze,yn+" in "+ft,"invalid "+qe+"."+fn+xn+", must be one of "+Object.keys(il))}),yn}var hr=Et("src","RGB"),zr=Et("dst","RGB");he.optional(function(){var fn=_e.constants.invalidBlendCombinations;_e.assert(Ze,fn+".indexOf("+hr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Zr=Ze.def(ft,"[",hr,"]"),tn=Ze.def(ft,"[",Et("src","Alpha"),"]"),Br=Ze.def(ft,"[",zr,"]"),Cn=Ze.def(ft,"[",Et("dst","Alpha"),"]");return[Zr,Br,tn,Cn]});case Fu:return nt(function(_e){if(typeof _e=="string")return he.commandParameter(_e,Xt,"invalid "+qe,ne.commandStr),[Xt[_e],Xt[_e]];if(typeof _e=="object")return he.commandParameter(_e.rgb,Xt,qe+".rgb",ne.commandStr),he.commandParameter(_e.alpha,Xt,qe+".alpha",ne.commandStr),[Xt[_e.rgb],Xt[_e.alpha]];he.commandRaise("invalid blend.equation",ne.commandStr)},function(_e,Ze,Ce){var ft=_e.constants.blendEquations,Et=Ze.def(),hr=Ze.def(),zr=_e.cond("typeof ",Ce,'==="string"');return he.optional(function(){function Zr(tn,Br,Cn){_e.assert(tn,Cn+" in "+ft,"invalid "+Br+", must be one of "+Object.keys(Xt))}Zr(zr.then,qe,Ce),_e.assert(zr.else,Ce+"&&typeof "+Ce+'==="object"',"invalid "+qe),Zr(zr.else,qe+".rgb",Ce+".rgb"),Zr(zr.else,qe+".alpha",Ce+".alpha")}),zr.then(Et,"=",hr,"=",ft,"[",Ce,"];"),zr.else(Et,"=",ft,"[",Ce,".rgb];",hr,"=",ft,"[",Ce,".alpha];"),Ze(zr),[Et,hr]});case ys:return nt(function(_e){return he.command(pa(_e)&&_e.length===4,"blend.color must be a 4d array",ne.commandStr),Ge(4,function(Ze){return+_e[Ze]})},function(_e,Ze,Ce){return he.optional(function(){_e.assert(Ze,_e.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","blend.color must be a 4d array")}),Ge(4,function(ft){return Ze.def("+",Ce,"[",ft,"]")})});case As:return nt(function(_e){return he.commandType(_e,"number",Be,ne.commandStr),_e|0},function(_e,Ze,Ce){return he.optional(function(){_e.assert(Ze,"typeof "+Ce+'==="number"',"invalid stencil.mask")}),Ze.def(Ce,"|0")});case Xo:return nt(function(_e){he.commandType(_e,"object",Be,ne.commandStr);var Ze=_e.cmp||"keep",Ce=_e.ref||0,ft="mask"in _e?_e.mask:-1;return he.commandParameter(Ze,dc,qe+".cmp",ne.commandStr),he.commandType(Ce,"number",qe+".ref",ne.commandStr),he.commandType(ft,"number",qe+".mask",ne.commandStr),[dc[Ze],Ce,ft]},function(_e,Ze,Ce){var ft=_e.constants.compareFuncs;he.optional(function(){function Zr(){_e.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Zr(Ce+"&&typeof ",Ce,'==="object"'),Zr('!("cmp" in ',Ce,")||(",Ce,".cmp in ",ft,")")});var Et=Ze.def('"cmp" in ',Ce,"?",ft,"[",Ce,".cmp]",":",du),hr=Ze.def(Ce,".ref|0"),zr=Ze.def('"mask" in ',Ce,"?",Ce,".mask|0:-1");return[Et,hr,zr]});case Bu:case sc:return nt(function(_e){he.commandType(_e,"object",Be,ne.commandStr);var Ze=_e.fail||"keep",Ce=_e.zfail||"keep",ft=_e.zpass||"keep";return he.commandParameter(Ze,vc,qe+".fail",ne.commandStr),he.commandParameter(Ce,vc,qe+".zfail",ne.commandStr),he.commandParameter(ft,vc,qe+".zpass",ne.commandStr),[qe===sc?hc:El,vc[Ze],vc[Ce],vc[ft]]},function(_e,Ze,Ce){var ft=_e.constants.stencilOps;he.optional(function(){_e.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid "+qe)});function Et(hr){return he.optional(function(){_e.assert(Ze,'!("'+hr+'" in '+Ce+")||("+Ce+"."+hr+" in "+ft+")","invalid "+qe+"."+hr+", must be one of "+Object.keys(vc))}),Ze.def('"',hr,'" in ',Ce,"?",ft,"[",Ce,".",hr,"]:",du)}return[qe===sc?hc:El,Et("fail"),Et("zfail"),Et("zpass")]});case Oa:return nt(function(_e){he.commandType(_e,"object",Be,ne.commandStr);var Ze=_e.factor|0,Ce=_e.units|0;return he.commandType(Ze,"number",Be+".factor",ne.commandStr),he.commandType(Ce,"number",Be+".units",ne.commandStr),[Ze,Ce]},function(_e,Ze,Ce){he.optional(function(){_e.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid "+qe)});var ft=Ze.def(Ce,".factor|0"),Et=Ze.def(Ce,".units|0");return[ft,Et]});case Fc:return nt(function(_e){var Ze=0;return _e==="front"?Ze=El:_e==="back"&&(Ze=hc),he.command(!!Ze,Be,ne.commandStr),Ze},function(_e,Ze,Ce){return he.optional(function(){_e.assert(Ze,Ce+'==="front"||'+Ce+'==="back"',"invalid cull.face")}),Ze.def(Ce,'==="front"?',El,":",hc)});case oc:return nt(function(_e){return he.command(typeof _e=="number"&&_e>=Dt.lineWidthDims[0]&&_e<=Dt.lineWidthDims[1],"invalid line width, must be a positive number between "+Dt.lineWidthDims[0]+" and "+Dt.lineWidthDims[1],ne.commandStr),_e},function(_e,Ze,Ce){return he.optional(function(){_e.assert(Ze,"typeof "+Ce+'==="number"&&'+Ce+">="+Dt.lineWidthDims[0]+"&&"+Ce+"<="+Dt.lineWidthDims[1],"invalid line width")}),Ce});case Su:return nt(function(_e){return he.commandParameter(_e,Zc,Be,ne.commandStr),Zc[_e]},function(_e,Ze,Ce){return he.optional(function(){_e.assert(Ze,Ce+'==="cw"||'+Ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Ce+'==="cw"?'+ah+":"+wp)});case Ls:return nt(function(_e){return he.command(pa(_e)&&_e.length===4,"color.mask must be length 4 array",ne.commandStr),_e.map(function(Ze){return!!Ze})},function(_e,Ze,Ce){return he.optional(function(){_e.assert(Ze,_e.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","invalid color.mask")}),Ge(4,function(ft){return"!!"+Ce+"["+ft+"]"})});case xl:return nt(function(_e){he.command(typeof _e=="object"&&_e,Be,ne.commandStr);var Ze="value"in _e?_e.value:1,Ce=!!_e.invert;return he.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ne.commandStr),[Ze,Ce]},function(_e,Ze,Ce){he.optional(function(){_e.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid sample.coverage")});var ft=Ze.def('"value" in ',Ce,"?+",Ce,".value:1"),Et=Ze.def("!!",Ce,".invert");return[ft,Et]})}}),It}function Ni(Ee,ne){var Ve=Ee.static,pt=Ee.dynamic,It={};return Object.keys(Ve).forEach(function(qe){var Be=Ve[qe],nt;if(typeof Be=="number"||typeof Be=="boolean")nt=Io(function(){return Be});else if(typeof Be=="function"){var _e=Be._reglType;_e==="texture2d"||_e==="textureCube"?nt=Io(function(Ze){return Ze.link(Be)}):_e==="framebuffer"||_e==="framebufferCube"?(he.command(Be.color.length>0,'missing color attachment for framebuffer sent to uniform "'+qe+'"',ne.commandStr),nt=Io(function(Ze){return Ze.link(Be.color[0])})):he.commandRaise('invalid data for uniform "'+qe+'"',ne.commandStr)}else pa(Be)?nt=Io(function(Ze){var Ce=Ze.global.def("[",Ge(Be.length,function(ft){return he.command(typeof Be[ft]=="number"||typeof Be[ft]=="boolean","invalid uniform "+qe,Ze.commandStr),Be[ft]}),"]");return Ce}):he.commandRaise('invalid or missing data for uniform "'+qe+'"',ne.commandStr);nt.value=Be,It[qe]=nt}),Object.keys(pt).forEach(function(qe){var Be=pt[qe];It[qe]=Hs(Be,function(nt,_e){return nt.invoke(_e,Be)})}),It}function os(Ee,ne){var Ve=Ee.static,pt=Ee.dynamic,It={};return Object.keys(Ve).forEach(function(qe){var Be=Ve[qe],nt=me.id(qe),_e=new st;if(Tp(Be))_e.state=Gn,_e.buffer=ur.getBuffer(ur.create(Be,zc,!1,!0)),_e.type=0;else{var Ze=ur.getBuffer(Be);if(Ze)_e.state=Gn,_e.buffer=Ze,_e.type=0;else if(he.command(typeof Be=="object"&&Be,"invalid data for attribute "+qe,ne.commandStr),"constant"in Be){var Ce=Be.constant;_e.buffer="null",_e.state=yi,typeof Ce=="number"?_e.x=Ce:(he.command(pa(Ce)&&Ce.length>0&&Ce.length<=4,"invalid constant for attribute "+qe,ne.commandStr),fi.forEach(function(Br,Cn){Cn<Ce.length&&(_e[Br]=Ce[Cn])}))}else{Tp(Be.buffer)?Ze=ur.getBuffer(ur.create(Be.buffer,zc,!1,!0)):Ze=ur.getBuffer(Be.buffer),he.command(!!Ze,'missing buffer for attribute "'+qe+'"',ne.commandStr);var ft=Be.offset|0;he.command(ft>=0,'invalid offset for attribute "'+qe+'"',ne.commandStr);var Et=Be.stride|0;he.command(Et>=0&&Et<256,'invalid stride for attribute "'+qe+'", must be integer betweeen [0, 255]',ne.commandStr);var hr=Be.size|0;he.command(!("size"in Be)||hr>0&&hr<=4,'invalid size for attribute "'+qe+'", must be 1,2,3,4',ne.commandStr);var zr=!!Be.normalized,Zr=0;"type"in Be&&(he.commandParameter(Be.type,su,"invalid type for attribute "+qe,ne.commandStr),Zr=su[Be.type]);var tn=Be.divisor|0;he.optional(function(){"divisor"in Be&&(he.command(tn===0||Er,'cannot specify divisor for attribute "'+qe+'", instancing not supported',ne.commandStr),he.command(tn>=0,'invalid divisor for attribute "'+qe+'"',ne.commandStr));var Br=ne.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Be).forEach(function(fn){he.command(Cn.indexOf(fn)>=0,'unknown parameter "'+fn+'" for attribute pointer "'+qe+'" (valid parameters are '+Cn+")",Br)})}),_e.buffer=Ze,_e.state=Gn,_e.size=hr,_e.normalized=zr,_e.type=Zr||Ze.dtype,_e.offset=ft,_e.stride=Et,_e.divisor=tn}}It[qe]=Io(function(Br,Cn){var fn=Br.attribCache;if(nt in fn)return fn[nt];var xn={isStream:!1};return Object.keys(_e).forEach(function(yn){xn[yn]=_e[yn]}),_e.buffer&&(xn.buffer=Br.link(_e.buffer),xn.type=xn.type||xn.buffer+".dtype"),fn[nt]=xn,xn})}),Object.keys(pt).forEach(function(qe){var Be=pt[qe];function nt(_e,Ze){var Ce=_e.invoke(Ze,Be),ft=_e.shared,Et=_e.constants,hr=ft.isBufferArgs,zr=ft.buffer;he.optional(function(){_e.assert(Ze,Ce+"&&(typeof "+Ce+'==="object"||typeof '+Ce+'==="function")&&('+hr+"("+Ce+")||"+zr+".getBuffer("+Ce+")||"+zr+".getBuffer("+Ce+".buffer)||"+hr+"("+Ce+'.buffer)||("constant" in '+Ce+"&&(typeof "+Ce+'.constant==="number"||'+ft.isArrayLike+"("+Ce+".constant))))",'invalid dynamic attribute "'+qe+'"')});var Zr={isStream:Ze.def(!1)},tn=new st;tn.state=Gn,Object.keys(tn).forEach(function(xn){Zr[xn]=Ze.def(""+tn[xn])});var Br=Zr.buffer,Cn=Zr.type;Ze("if(",hr,"(",Ce,")){",Zr.isStream,"=true;",Br,"=",zr,".createStream(",zc,",",Ce,");",Cn,"=",Br,".dtype;","}else{",Br,"=",zr,".getBuffer(",Ce,");","if(",Br,"){",Cn,"=",Br,".dtype;",'}else if("constant" in ',Ce,"){",Zr.state,"=",yi,";","if(typeof "+Ce+'.constant === "number"){',Zr[fi[0]],"=",Ce,".constant;",fi.slice(1).map(function(xn){return Zr[xn]}).join("="),"=0;","}else{",fi.map(function(xn,yn){return Zr[xn]+"="+Ce+".constant.length>"+yn+"?"+Ce+".constant["+yn+"]:0;"}).join(""),"}}else{","if(",hr,"(",Ce,".buffer)){",Br,"=",zr,".createStream(",zc,",",Ce,".buffer);","}else{",Br,"=",zr,".getBuffer(",Ce,".buffer);","}",Cn,'="type" in ',Ce,"?",Et.glTypes,"[",Ce,".type]:",Br,".dtype;",Zr.normalized,"=!!",Ce,".normalized;");function fn(xn){Ze(Zr[xn],"=",Ce,".",xn,"|0;")}return fn("size"),fn("offset"),fn("stride"),fn("divisor"),Ze("}}"),Ze.exit("if(",Zr.isStream,"){",zr,".destroyStream(",Br,");","}"),Zr}It[qe]=Hs(Be,nt)}),It}function $a(Ee){var ne=Ee.static,Ve=Ee.dynamic,pt={};return Object.keys(ne).forEach(function(It){var qe=ne[It];pt[It]=Io(function(Be,nt){return typeof qe=="number"||typeof qe=="boolean"?""+qe:Be.link(qe)})}),Object.keys(Ve).forEach(function(It){var qe=Ve[It];pt[It]=Hs(qe,function(Be,nt){return Be.invoke(nt,qe)})}),pt}function ns(Ee,ne,Ve,pt,It){var qe=Ee.static,Be=Ee.dynamic;he.optional(function(){var fn=[Gs,rl,Bc,pu,Ga,Bf,uc,yp,Bl,Nf].concat(Tn);function xn(yn){Object.keys(yn).forEach(function(mn){he.command(fn.indexOf(mn)>=0,'unknown parameter "'+mn+'"',It.commandStr)})}xn(qe),xn(Be)});var nt=pi(Ee,ne),_e=an(Ee,It),Ze=$n(Ee,_e,It),Ce=po(Ee,It),ft=ho(Ee,It),Et=Zi(Ee,It,nt);function hr(fn){var xn=Ze[fn];xn&&(ft[fn]=xn)}hr(Vs),hr(En(Fl));var zr=Object.keys(ft).length>0,Zr={framebuffer:_e,draw:Ce,shader:Et,state:ft,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Zr.profile=Yr(Ee,It),Zr.uniforms=Ni(Ve,It),Zr.drawVAO=Zr.scopeVAO=Ce.vao,!Zr.drawVAO&&Et.program&&!nt&&ze.angle_instanced_arrays&&Ce.static.elements){var tn=!0,Br=Et.program.attributes.map(function(fn){var xn=ne.static[fn];return tn=tn&&!!xn,xn});if(tn&&Br.length>0){var Cn=_r.getVAO(_r.createVAO({attributes:Br,elements:Ce.static.elements}));Zr.drawVAO=new va(null,null,null,function(fn,xn){return fn.link(Cn)}),Zr.useVAO=!0}}return nt?Zr.useVAO=!0:Zr.attributes=os(ne,It),Zr.context=$a(pt,It),Zr}function Oo(Ee,ne,Ve){var pt=Ee.shared,It=pt.context,qe=Ee.scope();Object.keys(Ve).forEach(function(Be){ne.save(It,"."+Be);var nt=Ve[Be],_e=nt.append(Ee,ne);Array.isArray(_e)?qe(It,".",Be,"=[",_e.join(),"];"):qe(It,".",Be,"=",_e,";")}),ne(qe)}function Yo(Ee,ne,Ve,pt){var It=Ee.shared,qe=It.gl,Be=It.framebuffer,nt;Ur&&(nt=ne.def(It.extensions,".webgl_draw_buffers"));var _e=Ee.constants,Ze=_e.drawBuffer,Ce=_e.backBuffer,ft;Ve?ft=Ve.append(Ee,ne):ft=ne.def(Be,".next"),pt||ne("if(",ft,"!==",Be,".cur){"),ne("if(",ft,"){",qe,".bindFramebuffer(",jh,",",ft,".framebuffer);"),Ur&&ne(nt,".drawBuffersWEBGL(",Ze,"[",ft,".colorAttachments.length]);"),ne("}else{",qe,".bindFramebuffer(",jh,",null);"),Ur&&ne(nt,".drawBuffersWEBGL(",Ce,");"),ne("}",Be,".cur=",ft,";"),pt||ne("}")}function zo(Ee,ne,Ve){var pt=Ee.shared,It=pt.gl,qe=Ee.current,Be=Ee.next,nt=pt.current,_e=pt.next,Ze=Ee.cond(nt,".dirty");Tn.forEach(function(Ce){var ft=En(Ce);if(!(ft in Ve.state)){var Et,hr;if(ft in Be){Et=Be[ft],hr=qe[ft];var zr=Ge(Lr[ft].length,function(tn){return Ze.def(Et,"[",tn,"]")});Ze(Ee.cond(zr.map(function(tn,Br){return tn+"!=="+hr+"["+Br+"]"}).join("||")).then(It,".",rr[ft],"(",zr,");",zr.map(function(tn,Br){return hr+"["+Br+"]="+tn}).join(";"),";"))}else{Et=Ze.def(_e,".",ft);var Zr=Ee.cond(Et,"!==",nt,".",ft);Ze(Zr),ft in Qt?Zr(Ee.cond(Et).then(It,".enable(",Qt[ft],");").else(It,".disable(",Qt[ft],");"),nt,".",ft,"=",Et,";"):Zr(It,".",rr[ft],"(",Et,");",nt,".",ft,"=",Et,";")}}}),Object.keys(Ve.state).length===0&&Ze(nt,".dirty=false;"),ne(Ze)}function xs(Ee,ne,Ve,pt){var It=Ee.shared,qe=Ee.current,Be=It.current,nt=It.gl;sh(Object.keys(Ve)).forEach(function(_e){var Ze=Ve[_e];if(!(pt&&!pt(Ze))){var Ce=Ze.append(Ee,ne);if(Qt[_e]){var ft=Qt[_e];Ul(Ze)?Ce?ne(nt,".enable(",ft,");"):ne(nt,".disable(",ft,");"):ne(Ee.cond(Ce).then(nt,".enable(",ft,");").else(nt,".disable(",ft,");")),ne(Be,".",_e,"=",Ce,";")}else if(pa(Ce)){var Et=qe[_e];ne(nt,".",rr[_e],"(",Ce,");",Ce.map(function(hr,zr){return Et+"["+zr+"]="+hr}).join(";"),";")}else ne(nt,".",rr[_e],"(",Ce,");",Be,".",_e,"=",Ce,";")}})}function xo(Ee,ne){Er&&(Ee.instancing=ne.def(Ee.shared.extensions,".angle_instanced_arrays"))}function _i(Ee,ne,Ve,pt,It){var qe=Ee.shared,Be=Ee.stats,nt=qe.current,_e=qe.timer,Ze=Ve.profile;function Ce(){var fn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return fn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ft,Et;function hr(fn){ft=ne.def(),fn(ft,"=",Ce(),";"),typeof It=="string"?fn(Be,".count+=",It,";"):fn(Be,".count++;"),br&&(pt?(Et=ne.def(),fn(Et,"=",_e,".getNumPendingQueries();")):fn(_e,".beginQuery(",Be,");"))}function zr(fn){fn(Be,".cpuTime+=",Ce(),"-",ft,";"),br&&(pt?fn(_e,".pushScopeStats(",Et,",",_e,".getNumPendingQueries(),",Be,");"):fn(_e,".endQuery();"))}function Zr(fn){var xn=ne.def(nt,".profile");ne(nt,".profile=",fn,";"),ne.exit(nt,".profile=",xn,";")}var tn;if(Ze){if(Ul(Ze)){Ze.enable?(hr(ne),zr(ne.exit),Zr("true")):Zr("false");return}tn=Ze.append(Ee,ne),Zr(tn)}else tn=ne.def(nt,".profile");var Br=Ee.block();hr(Br),ne("if(",tn,"){",Br,"}");var Cn=Ee.block();zr(Cn),ne.exit("if(",tn,"){",Cn,"}")}function qo(Ee,ne,Ve,pt,It){var qe=Ee.shared;function Be(_e){switch(_e){case Zf:case Ep:case Cp:return 2;case zl:case pc:case nl:return 3;case fc:case Sp:case pf:return 4;default:return 1}}function nt(_e,Ze,Ce){var ft=qe.gl,Et=ne.def(_e,".location"),hr=ne.def(qe.attributes,"[",Et,"]"),zr=Ce.state,Zr=Ce.buffer,tn=[Ce.x,Ce.y,Ce.z,Ce.w],Br=["buffer","normalized","offset","stride"];function Cn(){ne("if(!",hr,".buffer){",ft,".enableVertexAttribArray(",Et,");}");var xn=Ce.type,yn;if(Ce.size?yn=ne.def(Ce.size,"||",Ze):yn=Ze,ne("if(",hr,".type!==",xn,"||",hr,".size!==",yn,"||",Br.map(function(Wn){return hr+"."+Wn+"!=="+Ce[Wn]}).join("||"),"){",ft,".bindBuffer(",zc,",",Zr,".buffer);",ft,".vertexAttribPointer(",[Et,yn,xn,Ce.normalized,Ce.stride,Ce.offset],");",hr,".type=",xn,";",hr,".size=",yn,";",Br.map(function(Wn){return hr+"."+Wn+"="+Ce[Wn]+";"}).join(""),"}"),Er){var mn=Ce.divisor;ne("if(",hr,".divisor!==",mn,"){",Ee.instancing,".vertexAttribDivisorANGLE(",[Et,mn],");",hr,".divisor=",mn,";}")}}function fn(){ne("if(",hr,".buffer){",ft,".disableVertexAttribArray(",Et,");",hr,".buffer=null;","}if(",fi.map(function(xn,yn){return hr+"."+xn+"!=="+tn[yn]}).join("||"),"){",ft,".vertexAttrib4f(",Et,",",tn,");",fi.map(function(xn,yn){return hr+"."+xn+"="+tn[yn]+";"}).join(""),"}")}zr===Gn?Cn():zr===yi?fn():(ne("if(",zr,"===",Gn,"){"),Cn(),ne("}else{"),fn(),ne("}"))}pt.forEach(function(_e){var Ze=_e.name,Ce=Ve.attributes[Ze],ft;if(Ce){if(!It(Ce))return;ft=Ce.append(Ee,ne)}else{if(!It(uh))return;var Et=Ee.scopeAttrib(Ze);he.optional(function(){Ee.assert(ne,Et+".state","missing attribute "+Ze)}),ft={},Object.keys(new st).forEach(function(hr){ft[hr]=ne.def(Et,".",hr)})}nt(Ee.link(_e),Be(_e.info.type),ft)})}function ia(Ee,ne,Ve,pt,It,qe){for(var Be=Ee.shared,nt=Be.gl,_e,Ze=0;Ze<pt.length;++Ze){var Ce=pt[Ze],ft=Ce.name,Et=Ce.info.type,hr=Ve.uniforms[ft],zr=Ee.link(Ce),Zr=zr+".location",tn;if(hr){if(!It(hr))continue;if(Ul(hr)){var Br=hr.value;if(he.command(Br!==null&&typeof Br!="undefined",'missing uniform "'+ft+'"',Ee.commandStr),Et===hf||Et===df){he.command(typeof Br=="function"&&(Et===hf&&(Br._reglType==="texture2d"||Br._reglType==="framebuffer")||Et===df&&(Br._reglType==="textureCube"||Br._reglType==="framebufferCube")),"invalid texture for uniform "+ft,Ee.commandStr);var Cn=Ee.link(Br._texture||Br.color[0]._texture);ne(nt,".uniform1i(",Zr,",",Cn+".bind());"),ne.exit(Cn,".unbind();")}else if(Et===tu||Et===Gf||Et===Hf){he.optional(function(){he.command(pa(Br),"invalid matrix for uniform "+ft,Ee.commandStr),he.command(Et===tu&&Br.length===4||Et===Gf&&Br.length===9||Et===Hf&&Br.length===16,"invalid length for matrix uniform "+ft,Ee.commandStr)});var fn=Ee.global.def("new Float32Array(["+Array.prototype.slice.call(Br)+"])"),xn=2;Et===Gf?xn=3:Et===Hf&&(xn=4),ne(nt,".uniformMatrix",xn,"fv(",Zr,",false,",fn,");")}else{switch(Et){case Uf:he.commandType(Br,"number","uniform "+ft,Ee.commandStr),_e="1f";break;case Zf:he.command(pa(Br)&&Br.length===2,"uniform "+ft,Ee.commandStr),_e="2f";break;case zl:he.command(pa(Br)&&Br.length===3,"uniform "+ft,Ee.commandStr),_e="3f";break;case fc:he.command(pa(Br)&&Br.length===4,"uniform "+ft,Ee.commandStr),_e="4f";break;case Vf:he.commandType(Br,"boolean","uniform "+ft,Ee.commandStr),_e="1i";break;case jf:he.commandType(Br,"number","uniform "+ft,Ee.commandStr),_e="1i";break;case Cp:he.command(pa(Br)&&Br.length===2,"uniform "+ft,Ee.commandStr),_e="2i";break;case Ep:he.command(pa(Br)&&Br.length===2,"uniform "+ft,Ee.commandStr),_e="2i";break;case nl:he.command(pa(Br)&&Br.length===3,"uniform "+ft,Ee.commandStr),_e="3i";break;case pc:he.command(pa(Br)&&Br.length===3,"uniform "+ft,Ee.commandStr),_e="3i";break;case pf:he.command(pa(Br)&&Br.length===4,"uniform "+ft,Ee.commandStr),_e="4i";break;case Sp:he.command(pa(Br)&&Br.length===4,"uniform "+ft,Ee.commandStr),_e="4i";break}ne(nt,".uniform",_e,"(",Zr,",",pa(Br)?Array.prototype.slice.call(Br):Br,");")}continue}else tn=hr.append(Ee,ne)}else{if(!It(uh))continue;tn=ne.def(Be.uniforms,"[",me.id(ft),"]")}Et===hf?(he(!Array.isArray(tn),"must specify a scalar prop for textures"),ne("if(",tn,"&&",tn,'._reglType==="framebuffer"){',tn,"=",tn,".color[0];","}")):Et===df&&(he(!Array.isArray(tn),"must specify a scalar prop for cube maps"),ne("if(",tn,"&&",tn,'._reglType==="framebufferCube"){',tn,"=",tn,".color[0];","}")),he.optional(function(){function ws(Nu,jc){Ee.assert(ne,Nu,'bad data or missing for uniform "'+ft+'".  '+jc)}function Cl(Nu){he(!Array.isArray(tn),"must not specify an array type for uniform"),ws("typeof "+tn+'==="'+Nu+'"',"invalid type, expected "+Nu)}function Cu(Nu,jc){Array.isArray(tn)?he(tn.length===Nu,"must have length "+Nu):ws(Be.isArrayLike+"("+tn+")&&"+tn+".length==="+Nu,"invalid vector, should have length "+Nu,Ee.commandStr)}function qh(Nu){he(!Array.isArray(tn),"must not specify a value type"),ws("typeof "+tn+'==="function"&&'+tn+'._reglType==="texture'+(Nu===nh?"2d":"Cube")+'"',"invalid texture type",Ee.commandStr)}switch(Et){case jf:Cl("number");break;case Ep:Cu(2,"number");break;case pc:Cu(3,"number");break;case Sp:Cu(4,"number");break;case Uf:Cl("number");break;case Zf:Cu(2,"number");break;case zl:Cu(3,"number");break;case fc:Cu(4,"number");break;case Vf:Cl("boolean");break;case Cp:Cu(2,"boolean");break;case nl:Cu(3,"boolean");break;case pf:Cu(4,"boolean");break;case tu:Cu(4,"number");break;case Gf:Cu(9,"number");break;case Hf:Cu(16,"number");break;case hf:qh(nh);break;case df:qh(ih);break}});var yn=1;switch(Et){case hf:case df:var mn=ne.def(tn,"._texture");ne(nt,".uniform1i(",Zr,",",mn,".bind());"),ne.exit(mn,".unbind();");continue;case jf:case Vf:_e="1i";break;case Ep:case Cp:_e="2i",yn=2;break;case pc:case nl:_e="3i",yn=3;break;case Sp:case pf:_e="4i",yn=4;break;case Uf:_e="1f";break;case Zf:_e="2f",yn=2;break;case zl:_e="3f",yn=3;break;case fc:_e="4f",yn=4;break;case tu:_e="Matrix2fv";break;case Gf:_e="Matrix3fv";break;case Hf:_e="Matrix4fv";break}if(_e.charAt(0)==="M"){ne(nt,".uniform",_e,"(",Zr,",");var Wn=Math.pow(Et-tu+2,2),Ca=Ee.global.def("new Float32Array(",Wn,")");Array.isArray(tn)?ne("false,(",Ge(Wn,function(ws){return Ca+"["+ws+"]="+tn[ws]}),",",Ca,")"):ne("false,(Array.isArray(",tn,")||",tn," instanceof Float32Array)?",tn,":(",Ge(Wn,function(ws){return Ca+"["+ws+"]="+tn+"["+ws+"]"}),",",Ca,")"),ne(");")}else if(yn>1){for(var us=[],Ha=[],Sn=0;Sn<yn;++Sn)Array.isArray(tn)?Ha.push(tn[Sn]):Ha.push(ne.def(tn+"["+Sn+"]")),qe&&us.push(ne.def());qe&&ne("if(!",Ee.batchId,"||",us.map(function(ws,Cl){return ws+"!=="+Ha[Cl]}).join("||"),"){",us.map(function(ws,Cl){return ws+"="+Ha[Cl]+";"}).join("")),ne(nt,".uniform",_e,"(",Zr,",",Ha.join(","),");"),qe&&ne("}")}else{if(he(!Array.isArray(tn),"uniform value must not be an array"),qe){var oi=ne.def();ne("if(!",Ee.batchId,"||",oi,"!==",tn,"){",oi,"=",tn,";")}ne(nt,".uniform",_e,"(",Zr,",",tn,");"),qe&&ne("}")}}}function ss(Ee,ne,Ve,pt){var It=Ee.shared,qe=It.gl,Be=It.draw,nt=pt.draw;function _e(){var yn=nt.elements,mn,Wn=ne;return yn?((yn.contextDep&&pt.contextDynamic||yn.propDep)&&(Wn=Ve),mn=yn.append(Ee,Wn),nt.elementsActive&&Wn("if("+mn+")"+qe+".bindBuffer("+rh+","+mn+".buffer.buffer);")):(mn=Wn.def(),Wn(mn,"=",Be,".",pu,";","if(",mn,"){",qe,".bindBuffer(",rh,",",mn,".buffer.buffer);}","else if(",It.vao,".currentVAO){",mn,"=",Ee.shared.elements+".getElements("+It.vao,".currentVAO.elements);",fr?"":"if("+mn+")"+qe+".bindBuffer("+rh+","+mn+".buffer.buffer);","}")),mn}function Ze(){var yn=nt.count,mn,Wn=ne;return yn?((yn.contextDep&&pt.contextDynamic||yn.propDep)&&(Wn=Ve),mn=yn.append(Ee,Wn),he.optional(function(){yn.MISSING&&Ee.assert(ne,"false","missing vertex count"),yn.DYNAMIC&&Ee.assert(Wn,mn+">=0","missing vertex count")})):(mn=Wn.def(Be,".",uc),he.optional(function(){Ee.assert(Wn,mn+">=0","missing vertex count")})),mn}var Ce=_e();function ft(yn){var mn=nt[yn];return mn?mn.contextDep&&pt.contextDynamic||mn.propDep?mn.append(Ee,Ve):mn.append(Ee,ne):ne.def(Be,".",yn)}var Et=ft(Ga),hr=ft(Bf),zr=Ze();if(typeof zr=="number"){if(zr===0)return}else Ve("if(",zr,"){"),Ve.exit("}");var Zr,tn;Er&&(Zr=ft(yp),tn=Ee.instancing);var Br=Ce+".type",Cn=nt.elements&&Ul(nt.elements)&&!nt.vaoActive;function fn(){function yn(){Ve(tn,".drawElementsInstancedANGLE(",[Et,zr,Br,hr+"<<(("+Br+"-"+ei+")>>1)",Zr],");")}function mn(){Ve(tn,".drawArraysInstancedANGLE(",[Et,hr,zr,Zr],");")}Ce&&Ce!=="null"?Cn?yn():(Ve("if(",Ce,"){"),yn(),Ve("}else{"),mn(),Ve("}")):mn()}function xn(){function yn(){Ve(qe+".drawElements("+[Et,zr,Br,hr+"<<(("+Br+"-"+ei+")>>1)"]+");")}function mn(){Ve(qe+".drawArrays("+[Et,hr,zr]+");")}Ce&&Ce!=="null"?Cn?yn():(Ve("if(",Ce,"){"),yn(),Ve("}else{"),mn(),Ve("}")):mn()}Er&&(typeof Zr!="number"||Zr>=0)?typeof Zr=="string"?(Ve("if(",Zr,">0){"),fn(),Ve("}else if(",Zr,"<0){"),xn(),Ve("}")):fn():xn()}function ti(Ee,ne,Ve,pt,It){var qe=ni(),Be=qe.proc("body",It);return he.optional(function(){qe.commandStr=ne.commandStr,qe.command=qe.link(ne.commandStr)}),Er&&(qe.instancing=Be.def(qe.shared.extensions,".angle_instanced_arrays")),Ee(qe,Be,Ve,pt),qe.compile().body}function zi(Ee,ne,Ve,pt){xo(Ee,ne),Ve.useVAO?Ve.drawVAO?ne(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,ne),");"):ne(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(ne(Ee.shared.vao,".setVAO(null);"),qo(Ee,ne,Ve,pt.attributes,function(){return!0})),ia(Ee,ne,Ve,pt.uniforms,function(){return!0},!1),ss(Ee,ne,ne,Ve)}function ma(Ee,ne){var Ve=Ee.proc("draw",1);xo(Ee,Ve),Oo(Ee,Ve,ne.context),Yo(Ee,Ve,ne.framebuffer),zo(Ee,Ve,ne),xs(Ee,Ve,ne.state),_i(Ee,Ve,ne,!1,!0);var pt=ne.shader.progVar.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",pt,".program);"),ne.shader.program)zi(Ee,Ve,ne,ne.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var It=Ee.global.def("{}"),qe=Ve.def(pt,".id"),Be=Ve.def(It,"[",qe,"]");Ve(Ee.cond(Be).then(Be,".call(this,a0);").else(Be,"=",It,"[",qe,"]=",Ee.link(function(nt){return ti(zi,Ee,ne,nt,1)}),"(",pt,");",Be,".call(this,a0);"))}Object.keys(ne.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function Ro(Ee,ne,Ve,pt){Ee.batchId="a1",xo(Ee,ne);function It(){return!0}qo(Ee,ne,Ve,pt.attributes,It),ia(Ee,ne,Ve,pt.uniforms,It,!1),ss(Ee,ne,ne,Ve)}function al(Ee,ne,Ve,pt){xo(Ee,ne);var It=Ve.contextDep,qe=ne.def(),Be="a0",nt="a1",_e=ne.def();Ee.shared.props=_e,Ee.batchId=qe;var Ze=Ee.scope(),Ce=Ee.scope();ne(Ze.entry,"for(",qe,"=0;",qe,"<",nt,";++",qe,"){",_e,"=",Be,"[",qe,"];",Ce,"}",Ze.exit);function ft(Br){return Br.contextDep&&It||Br.propDep}function Et(Br){return!ft(Br)}if(Ve.needsContext&&Oo(Ee,Ce,Ve.context),Ve.needsFramebuffer&&Yo(Ee,Ce,Ve.framebuffer),xs(Ee,Ce,Ve.state,ft),Ve.profile&&ft(Ve.profile)&&_i(Ee,Ce,Ve,!1,!0),pt)Ve.useVAO?Ve.drawVAO?ft(Ve.drawVAO)?Ce(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ce),");"):Ze(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ze),");"):Ze(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(Ze(Ee.shared.vao,".setVAO(null);"),qo(Ee,Ze,Ve,pt.attributes,Et),qo(Ee,Ce,Ve,pt.attributes,ft)),ia(Ee,Ze,Ve,pt.uniforms,Et,!1),ia(Ee,Ce,Ve,pt.uniforms,ft,!0),ss(Ee,Ze,Ce,Ve);else{var hr=Ee.global.def("{}"),zr=Ve.shader.progVar.append(Ee,Ce),Zr=Ce.def(zr,".id"),tn=Ce.def(hr,"[",Zr,"]");Ce(Ee.shared.gl,".useProgram(",zr,".program);","if(!",tn,"){",tn,"=",hr,"[",Zr,"]=",Ee.link(function(Br){return ti(Ro,Ee,Ve,Br,2)}),"(",zr,");}",tn,".call(this,a0[",qe,"],",qe,");")}}function Te(Ee,ne){var Ve=Ee.proc("batch",2);Ee.batchId="0",xo(Ee,Ve);var pt=!1,It=!0;Object.keys(ne.context).forEach(function(hr){pt=pt||ne.context[hr].propDep}),pt||(Oo(Ee,Ve,ne.context),It=!1);var qe=ne.framebuffer,Be=!1;qe?(qe.propDep?pt=Be=!0:qe.contextDep&&pt&&(Be=!0),Be||Yo(Ee,Ve,qe)):Yo(Ee,Ve,null),ne.state.viewport&&ne.state.viewport.propDep&&(pt=!0);function nt(hr){return hr.contextDep&&pt||hr.propDep}zo(Ee,Ve,ne),xs(Ee,Ve,ne.state,function(hr){return!nt(hr)}),(!ne.profile||!nt(ne.profile))&&_i(Ee,Ve,ne,!1,"a1"),ne.contextDep=pt,ne.needsContext=It,ne.needsFramebuffer=Be;var _e=ne.shader.progVar;if(_e.contextDep&&pt||_e.propDep)al(Ee,Ve,ne,null);else{var Ze=_e.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",Ze,".program);"),ne.shader.program)al(Ee,Ve,ne,ne.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var Ce=Ee.global.def("{}"),ft=Ve.def(Ze,".id"),Et=Ve.def(Ce,"[",ft,"]");Ve(Ee.cond(Et).then(Et,".call(this,a0,a1);").else(Et,"=",Ce,"[",ft,"]=",Ee.link(function(hr){return ti(al,Ee,ne,hr,2)}),"(",Ze,");",Et,".call(this,a0,a1);"))}}Object.keys(ne.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function Zt(Ee,ne){var Ve=Ee.proc("scope",3);Ee.batchId="a2";var pt=Ee.shared,It=pt.current;Oo(Ee,Ve,ne.context),ne.framebuffer&&ne.framebuffer.append(Ee,Ve),sh(Object.keys(ne.state)).forEach(function(Be){var nt=ne.state[Be],_e=nt.append(Ee,Ve);pa(_e)?_e.forEach(function(Ze,Ce){Ve.set(Ee.next[Be],"["+Ce+"]",Ze)}):Ve.set(pt.next,"."+Be,_e)}),_i(Ee,Ve,ne,!0,!0),[pu,Bf,uc,yp,Ga].forEach(function(Be){var nt=ne.draw[Be];!nt||Ve.set(pt.draw,"."+Be,""+nt.append(Ee,Ve))}),Object.keys(ne.uniforms).forEach(function(Be){var nt=ne.uniforms[Be].append(Ee,Ve);Array.isArray(nt)&&(nt="["+nt.join()+"]"),Ve.set(pt.uniforms,"["+me.id(Be)+"]",nt)}),Object.keys(ne.attributes).forEach(function(Be){var nt=ne.attributes[Be].append(Ee,Ve),_e=Ee.scopeAttrib(Be);Object.keys(new st).forEach(function(Ze){Ve.set(_e,"."+Ze,nt[Ze])})}),ne.scopeVAO&&Ve.set(pt.vao,".targetVAO",ne.scopeVAO.append(Ee,Ve));function qe(Be){var nt=ne.shader[Be];nt&&Ve.set(pt.shader,"."+Be,nt.append(Ee,Ve))}qe(rl),qe(Bc),Object.keys(ne.state).length>0&&(Ve(It,".dirty=true;"),Ve.exit(It,".dirty=true;")),Ve("a1(",Ee.shared.context,",a0,",Ee.batchId,");")}function bt(Ee){if(!(typeof Ee!="object"||pa(Ee))){for(var ne=Object.keys(Ee),Ve=0;Ve<ne.length;++Ve)if(rn.isDynamic(Ee[ne[Ve]]))return!0;return!1}}function pn(Ee,ne,Ve){var pt=ne.static[Ve];if(!pt||!bt(pt))return;var It=Ee.global,qe=Object.keys(pt),Be=!1,nt=!1,_e=!1,Ze=Ee.global.def("{}");qe.forEach(function(ft){var Et=pt[ft];if(rn.isDynamic(Et)){typeof Et=="function"&&(Et=pt[ft]=rn.unbox(Et));var hr=Hs(Et,null);Be=Be||hr.thisDep,_e=_e||hr.propDep,nt=nt||hr.contextDep}else{switch(It(Ze,".",ft,"="),typeof Et){case"number":It(Et);break;case"string":It('"',Et,'"');break;case"object":Array.isArray(Et)&&It("[",Et.join(),"]");break;default:It(Ee.link(Et));break}It(";")}});function Ce(ft,Et){qe.forEach(function(hr){var zr=pt[hr];if(!!rn.isDynamic(zr)){var Zr=ft.invoke(Et,zr);Et(Ze,".",hr,"=",Zr,";")}})}ne.dynamic[Ve]=new rn.DynamicVariable(no,{thisDep:Be,contextDep:nt,propDep:_e,ref:Ze,append:Ce}),delete ne.static[Ve]}function ji(Ee,ne,Ve,pt,It){var qe=ni();qe.stats=qe.link(It),Object.keys(ne.static).forEach(function(nt){pn(qe,ne,nt)}),Nh.forEach(function(nt){pn(qe,Ee,nt)});var Be=ns(Ee,ne,Ve,pt,qe);return ma(qe,Be),Zt(qe,Be),Te(qe,Be),v(qe.compile(),{destroy:function(){Be.shader.program.destroy()}})}return{next:$r,current:Lr,procs:function(){var Ee=ni(),ne=Ee.proc("poll"),Ve=Ee.proc("refresh"),pt=Ee.block();ne(pt),Ve(pt);var It=Ee.shared,qe=It.gl,Be=It.next,nt=It.current;pt(nt,".dirty=false;"),Yo(Ee,ne),Yo(Ee,Ve,null,!0);var _e;Er&&(_e=Ee.link(Er)),ze.oes_vertex_array_object&&Ve(Ee.link(ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<Dt.maxAttributes;++Ze){var Ce=Ve.def(It.attributes,"[",Ze,"]"),ft=Ee.cond(Ce,".buffer");ft.then(qe,".enableVertexAttribArray(",Ze,");",qe,".bindBuffer(",zc,",",Ce,".buffer.buffer);",qe,".vertexAttribPointer(",Ze,",",Ce,".size,",Ce,".type,",Ce,".normalized,",Ce,".stride,",Ce,".offset);").else(qe,".disableVertexAttribArray(",Ze,");",qe,".vertexAttrib4f(",Ze,",",Ce,".x,",Ce,".y,",Ce,".z,",Ce,".w);",Ce,".buffer=null;"),Ve(ft),Er&&Ve(_e,".vertexAttribDivisorANGLE(",Ze,",",Ce,".divisor);")}return Ve(Ee.shared.vao,".currentVAO=null;",Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"),Object.keys(Qt).forEach(function(Et){var hr=Qt[Et],zr=pt.def(Be,".",Et),Zr=Ee.block();Zr("if(",zr,"){",qe,".enable(",hr,")}else{",qe,".disable(",hr,")}",nt,".",Et,"=",zr,";"),Ve(Zr),ne("if(",zr,"!==",nt,".",Et,"){",Zr,"}")}),Object.keys(rr).forEach(function(Et){var hr=rr[Et],zr=Lr[Et],Zr,tn,Br=Ee.block();if(Br(qe,".",hr,"("),pa(zr)){var Cn=zr.length;Zr=Ee.global.def(Be,".",Et),tn=Ee.global.def(nt,".",Et),Br(Ge(Cn,function(fn){return Zr+"["+fn+"]"}),");",Ge(Cn,function(fn){return tn+"["+fn+"]="+Zr+"["+fn+"];"}).join("")),ne("if(",Ge(Cn,function(fn){return Zr+"["+fn+"]!=="+tn+"["+fn+"]"}).join("||"),"){",Br,"}")}else Zr=pt.def(Be,".",Et),tn=pt.def(nt,".",Et),Br(Zr,");",nt,".",Et,"=",Zr,";"),ne("if(",Zr,"!==",tn,"){",Br,"}");Ve(Br)}),Ee.compile()}(),compile:ji}}function Gh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hh=34918,lh=34919,ch=35007,Pd=function(B,me){if(!me.ext_disjoint_timer_query)return null;var ze=[];function Dt(){return ze.pop()||me.ext_disjoint_timer_query.createQueryEXT()}function ur(Er){ze.push(Er)}var Lt=[];function tr(Er){var Ur=Dt();me.ext_disjoint_timer_query.beginQueryEXT(ch,Ur),Lt.push(Ur),br(Lt.length-1,Lt.length,Er)}function dr(){me.ext_disjoint_timer_query.endQueryEXT(ch)}function yr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var _r=[];function Ir(){return _r.pop()||new yr}function or(Er){_r.push(Er)}var Fr=[];function br(Er,Ur,fr){var Lr=Ir();Lr.startQueryIndex=Er,Lr.endQueryIndex=Ur,Lr.sum=0,Lr.stats=fr,Fr.push(Lr)}var Pr=[],st=[];function Xt(){var Er,Ur,fr=Lt.length;if(fr!==0){st.length=Math.max(st.length,fr+1),Pr.length=Math.max(Pr.length,fr+1),Pr[0]=0,st[0]=0;var Lr=0;for(Er=0,Ur=0;Ur<Lt.length;++Ur){var $r=Lt[Ur];me.ext_disjoint_timer_query.getQueryObjectEXT($r,lh)?(Lr+=me.ext_disjoint_timer_query.getQueryObjectEXT($r,Hh),ur($r)):Lt[Er++]=$r,Pr[Ur+1]=Lr,st[Ur+1]=Er}for(Lt.length=Er,Er=0,Ur=0;Ur<Fr.length;++Ur){var Tn=Fr[Ur],Qt=Tn.startQueryIndex,rr=Tn.endQueryIndex;Tn.sum+=Pr[rr]-Pr[Qt];var En=st[Qt],Vr=st[rr];Vr===En?(Tn.stats.gpuTime+=Tn.sum/1e6,or(Tn)):(Tn.startQueryIndex=En,Tn.endQueryIndex=Vr,Fr[Er++]=Tn)}Fr.length=Er}}return{beginQuery:tr,endQuery:dr,pushScopeStats:br,update:Xt,getNumPendingQueries:function(){return Lt.length},clear:function(){ze.push.apply(ze,Lt);for(var Er=0;Er<ze.length;Er++)me.ext_disjoint_timer_query.deleteQueryEXT(ze[Er]);Lt.length=0,ze.length=0},restore:function(){Lt.length=0,ze.length=0}}},Id=16384,Wf=256,Wh=1024,Xh=34962,Xf="webglcontextlost",Da="webglcontextrestored",fh=1,Sl=2,mf=3;function Yh(B,me){for(var ze=0;ze<B.length;++ze)if(B[ze]===me)return ze;return-1}function Od(B){var me=ge(B);if(!me)return null;var ze=me.gl,Dt=ze.getContextAttributes(),ur=ze.isContextLost(),Lt=Pe(ze,me);if(!Lt)return null;var tr=hs(),dr=Gh(),yr=Lt.extensions,_r=Pd(ze,yr),Ir=eo(),or=ze.drawingBufferWidth,Fr=ze.drawingBufferHeight,br={tick:0,time:0,viewportWidth:or,viewportHeight:Fr,framebufferWidth:or,framebufferHeight:Fr,drawingBufferWidth:or,drawingBufferHeight:Fr,pixelRatio:me.pixelRatio},Pr={},st={elements:null,primitive:4,count:-1,offset:0,instances:-1},Xt=Cc(ze,yr),Er=F(ze,dr,me,Lr),Ur=Wu(ze,yr,Er,dr),fr=yt(ze,yr,Xt,dr,Er,Ur,st);function Lr(ti){return fr.destroyBuffer(ti)}var $r=Or(ze,tr,dr,me),Tn=ms(ze,yr,Xt,function(){En.procs.poll()},br,dr,me),Qt=Rl(ze,yr,Xt,dr,me),rr=Oe(ze,yr,Xt,Tn,Qt,dr),En=Vh(ze,tr,yr,Xt,Er,Ur,Tn,rr,Pr,fr,$r,st,br,_r,me),Vr=Un(ze,rr,En.procs.poll,br,Dt,yr,Xt),Ar=En.next,Wr=ze.canvas,Kr=[],xi=[],ni=[],Yr=[me.onDestroy],an=null;function $n(){if(Kr.length===0){_r&&_r.update(),an=null;return}an=Ii.next($n),xo();for(var ti=Kr.length-1;ti>=0;--ti){var zi=Kr[ti];zi&&zi(br,null,0)}ze.flush(),_r&&_r.update()}function pi(){!an&&Kr.length>0&&(an=Ii.next($n))}function Zi(){an&&(Ii.cancel($n),an=null)}function po(ti){ti.preventDefault(),ur=!0,Zi(),xi.forEach(function(zi){zi()})}function ho(ti){ze.getError(),ur=!1,Lt.restore(),$r.restore(),Er.restore(),Tn.restore(),Qt.restore(),rr.restore(),fr.restore(),_r&&_r.restore(),En.procs.refresh(),pi(),ni.forEach(function(zi){zi()})}var Ni=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ni&&Wr&&(Wr.addEventListener(Xf,po,!1),Wr.addEventListener(Da,ho,!1));function os(){Kr.length=0,Zi(),!Ni&&Wr&&(Wr.removeEventListener(Xf,po),Wr.removeEventListener(Da,ho)),$r.clear(),rr.clear(),Qt.clear(),fr.clear(),Tn.clear(),Ur.clear(),Er.clear(),_r&&_r.clear(),Yr.forEach(function(ti){ti()})}function $a(ti){he(!!ti,"invalid args to regl({...})"),he.type(ti,"object","invalid args to regl({...})");function zi(qe){var Be=v({},qe);delete Be.uniforms,delete Be.attributes,delete Be.context,delete Be.vao,"stencil"in Be&&Be.stencil.op&&(Be.stencil.opBack=Be.stencil.opFront=Be.stencil.op,delete Be.stencil.op);function nt(_e){if(_e in Be){var Ze=Be[_e];delete Be[_e],Object.keys(Ze).forEach(function(Ce){Be[_e+"."+Ce]=Ze[Ce]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in qe&&(Be.vao=qe.vao),Be}function ma(qe,Be){var nt={},_e={};return Object.keys(qe).forEach(function(Ze){var Ce=qe[Ze];if(rn.isDynamic(Ce)){_e[Ze]=rn.unbox(Ce,Ze);return}else if(Be&&Array.isArray(Ce)){for(var ft=0;ft<Ce.length;++ft)if(rn.isDynamic(Ce[ft])){_e[Ze]=rn.unbox(Ce,Ze);return}}nt[Ze]=Ce}),{dynamic:_e,static:nt}}var Ro=ma(ti.context||{},!0),al=ma(ti.uniforms||{},!0),Te=ma(ti.attributes||{},!1),Zt=ma(zi(ti),!1),bt={gpuTime:0,cpuTime:0,count:0},pn=En.compile(Zt,Te,al,Ro,bt),ji=pn.draw,Ee=pn.batch,ne=pn.scope,Ve=[];function pt(qe){for(;Ve.length<qe;)Ve.push(null);return Ve}function It(qe,Be){var nt;if(ur&&he.raise("context lost"),typeof qe=="function")return ne.call(this,null,qe,0);if(typeof Be=="function")if(typeof qe=="number")for(nt=0;nt<qe;++nt)ne.call(this,null,Be,nt);else if(Array.isArray(qe))for(nt=0;nt<qe.length;++nt)ne.call(this,qe[nt],Be,nt);else return ne.call(this,qe,Be,0);else if(typeof qe=="number"){if(qe>0)return Ee.call(this,pt(qe|0),qe|0)}else if(Array.isArray(qe)){if(qe.length)return Ee.call(this,qe,qe.length)}else return ji.call(this,qe)}return v(It,{stats:bt,destroy:function(){pn.destroy()}})}var ns=rr.setFBO=$a({framebuffer:rn.define.call(null,fh,"framebuffer")});function Oo(ti,zi){var ma=0;En.procs.poll();var Ro=zi.color;Ro&&(ze.clearColor(+Ro[0]||0,+Ro[1]||0,+Ro[2]||0,+Ro[3]||0),ma|=Id),"depth"in zi&&(ze.clearDepth(+zi.depth),ma|=Wf),"stencil"in zi&&(ze.clearStencil(zi.stencil|0),ma|=Wh),he(!!ma,"called regl.clear with no buffer specified"),ze.clear(ma)}function Yo(ti){if(he(typeof ti=="object"&&ti,"regl.clear() takes an object as input"),"framebuffer"in ti)if(ti.framebuffer&&ti.framebuffer_reglType==="framebufferCube")for(var zi=0;zi<6;++zi)ns(v({framebuffer:ti.framebuffer.faces[zi]},ti),Oo);else ns(ti,Oo);else Oo(null,ti)}function zo(ti){he.type(ti,"function","regl.frame() callback must be a function"),Kr.push(ti);function zi(){var ma=Yh(Kr,ti);he(ma>=0,"cannot cancel a frame twice");function Ro(){var al=Yh(Kr,Ro);Kr[al]=Kr[Kr.length-1],Kr.length-=1,Kr.length<=0&&Zi()}Kr[ma]=Ro}return pi(),{cancel:zi}}function xs(){var ti=Ar.viewport,zi=Ar.scissor_box;ti[0]=ti[1]=zi[0]=zi[1]=0,br.viewportWidth=br.framebufferWidth=br.drawingBufferWidth=ti[2]=zi[2]=ze.drawingBufferWidth,br.viewportHeight=br.framebufferHeight=br.drawingBufferHeight=ti[3]=zi[3]=ze.drawingBufferHeight}function xo(){br.tick+=1,br.time=qo(),xs(),En.procs.poll()}function _i(){Tn.refresh(),xs(),En.procs.refresh(),_r&&_r.update()}function qo(){return(eo()-Ir)/1e3}_i();function ia(ti,zi){he.type(zi,"function","listener callback must be a function");var ma;switch(ti){case"frame":return zo(zi);case"lost":ma=xi;break;case"restore":ma=ni;break;case"destroy":ma=Yr;break;default:he.raise("invalid event, must be one of frame,lost,restore,destroy")}return ma.push(zi),{cancel:function(){for(var Ro=0;Ro<ma.length;++Ro)if(ma[Ro]===zi){ma[Ro]=ma[ma.length-1],ma.pop();return}}}}var ss=v($a,{clear:Yo,prop:rn.define.bind(null,fh),context:rn.define.bind(null,Sl),this:rn.define.bind(null,mf),draw:$a({}),buffer:function(ti){return Er.create(ti,Xh,!1,!1)},elements:function(ti){return Ur.create(ti,!1)},texture:Tn.create2D,cube:Tn.createCube,renderbuffer:Qt.create,framebuffer:rr.create,framebufferCube:rr.createCube,vao:fr.createVAO,attributes:Dt,frame:zo,on:ia,limits:Xt,hasExtension:function(ti){return Xt.extensions.indexOf(ti.toLowerCase())>=0},read:Vr,destroy:os,_gl:ze,_refresh:_i,poll:function(){xo(),_r&&_r.update()},now:qo,stats:dr});return me.onDone(null,ss),ss}return Od})},77412:function(At){function Q(N,le){for(var ye=-1,v=N==null?0:N.length;++ye<v&&le(N[ye],ye,N)!==!1;);return N}At.exports=Q},47443:function(At,Q,N){var le=N(42118);function ye(v,ve){var j=v==null?0:v.length;return!!j&&le(v,ve,0)>-1}At.exports=ye},1196:function(At){function Q(N,le,ye){for(var v=-1,ve=N==null?0:N.length;++v<ve;)if(ye(le,N[v]))return!0;return!1}At.exports=Q},62663:function(At){function Q(N,le,ye,v){var ve=-1,j=N==null?0:N.length;for(v&&j&&(ye=N[++ve]);++ve<j;)ye=le(ye,N[ve],ve,N);return ye}At.exports=Q},49029:function(At){var Q=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function N(le){return le.match(Q)||[]}At.exports=N},44037:function(At,Q,N){var le=N(98363),ye=N(3674);function v(ve,j){return ve&&le(j,ye(j),ve)}At.exports=v},63886:function(At,Q,N){var le=N(98363),ye=N(81704);function v(ve,j){return ve&&le(j,ye(j),ve)}At.exports=v},29750:function(At){function Q(N,le,ye){return N===N&&(ye!==void 0&&(N=N<=ye?N:ye),le!==void 0&&(N=N>=le?N:le)),N}At.exports=Q},85990:function(At,Q,N){var le=N(46384),ye=N(77412),v=N(34865),ve=N(44037),j=N(63886),ce=N(64626),se=N(278),Ne=N(18805),ae=N(1911),et=N(58234),Le=N(46904),it=N(64160),Ht=N(43824),sr=N(29148),Ct=N(38517),Jt=N(1469),Mt=N(44144),lt=N(56688),dt=N(13218),er=N(72928),Y=N(3674),$t=N(81704),gt=1,Qe=2,xt=4,$e="[object Arguments]",Kt="[object Array]",Sr="[object Boolean]",kr="[object Date]",Qr="[object Error]",we="[object Function]",Xe="[object GeneratorFunction]",De="[object Map]",St="[object Number]",vt="[object Object]",zt="[object RegExp]",qt="[object Set]",Cr="[object String]",Yn="[object Symbol]",vn="[object WeakMap]",Qi="[object ArrayBuffer]",jn="[object DataView]",Xn="[object Float32Array]",gi="[object Float64Array]",qn="[object Int8Array]",ui="[object Int16Array]",oa="[object Int32Array]",Fi="[object Uint8Array]",Ai="[object Uint8ClampedArray]",Gi="[object Uint16Array]",la="[object Uint32Array]",wi={};wi[$e]=wi[Kt]=wi[Qi]=wi[jn]=wi[Sr]=wi[kr]=wi[Xn]=wi[gi]=wi[qn]=wi[ui]=wi[oa]=wi[De]=wi[St]=wi[vt]=wi[zt]=wi[qt]=wi[Cr]=wi[Yn]=wi[Fi]=wi[Ai]=wi[Gi]=wi[la]=!0,wi[Qr]=wi[we]=wi[vn]=!1;function ba(Mn,Si,Ui,Ji,Xa,he){var Bn,Ya=Si&gt,ps=Si&Qe,jt=Si&xt;if(Ui&&(Bn=Xa?Ui(Mn,Ji,Xa,he):Ui(Mn)),Bn!==void 0)return Bn;if(!dt(Mn))return Mn;var ir=Jt(Mn);if(ir){if(Bn=Ht(Mn),!Ya)return se(Mn,Bn)}else{var Mr=it(Mn),I=Mr==we||Mr==Xe;if(Mt(Mn))return ce(Mn,Ya);if(Mr==vt||Mr==$e||I&&!Xa){if(Bn=ps||I?{}:Ct(Mn),!Ya)return ps?ae(Mn,j(Bn,Mn)):Ne(Mn,ve(Bn,Mn))}else{if(!wi[Mr])return Xa?Mn:{};Bn=sr(Mn,Mr,Ya)}}he||(he=new le);var ar=he.get(Mn);if(ar)return ar;he.set(Mn,Bn),er(Mn)?Mn.forEach(function(Vn){Bn.add(ba(Vn,Si,Ui,Vn,Mn,he))}):lt(Mn)&&Mn.forEach(function(Vn,rn){Bn.set(rn,ba(Vn,Si,Ui,rn,Mn,he))});var Ln=jt?ps?Le:et:ps?$t:Y,li=ir?void 0:Ln(Mn);return ye(li||Mn,function(Vn,rn){li&&(rn=Vn,Vn=Mn[rn]),v(Bn,rn,ba(Vn,Si,Ui,rn,Mn,he))}),Bn}At.exports=ba},41848:function(At){function Q(N,le,ye,v){for(var ve=N.length,j=ye+(v?1:-1);v?j--:++j<ve;)if(le(N[j],j,N))return j;return-1}At.exports=Q},42118:function(At,Q,N){var le=N(41848),ye=N(62722),v=N(42351);function ve(j,ce,se){return ce===ce?v(j,ce,se):le(j,ye,se)}At.exports=ve},25588:function(At,Q,N){var le=N(64160),ye=N(37005),v="[object Map]";function ve(j){return ye(j)&&le(j)==v}At.exports=ve},62722:function(At){function Q(N){return N!==N}At.exports=Q},29221:function(At,Q,N){var le=N(64160),ye=N(37005),v="[object Set]";function ve(j){return ye(j)&&le(j)==v}At.exports=ve},40371:function(At){function Q(N){return function(le){return le==null?void 0:le[N]}}At.exports=Q},18674:function(At){function Q(N){return function(le){return N==null?void 0:N[le]}}At.exports=Q},45652:function(At,Q,N){var le=N(88668),ye=N(47443),v=N(1196),ve=N(74757),j=N(23593),ce=N(21814),se=200;function Ne(ae,et,Le){var it=-1,Ht=ye,sr=ae.length,Ct=!0,Jt=[],Mt=Jt;if(Le)Ct=!1,Ht=v;else if(sr>=se){var lt=et?null:j(ae);if(lt)return ce(lt);Ct=!1,Ht=ve,Mt=new le}else Mt=et?[]:Jt;e:for(;++it<sr;){var dt=ae[it],er=et?et(dt):dt;if(dt=Le||dt!==0?dt:0,Ct&&er===er){for(var Y=Mt.length;Y--;)if(Mt[Y]===er)continue e;et&&Mt.push(er),Jt.push(dt)}else Ht(Mt,er,Le)||(Mt!==Jt&&Mt.push(er),Jt.push(dt))}return Jt}At.exports=Ne},57157:function(At,Q,N){var le=N(74318);function ye(v,ve){var j=ve?le(v.buffer):v.buffer;return new v.constructor(j,v.byteOffset,v.byteLength)}At.exports=ye},93147:function(At){var Q=/\w*$/;function N(le){var ye=new le.constructor(le.source,Q.exec(le));return ye.lastIndex=le.lastIndex,ye}At.exports=N},40419:function(At,Q,N){var le=N(62705),ye=le?le.prototype:void 0,v=ye?ye.valueOf:void 0;function ve(j){return v?Object(v.call(j)):{}}At.exports=ve},18805:function(At,Q,N){var le=N(98363),ye=N(99551);function v(ve,j){return le(ve,ye(ve),j)}At.exports=v},1911:function(At,Q,N){var le=N(98363),ye=N(51442);function v(ve,j){return le(ve,ye(ve),j)}At.exports=v},98805:function(At,Q,N){var le=N(40180),ye=N(62689),v=N(83140),ve=N(79833);function j(ce){return function(se){se=ve(se);var Ne=ye(se)?v(se):void 0,ae=Ne?Ne[0]:se.charAt(0),et=Ne?le(Ne,1).join(""):se.slice(1);return ae[ce]()+et}}At.exports=j},35393:function(At,Q,N){var le=N(62663),ye=N(53816),v=N(58748),ve="['\u2019]",j=RegExp(ve,"g");function ce(se){return function(Ne){return le(v(ye(Ne).replace(j,"")),se,"")}}At.exports=ce},23593:function(At,Q,N){var le=N(58525),ye=N(50308),v=N(21814),ve=1/0,j=le&&1/v(new le([,-0]))[1]==ve?function(ce){return new le(ce)}:ye;At.exports=j},69389:function(At,Q,N){var le=N(18674),ye={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=le(ye);At.exports=v},46904:function(At,Q,N){var le=N(68866),ye=N(51442),v=N(81704);function ve(j){return le(j,v,ye)}At.exports=ve},51442:function(At,Q,N){var le=N(62488),ye=N(85924),v=N(99551),ve=N(70479),j=Object.getOwnPropertySymbols,ce=j?function(se){for(var Ne=[];se;)le(Ne,v(se)),se=ye(se);return Ne}:ve;At.exports=ce},93157:function(At){var Q=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function N(le){return Q.test(le)}At.exports=N},43824:function(At){var Q=Object.prototype,N=Q.hasOwnProperty;function le(ye){var v=ye.length,ve=new ye.constructor(v);return v&&typeof ye[0]=="string"&&N.call(ye,"index")&&(ve.index=ye.index,ve.input=ye.input),ve}At.exports=le},29148:function(At,Q,N){var le=N(74318),ye=N(57157),v=N(93147),ve=N(40419),j=N(77133),ce="[object Boolean]",se="[object Date]",Ne="[object Map]",ae="[object Number]",et="[object RegExp]",Le="[object Set]",it="[object String]",Ht="[object Symbol]",sr="[object ArrayBuffer]",Ct="[object DataView]",Jt="[object Float32Array]",Mt="[object Float64Array]",lt="[object Int8Array]",dt="[object Int16Array]",er="[object Int32Array]",Y="[object Uint8Array]",$t="[object Uint8ClampedArray]",gt="[object Uint16Array]",Qe="[object Uint32Array]";function xt($e,Kt,Sr){var kr=$e.constructor;switch(Kt){case sr:return le($e);case ce:case se:return new kr(+$e);case Ct:return ye($e,Sr);case Jt:case Mt:case lt:case dt:case er:case Y:case $t:case gt:case Qe:return j($e,Sr);case Ne:return new kr;case ae:case it:return new kr($e);case et:return v($e);case Le:return new kr;case Ht:return ve($e)}}At.exports=xt},42351:function(At){function Q(N,le,ye){for(var v=ye-1,ve=N.length;++v<ve;)if(N[v]===le)return v;return-1}At.exports=Q},2757:function(At){var Q="\\ud800-\\udfff",N="\\u0300-\\u036f",le="\\ufe20-\\ufe2f",ye="\\u20d0-\\u20ff",v=N+le+ye,ve="\\u2700-\\u27bf",j="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",se="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ne="\\u2000-\\u206f",ae=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",et="A-Z\\xc0-\\xd6\\xd8-\\xde",Le="\\ufe0e\\ufe0f",it=ce+se+Ne+ae,Ht="['\u2019]",sr="["+it+"]",Ct="["+v+"]",Jt="\\d+",Mt="["+ve+"]",lt="["+j+"]",dt="[^"+Q+it+Jt+ve+j+et+"]",er="\\ud83c[\\udffb-\\udfff]",Y="(?:"+Ct+"|"+er+")",$t="[^"+Q+"]",gt="(?:\\ud83c[\\udde6-\\uddff]){2}",Qe="[\\ud800-\\udbff][\\udc00-\\udfff]",xt="["+et+"]",$e="\\u200d",Kt="(?:"+lt+"|"+dt+")",Sr="(?:"+xt+"|"+dt+")",kr="(?:"+Ht+"(?:d|ll|m|re|s|t|ve))?",Qr="(?:"+Ht+"(?:D|LL|M|RE|S|T|VE))?",we=Y+"?",Xe="["+Le+"]?",De="(?:"+$e+"(?:"+[$t,gt,Qe].join("|")+")"+Xe+we+")*",St="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",zt=Xe+we+De,qt="(?:"+[Mt,gt,Qe].join("|")+")"+zt,Cr=RegExp([xt+"?"+lt+"+"+kr+"(?="+[sr,xt,"$"].join("|")+")",Sr+"+"+Qr+"(?="+[sr,xt+Kt,"$"].join("|")+")",xt+"?"+Kt+"+"+kr,xt+"+"+Qr,vt,St,Jt,qt].join("|"),"g");function Yn(vn){return vn.match(Cr)||[]}At.exports=Yn},68929:function(At,Q,N){var le=N(48403),ye=N(35393),v=ye(function(ve,j,ce){return j=j.toLowerCase(),ve+(ce?le(j):j)});At.exports=v},48403:function(At,Q,N){var le=N(79833),ye=N(11700);function v(ve){return ye(le(ve).toLowerCase())}At.exports=v},74691:function(At,Q,N){var le=N(29750),ye=N(14841);function v(ve,j,ce){return ce===void 0&&(ce=j,j=void 0),ce!==void 0&&(ce=ye(ce),ce=ce===ce?ce:0),j!==void 0&&(j=ye(j),j=j===j?j:0),le(ye(ve),j,ce)}At.exports=v},50361:function(At,Q,N){var le=N(85990),ye=1,v=4;function ve(j){return le(j,ye|v)}At.exports=ve},53816:function(At,Q,N){var le=N(69389),ye=N(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve="\\u0300-\\u036f",j="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",se=ve+j+ce,Ne="["+se+"]",ae=RegExp(Ne,"g");function et(Le){return Le=ye(Le),Le&&Le.replace(v,le).replace(ae,"")}At.exports=et},56688:function(At,Q,N){var le=N(25588),ye=N(7518),v=N(31167),ve=v&&v.isMap,j=ve?ye(ve):le;At.exports=j},14293:function(At){function Q(N){return N==null}At.exports=Q},81763:function(At,Q,N){var le=N(44239),ye=N(37005),v="[object Number]";function ve(j){return typeof j=="number"||ye(j)&&le(j)==v}At.exports=ve},72928:function(At,Q,N){var le=N(29221),ye=N(7518),v=N(31167),ve=v&&v.isSet,j=ve?ye(ve):le;At.exports=j},47037:function(At,Q,N){var le=N(44239),ye=N(1469),v=N(37005),ve="[object String]";function j(ce){return typeof ce=="string"||!ye(ce)&&v(ce)&&le(ce)==ve}At.exports=j},52353:function(At){function Q(N){return N===void 0}At.exports=Q},30236:function(At,Q,N){var le=N(42980),ye=N(21463),v=ye(function(ve,j,ce,se){le(ve,j,ce,se)});At.exports=v},50308:function(At){function Q(){}At.exports=Q},44908:function(At,Q,N){var le=N(45652);function ye(v){return v&&v.length?le(v):[]}At.exports=ye},11700:function(At,Q,N){var le=N(98805),ye=le("toUpperCase");At.exports=ye},58748:function(At,Q,N){var le=N(49029),ye=N(93157),v=N(79833),ve=N(2757);function j(ce,se,Ne){return ce=v(ce),se=Ne?void 0:se,se===void 0?ye(ce)?ve(ce):le(ce):ce.match(se)||[]}At.exports=j},6158:function(At){(function(Q,N){At.exports=N()})(this,function(){"use strict";var Q,N,le;function ye(v,ve){if(!Q)Q=ve;else if(!N)N=ve;else{var j="var sharedChunk = {}; ("+Q+")(sharedChunk); ("+N+")(sharedChunk);",ce={};Q(ce),le=ve(ce),typeof window!="undefined"&&(le.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}return ye(["exports"],function(v){"use strict";function ve(t,o){return t(o={exports:{}},o.exports),o.exports}var j=ce;function ce(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,o){var u,h,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var P=this.sampleCurveDerivativeX(y);if(Math.abs(P)<1e-6)break;y-=b/P}if((y=t)<(u=0))return u;if(y>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:h=y,y=.5*(h-u)+u}return y},ce.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var se=Ne;function Ne(t,o){this.x=t,this.y=o}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),y=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(t){return t instanceof Ne?t:Array.isArray(t)?new Ne(t[0],t[1]):t};var ae=typeof self!="undefined"?self:{},et=Math.pow(2,53)-1;function Le(t,o,u,h){var y=new j(t,o,u,h);return function(b){return y.solve(b)}}var it=Le(.25,.1,.25,1);function Ht(t,o,u){return Math.min(u,Math.max(o,t))}function sr(t,o,u){var h=u-o,y=((t-o)%h+h)%h+o;return y===o?u:y}function Ct(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}var Jt=1;function Mt(){return Jt++}function lt(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function dt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function er(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Y(t,o){return t.indexOf(o,t.length-o.length)!==-1}function $t(t,o,u){var h={};for(var y in t)h[y]=o.call(u||this,t[y],y,t);return h}function gt(t,o,u){var h={};for(var y in t)o.call(u||this,t[y],y,t)&&(h[y]=t[y]);return h}function Qe(t){return Array.isArray(t)?t.map(Qe):typeof t=="object"&&t?$t(t,Qe):t}var xt={};function $e(t){xt[t]||(typeof console!="undefined"&&console.warn(t),xt[t]=!0)}function Kt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Sr(t){for(var o=0,u=0,h=t.length,y=h-1,b=void 0,S=void 0;u<h;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function kr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Qr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,y,b,S){var P=b||S;return o[y]=!P||P.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var we=null;function Xe(t){if(we==null){var o=t.navigator?t.navigator.userAgent:null;we=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return we}function De(t){try{var o=ae[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var St,vt,zt,qt,Cr=ae.performance&&ae.performance.now?ae.performance.now.bind(ae.performance):Date.now.bind(Date),Yn=ae.requestAnimationFrame||ae.mozRequestAnimationFrame||ae.webkitRequestAnimationFrame||ae.msRequestAnimationFrame,vn=ae.cancelAnimationFrame||ae.mozCancelAnimationFrame||ae.webkitCancelAnimationFrame||ae.msCancelAnimationFrame,Qi={now:Cr,frame:function(t){var o=Yn(t);return{cancel:function(){return vn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=ae.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return St||(St=ae.document.createElement("a")),St.href=t,St.href},hardwareConcurrency:ae.navigator&&ae.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ae.devicePixelRatio},get prefersReducedMotion(){return!!ae.matchMedia&&(vt==null&&(vt=ae.matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}},jn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Xn={supported:!1,testSupport:function(t){!gi&&qt&&(qn?ui(t):zt=t)}},gi=!1,qn=!1;function ui(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,qt),t.isContextLost())return;Xn.supported=!0}catch(u){}t.deleteTexture(o),gi=!0}ae.document&&((qt=ae.document.createElement("img")).onload=function(){zt&&ui(zt),zt=null,qn=!0},qt.onerror=function(){gi=!0,zt=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var oa="01",Fi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ai(t){return t.indexOf("mapbox:")===0}Fi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",oa,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Fi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Fi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Fi.prototype.normalizeStyleURL=function(t,o){if(!Ai(t))return t;var u=ba(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Fi.prototype.normalizeGlyphsURL=function(t,o){if(!Ai(t))return t;var u=ba(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Fi.prototype.normalizeSourceURL=function(t,o){if(!Ai(t))return t;var u=ba(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Fi.prototype.normalizeSpriteURL=function(t,o,u,h){var y=ba(t);return Ai(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||h)):(y.path+=""+o+u,Mn(y))},Fi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ai(t))return t;var u=ba(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Qi.devicePixelRatio>=2||o===512?"@2x":"")+(Xn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var P=S[b].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(u.params)||jn.ACCESS_TOKEN;return jn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},Fi.prototype.canonicalizeTileURL=function(t,o){var u=ba(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(h+="?"+y.join("&")),h},Fi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ai(o),h=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];la(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},Fi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=ba(jn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!jn.REQUIRE_ACCESS_TOKEN)return Mn(t);if(!(o=o||jn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),Mn(t)};var Gi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function la(t){return Gi.test(t)}var wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ba(t){var o=t.match(wi);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Mn(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Si(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(ae.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Ui=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Ui.prototype.getStorageKey=function(t){var o,u=Si(jn.ACCESS_TOKEN);return o=u&&u.u?ae.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,y){return String.fromCharCode(Number("0x"+y))})):jn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},Ui.prototype.fetchEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=ae.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var y=ae.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){$e("Unable to read from LocalStorage")}},Ui.prototype.saveEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ae.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ae.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){$e("Unable to write to LocalStorage")}},Ui.prototype.processRequests=function(t){},Ui.prototype.postEvent=function(t,o,u,h){var y=this;if(jn.EVENTS_URL){var b=ba(jn.EVENTS_URL);b.params.push("access_token="+(h||jn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:oa,userId:this.anonId},P=o?Ct(S,o):S,k={url:Mn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Aa(k,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(h)})}},Ui.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Ji,Xa,he=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,y,b){this.skuToken=y,(jn.EVENTS_URL&&b||jn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Ai(S)||la(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),dt(this.anonId)||(this.anonId=lt()),this.postEvent(S,{skuToken:this.skuToken},function(P){P||b&&(h.success[b]=!0)},u))}},o}(Ui),Bn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){jn.EVENTS_URL&&jn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Ai(y)||la(y)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Si(jn.ACCESS_TOKEN),b=y?y.u:jn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;dt(this.anonId)||(this.anonId=lt(),S=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),z=new Date(P),Z=(P-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||k.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(W){W||(h.eventData.lastSuccess=P,h.eventData.tokenU=b)},u)}},o}(Ui)),Ya=Bn.postTurnstileEvent.bind(Bn),ps=new he,jt=ps.postMapLoadEvent.bind(ps),ir=500,Mr=50;function I(){ae.caches&&!Ji&&(Ji=ae.caches.open("mapbox-tiles"))}function ar(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Ln,li=1/0;function Vn(){return Ln==null&&(Ln=ae.OffscreenCanvas&&new ae.OffscreenCanvas(1,1).getContext("2d")&&typeof ae.createImageBitmap=="function"),Ln}var rn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(rn);var Ii=function(t){function o(u,h,y){h===401&&la(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Oi=kr()?function(){return self.worker&&self.worker.referrer}:function(){return(ae.location.protocol==="blob:"?ae.parent:ae).location.href},eo,hs,ga=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Oi())&&!/^\w+:/.test(u))){if(ae.fetch&&ae.Request&&ae.AbortController&&ae.Request.prototype.hasOwnProperty("signal"))return function(h,y){var b,S=new ae.AbortController,P=new ae.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Oi(),signal:S.signal}),k=!1,z=!1,Z=(b=P.url).indexOf("sku=")>0&&la(b);h.type==="json"&&P.headers.set("Accept","application/json");var W=function(ie,Me,Re){if(!z){if(ie&&ie.message!=="SecurityError"&&$e(ie),Me&&Re)return ee(Me);var Ye=Date.now();ae.fetch(P).then(function(Ue){if(Ue.ok){var ut=Z?Ue.clone():null;return ee(Ue,ut,Ye)}return y(new Ii(Ue.statusText,Ue.status,h.url))}).catch(function(Ue){Ue.code!==20&&y(new Error(Ue.message))})}},ee=function(ie,Me,Re){(h.type==="arrayBuffer"?ie.arrayBuffer():h.type==="json"?ie.json():ie.text()).then(function(Ye){z||(Me&&Re&&function(Ue,ut,_t){if(I(),Ji){var Gt={status:ut.status,statusText:ut.statusText,headers:new ae.Headers};ut.headers.forEach(function(lr,wr){return Gt.headers.set(wr,lr)});var Yt=Qr(ut.headers.get("Cache-Control")||"");Yt["no-store"]||(Yt["max-age"]&&Gt.headers.set("Expires",new Date(_t+1e3*Yt["max-age"]).toUTCString()),new Date(Gt.headers.get("Expires")).getTime()-_t<42e4||function(lr,wr){if(Xa===void 0)try{new Response(new ReadableStream),Xa=!0}catch(Nr){Xa=!1}Xa?wr(lr.body):lr.blob().then(wr)}(ut,function(lr){var wr=new ae.Response(lr,Gt);I(),Ji&&Ji.then(function(Nr){return Nr.put(ar(Ue.url),wr)}).catch(function(Nr){return $e(Nr.message)})}))}}(P,Me,Re),k=!0,y(null,Ye,ie.headers.get("Cache-Control"),ie.headers.get("Expires")))}).catch(function(Ye){z||y(new Error(Ye.message))})};return Z?function(ie,Me){if(I(),!Ji)return Me(null);var Re=ar(ie.url);Ji.then(function(Ye){Ye.match(Re).then(function(Ue){var ut=function(_t){if(!_t)return!1;var Gt=new Date(_t.headers.get("Expires")||0),Yt=Qr(_t.headers.get("Cache-Control")||"");return Gt>Date.now()&&!Yt["no-cache"]}(Ue);Ye.delete(Re),ut&&Ye.put(Re,Ue.clone()),Me(null,Ue,ut)}).catch(Me)}).catch(Me)}(P,W):W(null,null),{cancel:function(){z=!0,k||S.abort()}}}(t,o);if(kr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,y){var b=new ae.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var P=b.response;if(h.type==="json")try{P=JSON.parse(b.response)}catch(k){return y(k)}y(null,P,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Ii(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},Fa=function(t,o){return ga(Ct(t,{type:"arrayBuffer"}),o)},Aa=function(t,o){return ga(Ct(t,{method:"POST"}),o)},H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";eo=[],hs=0;var K=function(t,o){if(Xn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hs>=jn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return eo.push(u),u}hs++;var h=!1,y=function(){if(!h)for(h=!0,hs--;eo.length&&hs<jn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=eo.shift();S.cancelled||(S.cancel=K(S.requestParameters,S.callback).cancel)}},b=Fa(t,function(S,P,k,z){y(),S?o(S):P&&(Vn()?function(Z,W){var ee=new ae.Blob([new Uint8Array(Z)],{type:"image/png"});ae.createImageBitmap(ee).then(function(ie){W(null,ie)}).catch(function(ie){W(new Error("Could not load image because of "+ie.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,o):function(Z,W,ee,ie){var Me=new ae.Image,Re=ae.URL;Me.onload=function(){W(null,Me),Re.revokeObjectURL(Me.src),Me.onload=null,ae.requestAnimationFrame(function(){Me.src=H})},Me.onerror=function(){return W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ye=new ae.Blob([new Uint8Array(Z)],{type:"image/png"});Me.cacheControl=ee,Me.expires=ie,Me.src=Z.byteLength?Re.createObjectURL(Ye):H}(P,o,k,z))});return{cancel:function(){b.cancel(),y()}}};function re(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ge(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Pe=function(t,o){o===void 0&&(o={}),Ct(this,o),this.type=t},Ge=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",Ct({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Pe),rt=function(){};rt.prototype.on=function(t,o){return this._listeners=this._listeners||{},re(t,o,this._listeners),this},rt.prototype.off=function(t,o){return ge(t,o,this._listeners),ge(t,o,this._oneTimeListeners),this},rt.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},re(t,o,this._oneTimeListeners),this},rt.prototype.fire=function(t,o){typeof t=="string"&&(t=new Pe(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<y.length;h+=1)y[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var P=S[b];ge(u,P,this._oneTimeListeners),P.call(this,t)}var k=this._eventedParent;k&&(Ct(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof Ge&&console.error(t.error);return this},rt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},rt.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Fe=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function mt(t){var o=t.value;return o?[new Fe(t.key,o,"constants have been deprecated as of v8")]:[]}function vr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}function Ft(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bt(t){if(Array.isArray(t))return t.map(Bt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Bt(t[u]);return o}return Ft(t)}var gr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),bn=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var y=h[u];this.bindings[y[0]]=y[1]}};bn.prototype.concat=function(t){return new bn(this,t)},bn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},bn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var cn={kind:"null"},wt={kind:"number"},on={kind:"string"},Hr={kind:"boolean"},Xr={kind:"color"},ii={kind:"object"},Jr={kind:"value"},Ti={kind:"collator"},ra={kind:"formatted"},Ei={kind:"resolvedImage"};function Ri(t,o){return{kind:"array",itemType:t,N:o}}function Ci(t){if(t.kind==="array"){var o=Ci(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var Jn=[cn,wt,on,Hr,Xr,ra,ii,Ri(Jr),Ei];function Yi(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Yi(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=Jn;u<h.length;u+=1)if(!Yi(h[u],o))return null}}return"Expected "+Ci(t)+" but found "+Ci(o)+" instead."}function Ba(t,o){return o.some(function(u){return u.kind===t.kind})}function sa(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Li=ve(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(P){return(P=Math.round(P))<0?0:P>255?255:P}function y(P){return h(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function b(P){return(k=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:k>1?1:k;var k}function S(P,k,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?P+(k-P)*z*6:2*z<1?k:3*z<2?P+(k-P)*(2/3-z)*6:P}try{o.parseCSSColor=function(P){var k,z=P.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(k=parseInt(z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:z.length===7&&(k=parseInt(z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var Z=z.indexOf("("),W=z.indexOf(")");if(Z!==-1&&W+1===z.length){var ee=z.substr(0,Z),ie=z.substr(Z+1,W-(Z+1)).split(","),Me=1;switch(ee){case"rgba":if(ie.length!==4)return null;Me=b(ie.pop());case"rgb":return ie.length!==3?null:[y(ie[0]),y(ie[1]),y(ie[2]),Me];case"hsla":if(ie.length!==4)return null;Me=b(ie.pop());case"hsl":if(ie.length!==3)return null;var Re=(parseFloat(ie[0])%360+360)%360/360,Ye=b(ie[1]),Ue=b(ie[2]),ut=Ue<=.5?Ue*(Ye+1):Ue+Ye-Ue*Ye,_t=2*Ue-ut;return[h(255*S(_t,ut,Re+1/3)),h(255*S(_t,ut,Re)),h(255*S(_t,ut,Re-1/3)),Me];default:return null}}return null}}catch(P){}}).parseCSSColor,Hi=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Hi.parse=function(t){if(t){if(t instanceof Hi)return t;if(typeof t=="string"){var o=Li(t);if(o)return new Hi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Hi.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Hi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1);var Za=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Za.prototype.compare=function(t,o){return this.collator.compare(t,o)},Za.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var au=function(t,o,u,h,y){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=y},wa=function(t){this.sections=t};wa.fromString=function(t){return new wa([new au(t,null,null,null,null)])},wa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},wa.factory=function(t){return t instanceof wa?t:wa.fromString(t)},wa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},wa.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var y={};h.fontStack&&(y["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(y["font-scale"]=h.scale),h.textColor&&(y["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(y)}}return t};var Ta=function(t){this.name=t.name,this.available=t.available};function Ss(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ds(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Hi||t instanceof Za||t instanceof wa||t instanceof Ta)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!ds(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!ds(t[h]))return!1;return!0}return!1}function na(t){if(t===null)return cn;if(typeof t=="string")return on;if(typeof t=="boolean")return Hr;if(typeof t=="number")return wt;if(t instanceof Hi)return Xr;if(t instanceof Za)return Ti;if(t instanceof wa)return ra;if(t instanceof Ta)return Ei;if(Array.isArray(t)){for(var o,u=t.length,h=0,y=t;h<y.length;h+=1){var b=na(y[h]);if(o){if(o===b)continue;o=Jr;break}o=b}return Ri(o||Jr,u)}return ii}function Zu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Hi||t instanceof wa||t instanceof Ta?t.toString():JSON.stringify(t)}Ta.prototype.toString=function(){return this.name},Ta.fromString=function(t){return t?new Ta({name:t,available:!1}):null},Ta.prototype.serialize=function(){return["image",this.name]};var So=function(t,o){this.type=t,this.value=o};So.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ds(t[1]))return o.error("invalid value");var u=t[1],h=na(u),y=o.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new So(h,u)},So.prototype.evaluate=function(){return this.value},So.prototype.eachChild=function(){},So.prototype.outputDefined=function(){return!0},So.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hi?["rgba"].concat(this.value.toArray()):this.value instanceof wa?this.value.serialize():this.value};var ja=function(t){this.name="ExpressionEvaluationError",this.message=t};ja.prototype.toJSON=function(){return this.message};var uo={string:on,number:wt,boolean:Hr,object:ii},ea=function(t,o){this.type=t,this.args=o};ea.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var P=t[1];if(typeof P!="string"||!(P in uo)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=uo[P],h++}else b=Jr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Ri(b,S)}else u=uo[y];for(var k=[];h<t.length;h++){var z=o.parse(t[h],h,Jr);if(!z)return null;k.push(z)}return new ea(u,k)},ea.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Yi(this.type,na(u)))return u;if(o===this.args.length-1)throw new ja("Expected value to be of type "+Ci(this.type)+", but found "+Ci(na(u))+" instead.")}return null},ea.prototype.eachChild=function(t){this.args.forEach(t)},ea.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ea.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var $o=function(t){this.type=ra,this.sections=t};$o.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var P=null;if(S["font-scale"]&&!(P=o.parse(S["font-scale"],1,wt)))return null;var k=null;if(S["text-font"]&&!(k=o.parse(S["text-font"],1,Ri(on))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Xr)))return null;var Z=h[h.length-1];Z.scale=P,Z.font=k,Z.textColor=z}else{var W=o.parse(t[b],1,Jr);if(!W)return null;var ee=W.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:W,scale:null,font:null,textColor:null})}}return new $o(h)},$o.prototype.evaluate=function(t){return new wa(this.sections.map(function(o){var u=o.content.evaluate(t);return na(u)===Ei?new au("",u,null,null,null):new au(Zu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},$o.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var y={};h.scale&&(y["font-scale"]=h.scale.serialize()),h.font&&(y["text-font"]=h.font.serialize()),h.textColor&&(y["text-color"]=h.textColor.serialize()),t.push(y)}return t};var Qo=function(t){this.type=Ei,this.input=t};Qo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,on);return u?new Qo(u):o.error("No image name provided.")},Qo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=Ta.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Qo.prototype.eachChild=function(t){t(this.input)},Qo.prototype.outputDefined=function(){return!1},Qo.prototype.serialize=function(){return["image",this.input.serialize()]};var ju={"to-boolean":Hr,"to-color":Xr,"to-number":wt,"to-string":on},To=function(t,o){this.type=t,this.args=o};To.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=ju[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,Jr);if(!S)return null;y.push(S)}return new To(h,y)},To.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,y=this.args;h<y.length;h+=1){if(u=null,(o=y[h].evaluate(t))instanceof Hi)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":Ss(o[0],o[1],o[2],o[3])))return new Hi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ja(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,P=0,k=this.args;P<k.length;P+=1){if((S=k[P].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new ja("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?wa.fromString(Zu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ta.fromString(Zu(this.args[0].evaluate(t))):Zu(this.args[0].evaluate(t))},To.prototype.eachChild=function(t){this.args.forEach(t)},To.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},To.prototype.serialize=function(){if(this.type.kind==="formatted")return new $o([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Qo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Jo=["Unknown","Point","LineString","Polygon"],ya=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ya.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ya.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Jo[this.feature.type]:this.feature.type:null},ya.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ya.prototype.canonicalID=function(){return this.canonical},ya.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ya.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Hi.parse(t)),o};var Co=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};Co.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Co.prototype.eachChild=function(t){this.args.forEach(t)},Co.prototype.outputDefined=function(){return!1},Co.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Co.parse=function(t,o){var u,h=t[0],y=Co.definitions[h];if(!y)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,P=S.filter(function(zn){var dn=zn[0];return!Array.isArray(dn)||dn.length===t.length-1}),k=null,z=0,Z=P;z<Z.length;z+=1){var W=Z[z],ee=W[0],ie=W[1];k=new Ks(o.registry,o.path,null,o.scope);for(var Me=[],Re=!1,Ye=1;Ye<t.length;Ye++){var Ue=t[Ye],ut=Array.isArray(ee)?ee[Ye-1]:ee.type,_t=k.parse(Ue,1+Me.length,ut);if(!_t){Re=!0;break}Me.push(_t)}if(!Re)if(Array.isArray(ee)&&ee.length!==Me.length)k.error("Expected "+ee.length+" arguments, but found "+Me.length+" instead.");else{for(var Gt=0;Gt<Me.length;Gt++){var Yt=Array.isArray(ee)?ee[Gt]:ee.type,lr=Me[Gt];k.concat(Gt+1).checkSubtype(Yt,lr.type)}if(k.errors.length===0)return new Co(h,b,ie,Me)}}if(P.length===1)(u=o.errors).push.apply(u,k.errors);else{for(var wr=(P.length?P:S).map(function(zn){var dn;return dn=zn[0],Array.isArray(dn)?"("+dn.map(Ci).join(", ")+")":"("+Ci(dn.type)+"...)"}).join(" | "),Nr=[],kn=1;kn<t.length;kn++){var hn=o.parse(t[kn],1+Nr.length);if(!hn)return null;Nr.push(Ci(hn.type))}o.error("Expected arguments of type "+wr+", but found ("+Nr.join(", ")+") instead.")}return null},Co.register=function(t,o){for(var u in Co.definitions=o,o)t[u]=Co};var es=function(t,o,u){this.type=Ti,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function lo(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function ou(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Cc(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(h*y*8192)]}function ks(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function $(t,o){for(var u,h,y,b,S,P,k,z=!1,Z=0,W=o.length;Z<W;Z++)for(var ee=o[Z],ie=0,Me=ee.length;ie<Me-1;ie++){if((b=(u=t)[0]-(h=ee[ie])[0])*(k=u[1]-(y=ee[ie+1])[1])-(P=u[0]-y[0])*(S=u[1]-h[1])==0&&b*P<=0&&S*k<=0)return!1;ks(t,ee[ie],ee[ie+1])&&(z=!z)}return z}function be(t,o){for(var u=0;u<o.length;u++)if($(t,o[u]))return!0;return!1}function Ke(t,o,u,h){var y=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),P=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&P<0||S<0&&P>0}function Rt(t,o,u){for(var h=0,y=u;h<y.length;h+=1)for(var b=y[h],S=0;S<b.length-1;++S)if((W=[(Z=b[S+1])[0]-(z=b[S])[0],Z[1]-z[1]])[0]*(ee=[(k=o)[0]-(P=t)[0],k[1]-P[1]])[1]-W[1]*ee[0]!=0&&Ke(P,k,z,Z)&&Ke(z,Z,P,k))return!0;var P,k,z,Z,W,ee;return!1}function Rr(t,o){for(var u=0;u<t.length;++u)if(!$(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(Rt(t[h],t[h+1],o))return!1;return!0}function ot(t,o){for(var u=0;u<o.length;u++)if(Rr(t,o[u]))return!0;return!1}function Tt(t,o,u){for(var h=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var P=Cc(t[y][S],u);lo(o,P),b.push(P)}h.push(b)}return h}function co(t,o,u){for(var h=[],y=0;y<t.length;y++){var b=Tt(t[y],o,u);h.push(b)}return h}function ta(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var y=.5*h,b=t[0]-u[0]>y?-h:u[0]-t[0]>y?h:0;b===0&&(b=t[0]-u[2]>y?-h:u[2]-t[0]>y?h:0),t[0]+=b}lo(o,t)}function qa(t,o,u,h){for(var y=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],P=0,k=t;P<k.length;P+=1)for(var z=0,Z=k[P];z<Z.length;z+=1){var W=Z[z],ee=[W.x+b[0],W.y+b[1]];ta(ee,o,u,y),S.push(ee)}return S}function ts(t,o,u,h){for(var y,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],P=[],k=0,z=t;k<z.length;k+=1){for(var Z=[],W=0,ee=z[k];W<ee.length;W+=1){var ie=ee[W],Me=[ie.x+S[0],ie.y+S[1]];lo(o,Me),Z.push(Me)}P.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Re=0,Ye=P;Re<Ye.length;Re+=1)for(var Ue=0,ut=Ye[Re];Ue<ut.length;Ue+=1)ta(ut[Ue],o,u,b)}return P}es.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Hr);if(!h)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Hr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,on))?null:new es(h,y,b)},es.prototype.evaluate=function(t){return new Za(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},es.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},es.prototype.outputDefined=function(){return!1},es.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var sn=function(t,o){this.type=Hr,this.geojson=t,this.geometries=o};function en(t){if(t instanceof Co&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof sn)return!1;var o=!0;return t.eachChild(function(u){o&&!en(u)&&(o=!1)}),o}function Nt(t){if(t instanceof Co&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Nt(u)&&(o=!1)}),o}function Vo(t,o){if(t instanceof Co&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!Vo(h,o)&&(u=!1)}),u}sn.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ds(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var y=u.features[h].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new sn(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new sn(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new sn(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},sn.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Tt(u.coordinates,y,b),P=qa(o.geometry(),h,y,b);if(!ou(h,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!$(z[k],S))return!1}if(u.type==="MultiPolygon"){var Z=co(u.coordinates,y,b),W=qa(o.geometry(),h,y,b);if(!ou(h,y))return!1;for(var ee=0,ie=W;ee<ie.length;ee+=1)if(!be(ie[ee],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Tt(u.coordinates,y,b),P=ts(o.geometry(),h,y,b);if(!ou(h,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!Rr(z[k],S))return!1}if(u.type==="MultiPolygon"){var Z=co(u.coordinates,y,b),W=ts(o.geometry(),h,y,b);if(!ou(h,y))return!1;for(var ee=0,ie=W;ee<ie.length;ee+=1)if(!ot(ie[ee],Z))return!1}return!0}(t,this.geometries)}return!1},sn.prototype.eachChild=function(){},sn.prototype.outputDefined=function(){return!0},sn.prototype.serialize=function(){return["within",this.geojson]};var de=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};de.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new de(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},de.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},de.prototype.eachChild=function(){},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){return["var",this.name]};var Ks=function(t,o,u,h,y){o===void 0&&(o=[]),h===void 0&&(h=new bn),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=y,this.expectedType=u};function su(t,o){for(var u,h=t.length-1,y=0,b=h,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===h||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new ja("Input is not a number.");b=S-1}return 0}Ks.prototype.parse=function(t,o,u,h,y){return y===void 0&&(y={}),o?this.concat(o,u,h)._parse(t,y):this._parse(t,y)},Ks.prototype._parse=function(t,o){function u(z,Z,W){return W==="assert"?new ea(Z,[z]):W==="coerce"?new To(Z,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[h];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,P=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof So)&&b.type.kind!=="resolvedImage"&&function z(Z){if(Z instanceof de)return z(Z.boundExpression);if(Z instanceof Co&&Z.name==="error"||Z instanceof es||Z instanceof sn)return!1;var W=Z instanceof To||Z instanceof ea,ee=!0;return Z.eachChild(function(ie){ee=W?ee&&z(ie):ee&&ie instanceof So}),!!ee&&en(Z)&&Vo(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var k=new ya;try{b=new So(b.type,b.evaluate(k))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ks.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Ks(this.registry,h,o||null,y,this.errors)},Ks.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new gr(h,t))},Ks.prototype.checkSubtype=function(t,o){var u=Yi(t,o);return u&&this.error(u),u};var vs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,y=u;h<y.length;h+=1){var b=y[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ua(t,o,u){return t*(1-u)+o*u}vs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,wt);if(!u)return null;var h=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],P=t[b+1],k=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var Z=o.parse(P,z,y);if(!Z)return null;y=y||Z.type,h.push([S,Z])}return new vs(y,u,h)},vs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;return h>=o[y-1]?u[y-1].evaluate(t):u[su(o,h)].evaluate(t)},vs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},vs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},vs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var Ao=Object.freeze({__proto__:null,number:ua,color:function(t,o,u){return new Hi(ua(t.r,o.r,u),ua(t.g,o.g,u),ua(t.b,o.b,u),ua(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,y){return ua(h,o[y],u)})}}),ql=6/29*3*(6/29),Ac=Math.PI/180,Vu=180/Math.PI;function wc(t){return t>.008856451679035631?Math.pow(t,1/3):t/ql+4/29}function Tl(t){return t>6/29?t*t*t:ql*(t-4/29)}function Gu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function uu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Hu(t){var o=uu(t.r),u=uu(t.g),h=uu(t.b),y=wc((.4124564*o+.3575761*u+.1804375*h)/.95047),b=wc((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-wc((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*Tl(o),u=.95047*Tl(u),h=1.08883*Tl(h),new Hi(Gu(3.2404542*u-1.5371385*o-.4985314*h),Gu(-.969266*u+1.8760108*o+.041556*h),Gu(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function T(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var F={forward:Hu,reverse:_,interpolate:function(t,o,u){return{l:ua(t.l,o.l,u),a:ua(t.a,o.a,u),b:ua(t.b,o.b,u),alpha:ua(t.alpha,o.alpha,u)}}},O={forward:function(t){var o=Hu(t),u=o.l,h=o.a,y=o.b,b=Math.atan2(y,h)*Vu;return{h:b<0?b+360:b,c:Math.sqrt(h*h+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*Ac,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:T(t.h,o.h,u),c:ua(t.c,o.c,u),l:ua(t.l,o.l,u),alpha:ua(t.alpha,o.alpha,u)}}},q=Object.freeze({__proto__:null,lab:F,hcl:O}),xe=function(t,o,u,h,y){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var P=S[b],k=P[1];this.labels.push(P[0]),this.outputs.push(k)}};function We(t,o,u,h){var y=h-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}xe.interpolationFactor=function(t,o,u,h){var y=0;if(t.name==="exponential")y=We(o,t.base,u,h);else if(t.name==="linear")y=We(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new j(b[0],b[1],b[2],b[3]).solve(We(o,1,u,h))}return y},xe.parse=function(t,o){var u=t[0],h=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var P=h.slice(1);if(P.length!==4||P.some(function(Ye){return typeof Ye!="number"||Ye<0||Ye>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:P}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,wt)))return null;var k=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Xr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var W=b[Z],ee=b[Z+1],ie=Z+3,Me=Z+4;if(typeof W!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ie);if(k.length&&k[k.length-1][0]>=W)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ie);var Re=o.parse(ee,Me,z);if(!Re)return null;z=z||Re.type,k.push([W,Re])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new xe(z,u,h,y,k):o.error("Type "+Ci(z)+" is not interpolatable.")},xe.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;if(h>=o[y-1])return u[y-1].evaluate(t);var b=su(o,h),S=xe.interpolationFactor(this.interpolation,h,o[b],o[b+1]),P=u[b].evaluate(t),k=u[b+1].evaluate(t);return this.operator==="interpolate"?Ao[this.type.kind.toLowerCase()](P,k,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(P),O.forward(k),S)):F.reverse(F.interpolate(F.forward(P),F.forward(k),S))},xe.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},xe.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},xe.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ct=function(t,o){this.type=t,this.args=o};ct.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var P=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,y.push(P)}var k=h&&y.some(function(z){return Yi(h,z.type)});return new ct(k?Jr:u,y)},ct.prototype.evaluate=function(t){for(var o,u=null,h=0,y=0,b=this.args;y<b.length&&(h++,(u=b[y].evaluate(t))&&u instanceof Ta&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);y+=1);return u},ct.prototype.eachChild=function(t){this.args.forEach(t)},ct.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ct.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var ht=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};ht.prototype.evaluate=function(t){return this.result.evaluate(t)},ht.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},ht.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var y=t[h];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",h);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new ht(u,S):null},ht.prototype.outputDefined=function(){return this.result.outputDefined()},ht.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var cr=function(t,o,u){this.type=t,this.index=o,this.input=u};cr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,wt),h=o.parse(t[2],2,Ri(o.expectedType||Jr));return u&&h?new cr(h.type.itemType,u,h):null},cr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new ja("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new ja("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new ja("Array index must be an integer, but found "+o+" instead.");return u[o]},cr.prototype.eachChild=function(t){t(this.index),t(this.input)},cr.prototype.outputDefined=function(){return!1},cr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var xr=function(t,o){this.type=Hr,this.needle=t,this.haystack=o};xr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Jr),h=o.parse(t[2],2,Jr);return u&&h?Ba(u.type,[Hr,on,wt,cn,Jr])?new xr(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+Ci(u.type)+" instead"):null},xr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!sa(o,["boolean","string","number","null"]))throw new ja("Expected first argument to be of type boolean, string, number or null, but found "+Ci(na(o))+" instead.");if(!sa(u,["string","array"]))throw new ja("Expected second argument to be of type array or string, but found "+Ci(na(u))+" instead.");return u.indexOf(o)>=0},xr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},xr.prototype.outputDefined=function(){return!0},xr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var In=function(t,o,u){this.type=wt,this.needle=t,this.haystack=o,this.fromIndex=u};In.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Jr),h=o.parse(t[2],2,Jr);if(!u||!h)return null;if(!Ba(u.type,[Hr,on,wt,cn,Jr]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+Ci(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,wt);return y?new In(u,h,y):null}return new In(u,h)},In.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!sa(o,["boolean","string","number","null"]))throw new ja("Expected first argument to be of type boolean, string, number or null, but found "+Ci(na(o))+" instead.");if(!sa(u,["string","array"]))throw new ja("Expected second argument to be of type array or string, but found "+Ci(na(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},In.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},In.prototype.outputDefined=function(){return!1},In.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ci=function(t,o,u,h,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=y,this.otherwise=b};ci.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var P=t[S],k=t[S+1];Array.isArray(P)||(P=[P]);var z=o.concat(S);if(P.length===0)return z.error("Expected at least one branch label.");for(var Z=0,W=P;Z<W.length;Z+=1){var ee=W[Z];if(typeof ee!="number"&&typeof ee!="string")return z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,na(ee)))return null}else u=na(ee);if(y[String(ee)]!==void 0)return z.error("Branch labels must be unique.");y[String(ee)]=b.length}var ie=o.parse(k,S,h);if(!ie)return null;h=h||ie.type,b.push(ie)}var Me=o.parse(t[1],1,Jr);if(!Me)return null;var Re=o.parse(t[t.length-1],t.length-1,h);return Re?Me.type.kind!=="value"&&o.concat(1).checkSubtype(u,Me.type)?null:new ci(u,h,Me,y,b,Re):null},ci.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(na(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ci.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ci.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ci.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(W=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[W][1].push(S)}for(var P=function(ie){return t.inputType.kind==="number"?Number(ie):ie},k=0,z=u;k<z.length;k+=1){var Z=z[k],W=Z[0],ee=Z[1];o.push(ee.length===1?P(ee[0]):ee.map(P)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Qn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Qn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Hr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var P=o.parse(t[t.length-1],t.length-1,u);return P?new Qn(u,h,P):null},Qn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];if(h[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Qn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];t(h[0]),t(y)}t(this.otherwise)},Qn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Qn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var qi=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function fa(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function La(t,o,u,h){return h.compare(o,u)===0}function Wi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function y(b,S,P){this.type=Hr,this.lhs=b,this.rhs=S,this.collator=P,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var P=b[0],k=S.parse(b[1],1,Jr);if(!k)return null;if(!fa(P,k.type))return S.concat(1).error('"'+P+`" comparisons are not supported for type '`+Ci(k.type)+"'.");var z=S.parse(b[2],2,Jr);if(!z)return null;if(!fa(P,z.type))return S.concat(2).error('"'+P+`" comparisons are not supported for type '`+Ci(z.type)+"'.");if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+Ci(k.type)+"' and '"+Ci(z.type)+"'.");h&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new ea(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new ea(k.type,[z])));var Z=null;if(b.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,Ti)))return null}return new y(k,z,Z)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),P=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var k=na(S),z=na(P);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new ja('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Z=na(S),W=na(P);if(Z.kind!=="string"||W.kind!=="string")return o(b,S,P)}return this.collator?u(b,S,P,this.collator.evaluate(b)):o(b,S,P)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}qi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Jr),h=o.parse(t[2],2,wt);if(!u||!h)return null;if(!Ba(u.type,[Ri(Jr),on,Jr]))return o.error("Expected first argument to be of type array or string, but found "+Ci(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,wt);return y?new qi(u.type,u,h,y):null}return new qi(u.type,u,h)},qi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!sa(o,["string","array"]))throw new ja("Expected first argument to be of type array or string, but found "+Ci(na(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},qi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},qi.prototype.outputDefined=function(){return!1},qi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Fo=Wi("==",function(t,o,u){return o===u},La),Cs=Wi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!La(0,o,u,h)}),cl=Wi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),qc=Wi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),Wu=Wi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),Tc=Wi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Iu=function(t,o,u,h,y){this.type=on,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=y};Iu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,wt);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var y=null;if(h.locale&&!(y=o.parse(h.locale,1,on)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,on)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,wt)))return null;var P=null;return h["max-fraction-digits"]&&!(P=o.parse(h["max-fraction-digits"],1,wt))?null:new Iu(u,y,b,S,P)},Iu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Iu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Iu.prototype.outputDefined=function(){return!1},Iu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var mu=function(t){this.type=wt,this.input=t};mu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+Ci(u.type)+" instead."):new mu(u):null},mu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ja("Expected value to be of type string or array, but found "+Ci(na(o))+" instead.")},mu.prototype.eachChild=function(t){t(this.input)},mu.prototype.outputDefined=function(){return!1},mu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Mo={"==":Fo,"!=":Cs,">":qc,"<":cl,">=":Tc,"<=":Wu,array:ea,at:cr,boolean:ea,case:Qn,coalesce:ct,collator:es,format:$o,image:Qo,in:xr,"index-of":In,interpolate:xe,"interpolate-hcl":xe,"interpolate-lab":xe,length:mu,let:ht,literal:So,match:ci,number:ea,"number-format":Iu,object:ea,slice:qi,step:vs,string:ea,"to-boolean":To,"to-color":To,"to-number":To,"to-string":To,var:de,within:sn};function pa(t,o){var u=o[0],h=o[1],y=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,P=Ss(u,h,y,S);if(P)throw new ja(P);return new Hi(u/255*S,h/255*S,y/255*S,S)}function up(t,o){return t in o}function lp(t,o){var u=o[t];return u===void 0?null:u}function go(t){return{type:t}}function If(t){return{result:"success",value:t}}function gu(t){return{result:"error",value:t}}function Ds(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Mc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function fl(t){return!!t.expression&&t.expression.interpolated}function Ea(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ml(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Kl(t){return t}function is(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Of(t,o,u,h,y){return is(typeof u===y?h[u]:void 0,t.default,o.default)}function cp(t,o,u){if(Ea(u)!=="number")return is(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var y=su(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function fp(t,o,u){var h=t.base!==void 0?t.base:1;if(Ea(u)!=="number")return is(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=su(t.stops.map(function(W){return W[0]}),u),S=function(W,ee,ie,Me){var Re=Me-ie,Ye=W-ie;return Re===0?0:ee===1?Ye/Re:(Math.pow(ee,Ye)-1)/(Math.pow(ee,Re)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),P=t.stops[b][1],k=t.stops[b+1][1],z=Ao[o.type]||Kl;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=q[t.colorSpace];z=function(W,ee){return Z.reverse(Z.interpolate(Z.forward(W),Z.forward(ee),S))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var W=[],ee=arguments.length;ee--;)W[ee]=arguments[ee];var ie=P.evaluate.apply(void 0,W),Me=k.evaluate.apply(void 0,W);if(ie!==void 0&&Me!==void 0)return z(ie,Me,S)}}:z(P,k,S)}function Kc(t,o,u){return o.type==="color"?u=Hi.parse(u):o.type==="formatted"?u=wa.fromString(u.toString()):o.type==="resolvedImage"?u=Ta.fromString(u.toString()):Ea(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),is(u,t.default,o.default)}Co.register(Mo,{error:[{kind:"error"},[on],function(t,o){throw new ja(o[0].evaluate(t))}],typeof:[on,[Jr],function(t,o){return Ci(na(o[0].evaluate(t)))}],"to-rgba":[Ri(wt,4),[Xr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Xr,[wt,wt,wt],pa],rgba:[Xr,[wt,wt,wt,wt],pa],has:{type:Hr,overloads:[[[on],function(t,o){return up(o[0].evaluate(t),t.properties())}],[[on,ii],function(t,o){var u=o[1];return up(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:Jr,overloads:[[[on],function(t,o){return lp(o[0].evaluate(t),t.properties())}],[[on,ii],function(t,o){var u=o[1];return lp(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[Jr,[on],function(t,o){return lp(o[0].evaluate(t),t.featureState||{})}],properties:[ii,[],function(t){return t.properties()}],"geometry-type":[on,[],function(t){return t.geometryType()}],id:[Jr,[],function(t){return t.id()}],zoom:[wt,[],function(t){return t.globals.zoom}],"heatmap-density":[wt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[wt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Jr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[wt,go(wt),function(t,o){for(var u=0,h=0,y=o;h<y.length;h+=1)u+=y[h].evaluate(t);return u}],"*":[wt,go(wt),function(t,o){for(var u=1,h=0,y=o;h<y.length;h+=1)u*=y[h].evaluate(t);return u}],"-":{type:wt,overloads:[[[wt,wt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[wt],function(t,o){return-o[0].evaluate(t)}]]},"/":[wt,[wt,wt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[wt,[wt,wt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[wt,[],function(){return Math.LN2}],pi:[wt,[],function(){return Math.PI}],e:[wt,[],function(){return Math.E}],"^":[wt,[wt,wt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[wt,[wt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[wt,[wt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[wt,[wt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[wt,[wt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[wt,[wt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[wt,[wt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[wt,[wt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[wt,[wt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[wt,[wt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[wt,[wt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[wt,go(wt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[wt,go(wt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[wt,[wt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[wt,[wt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[wt,[wt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[wt,[wt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Hr,[on,Jr],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Hr,[Jr],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Hr,[on],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Hr,[on,Jr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Hr,[Jr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<y}],"filter->":[Hr,[on,Jr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[Hr,[Jr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>y}],"filter-<=":[Hr,[on,Jr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Hr,[Jr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<=y}],"filter->=":[Hr,[on,Jr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Hr,[Jr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>=y}],"filter-has":[Hr,[Jr],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Hr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Hr,[Ri(on)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Hr,[Ri(Jr)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Hr,[on,Ri(Jr)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Hr,[on,Ri(Jr)],function(t,o){var u=o[0],h=o[1];return function(y,b,S,P){for(;S<=P;){var k=S+P>>1;if(b[k]===y)return!0;b[k]>y?P=k-1:S=k+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Hr,overloads:[[[Hr,Hr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[go(Hr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Hr,overloads:[[[Hr,Hr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[go(Hr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Hr,[Hr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Hr,[on],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[on,[on],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[on,[on],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[on,go(Jr),function(t,o){return o.map(function(u){return Zu(u.evaluate(t))}).join("")}],"resolved-locale":[on,[Ti],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var pl=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new ya,this._defaultValue=o?function(u){return u.type==="color"&&Ml(u.default)?new Hi(0,0,0,0):u.type==="color"?Hi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Go(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Mo}function Ou(t,o){var u=new Ks(Mo,[],o?function(y){var b={color:Xr,string:on,number:wt,enum:on,boolean:Hr,formatted:ra,resolvedImage:Ei};return y.type==="array"?Ri(b[y.value]||Jr,y.length):b[y.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?If(new pl(h,o)):gu(u.errors)}pl.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},pl.prototype.evaluate=function(t,o,u,h,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new ja("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Xu=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Nt(o.expression)};Xu.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},Xu.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)};var Ho=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Nt(o.expression),this.interpolationType=h};function Pl(t,o){if((t=Ou(t,o)).result==="error")return t;var u=t.value.expression,h=en(u);if(!h&&!Ds(o))return gu([new gr("","data expressions not supported")]);var y=Vo(u,["zoom"]);if(!y&&!Mc(o))return gu([new gr("","zoom expressions not supported")]);var b=function S(P){var k=null;if(P instanceof ht)k=S(P.result);else if(P instanceof ct)for(var z=0,Z=P.args;z<Z.length&&!(k=S(Z[z]));z+=1);else(P instanceof vs||P instanceof xe)&&P.input instanceof Co&&P.input.name==="zoom"&&(k=P);return k instanceof gr||P.eachChild(function(W){var ee=S(W);ee instanceof gr?k=ee:!k&&ee?k=new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&ee&&k!==ee&&(k=new gr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(u);return b||y?b instanceof gr?gu([b]):b instanceof xe&&!fl(o)?gu([new gr("",'"interpolate" expressions cannot be used with this property')]):If(b?new Ho(h?"camera":"composite",t.value,b.labels,b instanceof xe?b.interpolation:void 0):new Xu(h?"constant":"source",t.value)):gu([new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Ho.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},Ho.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)},Ho.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?xe.interpolationFactor(this.interpolationType,t,o,u):0};var Yu=function(t,o){this._parameters=t,this._specification=o,vr(this,function u(h,y){var b,S,P,k=y.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",Z=z||!(z||h.property!==void 0),W=h.type||(fl(y)?"exponential":"interval");if(k&&((h=vr({},h)).stops&&(h.stops=h.stops.map(function(hn){return[hn[0],Hi.parse(hn[1])]})),h.default=Hi.parse(h.default?h.default:y.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!q[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(W==="exponential")b=fp;else if(W==="interval")b=cp;else if(W==="categorical"){b=Of,S=Object.create(null);for(var ee=0,ie=h.stops;ee<ie.length;ee+=1){var Me=ie[ee];S[Me[0]]=Me[1]}P=typeof h.stops[0][0]}else{if(W!=="identity")throw new Error('Unknown function type "'+W+'"');b=Kc}if(z){for(var Re={},Ye=[],Ue=0;Ue<h.stops.length;Ue++){var ut=h.stops[Ue],_t=ut[0].zoom;Re[_t]===void 0&&(Re[_t]={zoom:_t,type:h.type,property:h.property,default:h.default,stops:[]},Ye.push(_t)),Re[_t].stops.push([ut[0].value,ut[1]])}for(var Gt=[],Yt=0,lr=Ye;Yt<lr.length;Yt+=1){var wr=lr[Yt];Gt.push([Re[wr].zoom,u(Re[wr],y)])}var Nr={name:"linear"};return{kind:"composite",interpolationType:Nr,interpolationFactor:xe.interpolationFactor.bind(void 0,Nr),zoomStops:Gt.map(function(hn){return hn[0]}),evaluate:function(hn,zn){var dn=hn.zoom;return fp({stops:Gt,base:h.base},y,dn).evaluate(dn,zn)}}}if(Z){var kn=W==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:kn,interpolationFactor:xe.interpolationFactor.bind(void 0,kn),zoomStops:h.stops.map(function(hn){return hn[0]}),evaluate:function(hn){return b(h,y,hn.zoom,S,P)}}}return{kind:"source",evaluate:function(hn,zn){var dn=zn&&zn.properties?zn.properties[h.property]:void 0;return dn===void 0?is(h.default,y.default):b(h,y,dn,S,P)}}}(this._parameters,this._specification))};function $s(t){var o=t.key,u=t.value,h=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,P=[],k=Ea(u);if(k!=="object")return[new Fe(o,u,"object expected, "+k+" found")];for(var z in u){var Z=z.split(".")[0],W=h[Z]||h["*"],ee=void 0;if(y[Z])ee=y[Z];else if(h[Z])ee=Bi;else if(y["*"])ee=y["*"];else{if(!h["*"]){P.push(new Fe(o,u[z],'unknown property "'+z+'"'));continue}ee=Bi}P=P.concat(ee({key:(o&&o+".")+z,value:u[z],valueSpec:W,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var ie in h)y[ie]||h[ie].required&&h[ie].default===void 0&&u[ie]===void 0&&P.push(new Fe(o,u,'missing required property "'+ie+'"'));return P}function $c(t){var o=t.value,u=t.valueSpec,h=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Bi;if(Ea(o)!=="array")return[new Fe(b,o,"array expected, "+Ea(o)+" found")];if(u.length&&o.length!==u.length)return[new Fe(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Fe(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var P={type:u.value,values:u.values};y.$version<7&&(P.function=u.function),Ea(u.value)==="object"&&(P=u.value);for(var k=[],z=0;z<o.length;z++)k=k.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:P,style:h,styleSpec:y,key:b+"["+z+"]"}));return k}function Qc(t){var o=t.key,u=t.value,h=t.valueSpec,y=Ea(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Fe(o,u,"number expected, "+y+" found")]:"minimum"in h&&u<h.minimum?[new Fe(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new Fe(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function Jc(t){var o,u,h,y=t.valueSpec,b=Ft(t.value.type),S={},P=b!=="categorical"&&t.value.property===void 0,k=!P,z=Ea(t.value.stops)==="array"&&Ea(t.value.stops[0])==="array"&&Ea(t.value.stops[0][0])==="object",Z=$s({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ie){if(b==="identity")return[new Fe(ie.key,ie.value,'identity function may not have a "stops" property')];var Me=[],Re=ie.value;return Me=Me.concat($c({key:ie.key,value:Re,valueSpec:ie.valueSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:W})),Ea(Re)==="array"&&Re.length===0&&Me.push(new Fe(ie.key,Re,"array must have at least one stop")),Me},default:function(ie){return Bi({key:ie.key,value:ie.value,valueSpec:y,style:ie.style,styleSpec:ie.styleSpec})}}});return b==="identity"&&P&&Z.push(new Fe(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new Fe(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!fl(t.valueSpec)&&Z.push(new Fe(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!Ds(t.valueSpec)?Z.push(new Fe(t.key,t.value,"property functions not supported")):P&&!Mc(t.valueSpec)&&Z.push(new Fe(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||Z.push(new Fe(t.key,t.value,'"property" property is required')),Z;function W(ie){var Me=[],Re=ie.value,Ye=ie.key;if(Ea(Re)!=="array")return[new Fe(Ye,Re,"array expected, "+Ea(Re)+" found")];if(Re.length!==2)return[new Fe(Ye,Re,"array length 2 expected, length "+Re.length+" found")];if(z){if(Ea(Re[0])!=="object")return[new Fe(Ye,Re,"object expected, "+Ea(Re[0])+" found")];if(Re[0].zoom===void 0)return[new Fe(Ye,Re,"object stop key must have zoom")];if(Re[0].value===void 0)return[new Fe(Ye,Re,"object stop key must have value")];if(h&&h>Ft(Re[0].zoom))return[new Fe(Ye,Re[0].zoom,"stop zoom values must appear in ascending order")];Ft(Re[0].zoom)!==h&&(h=Ft(Re[0].zoom),u=void 0,S={}),Me=Me.concat($s({key:Ye+"[0]",value:Re[0],valueSpec:{zoom:{}},style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:Qc,value:ee}}))}else Me=Me.concat(ee({key:Ye+"[0]",value:Re[0],valueSpec:{},style:ie.style,styleSpec:ie.styleSpec},Re));return Go(Bt(Re[1]))?Me.concat([new Fe(Ye+"[1]",Re[1],"expressions are not allowed in function stops.")]):Me.concat(Bi({key:Ye+"[1]",value:Re[1],valueSpec:y,style:ie.style,styleSpec:ie.styleSpec}))}function ee(ie,Me){var Re=Ea(ie.value),Ye=Ft(ie.value),Ue=ie.value!==null?ie.value:Me;if(o){if(Re!==o)return[new Fe(ie.key,Ue,Re+" stop domain type must match previous stop domain type "+o)]}else o=Re;if(Re!=="number"&&Re!=="string"&&Re!=="boolean")return[new Fe(ie.key,Ue,"stop domain value must be a number, string, or boolean")];if(Re!=="number"&&b!=="categorical"){var ut="number expected, "+Re+" found";return Ds(y)&&b===void 0&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(ie.key,Ue,ut)]}return b!=="categorical"||Re!=="number"||isFinite(Ye)&&Math.floor(Ye)===Ye?b!=="categorical"&&Re==="number"&&u!==void 0&&Ye<u?[new Fe(ie.key,Ue,"stop domain values must appear in ascending order")]:(u=Ye,b==="categorical"&&Ye in S?[new Fe(ie.key,Ue,"stop domain values must be unique")]:(S[Ye]=!0,[])):[new Fe(ie.key,Ue,"integer expected, found "+Ye)]}}function qu(t){var o=(t.expressionContext==="property"?Pl:Ou)(Bt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new Fe(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Fe(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Nt(u))return[new Fe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Nt(u))return[new Fe(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Vo(u,["zoom","feature-state"]))return[new Fe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!en(u))return[new Fe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $l(t){var o=t.key,u=t.value,h=t.valueSpec,y=[];return Array.isArray(h.values)?h.values.indexOf(Ft(u))===-1&&y.push(new Fe(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(Ft(u))===-1&&y.push(new Fe(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Pc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Pc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Yu.deserialize=function(t){return new Yu(t._parameters,t._specification)},Yu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var ef={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ic(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Pc(t)||(t=Oc(t));var o=Ou(t,ef);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,y){return o.value.evaluate(u,h,{},y)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var y=1;y<h.length;y++)if(u(h[y]))return!0;return!1}(t)}}function pp(t,o){return t<o?-1:t>o?1:0}function Oc(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?hl(t[1],t[2],"=="):u==="!="?Ru(hl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?hl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Oc))):u==="all"?["all"].concat(t.slice(1).map(Oc)):u==="none"?["all"].concat(t.slice(1).map(Oc).map(Ru)):u==="in"?tf(t[1],t.slice(2)):u==="!in"?Ru(tf(t[1],t.slice(2))):u==="has"?rf(t[1]):u==="!has"?Ru(rf(t[1])):u!=="within"||t}function hl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function tf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(pp)]]:["filter-in-small",t,["literal",o]]}}function rf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ru(t){return["!",t]}function nf(t){return Pc(Bt(t.value))?qu(vr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,y=u.key;if(Ea(h)!=="array")return[new Fe(y,h,"array expected, "+Ea(h)+" found")];var b,S=u.styleSpec,P=[];if(h.length<1)return[new Fe(y,h,"filter array must have at least 1 element")];switch(P=P.concat($l({key:y+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ft(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Ft(h[1])==="$type"&&P.push(new Fe(y,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&P.push(new Fe(y,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=Ea(h[1]))!=="string"&&P.push(new Fe(y+"[1]",h[1],"string expected, "+b+" found"));for(var k=2;k<h.length;k++)b=Ea(h[k]),Ft(h[1])==="$type"?P=P.concat($l({key:y+"["+k+"]",value:h[k],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&P.push(new Fe(y+"["+k+"]",h[k],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)P=P.concat(o({key:y+"["+z+"]",value:h[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Ea(h[1]),h.length!==2?P.push(new Fe(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&P.push(new Fe(y+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=Ea(h[1]),h.length!==2?P.push(new Fe(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&P.push(new Fe(y+"[1]",h[1],"object expected, "+b+" found"))}return P}(t)}function Rf(t,o){var u=t.key,h=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,P=y[o+"_"+t.layerType];if(!P)return[];var k=S.match(/^(.*)-transition$/);if(o==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return Bi({key:u,value:b,valueSpec:y.transition,style:h,styleSpec:y});var z,Z=t.valueSpec||P[S];if(!Z)return[new Fe(u,b,'unknown property "'+S+'"')];if(Ea(b)==="string"&&Ds(Z)&&!Z.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Fe(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var W=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&W.push(new Fe(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Ml(Bt(b))&&Ft(b.type)==="identity"&&W.push(new Fe(u,b,'"text-font" does not support identity functions'))),W.concat(Bi({key:t.key,value:b,valueSpec:Z,style:h,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function hp(t){return Rf(t,"paint")}function Il(t){return Rf(t,"layout")}function Kp(t){var o=[],u=t.value,h=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Fe(h,u,'either "type" or "ref" is required'));var S,P=Ft(u.type),k=Ft(u.ref);if(u.id)for(var z=Ft(u.id),Z=0;Z<t.arrayIndex;Z++){var W=y.layers[Z];Ft(W.id)===z&&o.push(new Fe(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+W.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in u&&o.push(new Fe(h,u[Me],'"'+Me+'" is prohibited for ref layers'))}),y.layers.forEach(function(Me){Ft(Me.id)===k&&(S=Me)}),S?S.ref?o.push(new Fe(h,u.ref,"ref cannot reference another ref layer")):P=Ft(S.type):o.push(new Fe(h,u.ref,'ref layer "'+k+'" not found'));else if(P!=="background")if(u.source){var ee=y.sources&&y.sources[u.source],ie=ee&&Ft(ee.type);ee?ie==="vector"&&P==="raster"?o.push(new Fe(h,u.source,'layer "'+u.id+'" requires a raster source')):ie==="raster"&&P!=="raster"?o.push(new Fe(h,u.source,'layer "'+u.id+'" requires a vector source')):ie!=="vector"||u["source-layer"]?ie==="raster-dem"&&P!=="hillshade"?o.push(new Fe(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!u.paint||!u.paint["line-gradient"]||ie==="geojson"&&ee.lineMetrics||o.push(new Fe(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Fe(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Fe(h,u.source,'source "'+u.source+'" not found'))}else o.push(new Fe(h,u,'missing required property "source"'));return o=o.concat($s({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Bi({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:nf,layout:function(Me){return $s({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Re){return Il(vr({layerType:P},Re))}}})},paint:function(Me){return $s({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Re){return hp(vr({layerType:P},Re))}}})}}}))}function as(t){var o=t.value,u=t.key,h=Ea(o);return h!=="string"?[new Fe(u,o,"string expected, "+h+" found")]:[]}var Ka={promoteId:function(t){var o=t.key,u=t.value;if(Ea(u)==="string")return as({key:o,value:u});var h=[];for(var y in u)h.push.apply(h,as({key:o+"."+y,value:u[y]}));return h}};function Ql(t){var o=t.value,u=t.key,h=t.styleSpec,y=t.style;if(!o.type)return[new Fe(u,o,'"type" is required')];var b,S=Ft(o.type);switch(S){case"vector":case"raster":case"raster-dem":return $s({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Ka});case"geojson":if(b=$s({key:u,value:o,valueSpec:h.source_geojson,style:y,styleSpec:h,objectElementValidators:Ka}),o.cluster)for(var P in o.clusterProperties){var k=o.clusterProperties[P],z=k[0],Z=typeof z=="string"?[z,["accumulated"],["get",P]]:z;b.push.apply(b,qu({key:u+"."+P+".map",value:k[1],expressionContext:"cluster-map"})),b.push.apply(b,qu({key:u+"."+P+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return $s({key:u,value:o,valueSpec:h.source_video,style:y,styleSpec:h});case"image":return $s({key:u,value:o,valueSpec:h.source_image,style:y,styleSpec:h});case"canvas":return[new Fe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $l({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:h})}}function Ol(t){var o=t.value,u=t.styleSpec,h=u.light,y=t.style,b=[],S=Ea(o);if(o===void 0)return b;if(S!=="object")return b.concat([new Fe("light",o,"object expected, "+S+" found")]);for(var P in o){var k=P.match(/^(.*)-transition$/);b=b.concat(k&&h[k[1]]&&h[k[1]].transition?Bi({key:P,value:o[P],valueSpec:u.transition,style:y,styleSpec:u}):h[P]?Bi({key:P,value:o[P],valueSpec:h[P],style:y,styleSpec:u}):[new Fe(P,o[P],'unknown property "'+P+'"')])}return b}var lu={"*":function(){return[]},array:$c,boolean:function(t){var o=t.value,u=t.key,h=Ea(o);return h!=="boolean"?[new Fe(u,o,"boolean expected, "+h+" found")]:[]},number:Qc,color:function(t){var o=t.key,u=t.value,h=Ea(u);return h!=="string"?[new Fe(o,u,"color expected, "+h+" found")]:Li(u)===null?[new Fe(o,u,'color expected, "'+u+'" found')]:[]},constants:mt,enum:$l,filter:nf,function:Jc,layer:Kp,object:$s,source:Ql,light:Ol,string:as,formatted:function(t){return as(t).length===0?[]:qu(t)},resolvedImage:function(t){return as(t).length===0?[]:qu(t)}};function Bi(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Ml(Ft(o))?Jc(t):u.expression&&Go(Bt(o))?qu(t):u.type&&lu[u.type]?lu[u.type](t):$s(vr({},t,{valueSpec:u.type?h[u.type]:u}))}function Na(t){var o=t.value,u=t.key,h=as(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new Fe(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new Fe(u,o,'"glyphs" url must include a "{range}" token'))),h}function Fs(t,o){o===void 0&&(o=fe);var u=[];return u=u.concat(Bi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Na,"*":function(){return[]}}})),t.constants&&(u=u.concat(mt({key:"constants",value:t.constants,style:t,styleSpec:o}))),af(u)}function af(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function dl(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return af(t.apply(this,o))}}Fs.source=dl(Ql),Fs.light=dl(Ol),Fs.layer=dl(Kp),Fs.filter=dl(nf),Fs.paintProperty=dl(hp),Fs.layoutProperty=dl(Il);var of=Fs,$p=of.light,Qp=of.paintProperty,Rc=of.layoutProperty;function Jl(t,o){var u=!1;if(o&&o.length)for(var h=0,y=o;h<y.length;h+=1)t.fire(new Ge(new Error(y[h].message))),u=!0;return u}var Ku=Bo;function Bo(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],P=y[3+b+1];h.push(S===P?null:y.subarray(S,P))}var k=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],k),this.bboxes=y.subarray(k),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}Bo.prototype.insert=function(t,o,u,h,y){this._forEachCell(o,u,h,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(y)},Bo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Bo.prototype._insertCell=function(t,o,u,h,y,b){this.cells[y].push(b)},Bo.prototype.query=function(t,o,u,h,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!y)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(t,o,u,h,this._queryCell,P,{},y),P},Bo.prototype._queryCell=function(t,o,u,h,y,b,S,P){var k=this.cells[y];if(k!==null)for(var z=this.keys,Z=this.bboxes,W=0;W<k.length;W++){var ee=k[W];if(S[ee]===void 0){var ie=4*ee;(P?P(Z[ie+0],Z[ie+1],Z[ie+2],Z[ie+3]):t<=Z[ie+2]&&o<=Z[ie+3]&&u>=Z[ie+0]&&h>=Z[ie+1])?(S[ee]=!0,b.push(z[ee])):S[ee]=!1}}},Bo.prototype._forEachCell=function(t,o,u,h,y,b,S,P){for(var k=this._convertToCellCoord(t),z=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),W=this._convertToCellCoord(h),ee=k;ee<=Z;ee++)for(var ie=z;ie<=W;ie++){var Me=this.d*ie+ee;if((!P||P(this._convertFromCellCoord(ee),this._convertFromCellCoord(ie),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(ie+1)))&&y.call(this,t,o,u,h,Me,b,S,P))return}},Bo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Bo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Bo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var P=t[S];y[3+S]=b,y.set(P,b),b+=P.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var ec=ae.ImageData,tc=ae.ImageBitmap,to={};function gn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),to[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var fo in gn("Object",Object),Ku.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Ku.deserialize=function(t){return new Ku(t.buffer)},gn("Grid",Ku),gn("Color",Hi),gn("Error",Error),gn("ResolvedImage",Ta),gn("StylePropertyFunction",Yu),gn("StyleExpression",pl,{omit:["_evaluator"]}),gn("ZoomDependentExpression",Ho),gn("ZoomConstantExpression",Xu),gn("CompoundExpression",Co,{omit:["_evaluate"]}),Mo)Mo[fo]._classRegistryKey||gn("Expression_"+fo,Mo[fo]);function $u(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Qu(t){return tc&&t instanceof tc}function yu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if($u(t)||Qu(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof ec)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],y=0,b=t;y<b.length;y+=1)h.push(yu(b[y],o));return h}if(typeof t=="object"){var S=t.constructor,P=S._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(to[P].omit.indexOf(z)>=0)){var Z=t[z];k[z]=to[P].shallow.indexOf(z)>=0?Z:yu(Z,o)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(k.$name=P),k}throw new Error("can't serialize object of type "+typeof t)}function Bs(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||$u(t)||Qu(t)||ArrayBuffer.isView(t)||t instanceof ec)return t;if(Array.isArray(t))return t.map(Bs);if(typeof t=="object"){var o=t.$name||"Object",u=to[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var P=t[S];h[S]=to[o].shallow.indexOf(S)>=0?P:Bs(P)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var Lf=function(){this.first=!0};Lf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var qr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function sf(t){for(var o=0,u=t;o<u.length;o+=1)if(kf(u[o].charCodeAt(0)))return!0;return!1}function kf(t){return!(t!==746&&t!==747&&(t<4352||!(qr["Bopomofo Extended"](t)||qr.Bopomofo(t)||qr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||qr["CJK Compatibility Ideographs"](t)||qr["CJK Compatibility"](t)||qr["CJK Radicals Supplement"](t)||qr["CJK Strokes"](t)||!(!qr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||qr["CJK Unified Ideographs Extension A"](t)||qr["CJK Unified Ideographs"](t)||qr["Enclosed CJK Letters and Months"](t)||qr["Hangul Compatibility Jamo"](t)||qr["Hangul Jamo Extended-A"](t)||qr["Hangul Jamo Extended-B"](t)||qr["Hangul Jamo"](t)||qr["Hangul Syllables"](t)||qr.Hiragana(t)||qr["Ideographic Description Characters"](t)||qr.Kanbun(t)||qr["Kangxi Radicals"](t)||qr["Katakana Phonetic Extensions"](t)||qr.Katakana(t)&&t!==12540||!(!qr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!qr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||qr["Unified Canadian Aboriginal Syllabics"](t)||qr["Unified Canadian Aboriginal Syllabics Extended"](t)||qr["Vertical Forms"](t)||qr["Yijing Hexagram Symbols"](t)||qr["Yi Syllables"](t)||qr["Yi Radicals"](t))))}function Lu(t){return!(kf(t)||function(o){return!!(qr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||qr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||qr["Letterlike Symbols"](o)||qr["Number Forms"](o)||qr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||qr["Control Pictures"](o)&&o!==9251||qr["Optical Character Recognition"](o)||qr["Enclosed Alphanumerics"](o)||qr["Geometric Shapes"](o)||qr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||qr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||qr["CJK Symbols and Punctuation"](o)||qr.Katakana(o)||qr["Private Use Area"](o)||qr["CJK Compatibility Forms"](o)||qr["Small Form Variants"](o)||qr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Wa(t){return t>=1424&&t<=2303||qr["Arabic Presentation Forms-A"](t)||qr["Arabic Presentation Forms-B"](t)}function Ns(t,o){return!(!o&&Wa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||qr.Khmer(t))}function uf(t){for(var o=0,u=t;o<u.length;o+=1)if(Wa(u[o].charCodeAt(0)))return!0;return!1}var ku=null,Is="unavailable",Po=null,dp=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Is="error"),ku&&ku(t)};function _a(){Df.fire(new Pe("pluginStateChange",{pluginStatus:Is,pluginURL:Po}))}var Df=new rt,vp=function(){return Is},Qs=function(){if(Is!=="deferred"||!Po)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Is="loading",_a(),Po&&Fa({url:Po},function(t){t?dp(t):(Is="loaded",_a())})},Os={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Is==="loaded"||Os.applyArabicShaping!=null},isLoading:function(){return Is==="loading"},setState:function(t){Is=t.pluginStatus,Po=t.pluginURL},isParsed:function(){return Os.applyArabicShaping!=null&&Os.processBidirectionalText!=null&&Os.processStyledBidirectionalText!=null},getPluginURL:function(){return Po}},ki=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lf,this.transition={})};ki.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,y=o;h<y.length;h+=1)if(!Ns(y[h].charCodeAt(0),u))return!1;return!0}(t,Os.isLoaded())},ki.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ki.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var _u=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Ml(u))return new Yu(u,h);if(Go(u)){var y=Pl(u,h);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=Hi.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};_u.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},_u.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var ha=function(t){this.property=t,this.value=new _u(t,void 0)};ha.prototype.transitioned=function(t,o){return new zs(this.property,this.value,o,Ct({},t.transition,this.transition),t.now)},ha.prototype.untransitioned=function(){return new zs(this.property,this.value,null,{},0)};var yo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};yo.prototype.getValue=function(t){return Qe(this._values[t].value.value)},yo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ha(this._values[t].property)),this._values[t].value=new _u(this._values[t].property,o===null?void 0:Qe(o))},yo.prototype.getTransition=function(t){return Qe(this._values[t].transition)},yo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ha(this._values[t].property)),this._values[t].transition=Qe(o)||void 0},yo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},yo.prototype.transitioned=function(t,o){for(var u=new cu(this._properties),h=0,y=Object.keys(this._values);h<y.length;h+=1){var b=y[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},yo.prototype.untransitioned=function(){for(var t=new cu(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var zs=function(t,o,u,h,y){this.property=t,this.value=o,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};zs.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(P){if(P<=0)return 0;if(P>=1)return 1;var k=P*P,z=k*P;return 4*(P<.5?z:3*(P-k)+z-.75)}(S))}return y};var cu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};cu.prototype.possiblyEvaluate=function(t,o,u){for(var h=new Zs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},cu.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Us=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Us.prototype.getValue=function(t){return Qe(this._values[t].value)},Us.prototype.setValue=function(t,o){this._values[t]=new _u(this._values[t].property,o===null?void 0:Qe(o))},Us.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y)}return t},Us.prototype.possiblyEvaluate=function(t,o,u){for(var h=new Zs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var ms=function(t,o,u){this.property=t,this.value=o,this.parameters=u};ms.prototype.isConstant=function(){return this.value.kind==="constant"},ms.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},ms.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var Zs=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Zs.prototype.get=function(t){return this._values[t]};var On=function(t){this.specification=t};On.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},On.prototype.interpolate=function(t,o,u){var h=Ao[this.specification.type];return h?h(t,o,u):t};var wn=function(t,o){this.specification=t,this.overrides=o};wn.prototype.possiblyEvaluate=function(t,o,u,h){return new ms(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},wn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new ms(this,{kind:"constant",value:void 0},t.parameters);var h=Ao[this.specification.type];return h?new ms(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},wn.prototype.evaluate=function(t,o,u,h,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,y,b)};var rc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,y,b){if(u.value===void 0)return new ms(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},y,b),P=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(P,P,P,h);return new ms(this,{kind:"constant",value:k},h)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new ms(this,{kind:"constant",value:z},h)}return new ms(this,u.expression,h)},o.prototype.evaluate=function(u,h,y,b,S,P){if(u.kind==="source"){var k=u.evaluate(h,y,b,S,P);return this._calculate(k,k,k,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},y,b),u.evaluate({zoom:Math.floor(h.zoom)},y,b),u.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):u.value},o.prototype._calculate=function(u,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:y,to:h}},o.prototype.interpolate=function(u){return u},o}(wn),gs=function(t){this.specification=t};gs.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,h);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new ki(Math.floor(o.zoom-1),o)),t.expression.evaluate(new ki(Math.floor(o.zoom),o)),t.expression.evaluate(new ki(Math.floor(o.zoom+1),o)),o)}},gs.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},gs.prototype.interpolate=function(t){return t};var xu=function(t){this.specification=t};xu.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},xu.prototype.interpolate=function(){return!1};var rs=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new _u(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new ha(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};gn("DataDrivenProperty",wn),gn("DataConstantProperty",On),gn("CrossFadedDataDrivenProperty",rc),gn("CrossFadedProperty",gs),gn("ColorRampProperty",xu);var Sa=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Us(h.layout)),h.paint)){for(var y in this._transitionablePaint=new yo(h.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zs(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,y){y===void 0&&(y={}),h!=null&&this._validate(Rc,"layers."+this.id+".layout."+u,u,h,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return Y(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,y){if(y===void 0&&(y={}),h!=null&&this._validate(Qp,"layers."+this.id+".paint."+u,u,h,y))return!1;if(Y(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",P=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||P||S||this._handleOverridablePaintPropertyUpdate(u,k,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),gt(u,function(h,y){return!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Jl(this,u.call(of,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof ms&&Ds(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}(rt),Lc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},kc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},da=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ma(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(y){var b=Lc[y.type].BYTES_PER_ELEMENT,S=u=Dc(u,Math.max(o,b)),P=y.components||1;return h=Math.max(h,b),u+=b*P,{name:y.name,type:y.type,components:P,offset:S}}),size:Dc(u,Math.max(h,o)),alignment:o}}function Dc(t,o){return Math.ceil(t/o)*o}da.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},da.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},da.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},da.prototype.clear=function(){this.length=0},da.prototype.resize=function(t){this.reserve(t),this.length=t},da.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},da.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Rl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=y,u},o}(da);Rl.prototype.bytesPerElement=4,gn("StructArrayLayout2i4",Rl);var bu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=4*u;return this.int16[P+0]=h,this.int16[P+1]=y,this.int16[P+2]=b,this.int16[P+3]=S,u},o}(da);bu.prototype.bytesPerElement=8,gn("StructArrayLayout4i8",bu);var Js=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,k){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(da);Js.prototype.bytesPerElement=12,gn("StructArrayLayout2i4i12",Js);var No=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,k){var z=4*u,Z=8*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=P,this.uint8[Z+7]=k,u},o}(da);No.prototype.bytesPerElement=8,gn("StructArrayLayout2i4ub8",No);var vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=y,u},o}(da);vl.prototype.bytesPerElement=8,gn("StructArrayLayout2f8",vl);var Eu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,h,y,b,S,P,k,z,Z,W)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee){var ie=10*u;return this.uint16[ie+0]=h,this.uint16[ie+1]=y,this.uint16[ie+2]=b,this.uint16[ie+3]=S,this.uint16[ie+4]=P,this.uint16[ie+5]=k,this.uint16[ie+6]=z,this.uint16[ie+7]=Z,this.uint16[ie+8]=W,this.uint16[ie+9]=ee,u},o}(da);Eu.prototype.bytesPerElement=20,gn("StructArrayLayout10ui20",Eu);var lf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W,ee,ie){var Me=this.length;return this.resize(Me+1),this.emplace(Me,u,h,y,b,S,P,k,z,Z,W,ee,ie)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee,ie,Me){var Re=12*u;return this.int16[Re+0]=h,this.int16[Re+1]=y,this.int16[Re+2]=b,this.int16[Re+3]=S,this.uint16[Re+4]=P,this.uint16[Re+5]=k,this.uint16[Re+6]=z,this.uint16[Re+7]=Z,this.int16[Re+8]=W,this.int16[Re+9]=ee,this.int16[Re+10]=ie,this.int16[Re+11]=Me,u},o}(da);lf.prototype.bytesPerElement=24,gn("StructArrayLayout4i4ui4i24",lf);var Ll=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(da);Ll.prototype.bytesPerElement=12,gn("StructArrayLayout3f12",Ll);var kl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(da);kl.prototype.bytesPerElement=4,gn("StructArrayLayout1ul4",kl);var Dl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z){var W=this.length;return this.resize(W+1),this.emplace(W,u,h,y,b,S,P,k,z,Z)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W){var ee=10*u,ie=5*u;return this.int16[ee+0]=h,this.int16[ee+1]=y,this.int16[ee+2]=b,this.int16[ee+3]=S,this.int16[ee+4]=P,this.int16[ee+5]=k,this.uint32[ie+3]=z,this.uint16[ee+8]=Z,this.uint16[ee+9]=W,u},o}(da);Dl.prototype.bytesPerElement=20,gn("StructArrayLayout6i1ul2ui20",Dl);var nc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,k){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(da);nc.prototype.bytesPerElement=12,gn("StructArrayLayout2i2i2i12",nc);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S){var P=this.length;return this.resize(P+1),this.emplace(P,u,h,y,b,S)},o.prototype.emplace=function(u,h,y,b,S,P){var k=4*u,z=8*u;return this.float32[k+0]=h,this.float32[k+1]=y,this.float32[k+2]=b,this.int16[z+6]=S,this.int16[z+7]=P,u},o}(da);ml.prototype.bytesPerElement=16,gn("StructArrayLayout2f1f2i16",ml);var mp=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=12*u,k=3*u;return this.uint8[P+0]=h,this.uint8[P+1]=y,this.float32[k+1]=b,this.float32[k+2]=S,u},o}(da);mp.prototype.bytesPerElement=12,gn("StructArrayLayout2ub2f12",mp);var Ju=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(da);Ju.prototype.bytesPerElement=6,gn("StructArrayLayout3ui6",Ju);var Du=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re,Ye,Ue,ut){var _t=this.length;return this.resize(_t+1),this.emplace(_t,u,h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re,Ye,Ue,ut)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re,Ye,Ue,ut,_t){var Gt=24*u,Yt=12*u,lr=48*u;return this.int16[Gt+0]=h,this.int16[Gt+1]=y,this.uint16[Gt+2]=b,this.uint16[Gt+3]=S,this.uint32[Yt+2]=P,this.uint32[Yt+3]=k,this.uint32[Yt+4]=z,this.uint16[Gt+10]=Z,this.uint16[Gt+11]=W,this.uint16[Gt+12]=ee,this.float32[Yt+7]=ie,this.float32[Yt+8]=Me,this.uint8[lr+36]=Re,this.uint8[lr+37]=Ye,this.uint8[lr+38]=Ue,this.uint32[Yt+10]=ut,this.int16[Gt+22]=_t,u},o}(da);Du.prototype.bytesPerElement=48,gn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Du);var Ff=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re,Ye,Ue,ut,_t,Gt,Yt,lr,wr,Nr,kn,hn,zn,dn,Mi){var ri=this.length;return this.resize(ri+1),this.emplace(ri,u,h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re,Ye,Ue,ut,_t,Gt,Yt,lr,wr,Nr,kn,hn,zn,dn,Mi)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re,Ye,Ue,ut,_t,Gt,Yt,lr,wr,Nr,kn,hn,zn,dn,Mi,ri){var Pn=34*u,Vi=17*u;return this.int16[Pn+0]=h,this.int16[Pn+1]=y,this.int16[Pn+2]=b,this.int16[Pn+3]=S,this.int16[Pn+4]=P,this.int16[Pn+5]=k,this.int16[Pn+6]=z,this.int16[Pn+7]=Z,this.uint16[Pn+8]=W,this.uint16[Pn+9]=ee,this.uint16[Pn+10]=ie,this.uint16[Pn+11]=Me,this.uint16[Pn+12]=Re,this.uint16[Pn+13]=Ye,this.uint16[Pn+14]=Ue,this.uint16[Pn+15]=ut,this.uint16[Pn+16]=_t,this.uint16[Pn+17]=Gt,this.uint16[Pn+18]=Yt,this.uint16[Pn+19]=lr,this.uint16[Pn+20]=wr,this.uint16[Pn+21]=Nr,this.uint16[Pn+22]=kn,this.uint32[Vi+12]=hn,this.float32[Vi+13]=zn,this.float32[Vi+14]=dn,this.float32[Vi+15]=Mi,this.float32[Vi+16]=ri,u},o}(da);Ff.prototype.bytesPerElement=68,gn("StructArrayLayout8i15ui1ul4f68",Ff);var gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(da);gl.prototype.bytesPerElement=4,gn("StructArrayLayout1f4",gl);var eu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(da);eu.prototype.bytesPerElement=6,gn("StructArrayLayout3i6",eu);var cf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(da);cf.prototype.bytesPerElement=8,gn("StructArrayLayout1ul2ui8",cf);var js=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=y,u},o}(da);js.prototype.bytesPerElement=4,gn("StructArrayLayout2ui4",js);var gp=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(da);gp.prototype.bytesPerElement=2,gn("StructArrayLayout1ui2",gp);var ic=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=4*u;return this.float32[P+0]=h,this.float32[P+1]=y,this.float32[P+2]=b,this.float32[P+3]=S,u},o}(da);ic.prototype.bytesPerElement=16,gn("StructArrayLayout4f16",ic);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new se(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(kc);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Dl);gn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(kc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Du);gn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(kc);E.prototype.size=68;var A=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Ff);gn("SymbolInstanceArray",A);var M=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(gl);gn("GlyphOffsetArray",M);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(eu);gn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(kc);U.prototype.size=8;var X=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(cf);gn("FeatureIndexArray",X);var oe=Ma([{name:"a_pos",components:2,type:"Int16"}],4).members,ue=function(t){t===void 0&&(t=[]),this.segments=t};function pe(t,o){return 256*(t=Ht(Math.floor(t),0,255))+Ht(Math.floor(o),0,255)}ue.prototype.prepareSegment=function(t,o,u,h){var y=this.segments[this.segments.length-1];return t>ue.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+ue.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>ue.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(y.sortKey=h),this.segments.push(y)),y},ue.prototype.get=function(){return this.segments},ue.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},ue.simpleSegment=function(t,o,u,h){return new ue([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gn("SegmentVector",ue);var Oe=Ma([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ie=ve(function(t){t.exports=function(o,u){var h,y,b,S,P,k,z,Z;for(y=o.length-(h=3&o.length),b=u,P=3432918353,k=461845907,Z=0;Z<y;)z=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&o.charCodeAt(Z+2))<<16;case 2:z^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(Z)))*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),ke=ve(function(t){t.exports=function(o,u){for(var h,y=o.length,b=u^y,S=0;y>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ae=Ie,je=ke;Ae.murmur3=Ie,Ae.murmur2=je;var Je=function(){this.ids=[],this.positions=[],this.indexed=!1};Je.prototype.add=function(t,o,u,h){this.ids.push(Wt(t)),this.positions.push(o,u,h)},Je.prototype.getPositions=function(t){for(var o=Wt(t),u=0,h=this.ids.length-1;u<h;){var y=u+h>>1;this.ids[y]>=o?h=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},Je.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function y(b,S,P,k){for(;P<k;){for(var z=b[P+k>>1],Z=P-1,W=k+1;;){do Z++;while(b[Z]<z);do W--;while(b[W]>z);if(Z>=W)break;Vt(b,Z,W),Vt(S,3*Z,3*W),Vt(S,3*Z+1,3*W+1),Vt(S,3*Z+2,3*W+2)}W-P<k-W?(y(b,S,P,W),P=W+1):(y(b,S,W+1,k),k=W)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},Je.deserialize=function(t){var o=new Je;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var yt=Math.pow(2,53)-1;function Wt(t){var o=+t;return!isNaN(o)&&o<=yt?o:Ae(String(t))}function Vt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}gn("FeaturePositionMap",Je);var Pt=function(t,o){this.gl=t.gl,this.location=o},pr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Pt),Or=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Pt),Dr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Pt),un=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Pt),Fn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Pt),Nn=function(t){function o(u,h){t.call(this,u,h),this.current=Hi.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Pt),Un=new Float32Array(16),Di=function(t){function o(u,h){t.call(this,u,h),this.current=Un}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Pt);function nn(t){return[pe(255*t.r,255*t.g),pe(255*t.b,255*t.a)]}var ai=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};ai.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ai.prototype.getBinding=function(t,o,u){return this.type==="color"?new Nn(t,o):new Or(t,o)};var fi=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};fi.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},fi.prototype.setUniform=function(t,o,u,h){var y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},fi.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Fn(t,o):new Or(t,o)};var ei=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};ei.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new ki(0),o,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},ei.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,y)},ei.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=nn(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ei.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Gn=function(t,o,u,h,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Gn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.expression.evaluate(new ki(this.zoom),o,{},h,[],y),S=this.expression.evaluate(new ki(this.zoom+1),o,{},h,[],y),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,b,S)},Gn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,y,b)},Gn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var y=nn(u),b=nn(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var P=t;P<o;P++)this.paintVertexArray.emplace(P,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Gn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Gn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Gn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=Ht(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Gn.prototype.getBinding=function(t,o,u){return new Or(t,o)};var yi=function(t,o,u,h,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};yi.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},yi.prototype.updatePaintArray=function(t,o,u,h,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},yi.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var y=h[u.min],b=h[u.mid],S=h[u.max];if(y&&b&&S)for(var P=t;P<o;P++)this.zoomInPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},yi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Oe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Oe.members,this.expression.isStateDependent))},yi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof ms&&Ds(b.property.specification)){var S=Pa(y,t.type),P=b.value,k=b.property.specification.type,z=b.property.useIntegerZoom,Z=b.property.specification["property-type"],W=Z==="cross-faded"||Z==="cross-faded-data-driven";if(P.kind==="constant")this.binders[y]=W?new fi(P.value,S):new ai(P.value,S,k),h.push("/u_"+y);else if(P.kind==="source"||W){var ee=ro(y,k,"source");this.binders[y]=W?new yi(P,k,z,o,ee,t.id):new ei(P,S,k,ee),h.push("/a_"+y)}else{var ie=ro(y,k,"composite");this.binders[y]=new Gn(P,S,k,z,o,ie),h.push("/z_"+y)}}}this.cacheKey=h.sort().join("")};Kn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ei||o instanceof Gn?o.maxValue:0},Kn.prototype.populatePaintArrays=function(t,o,u,h,y){for(var b in this.binders){var S=this.binders[b];(S instanceof ei||S instanceof Gn||S instanceof yi)&&S.populatePaintArray(t,o,u,h,y)}},Kn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof fi&&h.setConstantPatternPositions(t,o)}},Kn.prototype.updatePaintArrays=function(t,o,u,h,y){var b=!1;for(var S in t)for(var P=0,k=o.getPositions(S);P<k.length;P+=1){var z=k[P],Z=u.feature(z.index);for(var W in this.binders){var ee=this.binders[W];if((ee instanceof ei||ee instanceof Gn||ee instanceof yi)&&ee.expression.isStateDependent===!0){var ie=h.paint.get(W);ee.expression=ie.value,ee.updatePaintArray(z.start,z.end,Z,t[S],y),b=!0}}}return b},Kn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ai||u instanceof fi)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Kn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ei||u instanceof Gn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof yi)for(var y=0;y<Oe.members.length;y++)t.push(Oe.members[y].name)}return t},Kn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ai||u instanceof fi||u instanceof Gn)for(var h=0,y=u.uniformNames;h<y.length;h+=1)t.push(y[h])}return t},Kn.prototype.getPaintVertexBuffers=function(){return this._buffers},Kn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var y=this.binders[h];if(y instanceof ai||y instanceof fi||y instanceof Gn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var P=S[b];if(o[P]){var k=y.getBinding(t,o[P],P);u.push({name:P,property:h,binding:k})}}}return u},Kn.prototype.setUniforms=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],P=S.name,k=S.property;this.binders[k].setUniform(S.binding,h,u.get(k),P)}},Kn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof yi){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof ei||u instanceof Gn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Kn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ei||u instanceof Gn||u instanceof yi)&&u.upload(t)}this.updatePaintBuffers()},Kn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ei||o instanceof Gn||o instanceof yi)&&o.destroy()}};var Hn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,y=t;h<y.length;h+=1){var b=y[h];this.programConfigurations[b.id]=new Kn(b,o,u)}this.needsUpload=!1,this._featureMap=new Je,this._bufferOffset=0};function Pa(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function ro(t,o,u){var h={color:{source:vl,composite:ic},number:{source:gl,composite:vl}},y=function(b){return{"line-pattern":{source:Eu,composite:Eu},"fill-pattern":{source:Eu,composite:Eu},"fill-extrusion-pattern":{source:Eu,composite:Eu}}[b]}(t);return y&&y[u]||h[o][u]}Hn.prototype.populatePaintArrays=function(t,o,u,h,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Hn.prototype.updatePaintArrays=function(t,o,u,h){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Hn.prototype.get=function(t){return this.programConfigurations[t]},Hn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Hn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},gn("ConstantBinder",ai),gn("CrossFadedConstantBinder",fi),gn("SourceExpressionBinder",ei),gn("CrossFadedCompositeBinder",yi),gn("CompositeExpressionBinder",Gn),gn("ProgramConfiguration",Kn,{omit:["_buffers"]}),gn("ProgramConfigurationSet",Hn);var no=Math.pow(2,14)-1,Wo=-no-1;function Va(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var y=u[h],b=0;b<y.length;b++){var S=y[b],P=Math.round(S.x*o),k=Math.round(S.y*o);S.x=Ht(P,Wo,no),S.y=Ht(k,Wo,no),(P<S.x||P>S.x+1||k<S.y||k>S.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function io(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Va(t):[]}}function Rs(t,o,u,h,y){t.emplaceBack(2*o+(h+1)/2,2*u+(y+1)/2)}var ys=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Rl,this.indexArray=new Ju,this.segments=new ue,this.programConfigurations=new Hn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Fu(t,o){for(var u=0;u<t.length;u++)if(Su(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(Su(t,o[h]))return!0;return!!el(t,o)}function _s(t,o,u){return!!Su(t,o)||!!Ls(o,t,u)}function ka(t,o){if(t.length===1)return Fc(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],y=0;y<h.length;y++)if(Su(t,h[y]))return!0;for(var b=0;b<t.length;b++)if(Fc(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(el(t,o[S]))return!0;return!1}function Ia(t,o,u){if(t.length>1){if(el(t,o))return!0;for(var h=0;h<o.length;h++)if(Ls(o[h],t,u))return!0}for(var y=0;y<t.length;y++)if(Ls(t[y],o,u))return!0;return!1}function el(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(yl(h,y,o[b],o[b+1]))return!0;return!1}function yl(t,o,u,h){return Kt(t,u,h)!==Kt(o,u,h)&&Kt(t,o,u)!==Kt(t,o,h)}function Ls(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var y=1;y<o.length;y++)if(ac(t,o[y-1],o[y])<h)return!0;return!1}function ac(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Fc(t,o){for(var u,h,y,b=!1,S=0;S<t.length;S++)for(var P=0,k=(u=t[S]).length-1;P<u.length;k=P++)(h=u[P]).y>o.y!=(y=u[k]).y>o.y&&o.x<(y.x-h.x)*(o.y-h.y)/(y.y-h.y)+h.x&&(b=!b);return b}function Su(t,o){for(var u=!1,h=0,y=t.length-1;h<t.length;y=h++){var b=t[h],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function oc(t,o,u){var h=u[0],y=u[2];if(t.x<h.x&&o.x<h.x||t.x>y.x&&o.x>y.x||t.y<h.y&&o.y<h.y||t.y>y.y&&o.y>y.y)return!1;var b=Kt(t,o,u[0]);return b!==Kt(t,o,u[1])||b!==Kt(t,o,u[2])||b!==Kt(t,o,u[3])}function fu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Oa(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function tl(t,o,u,h,y){if(!o[0]&&!o[1])return t;var b=se.convert(o)._mult(y);u==="viewport"&&b._rotate(-h);for(var S=[],P=0;P<t.length;P++)S.push(t[P].sub(b));return S}ys.prototype.populate=function(t,o,u){var h=this.layers[0],y=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,P=t;S<P.length;S+=1){var k=P[S],z=k.feature,Z=k.id,W=k.index,ee=k.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,Me=io(z,ie);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),Me,u)){var Re=b?b.evaluate(Me,{},u):void 0,Ye={id:Z,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:W,geometry:ie?Me.geometry:Va(z),patterns:{},sortKey:Re};y.push(Ye)}}b&&y.sort(function(Nr,kn){return Nr.sortKey-kn.sortKey});for(var Ue=0,ut=y;Ue<ut.length;Ue+=1){var _t=ut[Ue],Gt=_t.geometry,Yt=_t.index,lr=_t.sourceLayerIndex,wr=t[Yt].feature;this.addFeature(_t,Gt,Yt,u),o.featureIndex.insert(wr,Gt,Yt,lr,this.index)}},ys.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ys.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ys.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ys.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ys.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ys.prototype.addFeature=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,P=b[y];S<P.length;S+=1){var k=P[S],z=k.x,Z=k.y;if(!(z<0||z>=8192||Z<0||Z>=8192)){var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ee=W.vertexLength;Rs(this.layoutVertexArray,z,Z,-1,-1),Rs(this.layoutVertexArray,z,Z,1,-1),Rs(this.layoutVertexArray,z,Z,1,1),Rs(this.layoutVertexArray,z,Z,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),W.vertexLength+=4,W.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},gn("CircleBucket",ys,{omit:["layers"]});var _l=new rs({"circle-sort-key":new wn(fe.layout_circle["circle-sort-key"])}),xl={paint:new rs({"circle-radius":new wn(fe.paint_circle["circle-radius"]),"circle-color":new wn(fe.paint_circle["circle-color"]),"circle-blur":new wn(fe.paint_circle["circle-blur"]),"circle-opacity":new wn(fe.paint_circle["circle-opacity"]),"circle-translate":new On(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new On(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wn(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wn(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wn(fe.paint_circle["circle-stroke-opacity"])}),layout:_l},Xi=typeof Float32Array!="undefined"?Float32Array:Array;function As(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xo(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],Z=o[7],W=o[8],ee=o[9],ie=o[10],Me=o[11],Re=o[12],Ye=o[13],Ue=o[14],ut=o[15],_t=u[0],Gt=u[1],Yt=u[2],lr=u[3];return t[0]=_t*h+Gt*P+Yt*W+lr*Re,t[1]=_t*y+Gt*k+Yt*ee+lr*Ye,t[2]=_t*b+Gt*z+Yt*ie+lr*Ue,t[3]=_t*S+Gt*Z+Yt*Me+lr*ut,t[4]=(_t=u[4])*h+(Gt=u[5])*P+(Yt=u[6])*W+(lr=u[7])*Re,t[5]=_t*y+Gt*k+Yt*ee+lr*Ye,t[6]=_t*b+Gt*z+Yt*ie+lr*Ue,t[7]=_t*S+Gt*Z+Yt*Me+lr*ut,t[8]=(_t=u[8])*h+(Gt=u[9])*P+(Yt=u[10])*W+(lr=u[11])*Re,t[9]=_t*y+Gt*k+Yt*ee+lr*Ye,t[10]=_t*b+Gt*z+Yt*ie+lr*Ue,t[11]=_t*S+Gt*Z+Yt*Me+lr*ut,t[12]=(_t=u[12])*h+(Gt=u[13])*P+(Yt=u[14])*W+(lr=u[15])*Re,t[13]=_t*y+Gt*k+Yt*ee+lr*Ye,t[14]=_t*b+Gt*z+Yt*ie+lr*Ue,t[15]=_t*S+Gt*Z+Yt*Me+lr*ut,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var Bu,sc=Xo;function bl(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*y+u[11]*b+u[15]*S,t}Bu=new Xi(3),Xi!=Float32Array&&(Bu[0]=0,Bu[1]=0,Bu[2]=0),function(){var t=new Xi(4);Xi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Fl=(function(){var t=new Xi(2);Xi!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,xl)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new ys(u)},o.prototype.queryRadius=function(u){var h=u;return fu("circle-radius",this,h)+fu("circle-stroke-width",this,h)+Oa(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k,z){for(var Z=tl(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,k),W=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),ee=this.paint.get("circle-pitch-alignment")==="map",ie=ee?Z:function(wr,Nr){return wr.map(function(kn){return Vs(kn,Nr)})}(Z,z),Me=ee?W*k:W,Re=0,Ye=b;Re<Ye.length;Re+=1)for(var Ue=0,ut=Ye[Re];Ue<ut.length;Ue+=1){var _t=ut[Ue],Gt=ee?_t:Vs(_t,z),Yt=Me,lr=bl([],[_t.x,_t.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Yt*=lr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Yt*=P.cameraToCenterDistance/lr[3]),_s(ie,Gt,Yt))return!0}return!1},o}(Sa));function Vs(t,o){var u=bl([],[t.x,t.y,0,1],o);return new se(u[0]/u[3],u[1]/u[3])}var Bl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ys);function Gs(t,o,u,h){var y=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==y*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=h,t}function rl(t,o,u){var h=o.width,y=o.height;if(h!==t.width||y!==t.height){var b=Gs({},{width:h,height:y},u);Bc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,y)},u),t.width=h,t.height=y,t.data=b.data}}function Bc(t,o,u,h,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||h.x>o.width-y.width||h.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,P=o.data,k=0;k<y.height;k++)for(var z=((u.y+k)*t.width+u.x)*b,Z=((h.y+k)*o.width+h.x)*b,W=0;W<y.width*b;W++)P[Z+W]=S[z+W];return o}gn("HeatmapBucket",Bl,{omit:["layers"]});var pu=function(t,o){Gs(this,t,1,o)};pu.prototype.resize=function(t){rl(this,t,1)},pu.prototype.clone=function(){return new pu({width:this.width,height:this.height},new Uint8Array(this.data))},pu.copy=function(t,o,u,h,y){Bc(t,o,u,h,y,1)};var Ga=function(t,o){Gs(this,t,4,o)};Ga.prototype.resize=function(t){rl(this,t,4)},Ga.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Ga.prototype.clone=function(){return new Ga({width:this.width,height:this.height},new Uint8Array(this.data))},Ga.copy=function(t,o,u,h,y){Bc(t,o,u,h,y,4)},gn("AlphaImage",pu),gn("RGBAImage",Ga);var uc={paint:new rs({"heatmap-radius":new wn(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wn(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xu(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(fe.paint_heatmap["heatmap-opacity"])})};function Bf(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,y=t.image||new Ga({width:u,height:h}),b=function(Me,Re,Ye){o[t.evaluationKey]=Ye;var Ue=t.expression.evaluate(o);y.data[Me+Re+0]=Math.floor(255*Ue.r/Ue.a),y.data[Me+Re+1]=Math.floor(255*Ue.g/Ue.a),y.data[Me+Re+2]=Math.floor(255*Ue.b/Ue.a),y.data[Me+Re+3]=Math.floor(255*Ue.a)};if(t.clips)for(var S=0,P=0;S<h;++S,P+=4*u)for(var k=0,z=0;k<u;k++,z+=4){var Z=k/(u-1),W=t.clips[S];b(P,z,W.start*(1-Z)+W.end*Z)}else for(var ee=0,ie=0;ee<u;ee++,ie+=4)b(0,ie,ee/(u-1));return y}var yp=function(t){function o(u){t.call(this,u,uc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Bl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Bf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Sa),Nf={paint:new rs({"hillshade-illumination-direction":new On(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(fe.paint_hillshade["hillshade-accent-color"])})},Jp=function(t){function o(u){t.call(this,u,Nf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Sa),eh=Ma([{name:"a_pos",components:2,type:"Int16"}],4).members,lc=hu,cc=hu;function hu(t,o,u){u=u||2;var h,y,b,S,P,k,z,Z=o&&o.length,W=Z?o[0]*u:t.length,ee=Bh(t,0,W,u,!0),ie=[];if(!ee||ee.next===ee.prev)return ie;if(Z&&(ee=function(Re,Ye,Ue,ut){var _t,Gt,Yt,lr=[];for(_t=0,Gt=Ye.length;_t<Gt;_t++)(Yt=Bh(Re,Ye[_t]*ut,_t<Gt-1?Ye[_t+1]*ut:Re.length,ut,!1))===Yt.next&&(Yt.steiner=!0),lr.push(Cd(Yt));for(lr.sort(Ed),_t=0;_t<lr.length;_t++)Sd(lr[_t],Ue),Ue=Nl(Ue,Ue.next);return Ue}(t,o,ee,u)),t.length>80*u){h=b=t[0],y=S=t[1];for(var Me=u;Me<W;Me+=u)(P=t[Me])<h&&(h=P),(k=t[Me+1])<y&&(y=k),P>b&&(b=P),k>S&&(S=k);z=(z=Math.max(b-h,S-y))!==0?1/z:0}return Nc(ee,ie,u,h,y,z),ie}function Bh(t,o,u,h,y){var b,S;if(y===jf(t,o,u,h)>0)for(b=o;b<u;b+=h)S=Zf(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=Zf(b,t[b],t[b+1],S);return S&&_p(S,S.next)&&(zl(S),S=S.next),S}function Nl(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!_p(h,h.next)&&_o(h.prev,h,h.next)!==0)h=h.next;else{if(zl(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function Nc(t,o,u,h,y,b,S){if(t){!S&&b&&function(Z,W,ee,ie){var Me=Z;do Me.z===null&&(Me.z=ih(Me.x,Me.y,W,ee,ie)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==Z);Me.prevZ.nextZ=null,Me.prevZ=null,function(Re){var Ye,Ue,ut,_t,Gt,Yt,lr,wr,Nr=1;do{for(Ue=Re,Re=null,Gt=null,Yt=0;Ue;){for(Yt++,ut=Ue,lr=0,Ye=0;Ye<Nr&&(lr++,ut=ut.nextZ);Ye++);for(wr=Nr;lr>0||wr>0&&ut;)lr!==0&&(wr===0||!ut||Ue.z<=ut.z)?(_t=Ue,Ue=Ue.nextZ,lr--):(_t=ut,ut=ut.nextZ,wr--),Gt?Gt.nextZ=_t:Re=_t,_t.prevZ=Gt,Gt=_t;Ue=ut}Gt.nextZ=null,Nr*=2}while(Yt>1)}(Me)}(t,h,y,b);for(var P,k,z=t;t.prev!==t.next;)if(P=t.prev,k=t.next,b?Nh(t,h,y,b):th(t))o.push(P.i/u),o.push(t.i/u),o.push(k.i/u),zl(t),t=k.next,z=k.next;else if((t=k)===z){S?S===1?Nc(t=zc(Nl(t),o,u),o,u,h,y,b,2):S===2&&rh(t,o,u,h,y,b):Nc(Nl(t),o,u,h,y,b,1);break}}}function th(t){var o=t.prev,u=t,h=t.next;if(_o(o,u,h)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(ff(o.x,o.y,u.x,u.y,h.x,h.y,y.x,y.y)&&_o(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Nh(t,o,u,h){var y=t.prev,b=t,S=t.next;if(_o(y,b,S)>=0)return!1;for(var P=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,k=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=ih(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,h),Z=ih(P,k,o,u,h),W=t.prevZ,ee=t.nextZ;W&&W.z>=z&&ee&&ee.z<=Z;){if(W!==t.prev&&W!==t.next&&ff(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&_o(W.prev,W,W.next)>=0||(W=W.prevZ,ee!==t.prev&&ee!==t.next&&ff(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&_o(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;W&&W.z>=z;){if(W!==t.prev&&W!==t.next&&ff(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&_o(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;ee&&ee.z<=Z;){if(ee!==t.prev&&ee!==t.next&&ff(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&_o(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function zc(t,o,u){var h=t;do{var y=h.prev,b=h.next.next;!_p(y,b)&&Uh(y,h,h.next,b)&&zf(y,b)&&zf(b,y)&&(o.push(y.i/u),o.push(h.i/u),o.push(b.i/u),zl(h),zl(h.next),h=t=b),h=h.next}while(h!==t);return Nl(h)}function rh(t,o,u,h,y,b){var S=t;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&zh(S,P)){var k=Uf(S,P);return S=Nl(S,S.next),k=Nl(k,k.next),Nc(S,o,u,h,y,b),void Nc(k,o,u,h,y,b)}P=P.next}S=S.next}while(S!==t)}function Ed(t,o){return t.x-o.x}function Sd(t,o){if(o=function(h,y){var b,S=y,P=h.x,k=h.y,z=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var Z=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=P&&Z>z){if(z=Z,Z===P){if(k===S.y)return S;if(k===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(P===z)return b;var W,ee=b,ie=b.x,Me=b.y,Re=1/0;S=b;do P>=S.x&&S.x>=ie&&P!==S.x&&ff(k<Me?P:z,k,ie,Me,k<Me?z:P,k,S.x,S.y)&&(W=Math.abs(k-S.y)/(P-S.x),zf(S,h)&&(W<Re||W===Re&&(S.x>b.x||S.x===b.x&&nh(b,S)))&&(b=S,Re=W)),S=S.next;while(S!==ee);return b}(t,o)){var u=Uf(o,t);Nl(o,o.next),Nl(u,u.next)}}function nh(t,o){return _o(t.prev,t,o.prev)<0&&_o(o.next,t,t.next)<0}function ih(t,o,u,h,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Cd(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function ff(t,o,u,h,y,b,S,P){return(y-S)*(o-P)-(t-S)*(b-P)>=0&&(t-S)*(h-P)-(u-S)*(o-P)>=0&&(u-S)*(b-P)-(y-S)*(h-P)>=0}function zh(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==h.i&&y.next.i!==h.i&&Uh(y,y.next,u,h))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(zf(t,o)&&zf(o,t)&&function(u,h){var y=u,b=!1,S=(u.x+h.x)/2,P=(u.y+h.y)/2;do y.y>P!=y.next.y>P&&y.next.y!==y.y&&S<(y.next.x-y.x)*(P-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(_o(t.prev,t,o.prev)||_o(t,o.prev,o))||_p(t,o)&&_o(t.prev,t,t.next)>0&&_o(o.prev,o,o.next)>0)}function _o(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function _p(t,o){return t.x===o.x&&t.y===o.y}function Uh(t,o,u,h){var y=bp(_o(t,o,u)),b=bp(_o(t,o,h)),S=bp(_o(u,h,t)),P=bp(_o(u,h,o));return y!==b&&S!==P||!(y!==0||!xp(t,u,o))||!(b!==0||!xp(t,h,o))||!(S!==0||!xp(u,t,h))||!(P!==0||!xp(u,o,h))}function xp(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function bp(t){return t>0?1:t<0?-1:0}function zf(t,o){return _o(t.prev,t,t.next)<0?_o(t,o,t.next)>=0&&_o(t,t.prev,o)>=0:_o(t,o,t.prev)<0||_o(t,t.next,o)<0}function Uf(t,o){var u=new fc(t.i,t.x,t.y),h=new fc(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function Zf(t,o,u,h){var y=new fc(t,o,u);return h?(y.next=h.next,y.prev=h,h.next.prev=y,h.next=y):(y.prev=y,y.next=y),y}function zl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function fc(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jf(t,o,u,h){for(var y=0,b=o,S=u-h;b<u;b+=h)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Ep(t,o,u,h,y){(function b(S,P,k,z,Z){for(;z>k;){if(z-k>600){var W=z-k+1,ee=P-k+1,ie=Math.log(W),Me=.5*Math.exp(2*ie/3),Re=.5*Math.sqrt(ie*Me*(W-Me)/W)*(ee-W/2<0?-1:1);b(S,P,Math.max(k,Math.floor(P-ee*Me/W+Re)),Math.min(z,Math.floor(P+(W-ee)*Me/W+Re)),Z)}var Ye=S[P],Ue=k,ut=z;for(pc(S,k,P),Z(S[z],Ye)>0&&pc(S,k,z);Ue<ut;){for(pc(S,Ue,ut),Ue++,ut--;Z(S[Ue],Ye)<0;)Ue++;for(;Z(S[ut],Ye)>0;)ut--}Z(S[k],Ye)===0?pc(S,k,ut):pc(S,++ut,z),ut<=P&&(k=ut+1),P<=ut&&(z=ut-1)}})(t,o,u||0,h||t.length-1,y||Sp)}function pc(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function Sp(t,o){return t<o?-1:t>o?1:0}function Vf(t,o){var u=t.length;if(u<=1)return[t];for(var h,y,b=[],S=0;S<u;S++){var P=Sr(t[S]);P!==0&&(t[S].area=Math.abs(P),y===void 0&&(y=P<0),y===P<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var k=0;k<b.length;k++)b[k].length<=o||(Ep(b[k],o,1,b[k].length-1,Cp),b[k]=b[k].slice(0,o));return b}function Cp(t,o){return o.area-t.area}function nl(t,o,u){for(var h=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var P=S[b].paint.get(t+"-pattern");P.isConstant()||(y=!0);var k=P.constantOr(null);k&&(y=!0,h[k.to]=!0,h[k.from]=!0)}return y}function pf(t,o,u,h,y){for(var b=y.patternDependencies,S=0,P=o;S<P.length;S+=1){var k=P[S],z=k.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var Z=z.evaluate({zoom:h-1},u,{},y.availableImages),W=z.evaluate({zoom:h},u,{},y.availableImages),ee=z.evaluate({zoom:h+1},u,{},y.availableImages);W=W&&W.name?W.name:W,ee=ee&&ee.name?ee.name:ee,b[Z=Z&&Z.name?Z.name:Z]=!0,b[W]=!0,b[ee]=!0,u.patterns[k.id]={min:Z,mid:W,max:ee}}}return u}hu.deviation=function(t,o,u,h){var y=o&&o.length,b=Math.abs(jf(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,P=o.length;S<P;S++)b-=Math.abs(jf(t,o[S]*u,S<P-1?o[S+1]*u:t.length,u));var k=0;for(S=0;S<h.length;S+=3){var z=h[S]*u,Z=h[S+1]*u,W=h[S+2]*u;k+=Math.abs((t[z]-t[W])*(t[Z+1]-t[z+1])-(t[z]-t[Z])*(t[W+1]-t[z+1]))}return b===0&&k===0?0:Math.abs((k-b)/b)},hu.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(h+=t[y-1].length)}return u},lc.default=cc;var tu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Rl,this.indexArray=new Ju,this.indexArray2=new js,this.programConfigurations=new Hn(t.layers,t.zoom),this.segments=new ue,this.segments2=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};tu.prototype.populate=function(t,o,u){this.hasPattern=nl("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,Z=P.index,W=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ie=io(k,ee);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),ie,u)){var Me=h?h.evaluate(ie,{},u,o.availableImages):void 0,Re={id:z,properties:k.properties,type:k.type,sourceLayerIndex:W,index:Z,geometry:ee?ie.geometry:Va(k),patterns:{},sortKey:Me};y.push(Re)}}h&&y.sort(function(wr,Nr){return wr.sortKey-Nr.sortKey});for(var Ye=0,Ue=y;Ye<Ue.length;Ye+=1){var ut=Ue[Ye],_t=ut.geometry,Gt=ut.index,Yt=ut.sourceLayerIndex;if(this.hasPattern){var lr=pf("fill",this.layers,ut,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(ut,_t,Gt,u,{});o.featureIndex.insert(t[Gt].feature,_t,Gt,Yt,this.index)}},tu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},tu.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},tu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},tu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},tu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,eh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},tu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},tu.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Vf(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,Z=P;z<Z.length;z+=1)k+=Z[z].length;for(var W=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),ee=W.vertexLength,ie=[],Me=[],Re=0,Ye=P;Re<Ye.length;Re+=1){var Ue=Ye[Re];if(Ue.length!==0){Ue!==P[0]&&Me.push(ie.length/2);var ut=this.segments2.prepareSegment(Ue.length,this.layoutVertexArray,this.indexArray2),_t=ut.vertexLength;this.layoutVertexArray.emplaceBack(Ue[0].x,Ue[0].y),this.indexArray2.emplaceBack(_t+Ue.length-1,_t),ie.push(Ue[0].x),ie.push(Ue[0].y);for(var Gt=1;Gt<Ue.length;Gt++)this.layoutVertexArray.emplaceBack(Ue[Gt].x,Ue[Gt].y),this.indexArray2.emplaceBack(_t+Gt-1,_t+Gt),ie.push(Ue[Gt].x),ie.push(Ue[Gt].y);ut.vertexLength+=Ue.length,ut.primitiveLength+=Ue.length}}for(var Yt=lc(ie,Me),lr=0;lr<Yt.length;lr+=3)this.indexArray.emplaceBack(ee+Yt[lr],ee+Yt[lr+1],ee+Yt[lr+2]);W.vertexLength+=k,W.primitiveLength+=Yt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},gn("FillBucket",tu,{omit:["layers","patternFeatures"]});var Gf=new rs({"fill-sort-key":new wn(fe.layout_fill["fill-sort-key"])}),Hf={paint:new rs({"fill-antialias":new On(fe.paint_fill["fill-antialias"]),"fill-opacity":new wn(fe.paint_fill["fill-opacity"]),"fill-color":new wn(fe.paint_fill["fill-color"]),"fill-outline-color":new wn(fe.paint_fill["fill-outline-color"]),"fill-translate":new On(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new On(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new rc(fe.paint_fill["fill-pattern"])}),layout:Gf},hf=function(t){function o(u){t.call(this,u,Hf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new tu(u)},o.prototype.queryRadius=function(){return Oa(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k){return ka(tl(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,k),b)},o.prototype.isTileClipped=function(){return!0},o}(Sa),df=Ma([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Ap=El;function El(t,o,u,h,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(hc,this,o)}function hc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,y){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=y._keys[h.readVarint()],P=y._values[h.readVarint()];y.properties[S]=P}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function ah(t){for(var o,u,h=0,y=0,b=t.length,S=b-1;y<b;S=y++)h+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return h}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,y=0,b=0,S=0,P=[];t.pos<u;){if(y<=0){var k=t.readVarint();h=7&k,y=k>>3}if(y--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&P.push(o),o=[]),o.push(new se(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&P.push(o),P},El.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,y=0,b=0,S=1/0,P=-1/0,k=1/0,z=-1/0;t.pos<o;){if(h<=0){var Z=t.readVarint();u=7&Z,h=Z>>3}if(h--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>P&&(P=y),(b+=t.readSVarint())<k&&(k=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,k,P,z]},El.prototype.toGeoJSON=function(t,o,u){var h,y,b=this.extent*Math.pow(2,u),S=this.extent*t,P=this.extent*o,k=this.loadGeometry(),z=El.types[this.type];function Z(ie){for(var Me=0;Me<ie.length;Me++){var Re=ie[Me];ie[Me]=[360*(Re.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Re.y+P)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(h=0;h<k.length;h++)W[h]=k[h][0];Z(k=W);break;case 2:for(h=0;h<k.length;h++)Z(k[h]);break;case 3:for(k=function(ie){var Me=ie.length;if(Me<=1)return[ie];for(var Re,Ye,Ue=[],ut=0;ut<Me;ut++){var _t=ah(ie[ut]);_t!==0&&(Ye===void 0&&(Ye=_t<0),Ye===_t<0?(Re&&Ue.push(Re),Re=[ie[ut]]):Re.push(ie[ut]))}return Re&&Ue.push(Re),Ue}(k),h=0;h<k.length;h++)for(y=0;y<k[h].length;y++)Z(k[h][y])}k.length===1?k=k[0]:z="Multi"+z;var ee={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var wp=Zh;function Zh(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ad,this,o),this.length=this._features.length}function Ad(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var y=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;y=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return y}(u))}function wd(t,o,u){if(t===3){var h=new wp(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}Zh.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Ap(this._pbf,o,this.extent,this._keys,this._values)};var du={VectorTile:function(t,o){this.layers=t.readFields(wd,{},o)},VectorTileFeature:Ap,VectorTileLayer:wp},Td=du.VectorTileFeature.types,jr=Math.pow(2,13);function vf(t,o,u,h,y,b,S,P){t.emplaceBack(o,u,2*Math.floor(h*jr)+S,y*jr*2,b*jr*2,Math.round(P))}var Ut=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Js,this.indexArray=new Ju,this.programConfigurations=new Hn(t.layers,t.zoom),this.segments=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function jh(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}Ut.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=nl("fill-extrusion",this.layers,o);for(var h=0,y=t;h<y.length;h+=1){var b=y[h],S=b.feature,P=b.id,k=b.index,z=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,W=io(S,Z);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),W,u)){var ee={id:P,sourceLayerIndex:z,index:k,geometry:Z?W.geometry:Va(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(pf("fill-extrusion",this.layers,ee,this.zoom,o)):this.addFeature(ee,ee.geometry,k,u,{}),o.featureIndex.insert(S,ee.geometry,k,z,this.index,!0)}}},Ut.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.features;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Ut.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Ut.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ut.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ut.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,df),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ut.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ut.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Vf(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,Z=P;z<Z.length;z+=1)k+=Z[z].length;for(var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,ie=P;ee<ie.length;ee+=1){var Me=ie[ee];if(Me.length!==0&&!((Vi=Me).every(function(vi){return vi.x<0})||Vi.every(function(vi){return vi.x>8192})||Vi.every(function(vi){return vi.y<0})||Vi.every(function(vi){return vi.y>8192})))for(var Re=0,Ye=0;Ye<Me.length;Ye++){var Ue=Me[Ye];if(Ye>=1){var ut=Me[Ye-1];if(!jh(Ue,ut)){W.vertexLength+4>ue.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _t=Ue.sub(ut)._perp()._unit(),Gt=ut.dist(Ue);Re+Gt>32768&&(Re=0),vf(this.layoutVertexArray,Ue.x,Ue.y,_t.x,_t.y,0,0,Re),vf(this.layoutVertexArray,Ue.x,Ue.y,_t.x,_t.y,0,1,Re),vf(this.layoutVertexArray,ut.x,ut.y,_t.x,_t.y,0,0,Re+=Gt),vf(this.layoutVertexArray,ut.x,ut.y,_t.x,_t.y,0,1,Re);var Yt=W.vertexLength;this.indexArray.emplaceBack(Yt,Yt+2,Yt+1),this.indexArray.emplaceBack(Yt+1,Yt+2,Yt+3),W.vertexLength+=4,W.primitiveLength+=2}}}}if(W.vertexLength+k>ue.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),Td[t.type]==="Polygon"){for(var lr=[],wr=[],Nr=W.vertexLength,kn=0,hn=P;kn<hn.length;kn+=1){var zn=hn[kn];if(zn.length!==0){zn!==P[0]&&wr.push(lr.length/2);for(var dn=0;dn<zn.length;dn++){var Mi=zn[dn];vf(this.layoutVertexArray,Mi.x,Mi.y,0,0,1,1,0),lr.push(Mi.x),lr.push(Mi.y)}}}for(var ri=lc(lr,wr),Pn=0;Pn<ri.length;Pn+=3)this.indexArray.emplaceBack(Nr+ri[Pn],Nr+ri[Pn+2],Nr+ri[Pn+1]);W.primitiveLength+=ri.length/3,W.vertexLength+=k}}var Vi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},gn("FillExtrusionBucket",Ut,{omit:["layers","features"]});var Md={paint:new rs({"fill-extrusion-opacity":new On(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wn(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rc(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wn(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wn(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},il=function(t){function o(u){t.call(this,u,Md)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Ut(u)},o.prototype.queryRadius=function(){return Oa(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k,z){var Z=tl(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,k),W=this.paint.get("fill-extrusion-height").evaluate(h,y),ee=this.paint.get("fill-extrusion-base").evaluate(h,y),ie=function(Re,Ye,Ue,ut){for(var _t=[],Gt=0,Yt=Re;Gt<Yt.length;Gt+=1){var lr=Yt[Gt],wr=[lr.x,lr.y,0,1];bl(wr,wr,Ye),_t.push(new se(wr[0]/wr[3],wr[1]/wr[3]))}return _t}(Z,z),Me=function(Re,Ye,Ue,ut){for(var _t=[],Gt=[],Yt=ut[8]*Ye,lr=ut[9]*Ye,wr=ut[10]*Ye,Nr=ut[11]*Ye,kn=ut[8]*Ue,hn=ut[9]*Ue,zn=ut[10]*Ue,dn=ut[11]*Ue,Mi=0,ri=Re;Mi<ri.length;Mi+=1){for(var Pn=[],Vi=[],vi=0,hi=ri[Mi];vi<hi.length;vi+=1){var Zn=hi[vi],ca=Zn.x,ao=Zn.y,bo=ut[0]*ca+ut[4]*ao+ut[12],Eo=ut[1]*ca+ut[5]*ao+ut[13],vo=ut[2]*ca+ut[6]*ao+ut[14],Lo=ut[3]*ca+ut[7]*ao+ut[15],cs=vo+wr,fs=Lo+Nr,za=bo+kn,bs=Eo+hn,Pi=vo+zn,Uo=Lo+dn,Es=new se((bo+Yt)/fs,(Eo+lr)/fs);Es.z=cs/fs,Pn.push(Es);var Ki=new se(za/Uo,bs/Uo);Ki.z=Pi/Uo,Vi.push(Ki)}_t.push(Pn),Gt.push(Vi)}return[_t,Gt]}(b,ee,W,z);return function(Re,Ye,Ue){var ut=1/0;ka(Ue,Ye)&&(ut=dc(Ue,Ye[0]));for(var _t=0;_t<Ye.length;_t++)for(var Gt=Ye[_t],Yt=Re[_t],lr=0;lr<Gt.length-1;lr++){var wr=Gt[lr],Nr=[wr,Gt[lr+1],Yt[lr+1],Yt[lr],wr];Fu(Ue,Nr)&&(ut=Math.min(ut,dc(Ue,Nr)))}return ut!==1/0&&ut}(Me[0],Me[1],ie)},o}(Sa);function Uc(t,o){return t.x*o.x+t.y*o.y}function dc(t,o){if(t.length===1){for(var u,h=0,y=o[h++];!u||y.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],P=u.sub(y),k=b.sub(y),z=S.sub(y),Z=Uc(P,P),W=Uc(P,k),ee=Uc(k,k),ie=Uc(z,P),Me=Uc(z,k),Re=Z*ee-W*W,Ye=(ee*ie-W*Me)/Re,Ue=(Z*Me-W*ie)/Re,ut=y.z*(1-Ye-Ue)+u.z*Ye+b.z*Ue;if(isFinite(ut))return ut}return 1/0}for(var _t=1/0,Gt=0,Yt=o;Gt<Yt.length;Gt+=1)_t=Math.min(_t,Yt[Gt].z);return _t}var vc=Ma([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,oh=Ma([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Zc=du.VectorTileFeature.types,Tp=Math.cos(Math.PI/180*37.5),sh=Math.pow(2,14)/.5,va=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new No,this.layoutVertexArray2=new vl,this.indexArray=new Ju,this.programConfigurations=new Hn(t.layers,t.zoom),this.segments=new ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};va.prototype.populate=function(t,o,u){this.hasPattern=nl("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,Z=P.index,W=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ie=io(k,ee);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),ie,u)){var Me=h?h.evaluate(ie,{},u):void 0,Re={id:z,properties:k.properties,type:k.type,sourceLayerIndex:W,index:Z,geometry:ee?ie.geometry:Va(k),patterns:{},sortKey:Me};y.push(Re)}}h&&y.sort(function(wr,Nr){return wr.sortKey-Nr.sortKey});for(var Ye=0,Ue=y;Ye<Ue.length;Ye+=1){var ut=Ue[Ye],_t=ut.geometry,Gt=ut.index,Yt=ut.sourceLayerIndex;if(this.hasPattern){var lr=pf("line",this.layers,ut,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(ut,_t,Gt,u,{});o.featureIndex.insert(t[Gt].feature,_t,Gt,Yt,this.index)}},va.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},va.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},va.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},va.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,oh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},va.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},va.prototype.addFeature=function(t,o,u,h,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),P=b.get("line-cap"),k=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,W=o;Z<W.length;Z+=1)this.addLine(W[Z],t,S,P,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},va.prototype.addLine=function(t,o,u,h,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=Zc[o.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var z=0;z<k-1&&t[z].equals(t[z+1]);)z++;if(!(k<(P?3:2))){u==="bevel"&&(y=1.05);var Z,W=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),ie=void 0,Me=void 0,Re=void 0,Ye=void 0;this.e1=this.e2=-1,P&&(Ye=t[z].sub(Z=t[k-2])._unit()._perp());for(var Ue=z;Ue<k;Ue++)if(!(Me=Ue===k-1?P?t[z+1]:void 0:t[Ue+1])||!t[Ue].equals(Me)){Ye&&(Re=Ye),Z&&(ie=Z),Z=t[Ue],Ye=Me?Me.sub(Z)._unit()._perp():Re;var ut=(Re=Re||Ye).add(Ye);ut.x===0&&ut.y===0||ut._unit();var _t=Re.x*Ye.x+Re.y*Ye.y,Gt=ut.x*Ye.x+ut.y*Ye.y,Yt=Gt!==0?1/Gt:1/0,lr=2*Math.sqrt(2-2*Gt),wr=Gt<Tp&&ie&&Me,Nr=Re.x*Ye.y-Re.y*Ye.x>0;if(wr&&Ue>z){var kn=Z.dist(ie);if(kn>2*W){var hn=Z.sub(Z.sub(ie)._mult(W/kn)._round());this.updateDistance(ie,hn),this.addCurrentVertex(hn,Re,0,0,ee),ie=hn}}var zn=ie&&Me,dn=zn?u:P?"butt":h;if(zn&&dn==="round"&&(Yt<b?dn="miter":Yt<=2&&(dn="fakeround")),dn==="miter"&&Yt>y&&(dn="bevel"),dn==="bevel"&&(Yt>2&&(dn="flipbevel"),Yt<y&&(dn="miter")),ie&&this.updateDistance(ie,Z),dn==="miter")ut._mult(Yt),this.addCurrentVertex(Z,ut,0,0,ee);else if(dn==="flipbevel"){if(Yt>100)ut=Ye.mult(-1);else{var Mi=Yt*Re.add(Ye).mag()/Re.sub(Ye).mag();ut._perp()._mult(Mi*(Nr?-1:1))}this.addCurrentVertex(Z,ut,0,0,ee),this.addCurrentVertex(Z,ut.mult(-1),0,0,ee)}else if(dn==="bevel"||dn==="fakeround"){var ri=-Math.sqrt(Yt*Yt-1),Pn=Nr?ri:0,Vi=Nr?0:ri;if(ie&&this.addCurrentVertex(Z,Re,Pn,Vi,ee),dn==="fakeround")for(var vi=Math.round(180*lr/Math.PI/20),hi=1;hi<vi;hi++){var Zn=hi/vi;if(Zn!==.5){var ca=Zn-.5;Zn+=Zn*ca*(Zn-1)*((1.0904+_t*(_t*(3.55645-1.43519*_t)-3.2452))*ca*ca+(.848013+_t*(.215638*_t-1.06021)))}var ao=Ye.sub(Re)._mult(Zn)._add(Re)._unit()._mult(Nr?-1:1);this.addHalfVertex(Z,ao.x,ao.y,!1,Nr,0,ee)}Me&&this.addCurrentVertex(Z,Ye,-Pn,-Vi,ee)}else if(dn==="butt")this.addCurrentVertex(Z,ut,0,0,ee);else if(dn==="square"){var bo=ie?1:-1;this.addCurrentVertex(Z,ut,bo,bo,ee)}else dn==="round"&&(ie&&(this.addCurrentVertex(Z,Re,0,0,ee),this.addCurrentVertex(Z,Re,1,1,ee,!0)),Me&&(this.addCurrentVertex(Z,Ye,-1,-1,ee,!0),this.addCurrentVertex(Z,Ye,0,0,ee)));if(wr&&Ue<k-1){var Eo=Z.dist(Me);if(Eo>2*W){var vo=Z.add(Me.sub(Z)._mult(W/Eo)._round());this.updateDistance(Z,vo),this.addCurrentVertex(vo,Ye,0,0,ee),Z=vo}}}}},va.prototype.addCurrentVertex=function(t,o,u,h,y,b){b===void 0&&(b=!1);var S=o.y*h-o.x,P=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,P,b,!0,-h,y),this.distance>sh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,y,b))},va.prototype.addHalfVertex=function(t,o,u,h,y,b,S){var P=.5*(this.lineClips?this.scaledDistance*(sh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),y?this.e2=k:this.e1=k},va.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},va.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},gn("LineBucket",va,{omit:["layers","patternFeatures"]});var Ul=new rs({"line-cap":new On(fe.layout_line["line-cap"]),"line-join":new wn(fe.layout_line["line-join"]),"line-miter-limit":new On(fe.layout_line["line-miter-limit"]),"line-round-limit":new On(fe.layout_line["line-round-limit"]),"line-sort-key":new wn(fe.layout_line["line-sort-key"])}),Io={paint:new rs({"line-opacity":new wn(fe.paint_line["line-opacity"]),"line-color":new wn(fe.paint_line["line-color"]),"line-translate":new On(fe.paint_line["line-translate"]),"line-translate-anchor":new On(fe.paint_line["line-translate-anchor"]),"line-width":new wn(fe.paint_line["line-width"]),"line-gap-width":new wn(fe.paint_line["line-gap-width"]),"line-offset":new wn(fe.paint_line["line-offset"]),"line-blur":new wn(fe.paint_line["line-blur"]),"line-dasharray":new gs(fe.paint_line["line-dasharray"]),"line-pattern":new rc(fe.paint_line["line-pattern"]),"line-gradient":new xu(fe.paint_line["line-gradient"])}),layout:Ul},Hs=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new ki(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,y,b){return h=Ct({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,y,b)},o}(wn))(Io.paint.properties["line-width"].specification);Hs.useIntegerZoom=!0;var uh=function(t){function o(u){t.call(this,u,Io),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof vs,this.gradientVersion=(this.gradientVersion+1)%et)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Hs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new va(u)},o.prototype.queryRadius=function(u){var h=u,y=Vh(fu("line-width",this,h),fu("line-gap-width",this,h)),b=fu("line-offset",this,h);return y/2+Math.abs(b)+Oa(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k){var z=tl(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,k),Z=k/2*Vh(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),W=this.paint.get("line-offset").evaluate(h,y);return W&&(b=function(ee,ie){for(var Me=[],Re=new se(0,0),Ye=0;Ye<ee.length;Ye++){for(var Ue=ee[Ye],ut=[],_t=0;_t<Ue.length;_t++){var Gt=Ue[_t],Yt=Ue[_t+1],lr=_t===0?Re:Gt.sub(Ue[_t-1])._unit()._perp(),wr=_t===Ue.length-1?Re:Yt.sub(Gt)._unit()._perp(),Nr=lr._add(wr)._unit();Nr._mult(1/(Nr.x*wr.x+Nr.y*wr.y)),ut.push(Nr._mult(ie)._add(Gt))}Me.push(ut)}return Me}(b,W*k)),function(ee,ie,Me){for(var Re=0;Re<ie.length;Re++){var Ye=ie[Re];if(ee.length>=3){for(var Ue=0;Ue<Ye.length;Ue++)if(Su(ee,Ye[Ue]))return!0}if(Ia(ee,Ye,Me))return!0}return!1}(z,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(Sa);function Vh(t,o){return o>0?o+2*t:t}var Gh=Ma([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hh=Ma([{name:"a_projected_pos",components:3,type:"Float32"}],4),lh=(Ma([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ma([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ch=(Ma([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ma([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Pd=Ma([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Id(t,o,u){return t.sections.forEach(function(h){h.text=function(y,b,S){var P=b.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?y=y.toLocaleUpperCase():P==="lowercase"&&(y=y.toLocaleLowerCase()),Os.applyArabicShaping&&(y=Os.applyArabicShaping(y)),y}(h.text,o,u)}),t}Ma([{name:"triangle",components:3,type:"Uint16"}]),Ma([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ma([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ma([{type:"Float32",name:"offsetX"}]),Ma([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Wf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Wh=function(t,o,u,h,y){var b,S,P=8*y-h-1,k=(1<<P)-1,z=k>>1,Z=-7,W=u?y-1:0,ee=u?-1:1,ie=t[o+W];for(W+=ee,b=ie&(1<<-Z)-1,ie>>=-Z,Z+=P;Z>0;b=256*b+t[o+W],W+=ee,Z-=8);for(S=b&(1<<-Z)-1,b>>=-Z,Z+=h;Z>0;S=256*S+t[o+W],W+=ee,Z-=8);if(b===0)b=1-z;else{if(b===k)return S?NaN:1/0*(ie?-1:1);S+=Math.pow(2,h),b-=z}return(ie?-1:1)*S*Math.pow(2,b-h)},Xh=function(t,o,u,h,y,b){var S,P,k,z=8*b-y-1,Z=(1<<z)-1,W=Z>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ie=h?0:b-1,Me=h?1:-1,Re=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(P=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(k=Math.pow(2,-S))<1&&(S--,k*=2),(o+=S+W>=1?ee/k:ee*Math.pow(2,1-W))*k>=2&&(S++,k/=2),S+W>=Z?(P=0,S=Z):S+W>=1?(P=(o*k-1)*Math.pow(2,y),S+=W):(P=o*Math.pow(2,W-1)*Math.pow(2,y),S=0));y>=8;t[u+ie]=255&P,ie+=Me,P/=256,y-=8);for(S=S<<y|P,z+=y;z>0;t[u+ie]=255&S,ie+=Me,S/=256,z-=8);t[u+ie-Me]|=128*Re},Xf=Da;function Da(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Da.Varint=0,Da.Fixed64=1,Da.Bytes=2,Da.Fixed32=5;var fh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Sl(t){return t.type===Da.Bytes?t.readVarint()+t.pos:t.pos+1}function mf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function Yh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var y=u.pos-1;y>=t;y--)u.buf[y+h]=u.buf[y]}function Od(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function me(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function ze(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Dt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function ur(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Lt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function tr(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function dr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function yr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function _r(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Ir(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function or(t,o,u){t===1&&u.readMessage(Fr,o)}function Fr(t,o,u){if(t===3){var h=u.readMessage(br,{}),y=h.width,b=h.height,S=h.left,P=h.top,k=h.advance;o.push({id:h.id,bitmap:new pu({width:y+6,height:b+6},h.bitmap),metrics:{width:y,height:b,left:S,top:P,advance:k}})}}function br(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Pr(t){for(var o=0,u=0,h=0,y=t;h<y.length;h+=1){var b=y[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Re,Ye){return Ye.h-Re.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],P=0,k=0,z=0,Z=t;z<Z.length;z+=1)for(var W=Z[z],ee=S.length-1;ee>=0;ee--){var ie=S[ee];if(!(W.w>ie.w||W.h>ie.h)){if(W.x=ie.x,W.y=ie.y,k=Math.max(k,W.y+W.h),P=Math.max(P,W.x+W.w),W.w===ie.w&&W.h===ie.h){var Me=S.pop();ee<S.length&&(S[ee]=Me)}else W.h===ie.h?(ie.x+=W.w,ie.w-=W.w):W.w===ie.w?(ie.y+=W.h,ie.h-=W.h):(S.push({x:ie.x+W.w,y:ie.y,w:ie.w-W.w,h:W.h}),ie.y+=W.h,ie.h-=W.h);break}}return{w:P,h:k,fill:o/(P*k)||0}}Da.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),y=h>>3,b=this.pos;this.type=7&h,t(y,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=yr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ir(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=yr(this.buf,this.pos)+4294967296*yr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=yr(this.buf,this.pos)+4294967296*Ir(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Wh(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Wh(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(y,b,S){var P,k,z=S.buf;if(P=(112&(k=z[S.pos++]))>>4,k<128||(P|=(127&(k=z[S.pos++]))<<3,k<128)||(P|=(127&(k=z[S.pos++]))<<10,k<128)||(P|=(127&(k=z[S.pos++]))<<17,k<128)||(P|=(127&(k=z[S.pos++]))<<24,k<128)||(P|=(1&(k=z[S.pos++]))<<31,k<128))return mf(y,P,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&fh?function(u,h,y){return fh.decode(u.subarray(h,y))}(this.buf,o,t):function(u,h,y){for(var b="",S=h;S<y;){var P,k,z,Z=u[S],W=null,ee=Z>239?4:Z>223?3:Z>191?2:1;if(S+ee>y)break;ee===1?Z<128&&(W=Z):ee===2?(192&(P=u[S+1]))==128&&(W=(31&Z)<<6|63&P)<=127&&(W=null):ee===3?(k=u[S+2],(192&(P=u[S+1]))==128&&(192&k)==128&&((W=(15&Z)<<12|(63&P)<<6|63&k)<=2047||W>=55296&&W<=57343)&&(W=null)):ee===4&&(k=u[S+2],z=u[S+3],(192&(P=u[S+1]))==128&&(192&k)==128&&(192&z)==128&&((W=(15&Z)<<18|(63&P)<<12|(63&k)<<6|63&z)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,ee=1):W>65535&&(W-=65536,b+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),b+=String.fromCharCode(W),S+=ee}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Da.Bytes)return t.push(this.readVarint(o));var u=Sl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Da.Bytes)return t.push(this.readSVarint());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Da.Bytes)return t.push(this.readBoolean());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Da.Bytes)return t.push(this.readFloat());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Da.Bytes)return t.push(this.readDouble());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Da.Bytes)return t.push(this.readFixed32());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Da.Bytes)return t.push(this.readSFixed32());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Da.Bytes)return t.push(this.readFixed64());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Da.Bytes)return t.push(this.readSFixed64());var o=Sl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Da.Varint)for(;this.buf[this.pos++]>127;);else if(o===Da.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Da.Fixed32)this.pos+=4;else{if(o!==Da.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_r(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_r(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_r(this.buf,-1&t,this.pos),_r(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_r(this.buf,-1&t,this.pos),_r(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,y;if(o>=0?(h=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,P){P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,P.buf[P.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var P=(7&b)<<4;S.buf[S.pos++]|=P|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,y,b){for(var S,P,k=0;k<y.length;k++){if((S=y.charCodeAt(k))>55295&&S<57344){if(!P){S>56319||k+1===y.length?(h[b++]=239,h[b++]=191,h[b++]=189):P=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(h[b++]=239,h[b++]=191,h[b++]=189,P=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&Yh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),Xh(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Xh(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&Yh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,Da.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Od,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Dt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,me,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,ze,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,ur,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Lt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,tr,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,dr,o)},writeBytesField:function(t,o){this.writeTag(t,Da.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Da.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Da.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Da.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Da.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Da.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Da.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Da.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Da.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Da.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var st=function(t,o){var u=o.pixelRatio,h=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=h},Xt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Xt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Xt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Xt.tlbr.get=function(){return this.tl.concat(this.br)},Xt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(st.prototype,Xt);var Er=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,h,y);var b=Pr(y),S=new Ga({width:b.w||1,height:b.h||1});for(var P in t){var k=t[P],z=u[P].paddedRect;Ga.copy(k.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},k.data)}for(var Z in o){var W=o[Z],ee=h[Z].paddedRect,ie=ee.x+1,Me=ee.y+1,Re=W.data.width,Ye=W.data.height;Ga.copy(W.data,S,{x:0,y:0},{x:ie,y:Me},W.data),Ga.copy(W.data,S,{x:0,y:Ye-1},{x:ie,y:Me-1},{width:Re,height:1}),Ga.copy(W.data,S,{x:0,y:0},{x:ie,y:Me+Ye},{width:Re,height:1}),Ga.copy(W.data,S,{x:Re-1,y:0},{x:ie-1,y:Me},{width:1,height:Ye}),Ga.copy(W.data,S,{x:0,y:0},{x:ie+Re,y:Me},{width:1,height:Ye})}this.image=S,this.iconPositions=u,this.patternPositions=h};Er.prototype.addImages=function(t,o,u){for(var h in t){var y=t[h],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[h]=new st(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},Er.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},Er.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},gn("ImagePosition",st),gn("ImageAtlas",Er);var Ur={horizontal:1,vertical:2,horizontalOnly:3},fr=function(){this.scale=1,this.fontStack="",this.imageName=null};fr.forText=function(t,o){var u=new fr;return u.scale=t||1,u.fontStack=o,u},fr.forImage=function(t){var o=new fr;return o.imageName=t,o};var Lr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function $r(t,o,u,h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re){var Ye,Ue=Lr.fromFeature(t,y);W===Ur.vertical&&Ue.verticalizePunctuation();var ut=Os.processBidirectionalText,_t=Os.processStyledBidirectionalText;if(ut&&Ue.sections.length===1){Ye=[];for(var Gt=0,Yt=ut(Ue.toString(),Wr(Ue,z,b,o,h,ie,Me));Gt<Yt.length;Gt+=1){var lr=Yt[Gt],wr=new Lr;wr.text=lr,wr.sections=Ue.sections;for(var Nr=0;Nr<lr.length;Nr++)wr.sectionIndex.push(0);Ye.push(wr)}}else if(_t){Ye=[];for(var kn=0,hn=_t(Ue.text,Ue.sectionIndex,Wr(Ue,z,b,o,h,ie,Me));kn<hn.length;kn+=1){var zn=hn[kn],dn=new Lr;dn.text=zn[0],dn.sectionIndex=zn[1],dn.sections=Ue.sections,Ye.push(dn)}}else Ye=function(Pn,Vi){for(var vi=[],hi=Pn.text,Zn=0,ca=0,ao=Vi;ca<ao.length;ca+=1){var bo=ao[ca];vi.push(Pn.substring(Zn,bo)),Zn=bo}return Zn<hi.length&&vi.push(Pn.substring(Zn,hi.length)),vi}(Ue,Wr(Ue,z,b,o,h,ie,Me));var Mi=[],ri={positionedLines:Mi,text:Ue.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(Pn,Vi,vi,hi,Zn,ca,ao,bo,Eo,vo,Lo,cs){for(var fs=0,za=-17,bs=0,Pi=0,Uo=bo==="right"?1:bo==="left"?0:.5,Es=0,Ki=0,G=Zn;Ki<G.length;Ki+=1){var Ra=G[Ki];Ra.trim();var aa=Ra.getMaxScale(),Ws=24*(aa-1),Ms={positionedGlyphs:[],lineOffset:0};Pn.positionedLines[Es]=Ms;var Qa=Ms.positionedGlyphs,Zo=0;if(Ra.length()){for(var Ps=0;Ps<Ra.length();Ps++){var $i=Ra.getSection(Ps),Zl=Ra.getSectionIndex(Ps),Au=Ra.getCharCode(Ps),jl=0,ko=null,Vl=null,ol=null,Vc=24,qf=!(Eo===Ur.horizontal||!Lo&&!kf(Au)||Lo&&(Tn[Au]||(gc=Au,qr.Arabic(gc)||qr["Arabic Supplement"](gc)||qr["Arabic Extended-A"](gc)||qr["Arabic Presentation Forms-A"](gc)||qr["Arabic Presentation Forms-B"](gc))));if($i.imageName){var Ip=hi[$i.imageName];if(!Ip)continue;ol=$i.imageName,Pn.iconsInText=Pn.iconsInText||!0,Vl=Ip.paddedRect;var mc=Ip.displaySize;$i.scale=24*$i.scale/cs,jl=Ws+(24-mc[1]*$i.scale),Vc=(ko={width:mc[0],height:mc[1],left:1,top:-3,advance:qf?mc[1]:mc[0]}).advance;var Kf=qf?mc[0]*$i.scale-24*aa:mc[1]*$i.scale-24*aa;Kf>0&&Kf>Zo&&(Zo=Kf)}else{var ph=vi[$i.fontStack],$f=ph&&ph[Au];if($f&&$f.rect)Vl=$f.rect,ko=$f.metrics;else{var Op=Vi[$i.fontStack],_f=Op&&Op[Au];if(!_f)continue;ko=_f.metrics}jl=24*(aa-$i.scale)}qf?(Pn.verticalizable=!0,Qa.push({glyph:Au,imageName:ol,x:fs,y:za+jl,vertical:qf,scale:$i.scale,fontStack:$i.fontStack,sectionIndex:Zl,metrics:ko,rect:Vl}),fs+=Vc*$i.scale+vo):(Qa.push({glyph:Au,imageName:ol,x:fs,y:za+jl,vertical:qf,scale:$i.scale,fontStack:$i.fontStack,sectionIndex:Zl,metrics:ko,rect:Vl}),fs+=ko.advance*$i.scale+vo)}Qa.length!==0&&(bs=Math.max(fs-vo,bs),xi(Qa,0,Qa.length-1,Uo,Zo)),fs=0;var hh=ca*aa+Zo;Ms.lineOffset=Math.max(Zo,Ws),za+=hh,Pi=Math.max(hh,Pi),++Es}else za+=ca,++Es}var gc,Rp=za- -17,Lp=Kr(ao),xf=Lp.horizontalAlign,Qf=Lp.verticalAlign;(function($h,bf,dh,sl,Qh,vh,Gc,kp,mh){var Jf,Dp=(bf-dh)*Qh;Jf=vh!==Gc?-kp*sl- -17:(-sl*mh+.5)*Gc;for(var ep=0,Fp=$h;ep<Fp.length;ep+=1)for(var Hc=0,Jh=Fp[ep].positionedGlyphs;Hc<Jh.length;Hc+=1){var Bp=Jh[Hc];Bp.x+=Dp,Bp.y+=Jf}})(Pn.positionedLines,Uo,xf,Qf,bs,Pi,ca,Rp,Zn.length),Pn.top+=-Qf*Rp,Pn.bottom=Pn.top+Rp,Pn.left+=-xf*bs,Pn.right=Pn.left+bs}(ri,o,u,h,Ye,S,P,k,W,z,ee,Re),!function(Pn){for(var Vi=0,vi=Pn;Vi<vi.length;Vi+=1)if(vi[Vi].positionedGlyphs.length!==0)return!1;return!0}(Mi)&&ri}Lr.fromFeature=function(t,o){for(var u=new Lr,h=0;h<t.sections.length;h++){var y=t.sections[h];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Lr.prototype.length=function(){return this.text.length},Lr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Lr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Lr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Lr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=h&&Lu(h)&&!Wf[t[u+1]]||y&&Lu(y)&&!Wf[t[u-1]]||!Wf[t[u]]?t[u]:Wf[t[u]]}return o}(this.text)},Lr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Tn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Tn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Lr.prototype.substring=function(t,o){var u=new Lr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Lr.prototype.toString=function(){return this.text},Lr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Lr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(fr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Lr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(fr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},Lr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qt={};function rr(t,o,u,h,y,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var P=u[o.fontStack],k=P&&P[t];return k?k.metrics.advance*o.scale+y:0}function En(t,o,u,h){var y=Math.pow(t-o,2);return h?t<o?y/2:2*y:y+Math.abs(u)*u}function Vr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function Ar(t,o,u,h,y,b){for(var S=null,P=En(o,u,y,b),k=0,z=h;k<z.length;k+=1){var Z=z[k],W=En(o-Z.x,u,y,b)+Z.badness;W<=P&&(S=Z,P=W)}return{index:t,x:o,priorBreak:S,badness:P}}function Wr(t,o,u,h,y,b,S){if(b!=="point")return[];if(!t)return[];for(var P,k=[],z=function(Ye,Ue,ut,_t,Gt,Yt){for(var lr=0,wr=0;wr<Ye.length();wr++){var Nr=Ye.getSection(wr);lr+=rr(Ye.getCharCode(wr),Nr,_t,Gt,Ue,Yt)}return lr/Math.max(1,Math.ceil(lr/ut))}(t,o,u,h,y,S),Z=t.text.indexOf("\u200B")>=0,W=0,ee=0;ee<t.length();ee++){var ie=t.getSection(ee),Me=t.getCharCode(ee);if(Tn[Me]||(W+=rr(Me,ie,h,y,o,S)),ee<t.length()-1){var Re=!((P=Me)<11904||!(qr["Bopomofo Extended"](P)||qr.Bopomofo(P)||qr["CJK Compatibility Forms"](P)||qr["CJK Compatibility Ideographs"](P)||qr["CJK Compatibility"](P)||qr["CJK Radicals Supplement"](P)||qr["CJK Strokes"](P)||qr["CJK Symbols and Punctuation"](P)||qr["CJK Unified Ideographs Extension A"](P)||qr["CJK Unified Ideographs"](P)||qr["Enclosed CJK Letters and Months"](P)||qr["Halfwidth and Fullwidth Forms"](P)||qr.Hiragana(P)||qr["Ideographic Description Characters"](P)||qr["Kangxi Radicals"](P)||qr["Katakana Phonetic Extensions"](P)||qr.Katakana(P)||qr["Vertical Forms"](P)||qr["Yi Radicals"](P)||qr["Yi Syllables"](P)));(Qt[Me]||Re||ie.imageName)&&k.push(Ar(ee+1,W,z,k,Vr(Me,t.getCharCode(ee+1),Re&&Z),!1))}}return function Ye(Ue){return Ue?Ye(Ue.priorBreak).concat(Ue.index):[]}(Ar(t.length(),W,z,k,0,!0))}function Kr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function xi(t,o,u,h,y){if(h||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,P=o;P<=u;P++)t[P].x-=S,t[P].y+=y}function ni(t,o,u,h,y,b){var S,P=t.image;if(P.content){var k=P.content,z=P.pixelRatio||1;S=[k[0]/z,k[1]/z,P.displaySize[0]-k[2]/z,P.displaySize[1]-k[3]/z]}var Z,W,ee,ie,Me=o.left*b,Re=o.right*b;u==="width"||u==="both"?(ie=y[0]+Me-h[3],W=y[0]+Re+h[1]):W=(ie=y[0]+(Me+Re-P.displaySize[0])/2)+P.displaySize[0];var Ye=o.top*b,Ue=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+Ye-h[0],ee=y[1]+Ue+h[2]):ee=(Z=y[1]+(Ye+Ue-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:Z,right:W,bottom:ee,left:ie,collisionPadding:S}}Qt[10]=!0,Qt[32]=!0,Qt[38]=!0,Qt[40]=!0,Qt[41]=!0,Qt[43]=!0,Qt[45]=!0,Qt[47]=!0,Qt[173]=!0,Qt[183]=!0,Qt[8203]=!0,Qt[8208]=!0,Qt[8211]=!0,Qt[8231]=!0;var Yr=function(t){function o(u,h,y,b){t.call(this,u,h),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(se);function an(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new ki(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,y=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var P=h[b],k=h[S];return u.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:P,maxZoom:k,minSize:u.evaluate(new ki(P)),maxSize:u.evaluate(new ki(k)),interpolationType:y}}function $n(t,o,u){var h=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ua(y/128,u.upperSize/128,o.uSizeT):h}function pi(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?Ht(xe.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ua(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}gn("Anchor",Yr);var Zi=Object.freeze({__proto__:null,getSizeData:an,evaluateSizeForFeature:$n,evaluateSizeForZoom:pi,SIZE_PACK_FACTOR:128});function po(t,o,u,h,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,P=0;P>-u/2;){if(--S<0)return!1;P-=t[S].dist(b),b=t[S]}P+=t[S].dist(t[S+1]),S++;for(var k=[],z=0;P<u/2;){var Z=t[S],W=t[S+1];if(!W)return!1;var ee=t[S-1].angleTo(Z)-Z.angleTo(W);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:ee}),z+=ee;P-k[0].distance>h;)z-=k.shift().angleDelta;if(z>y)return!1;S++,P+=Z.dist(W)}return!0}function ho(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Ni(t,o,u){return t?.6*o*u:0}function os(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function $a(t,o,u,h,y,b){for(var S=Ni(u,y,b),P=os(u,h)*b,k=0,z=ho(t)/2,Z=0;Z<t.length-1;Z++){var W=t[Z],ee=t[Z+1],ie=W.dist(ee);if(k+ie>z){var Me=(z-k)/ie,Re=ua(W.x,ee.x,Me),Ye=ua(W.y,ee.y,Me),Ue=new Yr(Re,Ye,ee.angleTo(W),Z);return Ue._round(),!S||po(t,Ue,P,S,o)?Ue:void 0}k+=ie}}function ns(t,o,u,h,y,b,S,P,k){var z=Ni(h,b,S),Z=os(h,y),W=Z*S,ee=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return o-W<o/4&&(o=W+o/4),function ie(Me,Re,Ye,Ue,ut,_t,Gt,Yt,lr){for(var wr=_t/2,Nr=ho(Me),kn=0,hn=Re-Ye,zn=[],dn=0;dn<Me.length-1;dn++){for(var Mi=Me[dn],ri=Me[dn+1],Pn=Mi.dist(ri),Vi=ri.angleTo(Mi);hn+Ye<kn+Pn;){var vi=((hn+=Ye)-kn)/Pn,hi=ua(Mi.x,ri.x,vi),Zn=ua(Mi.y,ri.y,vi);if(hi>=0&&hi<lr&&Zn>=0&&Zn<lr&&hn-wr>=0&&hn+wr<=Nr){var ca=new Yr(hi,Zn,Vi,dn);ca._round(),Ue&&!po(Me,ca,_t,Ue,ut)||zn.push(ca)}}kn+=Pn}return Yt||zn.length||Gt||(zn=ie(Me,kn/2,Ye,Ue,ut,_t,Gt,!0,lr)),zn}(t,ee?o/2*P%o:(Z/2+2*b)*S*P%o,o,z,u,W,ee,!1,k)}function Oo(t,o,u,h,y){for(var b=[],S=0;S<t.length;S++)for(var P=t[S],k=void 0,z=0;z<P.length-1;z++){var Z=P[z],W=P[z+1];Z.x<o&&W.x<o||(Z.x<o?Z=new se(o,Z.y+(o-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round():W.x<o&&(W=new se(o,Z.y+(o-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round()),Z.y<u&&W.y<u||(Z.y<u?Z=new se(Z.x+(u-Z.y)/(W.y-Z.y)*(W.x-Z.x),u)._round():W.y<u&&(W=new se(Z.x+(u-Z.y)/(W.y-Z.y)*(W.x-Z.x),u)._round()),Z.x>=h&&W.x>=h||(Z.x>=h?Z=new se(h,Z.y+(h-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round():W.x>=h&&(W=new se(h,Z.y+(h-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round()),Z.y>=y&&W.y>=y||(Z.y>=y?Z=new se(Z.x+(y-Z.y)/(W.y-Z.y)*(W.x-Z.x),y)._round():W.y>=y&&(W=new se(Z.x+(y-Z.y)/(W.y-Z.y)*(W.x-Z.x),y)._round()),k&&Z.equals(k[k.length-1])||b.push(k=[Z]),k.push(W)))))}return b}function Yo(t,o,u,h){var y=[],b=t.image,S=b.pixelRatio,P=b.paddedRect.w-2,k=b.paddedRect.h-2,z=t.right-t.left,Z=t.bottom-t.top,W=b.stretchX||[[0,P]],ee=b.stretchY||[[0,k]],ie=function(hi,Zn){return hi+Zn[1]-Zn[0]},Me=W.reduce(ie,0),Re=ee.reduce(ie,0),Ye=P-Me,Ue=k-Re,ut=0,_t=Me,Gt=0,Yt=Re,lr=0,wr=Ye,Nr=0,kn=Ue;if(b.content&&h){var hn=b.content;ut=zo(W,0,hn[0]),Gt=zo(ee,0,hn[1]),_t=zo(W,hn[0],hn[2]),Yt=zo(ee,hn[1],hn[3]),lr=hn[0]-ut,Nr=hn[1]-Gt,wr=hn[2]-hn[0]-_t,kn=hn[3]-hn[1]-Yt}var zn=function(hi,Zn,ca,ao){var bo=xo(hi.stretch-ut,_t,z,t.left),Eo=_i(hi.fixed-lr,wr,hi.stretch,Me),vo=xo(Zn.stretch-Gt,Yt,Z,t.top),Lo=_i(Zn.fixed-Nr,kn,Zn.stretch,Re),cs=xo(ca.stretch-ut,_t,z,t.left),fs=_i(ca.fixed-lr,wr,ca.stretch,Me),za=xo(ao.stretch-Gt,Yt,Z,t.top),bs=_i(ao.fixed-Nr,kn,ao.stretch,Re),Pi=new se(bo,vo),Uo=new se(cs,vo),Es=new se(cs,za),Ki=new se(bo,za),G=new se(Eo/S,Lo/S),Ra=new se(fs/S,bs/S),aa=o*Math.PI/180;if(aa){var Ws=Math.sin(aa),Ms=Math.cos(aa),Qa=[Ms,-Ws,Ws,Ms];Pi._matMult(Qa),Uo._matMult(Qa),Ki._matMult(Qa),Es._matMult(Qa)}var Zo=hi.stretch+hi.fixed,Ps=Zn.stretch+Zn.fixed;return{tl:Pi,tr:Uo,bl:Ki,br:Es,tex:{x:b.paddedRect.x+1+Zo,y:b.paddedRect.y+1+Ps,w:ca.stretch+ca.fixed-Zo,h:ao.stretch+ao.fixed-Ps},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:G,pixelOffsetBR:Ra,minFontScaleX:wr/S/z,minFontScaleY:kn/S/Z,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var dn=xs(W,Ye,Me),Mi=xs(ee,Ue,Re),ri=0;ri<dn.length-1;ri++)for(var Pn=dn[ri],Vi=dn[ri+1],vi=0;vi<Mi.length-1;vi++)y.push(zn(Pn,Mi[vi],Vi,Mi[vi+1]));else y.push(zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return y}function zo(t,o,u){for(var h=0,y=0,b=t;y<b.length;y+=1){var S=b[y];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function xs(t,o,u){for(var h=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],P=S[0],k=S[1],z=h[h.length-1];h.push({fixed:P-z.stretch,stretch:z.stretch}),h.push({fixed:P-z.stretch,stretch:z.stretch+(k-P)})}return h.push({fixed:o+1,stretch:u}),h}function xo(t,o,u,h){return t/o*u+h}function _i(t,o,u,h){return t-o*u/h}var qo=function(t,o,u,h,y,b,S,P,k,z){if(this.boxStartIndex=t.length,k){var Z=b.top,W=b.bottom,ee=b.collisionPadding;ee&&(Z-=ee[1],W+=ee[3]);var ie=W-Z;ie>0&&(ie=Math.max(10,ie),this.circleDiameter=ie)}else{var Me=b.top*S-P,Re=b.bottom*S+P,Ye=b.left*S-P,Ue=b.right*S+P,ut=b.collisionPadding;if(ut&&(Ye-=ut[0]*S,Me-=ut[1]*S,Ue+=ut[2]*S,Re+=ut[3]*S),z){var _t=new se(Ye,Me),Gt=new se(Ue,Me),Yt=new se(Ye,Re),lr=new se(Ue,Re),wr=z*Math.PI/180;_t._rotate(wr),Gt._rotate(wr),Yt._rotate(wr),lr._rotate(wr),Ye=Math.min(_t.x,Gt.x,Yt.x,lr.x),Ue=Math.max(_t.x,Gt.x,Yt.x,lr.x),Me=Math.min(_t.y,Gt.y,Yt.y,lr.y),Re=Math.max(_t.y,Gt.y,Yt.y,lr.y)}t.emplaceBack(o.x,o.y,Ye,Me,Ue,Re,u,h,y)}this.boxEndIndex=t.length},ia=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=ss),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function ss(t,o){return t<o?-1:t>o?1:0}function ti(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,y=1/0,b=-1/0,S=-1/0,P=t[0],k=0;k<P.length;k++){var z=P[k];(!k||z.x<h)&&(h=z.x),(!k||z.y<y)&&(y=z.y),(!k||z.x>b)&&(b=z.x),(!k||z.y>S)&&(S=z.y)}var Z=Math.min(b-h,S-y),W=Z/2,ee=new ia([],zi);if(Z===0)return new se(h,y);for(var ie=h;ie<b;ie+=Z)for(var Me=y;Me<S;Me+=Z)ee.push(new ma(ie+W,Me+W,W,t));for(var Re=function(ut){for(var _t=0,Gt=0,Yt=0,lr=ut[0],wr=0,Nr=lr.length,kn=Nr-1;wr<Nr;kn=wr++){var hn=lr[wr],zn=lr[kn],dn=hn.x*zn.y-zn.x*hn.y;Gt+=(hn.x+zn.x)*dn,Yt+=(hn.y+zn.y)*dn,_t+=3*dn}return new ma(Gt/_t,Yt/_t,0,ut)}(t),Ye=ee.length;ee.length;){var Ue=ee.pop();(Ue.d>Re.d||!Re.d)&&(Re=Ue,u&&console.log("found best %d after %d probes",Math.round(1e4*Ue.d)/1e4,Ye)),Ue.max-Re.d<=o||(ee.push(new ma(Ue.p.x-(W=Ue.h/2),Ue.p.y-W,W,t)),ee.push(new ma(Ue.p.x+W,Ue.p.y-W,W,t)),ee.push(new ma(Ue.p.x-W,Ue.p.y+W,W,t)),ee.push(new ma(Ue.p.x+W,Ue.p.y+W,W,t)),Ye+=4)}return u&&(console.log("num probes: "+Ye),console.log("best distance: "+Re.d)),Re.p}function zi(t,o){return o.max-t.max}function ma(t,o,u,h){this.p=new se(t,o),this.h=u,this.d=function(y,b){for(var S=!1,P=1/0,k=0;k<b.length;k++)for(var z=b[k],Z=0,W=z.length,ee=W-1;Z<W;ee=Z++){var ie=z[Z],Me=z[ee];ie.y>y.y!=Me.y>y.y&&y.x<(Me.x-ie.x)*(y.y-ie.y)/(Me.y-ie.y)+ie.x&&(S=!S),P=Math.min(P,ac(y,ie,Me))}return(S?1:-1)*Math.sqrt(P)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ia.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ia.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},ia.prototype.peek=function(){return this.data[0]},ia.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(h,b)>=0)break;o[t]=b,t=y}o[t]=h},ia.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,y=o[t];t<h;){var b=1+(t<<1),S=o[b],P=b+1;if(P<this.length&&u(o[P],S)<0&&(b=P,S=o[P]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Ro=Number.POSITIVE_INFINITY;function al(t,o){return o[1]!==Ro?function(u,h,y){var b=0,S=0;switch(h=Math.abs(h),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var y=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=h;break;case"right":y=-h}return[y,b]}(t,o[0])}function Te(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zt(t,o,u,h,y,b,S,P,k,z,Z,W,ee,ie,Me){var Re=function(Gt,Yt,lr,wr,Nr,kn,hn,zn){for(var dn=wr.layout.get("text-rotate").evaluate(kn,{})*Math.PI/180,Mi=[],ri=0,Pn=Yt.positionedLines;ri<Pn.length;ri+=1)for(var Vi=Pn[ri],vi=0,hi=Vi.positionedGlyphs;vi<hi.length;vi+=1){var Zn=hi[vi];if(Zn.rect){var ca=Zn.rect||{},ao=4,bo=!0,Eo=1,vo=0,Lo=(Nr||zn)&&Zn.vertical,cs=Zn.metrics.advance*Zn.scale/2;if(zn&&Yt.verticalizable&&(vo=Vi.lineOffset/2-(Zn.imageName?-(24-Zn.metrics.width*Zn.scale)/2:24*(Zn.scale-1))),Zn.imageName){var fs=hn[Zn.imageName];bo=fs.sdf,ao=1/(Eo=fs.pixelRatio)}var za=Nr?[Zn.x+cs,Zn.y]:[0,0],bs=Nr?[0,0]:[Zn.x+cs+lr[0],Zn.y+lr[1]-vo],Pi=[0,0];Lo&&(Pi=bs,bs=[0,0]);var Uo=(Zn.metrics.left-ao)*Zn.scale-cs+bs[0],Es=(-Zn.metrics.top-ao)*Zn.scale+bs[1],Ki=Uo+ca.w*Zn.scale/Eo,G=Es+ca.h*Zn.scale/Eo,Ra=new se(Uo,Es),aa=new se(Ki,Es),Ws=new se(Uo,G),Ms=new se(Ki,G);if(Lo){var Qa=new se(-cs,cs- -17),Zo=-Math.PI/2,Ps=12-cs,$i=new se(22-Ps,-(Zn.imageName?Ps:0)),Zl=new(Function.prototype.bind.apply(se,[null].concat(Pi)));Ra._rotateAround(Zo,Qa)._add($i)._add(Zl),aa._rotateAround(Zo,Qa)._add($i)._add(Zl),Ws._rotateAround(Zo,Qa)._add($i)._add(Zl),Ms._rotateAround(Zo,Qa)._add($i)._add(Zl)}if(dn){var Au=Math.sin(dn),jl=Math.cos(dn),ko=[jl,-Au,Au,jl];Ra._matMult(ko),aa._matMult(ko),Ws._matMult(ko),Ms._matMult(ko)}var Vl=new se(0,0),ol=new se(0,0);Mi.push({tl:Ra,tr:aa,bl:Ws,br:Ms,tex:ca,writingMode:Yt.writingMode,glyphOffset:za,sectionIndex:Zn.sectionIndex,isSDF:bo,pixelOffsetTL:Vl,pixelOffsetBR:ol,minFontScaleX:0,minFontScaleY:0})}}return Mi}(0,u,P,y,b,S,h,t.allowVerticalPlacement),Ye=t.textSizeData,Ue=null;Ye.kind==="source"?(Ue=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ye.kind==="composite"&&((Ue=[128*ie.compositeTextSizes[0].evaluate(S,{},Me),128*ie.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||Ue[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Re,Ue,P,b,S,z,o,k.lineStartIndex,k.lineLength,ee,Me);for(var ut=0,_t=Z;ut<_t.length;ut+=1)W[_t[ut]]=t.text.placedSymbolArray.length-1;return 4*Re.length}function bt(t){for(var o in t)return t[o];return null}function pn(t,o,u,h){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(h),!1}var ji=du.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ne(t,o,u,h,y,b,S,P,k,z,Z,W,ee){var ie=P?Math.min(32640,Math.round(P[0])):0,Me=P?Math.min(32640,Math.round(P[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*y),b,S,(ie<<1)+(k?1:0),Me,16*z,16*Z,256*W,256*ee)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function pt(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(uf(u[o].text))return!0;return!1}var It=function(t){this.layoutVertexArray=new lf,this.indexArray=new Ju,this.programConfigurations=t,this.segments=new ue,this.dynamicLayoutVertexArray=new Ll,this.opacityVertexArray=new kl,this.placedSymbolArray=new d};It.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},It.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Hh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},It.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},gn("SymbolBuffers",It);var qe=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new ue,this.collisionVertexArray=new mp};qe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,lh.members,!0)},qe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},gn("CollisionBuffers",qe);var Be=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=As([]),this.placementViewportMatrix=As([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=an(this.zoom,o["text-size"]),this.iconSizeData=an(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Ur[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Be.prototype.createArrays=function(){this.text=new It(new Hn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new It(new Hn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new M,this.lineVertexArray=new L,this.symbolInstances=new A},Be.prototype.calculateGlyphDependencies=function(t,o,u,h,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&y){var S=Wf[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Be.prototype.populate=function(t,o,u){var h=this.layers[0],y=h.layout,b=y.get("text-font"),S=y.get("text-field"),P=y.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof wa&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],k||z){for(var W=o.iconDependencies,ee=o.glyphDependencies,ie=o.availableImages,Me=new ki(this.zoom),Re=0,Ye=t;Re<Ye.length;Re+=1){var Ue=Ye[Re],ut=Ue.feature,_t=Ue.id,Gt=Ue.index,Yt=Ue.sourceLayerIndex,lr=h._featureFilter.needGeometry,wr=io(ut,lr);if(h._featureFilter.filter(Me,wr,u)){lr||(wr.geometry=Va(ut));var Nr=void 0;if(k){var kn=h.getValueAndResolveTokens("text-field",wr,u,ie),hn=wa.factory(kn);pt(hn)&&(this.hasRTLText=!0),(!this.hasRTLText||vp()==="unavailable"||this.hasRTLText&&Os.isParsed())&&(Nr=Id(hn,h,wr))}var zn=void 0;if(z){var dn=h.getValueAndResolveTokens("icon-image",wr,u,ie);zn=dn instanceof Ta?dn:Ta.fromString(dn)}if(Nr||zn){var Mi=this.sortFeaturesByKey?Z.evaluate(wr,{},u):void 0;if(this.features.push({id:_t,text:Nr,icon:zn,index:Gt,sourceLayerIndex:Yt,geometry:wr.geometry,properties:ut.properties,type:ji[ut.type],sortKey:Mi}),zn&&(W[zn.name]=!0),Nr){var ri=b.evaluate(wr,{},u).join(","),Pn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ur.vertical)>=0;for(var Vi=0,vi=Nr.sections;Vi<vi.length;Vi+=1){var hi=vi[Vi];if(hi.image)W[hi.image.name]=!0;else{var Zn=sf(Nr.toString()),ca=hi.fontStack||ri,ao=ee[ca]=ee[ca]||{};this.calculateGlyphDependencies(hi.text,ao,Pn,this.allowVerticalPlacement,Zn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(bo){var Eo={},vo={},Lo=[],cs=0;function fs(Qa){Lo.push(bo[Qa]),cs++}function za(Qa,Zo,Ps){var $i=vo[Qa];return delete vo[Qa],vo[Zo]=$i,Lo[$i].geometry[0].pop(),Lo[$i].geometry[0]=Lo[$i].geometry[0].concat(Ps[0]),$i}function bs(Qa,Zo,Ps){var $i=Eo[Zo];return delete Eo[Zo],Eo[Qa]=$i,Lo[$i].geometry[0].shift(),Lo[$i].geometry[0]=Ps[0].concat(Lo[$i].geometry[0]),$i}function Pi(Qa,Zo,Ps){var $i=Ps?Zo[0][Zo[0].length-1]:Zo[0][0];return Qa+":"+$i.x+":"+$i.y}for(var Uo=0;Uo<bo.length;Uo++){var Es=bo[Uo],Ki=Es.geometry,G=Es.text?Es.text.toString():null;if(G){var Ra=Pi(G,Ki),aa=Pi(G,Ki,!0);if(Ra in vo&&aa in Eo&&vo[Ra]!==Eo[aa]){var Ws=bs(Ra,aa,Ki),Ms=za(Ra,aa,Lo[Ws].geometry);delete Eo[Ra],delete vo[aa],vo[Pi(G,Lo[Ms].geometry,!0)]=Ms,Lo[Ws].geometry=null}else Ra in vo?za(Ra,aa,Ki):aa in Eo?bs(Ra,aa,Ki):(fs(Uo),Eo[Ra]=cs-1,vo[aa]=cs-1)}else fs(Uo)}return Lo.filter(function(Qa){return Qa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(bo,Eo){return bo.sortKey-Eo.sortKey})}},Be.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Be.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Be.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Be.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Be.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Be.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Be.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var P=t.segment||0;P>=0;P--)b[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:y},P>0&&(y+=o[P-1].dist(o[P]));for(var k=0;k<o.length;k++){var z=b[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Be.prototype.addSymbols=function(t,o,u,h,y,b,S,P,k,z,Z,W){for(var ee=t.indexArray,ie=t.layoutVertexArray,Me=t.segments.prepareSegment(4*o.length,ie,ee,this.canOverlap?b.sortKey:void 0),Re=this.glyphOffsetArray.length,Ye=Me.vertexLength,Ue=this.allowVerticalPlacement&&S===Ur.vertical?Math.PI/2:0,ut=b.text&&b.text.sections,_t=0;_t<o.length;_t++){var Gt=o[_t],Yt=Gt.tl,lr=Gt.tr,wr=Gt.bl,Nr=Gt.br,kn=Gt.tex,hn=Gt.pixelOffsetTL,zn=Gt.pixelOffsetBR,dn=Gt.minFontScaleX,Mi=Gt.minFontScaleY,ri=Gt.glyphOffset,Pn=Gt.isSDF,Vi=Gt.sectionIndex,vi=Me.vertexLength,hi=ri[1];ne(ie,P.x,P.y,Yt.x,hi+Yt.y,kn.x,kn.y,u,Pn,hn.x,hn.y,dn,Mi),ne(ie,P.x,P.y,lr.x,hi+lr.y,kn.x+kn.w,kn.y,u,Pn,zn.x,hn.y,dn,Mi),ne(ie,P.x,P.y,wr.x,hi+wr.y,kn.x,kn.y+kn.h,u,Pn,hn.x,zn.y,dn,Mi),ne(ie,P.x,P.y,Nr.x,hi+Nr.y,kn.x+kn.w,kn.y+kn.h,u,Pn,zn.x,zn.y,dn,Mi),Ve(t.dynamicLayoutVertexArray,P,Ue),ee.emplaceBack(vi,vi+1,vi+2),ee.emplaceBack(vi+1,vi+2,vi+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ri[0]),_t!==o.length-1&&Vi===o[_t+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,b,b.index,{},W,ut&&ut[Vi])}t.placedSymbolArray.emplaceBack(P.x,P.y,Re,this.glyphOffsetArray.length-Re,Ye,k,z,P.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,Z)},Be.prototype._addCollisionDebugVertex=function(t,o,u,h,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,y,Math.round(b.x),Math.round(b.y))},Be.prototype.addCollisionDebugVertices=function(t,o,u,h,y,b,S){var P=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),k=P.vertexLength,z=y.layoutVertexArray,Z=y.collisionVertexArray,W=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(z,Z,b,W,ee,new se(t,o)),this._addCollisionDebugVertex(z,Z,b,W,ee,new se(u,o)),this._addCollisionDebugVertex(z,Z,b,W,ee,new se(u,h)),this._addCollisionDebugVertex(z,Z,b,W,ee,new se(t,h)),P.vertexLength+=4;var ie=y.indexArray;ie.emplaceBack(k,k+1),ie.emplaceBack(k+1,k+2),ie.emplaceBack(k+2,k+3),ie.emplaceBack(k+3,k),P.primitiveLength+=4},Be.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Be.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qe(nc,ch.members,js),this.iconCollisionBox=new qe(nc,ch.members,js);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Be.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,y,b,S,P,k){for(var z={},Z=o;Z<u;Z++){var W=t.get(Z);z.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},z.textFeatureIndex=W.featureIndex;break}for(var ee=h;ee<y;ee++){var ie=t.get(ee);z.verticalTextBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},z.verticalTextFeatureIndex=ie.featureIndex;break}for(var Me=b;Me<S;Me++){var Re=t.get(Me);z.iconBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,anchorPointX:Re.anchorPointX,anchorPointY:Re.anchorPointY},z.iconFeatureIndex=Re.featureIndex;break}for(var Ye=P;Ye<k;Ye++){var Ue=t.get(Ye);z.verticalIconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},z.verticalIconFeatureIndex=Ue.featureIndex;break}return z},Be.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Be.prototype.hasTextData=function(){return this.text.segments.get().length>0},Be.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Be.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Be.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Be.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Be.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},Be.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var P=this.symbolInstances.get(S);h.push(0|Math.round(o*P.anchorX+u*P.anchorY)),y.push(P.featureIndex)}return b.sort(function(k,z){return h[k]-h[z]||y[z]-y[k]}),b},Be.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Be.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var y=this.symbolInstances.get(h[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,P){b>=0&&P.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},gn("SymbolBucket",Be,{omit:["layers","collisionBoxArray","features","compareText"]}),Be.MAX_GLYPHS=65535,Be.addDynamicAttributes=Ve;var nt=new rs({"symbol-placement":new On(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new On(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wn(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new On(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new wn(fe.layout_symbol["icon-size"]),"icon-text-fit":new On(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new wn(fe.layout_symbol["icon-image"]),"icon-rotate":new wn(fe.layout_symbol["icon-rotate"]),"icon-padding":new On(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new On(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new wn(fe.layout_symbol["icon-offset"]),"icon-anchor":new wn(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(fe.layout_symbol["text-rotation-alignment"]),"text-field":new wn(fe.layout_symbol["text-field"]),"text-font":new wn(fe.layout_symbol["text-font"]),"text-size":new wn(fe.layout_symbol["text-size"]),"text-max-width":new wn(fe.layout_symbol["text-max-width"]),"text-line-height":new On(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new wn(fe.layout_symbol["text-letter-spacing"]),"text-justify":new wn(fe.layout_symbol["text-justify"]),"text-radial-offset":new wn(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new wn(fe.layout_symbol["text-anchor"]),"text-max-angle":new On(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new On(fe.layout_symbol["text-writing-mode"]),"text-rotate":new wn(fe.layout_symbol["text-rotate"]),"text-padding":new On(fe.layout_symbol["text-padding"]),"text-keep-upright":new On(fe.layout_symbol["text-keep-upright"]),"text-transform":new wn(fe.layout_symbol["text-transform"]),"text-offset":new wn(fe.layout_symbol["text-offset"]),"text-allow-overlap":new On(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(fe.layout_symbol["text-ignore-placement"]),"text-optional":new On(fe.layout_symbol["text-optional"])}),_e={paint:new rs({"icon-opacity":new wn(fe.paint_symbol["icon-opacity"]),"icon-color":new wn(fe.paint_symbol["icon-color"]),"icon-halo-color":new wn(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new wn(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wn(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new On(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new wn(fe.paint_symbol["text-opacity"]),"text-color":new wn(fe.paint_symbol["text-color"],{runtimeType:Xr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new wn(fe.paint_symbol["text-halo-color"]),"text-halo-width":new wn(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new wn(fe.paint_symbol["text-halo-blur"]),"text-translate":new On(fe.paint_symbol["text-translate"]),"text-translate-anchor":new On(fe.paint_symbol["text-translate-anchor"])}),layout:nt},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},gn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Ce=function(t){function o(u){t.call(this,u,_e)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,P=y;S<P.length;S+=1){var k=P[S];b.indexOf(k)<0&&b.push(k)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,y,b){var S=this.layout.get(u).evaluate(h,{},y,b),P=this._unevaluatedLayout._values[u];return P.isDataDriven()||Go(P.value)||!S?S:function(k,z){return z.replace(/{([^{}]+)}/g,function(Z,W){return W in k?String(k[W]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new Be(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=_e.paint.overridableProperties;u<h.length;u+=1){var y=h[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),P=new Ze(S),k=new pl(P,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Xu("source",k):new Ho("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new ms(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var y=u.get("text-field"),b=_e.paint.properties[h],S=!1,P=function(Z){for(var W=0,ee=Z;W<ee.length;W+=1)if(b.overrides&&b.overrides.hasOverride(ee[W]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof wa)P(y.value.value.sections);else if(y.value.kind==="source"){var k=function(Z){S||(Z instanceof So&&na(Z.value)===ra?P(Z.value.sections):Z instanceof $o?P(Z.sections):Z.eachChild(k))},z=y.value;z._styleExpression&&k(z._styleExpression.expression)}return S},o}(Sa),ft={paint:new rs({"background-color":new On(fe.paint_background["background-color"]),"background-pattern":new gs(fe.paint_background["background-pattern"]),"background-opacity":new On(fe.paint_background["background-opacity"])})},Et=function(t){function o(u){t.call(this,u,ft)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Sa),hr={paint:new rs({"raster-opacity":new On(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new On(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new On(fe.paint_raster["raster-saturation"]),"raster-contrast":new On(fe.paint_raster["raster-contrast"]),"raster-resampling":new On(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new On(fe.paint_raster["raster-fade-duration"])})},zr=function(t){function o(u){t.call(this,u,hr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Sa),Zr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Sa),tn={circle:Fl,heatmap:yp,hillshade:Jp,fill:hf,"fill-extrusion":il,line:uh,symbol:Ce,background:Et,raster:zr},Br=ae.HTMLImageElement,Cn=ae.HTMLCanvasElement,fn=ae.HTMLVideoElement,xn=ae.ImageData,yn=ae.ImageBitmap,mn=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};mn.prototype.update=function(t,o,u){var h=t.width,y=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===y||u),S=this.context,P=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,y],t instanceof Br||t instanceof Cn||t instanceof fn||t instanceof xn||yn&&t instanceof yn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,t):P.texImage2D(P.TEXTURE_2D,0,this.format,h,y,0,this.format,P.UNSIGNED_BYTE,t.data);else{var k=u||{x:0,y:0},z=k.x,Z=k.y;t instanceof Br||t instanceof Cn||t instanceof fn||t instanceof xn||yn&&t instanceof yn?P.texSubImage2D(P.TEXTURE_2D,0,z,Z,P.RGBA,P.UNSIGNED_BYTE,t):P.texSubImage2D(P.TEXTURE_2D,0,z,Z,h,y,P.RGBA,P.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},mn.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},mn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},mn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Wn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Wn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Wn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ca=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},er(["receive","process"],this),this.invoker=new Wn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=kr()?t:ae};function us(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}Ca.prototype.send=function(t,o,u,h,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var P=Xe(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:y,sourceMapId:this.mapId,data:yu(o,P)},P),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},Ca.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else kr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Ca.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},Ca.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(Bs(o.error)):h(null,Bs(o.data)))}else{var y=!1,b=Xe(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,W){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?yu(Z):null,data:yu(W,b)},b)}:function(Z){y=!0},P=null,k=Bs(o.data);if(this.parent[o.type])P=this.parent[o.type](o.sourceMapId,k,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");P=this.parent.getWorkerSource(o.sourceMapId,z[0],k.source)[z[1]](k,S)}else S(new Error("Could not find function "+o.type));!y&&P&&P.cancel&&(this.cancelCallbacks[t]=P.cancel)}},Ca.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ha=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ha.prototype.setNorthEast=function(t){return this._ne=t instanceof Sn?new Sn(t.lng,t.lat):Sn.convert(t),this},Ha.prototype.setSouthWest=function(t){return this._sw=t instanceof Sn?new Sn(t.lng,t.lat):Sn.convert(t),this},Ha.prototype.extend=function(t){var o,u,h=this._sw,y=this._ne;if(t instanceof Sn)o=t,u=t;else{if(!(t instanceof Ha))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ha.convert(t)):this.extend(Sn.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||y?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new Sn(o.lng,o.lat),this._ne=new Sn(u.lng,u.lat)),this},Ha.prototype.getCenter=function(){return new Sn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ha.prototype.getSouthWest=function(){return this._sw},Ha.prototype.getNorthEast=function(){return this._ne},Ha.prototype.getNorthWest=function(){return new Sn(this.getWest(),this.getNorth())},Ha.prototype.getSouthEast=function(){return new Sn(this.getEast(),this.getSouth())},Ha.prototype.getWest=function(){return this._sw.lng},Ha.prototype.getSouth=function(){return this._sw.lat},Ha.prototype.getEast=function(){return this._ne.lng},Ha.prototype.getNorth=function(){return this._ne.lat},Ha.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ha.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ha.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ha.prototype.contains=function(t){var o=Sn.convert(t),u=o.lng,h=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&y},Ha.convert=function(t){return!t||t instanceof Ha?t:new Ha(t)};var Sn=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Sn.prototype.wrap=function(){return new Sn(sr(this.lng,-180,180),this.lat)},Sn.prototype.toArray=function(){return[this.lng,this.lat]},Sn.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Sn.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,y=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},Sn.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Ha(new Sn(this.lng-u,this.lat-o),new Sn(this.lng+u,this.lat+o))},Sn.convert=function(t){if(t instanceof Sn)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Sn(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Sn(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var oi=2*Math.PI*63710088e-1;function ws(t){return oi*Math.cos(t*Math.PI/180)}function Cl(t){return(180+t)/360}function Cu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function qh(t,o){return t/ws(o)}function Nu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var jc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};jc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=Sn.convert(t);return new jc(Cl(u.lng),Cu(u.lat),qh(o,u.lat))},jc.prototype.toLngLat=function(){return new Sn(360*this.x-180,Nu(this.y))},jc.prototype.toAltitude=function(){return this.z*ws(Nu(this.y))},jc.prototype.meterInMercatorCoordinateUnits=function(){return 1/oi*(t=Nu(this.y),1/Math.cos(t*Math.PI/180));var t};var Mp=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Kh(0,t,t,o,u)};Mp.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Mp.prototype.url=function(t,o){var u,h,y,b,S,P=(h=this.y,y=this.z,b=us(256*(u=this.x),256*(h=Math.pow(2,y)-h-1),y),S=us(256*(u+1),256*(h+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),k=function(z,Z,W){for(var ee,ie="",Me=z;Me>0;Me--)ie+=(Z&(ee=1<<Me-1)?1:0)+(W&ee?2:0);return ie}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",P)},Mp.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new se(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Mp.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var v0=function(t,o){this.wrap=t,this.canonical=o,this.key=Kh(t,o.z,o.z,o.x,o.y)},ls=function(t,o,u,h,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Mp(u,+h,+y),this.key=Kh(o,t,u,h,y)};function Kh(t,o,u,h,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+h).toString(36)+u.toString(36)+o.toString(36)}ls.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},ls.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new ls(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},ls.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Kh(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Kh(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},ls.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},ls.prototype.children=function(t){if(this.overscaledZ>=t)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new ls(o,this.wrap,o,u,h),new ls(o,this.wrap,o,u+1,h),new ls(o,this.wrap,o,u,h+1),new ls(o,this.wrap,o,u+1,h+1)]},ls.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},ls.prototype.wrapped=function(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.unwrapTo=function(t){return new ls(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ls.prototype.toUnwrapped=function(){return new v0(this.wrap,this.canonical)},ls.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ls.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new jc(t.x-this.wrap,t.y))},gn("CanonicalTileID",Mp),gn("OverscaledTileID",ls,{omit:["posMatrix"]});var gf=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return $e('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<h;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(h,y)]=this.data[this._idx(h-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,h)]=this.data[this._idx(y,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};gf.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},gf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},gf.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},gf.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},gf.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},gf.prototype.getPixels=function(){return new Ga({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},gf.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=y-1;break;case 1:y=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var P=-o*this.dim,k=-u*this.dim,z=b;z<S;z++)for(var Z=h;Z<y;Z++)this.data[this._idx(Z,z)]=t.data[this._idx(Z+P,z+k)]},gn("DEMData",gf);var Rd=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Rd.prototype.encode=function(t){return this._stringToNumber[t]},Rd.prototype.decode=function(t){return this._numberToString[t]};var Ld=function(t,o,u,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=y},xv={geometry:{configurable:!0}};xv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},xv.geometry.set=function(t){this._geometry=t},Ld.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Ld.prototype,xv);var Pp=function(){this.state={},this.stateChanges={},this.deletedStates={}};Pp.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Ct(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==h&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},Pp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},Pp.prototype.getState=function(t,o){var u=String(o),h=Ct({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete h[b]}return h},Pp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},Pp.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var y={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),Ct(this.state[h][b],this.stateChanges[h][b]),y[b]=this.state[h][b];u[h]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var P={};if(this.deletedStates[S]===null)for(var k in this.state[S])P[k]={},this.state[S][k]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var Z=0,W=Object.keys(this.deletedStates[S][z]);Z<W.length;Z+=1)delete this.state[S][z][W[Z]];P[z]=this.state[S][z]}u[S]=u[S]||{},Ct(u[S],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ee in t)t[ee].setFeatureState(u,o)};var yf=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ku(8192,16,0),this.grid3D=new Ku(8192,16,0),this.featureIndexArray=new X,this.promoteId=o};function m0(t,o,u,h,y){return $t(t,function(b,S){var P=o instanceof Zs?o.get(S):null;return P&&P.evaluate?P.evaluate(u,h,y):P})}function g0(t){for(var o=1/0,u=1/0,h=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var P=S[b];o=Math.min(o,P.x),u=Math.min(u,P.y),h=Math.max(h,P.x),y=Math.max(y,P.y)}return{minX:o,minY:u,maxX:h,maxY:y}}function vm(t,o){return o-t}yf.prototype.insert=function(t,o,u,h,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,y);for(var P=b?this.grid3D:this.grid,k=0;k<o.length;k++){for(var z=o[k],Z=[1/0,1/0,-1/0,-1/0],W=0;W<z.length;W++){var ee=z[W];Z[0]=Math.min(Z[0],ee.x),Z[1]=Math.min(Z[1],ee.y),Z[2]=Math.max(Z[2],ee.x),Z[3]=Math.max(Z[3],ee.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&P.insert(S,Z[0],Z[1],Z[2],Z[3])}},yf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new du.VectorTile(new Xf(this.rawTileData)).layers,this.sourceLayerCoder=new Rd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},yf.prototype.query=function(t,o,u,h){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,P=Ic(b.filter),k=t.queryGeometry,z=t.queryPadding*S,Z=g0(k),W=this.grid.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z),ee=g0(t.cameraQueryGeometry),ie=this.grid3D.query(ee.minX-z,ee.minY-z,ee.maxX+z,ee.maxY+z,function(Gt,Yt,lr,wr){return function(Nr,kn,hn,zn,dn){for(var Mi=0,ri=Nr;Mi<ri.length;Mi+=1){var Pn=ri[Mi];if(kn<=Pn.x&&hn<=Pn.y&&zn>=Pn.x&&dn>=Pn.y)return!0}var Vi=[new se(kn,hn),new se(kn,dn),new se(zn,dn),new se(zn,hn)];if(Nr.length>2){for(var vi=0,hi=Vi;vi<hi.length;vi+=1)if(Su(Nr,hi[vi]))return!0}for(var Zn=0;Zn<Nr.length-1;Zn++)if(oc(Nr[Zn],Nr[Zn+1],Vi))return!0;return!1}(t.cameraQueryGeometry,Gt-z,Yt-z,lr+z,wr+z)}),Me=0,Re=ie;Me<Re.length;Me+=1)W.push(Re[Me]);W.sort(vm);for(var Ye,Ue={},ut=function(Gt){var Yt=W[Gt];if(Yt!==Ye){Ye=Yt;var lr=y.featureIndexArray.get(Yt),wr=null;y.loadMatchingFeature(Ue,lr.bucketIndex,lr.sourceLayerIndex,lr.featureIndex,P,b.layers,b.availableImages,o,u,h,function(Nr,kn,hn){return wr||(wr=Va(Nr)),kn.queryIntersectsFeature(k,Nr,hn,wr,y.z,t.transform,S,t.pixelPosMatrix)})}},_t=0;_t<W.length;_t++)ut(_t);return Ue},yf.prototype.loadMatchingFeature=function(t,o,u,h,y,b,S,P,k,z,Z){var W=this.bucketLayerIDs[o];if(!b||function(Nr,kn){for(var hn=0;hn<Nr.length;hn++)if(kn.indexOf(Nr[hn])>=0)return!0;return!1}(b,W)){var ee=this.sourceLayerCoder.decode(u),ie=this.vtLayers[ee].feature(h);if(y.needGeometry){var Me=io(ie,!0);if(!y.filter(new ki(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!y.filter(new ki(this.tileID.overscaledZ),ie))return;for(var Re=this.getId(ie,ee),Ye=0;Ye<W.length;Ye++){var Ue=W[Ye];if(!(b&&b.indexOf(Ue)<0)){var ut=P[Ue];if(ut){var _t={};Re!==void 0&&z&&(_t=z.getState(ut.sourceLayer||"_geojsonTileLayer",Re));var Gt=Ct({},k[Ue]);Gt.paint=m0(Gt.paint,ut.paint,ie,_t,S),Gt.layout=m0(Gt.layout,ut.layout,ie,_t,S);var Yt=!Z||Z(ie,ut,_t);if(Yt){var lr=new Ld(ie,this.z,this.x,this.y,Re);lr.layer=Gt;var wr=t[Ue];wr===void 0&&(wr=t[Ue]=[]),wr.push({featureIndex:h,feature:lr,intersectionZ:Yt})}}}}}},yf.prototype.lookupSymbolFeatures=function(t,o,u,h,y,b,S,P){var k={};this.loadVTLayers();for(var z=Ic(y),Z=0,W=t;Z<W.length;Z+=1)this.loadMatchingFeature(k,u,h,W[Z],z,b,S,P,o);return k},yf.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,y=u[o];h<y.length;h+=1)if(t===y[h])return!0;return!1},yf.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},gn("FeatureIndex",yf,{omit:["rawTileData","sourceLayerCoder"]});var Ts=function(t,o){this.tileID=t,this.uid=Mt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ts.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<Qi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},Ts.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ts.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,Z){var W={};if(!Z)return W;for(var ee=function(){var Re=Me[ie],Ye=Re.layerIds.map(function(_t){return Z.getLayer(_t)}).filter(Boolean);if(Ye.length!==0){Re.layers=Ye,Re.stateDependentLayerIds&&(Re.stateDependentLayers=Re.stateDependentLayerIds.map(function(_t){return Ye.filter(function(Gt){return Gt.id===_t})[0]}));for(var Ue=0,ut=Ye;Ue<ut.length;Ue+=1)W[ut[Ue].id]=Re}},ie=0,Me=z;ie<Me.length;ie+=1)ee();return W}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[h];if(y instanceof Be){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Be&&S.hasRTLText){this.hasRTLText=!0,Os.isLoading()||Os.isLoaded()||vp()!=="deferred"||Qs();break}}for(var P in this.queryPadding=0,this.buckets){var k=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(P).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},Ts.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ts.prototype.getBucket=function(t){return this.buckets[t.id]},Ts.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},Ts.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Ts.prototype.queryRenderedFeatures=function(t,o,u,h,y,b,S,P,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:P,params:S,queryPadding:this.queryPadding*k},t,o,u):{}},Ts.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),y=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[y];if(b)for(var S=Ic(o&&o.filter),P=this.tileID.canonical,k=P.z,z=P.x,Z=P.y,W={z:k,x:z,y:Z},ee=0;ee<b.length;ee++){var ie=b.feature(ee);if(S.needGeometry){var Me=io(ie,!0);if(!S.filter(new ki(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new ki(this.tileID.overscaledZ),ie))continue;var Re=u.getId(ie,y),Ye=new Ld(ie,k,z,Z,Re);Ye.tile=W,t.push(Ye)}}},Ts.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ts.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ts.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Qr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),y=!1;if(this.expirationTime>h)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ts.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ts.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var y=this.buckets[h],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],P=t[b];if(S&&P&&Object.keys(P).length!==0){y.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=o&&o.style&&o.style.getLayer(h);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}}},Ts.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ts.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qi.now()},Ts.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ts.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Qi.now()+t},Ts.prototype.setDependencies=function(t,o){for(var u={},h=0,y=o;h<y.length;h+=1)u[y[h]]=!0;this.dependencies[t]=u},Ts.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var y=this.dependencies[h[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var Yf=ae.performance,y0=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Yf.mark(this._marks.start)};y0.prototype.finish=function(){Yf.mark(this._marks.end);var t=Yf.getEntriesByName(this._marks.measure);return t.length===0&&(Yf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Yf.getEntriesByName(this._marks.measure),Yf.clearMarks(this._marks.start),Yf.clearMarks(this._marks.end),Yf.clearMeasures(this._marks.measure)),t},v.Actor=Ca,v.AlphaImage=pu,v.CanonicalTileID=Mp,v.CollisionBoxArray=f,v.Color=Hi,v.DEMData=gf,v.DataConstantProperty=On,v.DictionaryCoder=Rd,v.EXTENT=8192,v.ErrorEvent=Ge,v.EvaluationParameters=ki,v.Event=Pe,v.Evented=rt,v.FeatureIndex=yf,v.FillBucket=tu,v.FillExtrusionBucket=Ut,v.ImageAtlas=Er,v.ImagePosition=st,v.LineBucket=va,v.LngLat=Sn,v.LngLatBounds=Ha,v.MercatorCoordinate=jc,v.ONE_EM=24,v.OverscaledTileID=ls,v.Point=se,v.Point$1=se,v.Properties=rs,v.Protobuf=Xf,v.RGBAImage=Ga,v.RequestManager=Fi,v.RequestPerformance=y0,v.ResourceType=rn,v.SegmentVector=ue,v.SourceFeatureState=Pp,v.StructArrayLayout1ui2=gp,v.StructArrayLayout2f1f2i16=ml,v.StructArrayLayout2i4=Rl,v.StructArrayLayout3ui6=Ju,v.StructArrayLayout4i8=bu,v.SymbolBucket=Be,v.Texture=mn,v.Tile=Ts,v.Transitionable=yo,v.Uniform1f=Or,v.Uniform1i=pr,v.Uniform2f=Dr,v.Uniform3f=un,v.Uniform4f=Fn,v.UniformColor=Nn,v.UniformMatrix4f=Di,v.UnwrappedTileID=v0,v.ValidationError=Fe,v.WritingMode=Ur,v.ZoomHistory=Lf,v.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},v.addDynamicAttributes=Ve,v.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,y=new Array(t.length),b=null;t.forEach(function(S,P){o(S,function(k,z){k&&(b=k),y[P]=z,--h==0&&u(b,y)})})},v.bezier=Le,v.bindAll=er,v.browser=Qi,v.cacheEntryPossiblyAdded=function(t){++li>Mr&&(t.getActor().send("enforceCacheSizeLimit",ir),li=0)},v.clamp=Ht,v.clearTileCache=function(t){var o=ae.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},v.clipLine=Oo,v.clone=function(t){var o=new Xi(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},v.clone$1=Qe,v.clone$2=function(t){var o=new Xi(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},v.collisionCircleLayout=Pd,v.config=jn,v.create=function(){var t=new Xi(16);return Xi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new Xi(9);return Xi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new Xi(4);return Xi!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=ve,v.createExpression=Ou,v.createLayout=Ma,v.createStyleLayer=function(t){return t.type==="custom"?new Zr(t):new tn[t.type](t)},v.cross=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=u[0],P=u[1],k=u[2];return t[0]=y*k-b*P,t[1]=b*S-h*k,t[2]=h*P-y*S,t},v.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},v.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},v.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},v.ease=it,v.emitValidationErrors=Jl,v.endsWith=Y,v.enforceCacheSizeLimit=function(t){I(),Ji&&Ji.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},v.evaluateSizeForFeature=$n,v.evaluateSizeForZoom=pi,v.evaluateVariableOffset=al,v.evented=Df,v.extend=Ct,v.featureFilter=Ic,v.filterObject=gt,v.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=Kr,v.getAnchorJustification=Te,v.getArrayBuffer=Fa,v.getImage=K,v.getJSON=function(t,o){return ga(Ct(t,{type:"json"}),o)},v.getRTLTextPluginStatus=vp,v.getReferrer=Oi,v.getVideo=function(t,o){var u,h,y=ae.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=ae.document.createElement("source");u=t[b],h=void 0,(h=ae.document.createElement("a")).href=u,(h.protocol!==ae.document.location.protocol||h.host!==ae.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},v.identity=As,v.invert=function(t,o){var u=o[0],h=o[1],y=o[2],b=o[3],S=o[4],P=o[5],k=o[6],z=o[7],Z=o[8],W=o[9],ee=o[10],ie=o[11],Me=o[12],Re=o[13],Ye=o[14],Ue=o[15],ut=u*P-h*S,_t=u*k-y*S,Gt=u*z-b*S,Yt=h*k-y*P,lr=h*z-b*P,wr=y*z-b*k,Nr=Z*Re-W*Me,kn=Z*Ye-ee*Me,hn=Z*Ue-ie*Me,zn=W*Ye-ee*Re,dn=W*Ue-ie*Re,Mi=ee*Ue-ie*Ye,ri=ut*Mi-_t*dn+Gt*zn+Yt*hn-lr*kn+wr*Nr;return ri?(t[0]=(P*Mi-k*dn+z*zn)*(ri=1/ri),t[1]=(y*dn-h*Mi-b*zn)*ri,t[2]=(Re*wr-Ye*lr+Ue*Yt)*ri,t[3]=(ee*lr-W*wr-ie*Yt)*ri,t[4]=(k*hn-S*Mi-z*kn)*ri,t[5]=(u*Mi-y*hn+b*kn)*ri,t[6]=(Ye*Gt-Me*wr-Ue*_t)*ri,t[7]=(Z*wr-ee*Gt+ie*_t)*ri,t[8]=(S*dn-P*hn+z*Nr)*ri,t[9]=(h*hn-u*dn-b*Nr)*ri,t[10]=(Me*lr-Re*Gt+Ue*ut)*ri,t[11]=(W*Gt-Z*lr-ie*ut)*ri,t[12]=(P*kn-S*zn-k*Nr)*ri,t[13]=(u*zn-h*kn+y*Nr)*ri,t[14]=(Re*_t-Me*Yt-Ye*ut)*ri,t[15]=(Z*Yt-W*_t+ee*ut)*ri,t):null},v.isChar=qr,v.isMapboxURL=Ai,v.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},v.makeRequest=ga,v.mapObject=$t,v.mercatorXfromLng=Cl,v.mercatorYfromLat=Cu,v.mercatorZfromAltitude=qh,v.mul=sc,v.multiply=Xo,v.mvt=du,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,o){var u=o[0],h=o[1],y=o[2],b=u*u+h*h+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},v.number=ua,v.offscreenCanvasSupported=Vn,v.ortho=function(t,o,u,h,y,b,S){var P=1/(o-u),k=1/(h-y),z=1/(b-S);return t[0]=-2*P,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*P,t[13]=(y+h)*k,t[14]=(S+b)*z,t[15]=1,t},v.parseGlyphPBF=function(t){return new Xf(t).readFields(or,[])},v.pbf=Xf,v.performSymbolLayout=function(t,o,u,h,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var P=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,W=Z.maxZoom;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new ki(Z.minZoom),S),k["text-size"].possiblyEvaluate(new ki(W),S)]}if(t.iconSizeData.kind==="composite"){var ee=t.iconSizeData,ie=ee.maxZoom;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new ki(ee.minZoom),S),k["icon-size"].possiblyEvaluate(new ki(ie),S)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new ki(t.zoom+1),S),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new ki(t.zoom+1),S),z.textMaxSize=k["text-size"].possiblyEvaluate(new ki(18));for(var Me=24*P.get("text-line-height"),Re=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Ye=P.get("text-keep-upright"),Ue=P.get("text-size"),ut=function(){var Yt=Gt[_t],lr=P.get("text-font").evaluate(Yt,{},S).join(","),wr=Ue.evaluate(Yt,{},S),Nr=z.layoutTextSize.evaluate(Yt,{},S),kn=z.layoutIconSize.evaluate(Yt,{},S),hn={horizontal:{},vertical:void 0},zn=Yt.text,dn=[0,0];if(zn){var Mi=zn.toString(),ri=24*P.get("text-letter-spacing").evaluate(Yt,{},S),Pn=function(Ki){for(var G=0,Ra=Ki;G<Ra.length;G+=1)if(aa=Ra[G].charCodeAt(0),qr.Arabic(aa)||qr["Arabic Supplement"](aa)||qr["Arabic Extended-A"](aa)||qr["Arabic Presentation Forms-A"](aa)||qr["Arabic Presentation Forms-B"](aa))return!1;var aa;return!0}(Mi)?ri:0,Vi=P.get("text-anchor").evaluate(Yt,{},S),vi=P.get("text-variable-anchor");if(!vi){var hi=P.get("text-radial-offset").evaluate(Yt,{},S);dn=hi?al(Vi,[24*hi,Ro]):P.get("text-offset").evaluate(Yt,{},S).map(function(Ki){return 24*Ki})}var Zn=Re?"center":P.get("text-justify").evaluate(Yt,{},S),ca=P.get("symbol-placement"),ao=ca==="point"?24*P.get("text-max-width").evaluate(Yt,{},S):0,bo=function(){t.allowVerticalPlacement&&sf(Mi)&&(hn.vertical=$r(zn,o,u,y,lr,ao,Me,Vi,"left",Pn,dn,Ur.vertical,!0,ca,Nr,wr))};if(!Re&&vi){for(var Eo=Zn==="auto"?vi.map(function(Ki){return Te(Ki)}):[Zn],vo=!1,Lo=0;Lo<Eo.length;Lo++){var cs=Eo[Lo];if(!hn.horizontal[cs])if(vo)hn.horizontal[cs]=hn.horizontal[0];else{var fs=$r(zn,o,u,y,lr,ao,Me,"center",cs,Pn,dn,Ur.horizontal,!1,ca,Nr,wr);fs&&(hn.horizontal[cs]=fs,vo=fs.positionedLines.length===1)}}bo()}else{Zn==="auto"&&(Zn=Te(Vi));var za=$r(zn,o,u,y,lr,ao,Me,Vi,Zn,Pn,dn,Ur.horizontal,!1,ca,Nr,wr);za&&(hn.horizontal[Zn]=za),bo(),sf(Mi)&&Re&&Ye&&(hn.vertical=$r(zn,o,u,y,lr,ao,Me,Vi,Zn,Pn,dn,Ur.vertical,!1,ca,Nr,wr))}}var bs=void 0,Pi=!1;if(Yt.icon&&Yt.icon.name){var Uo=h[Yt.icon.name];Uo&&(bs=function(Ki,G,Ra){var aa=Kr(Ra),Ws=G[0]-Ki.displaySize[0]*aa.horizontalAlign,Ms=G[1]-Ki.displaySize[1]*aa.verticalAlign;return{image:Ki,top:Ms,bottom:Ms+Ki.displaySize[1],left:Ws,right:Ws+Ki.displaySize[0]}}(y[Yt.icon.name],P.get("icon-offset").evaluate(Yt,{},S),P.get("icon-anchor").evaluate(Yt,{},S)),Pi=Uo.sdf,t.sdfIcons===void 0?t.sdfIcons=Uo.sdf:t.sdfIcons!==Uo.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Uo.pixelRatio!==t.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Es=bt(hn.horizontal)||hn.vertical;t.iconsInText=!!Es&&Es.iconsInText,(Es||bs)&&function(Ki,G,Ra,aa,Ws,Ms,Qa,Zo,Ps,$i,Zl){var Au=Ms.textMaxSize.evaluate(G,{});Au===void 0&&(Au=Qa);var jl,ko=Ki.layers[0].layout,Vl=ko.get("icon-offset").evaluate(G,{},Zl),ol=bt(Ra.horizontal),Vc=Qa/24,qf=Ki.tilePixelRatio*Vc,Ip=Ki.tilePixelRatio*Au/24,mc=Ki.tilePixelRatio*Zo,Kf=Ki.tilePixelRatio*ko.get("symbol-spacing"),ph=ko.get("text-padding")*Ki.tilePixelRatio,$f=ko.get("icon-padding")*Ki.tilePixelRatio,Op=ko.get("text-max-angle")/180*Math.PI,_f=ko.get("text-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",hh=ko.get("icon-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",gc=ko.get("symbol-placement"),Rp=Kf/2,Lp=ko.get("icon-text-fit");aa&&Lp!=="none"&&(Ki.allowVerticalPlacement&&Ra.vertical&&(jl=ni(aa,Ra.vertical,Lp,ko.get("icon-text-fit-padding"),Vl,Vc)),ol&&(aa=ni(aa,ol,Lp,ko.get("icon-text-fit-padding"),Vl,Vc)));var xf=function(bv,Np){Np.x<0||Np.x>=8192||Np.y<0||Np.y>=8192||function(Do,Al,Ev,Wc,td,Nd,gh,Gl,yh,zp,_h,xh,rd,Xs,Up,zd,Ud,Zd,jd,Vd,wu,bh,Gd,Hl,Sv){var Hd,Ef,tp,rp,Zp,jp=Do.addToLineVertexArray(Al,Ev),Cv=0,Av=0,Wd=0,wv=0,Xd=-1,nd=-1,yc={},Yd=Ae(""),id=0,np=0;if(Gl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(id=(Hd=Gl.layout.get("text-offset").evaluate(wu,{},Hl).map(function(Sf){return 24*Sf}))[0],np=Hd[1]):(id=24*Gl.layout.get("text-radial-offset").evaluate(wu,{},Hl),np=Ro),Do.allowVerticalPlacement&&Wc.vertical){var qd=Gl.layout.get("text-rotate").evaluate(wu,{},Hl)+90;rp=new qo(yh,Al,zp,_h,xh,Wc.vertical,rd,Xs,Up,qd),gh&&(Zp=new qo(yh,Al,zp,_h,xh,gh,Ud,Zd,Up,qd))}if(td){var Kd=Gl.layout.get("icon-rotate").evaluate(wu,{}),Tv=Gl.layout.get("icon-text-fit")!=="none",Mv=Yo(td,Kd,Gd,Tv),$d=gh?Yo(gh,Kd,Gd,Tv):void 0;tp=new qo(yh,Al,zp,_h,xh,td,Ud,Zd,!1,Kd),Cv=4*Mv.length;var Pv=Do.iconSizeData,Eh=null;Pv.kind==="source"?(Eh=[128*Gl.layout.get("icon-size").evaluate(wu,{})])[0]>32640&&$e(Do.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Pv.kind==="composite"&&((Eh=[128*bh.compositeIconSizes[0].evaluate(wu,{},Hl),128*bh.compositeIconSizes[1].evaluate(wu,{},Hl)])[0]>32640||Eh[1]>32640)&&$e(Do.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Do.addSymbols(Do.icon,Mv,Eh,Vd,jd,wu,!1,Al,jp.lineStartIndex,jp.lineLength,-1,Hl),Xd=Do.icon.placedSymbolArray.length-1,$d&&(Av=4*$d.length,Do.addSymbols(Do.icon,$d,Eh,Vd,jd,wu,Ur.vertical,Al,jp.lineStartIndex,jp.lineLength,-1,Hl),nd=Do.icon.placedSymbolArray.length-1)}for(var Iv in Wc.horizontal){var ad=Wc.horizontal[Iv];if(!Ef){Yd=Ae(ad.text);var _0=Gl.layout.get("text-rotate").evaluate(wu,{},Hl);Ef=new qo(yh,Al,zp,_h,xh,ad,rd,Xs,Up,_0)}var Ov=ad.positionedLines.length===1;if(Wd+=Zt(Do,Al,ad,Nd,Gl,Up,wu,zd,jp,Wc.vertical?Ur.horizontal:Ur.horizontalOnly,Ov?Object.keys(Wc.horizontal):[Iv],yc,Xd,bh,Hl),Ov)break}Wc.vertical&&(wv+=Zt(Do,Al,Wc.vertical,Nd,Gl,Up,wu,zd,jp,Ur.vertical,["vertical"],yc,nd,bh,Hl));var x0=Ef?Ef.boxStartIndex:Do.collisionBoxArray.length,b0=Ef?Ef.boxEndIndex:Do.collisionBoxArray.length,E0=rp?rp.boxStartIndex:Do.collisionBoxArray.length,S0=rp?rp.boxEndIndex:Do.collisionBoxArray.length,C0=tp?tp.boxStartIndex:Do.collisionBoxArray.length,A0=tp?tp.boxEndIndex:Do.collisionBoxArray.length,w0=Zp?Zp.boxStartIndex:Do.collisionBoxArray.length,od=Zp?Zp.boxEndIndex:Do.collisionBoxArray.length,ru=-1,Sh=function(Sf,Jd){return Sf&&Sf.circleDiameter?Math.max(Sf.circleDiameter,Jd):Jd};ru=Sh(Ef,ru),ru=Sh(rp,ru),ru=Sh(tp,ru);var Qd=(ru=Sh(Zp,ru))>-1?1:0;Qd&&(ru*=Sv/24),Do.glyphOffsetArray.length>=Be.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wu.sortKey!==void 0&&Do.addToSortKeyRanges(Do.symbolInstances.length,wu.sortKey),Do.symbolInstances.emplaceBack(Al.x,Al.y,yc.right>=0?yc.right:-1,yc.center>=0?yc.center:-1,yc.left>=0?yc.left:-1,yc.vertical||-1,Xd,nd,Yd,x0,b0,E0,S0,C0,A0,w0,od,zp,Wd,wv,Cv,Av,Qd,0,rd,id,np,ru)}(Ki,Np,bv,Ra,aa,Ws,jl,Ki.layers[0],Ki.collisionBoxArray,G.index,G.sourceLayerIndex,Ki.index,qf,ph,_f,Ps,mc,$f,hh,Vl,G,Ms,$i,Zl,Qa)};if(gc==="line")for(var Qf=0,$h=Oo(G.geometry,0,0,8192,8192);Qf<$h.length;Qf+=1)for(var bf=$h[Qf],dh=0,sl=ns(bf,Kf,Op,Ra.vertical||ol,aa,24,Ip,Ki.overscaling,8192);dh<sl.length;dh+=1){var Qh=sl[dh];ol&&pn(Ki,ol.text,Rp,Qh)||xf(bf,Qh)}else if(gc==="line-center")for(var vh=0,Gc=G.geometry;vh<Gc.length;vh+=1){var kp=Gc[vh];if(kp.length>1){var mh=$a(kp,Op,Ra.vertical||ol,aa,24,Ip);mh&&xf(kp,mh)}}else if(G.type==="Polygon")for(var Jf=0,Dp=Vf(G.geometry,0);Jf<Dp.length;Jf+=1){var ep=Dp[Jf],Fp=ti(ep,16);xf(ep[0],new Yr(Fp.x,Fp.y,0))}else if(G.type==="LineString")for(var Hc=0,Jh=G.geometry;Hc<Jh.length;Hc+=1){var Bp=Jh[Hc];xf(Bp,new Yr(Bp[0].x,Bp[0].y,0))}else if(G.type==="Point")for(var kd=0,Dd=G.geometry;kd<Dd.length;kd+=1)for(var Fd=0,Bd=Dd[kd];Fd<Bd.length;Fd+=1){var ed=Bd[Fd];xf([ed],new Yr(ed.x,ed.y,0))}}(t,Yt,hn,bs,h,z,Nr,kn,dn,Pi,S)},_t=0,Gt=t.features;_t<Gt.length;_t+=1)ut();b&&t.generateCollisionDebugBuffers()},v.perspective=function(t,o,u,h,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+h)*(b=1/(h-y)),t[14]=2*y*h*b):(t[10]=-1,t[14]=-2*h),t},v.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var y=o[h];y in t&&(u[y]=t[y])}return u},v.plugin=Os,v.polygonIntersectsPolygon=Fu,v.postMapLoadEvent=jt,v.postTurnstileEvent=Ya,v.potpack=Pr,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=gn,v.registerForPluginStateChange=function(t){return t({pluginStatus:Is,pluginURL:Po}),Df.on("pluginStateChange",t),t},v.renderColorRamp=Bf,v.rotate=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],P=Math.sin(u),k=Math.cos(u);return t[0]=h*k+b*P,t[1]=y*k+S*P,t[2]=h*-P+b*k,t[3]=y*-P+S*k,t},v.rotateX=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],P=o[6],k=o[7],z=o[8],Z=o[9],W=o[10],ee=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*h,t[5]=S*y+Z*h,t[6]=P*y+W*h,t[7]=k*y+ee*h,t[8]=z*y-b*h,t[9]=Z*y-S*h,t[10]=W*y-P*h,t[11]=ee*y-k*h,t},v.rotateZ=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],P=o[2],k=o[3],z=o[4],Z=o[5],W=o[6],ee=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*h,t[1]=S*y+Z*h,t[2]=P*y+W*h,t[3]=k*y+ee*h,t[4]=z*y-b*h,t[5]=Z*y-S*h,t[6]=W*y-P*h,t[7]=ee*y-k*h,t},v.scale=function(t,o,u){var h=u[0],y=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},v.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},v.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},v.setCacheLimits=function(t,o){ir=t,Mr=o},v.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Is==="deferred"||Is==="loading"||Is==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Po=Qi.resolveURL(t),Is="deferred",ku=o,_a(),u||Qs()},v.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},v.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},v.styleSpec=fe,v.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},v.symbolSize=Zi,v.transformMat3=function(t,o,u){var h=o[0],y=o[1],b=o[2];return t[0]=h*u[0]+y*u[3]+b*u[6],t[1]=h*u[1]+y*u[4]+b*u[7],t[2]=h*u[2]+y*u[5]+b*u[8],t},v.transformMat4=bl,v.translate=function(t,o,u){var h,y,b,S,P,k,z,Z,W,ee,ie,Me,Re=u[0],Ye=u[1],Ue=u[2];return o===t?(t[12]=o[0]*Re+o[4]*Ye+o[8]*Ue+o[12],t[13]=o[1]*Re+o[5]*Ye+o[9]*Ue+o[13],t[14]=o[2]*Re+o[6]*Ye+o[10]*Ue+o[14],t[15]=o[3]*Re+o[7]*Ye+o[11]*Ue+o[15]):(y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],Z=o[7],W=o[8],ee=o[9],ie=o[10],Me=o[11],t[0]=h=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=P,t[5]=k,t[6]=z,t[7]=Z,t[8]=W,t[9]=ee,t[10]=ie,t[11]=Me,t[12]=h*Re+P*Ye+W*Ue+o[12],t[13]=y*Re+k*Ye+ee*Ue+o[13],t[14]=b*Re+z*Ye+ie*Ue+o[14],t[15]=S*Re+Z*Ye+Me*Ue+o[15]),t},v.triggerPluginCompletionEvent=dp,v.uniqueId=Mt,v.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},v.validateLight=$p,v.validateStyle=of,v.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},v.vectorTile=du,v.version="1.13.2",v.warnOnce=$e,v.webpSupported=Xn,v.window=ae,v.wrap=sr}),ye(["./shared"],function(v){"use strict";function ve(H){var K=typeof H;if(K==="number"||K==="boolean"||K==="string"||H==null)return JSON.stringify(H);if(Array.isArray(H)){for(var re="[",ge=0,Pe=H;ge<Pe.length;ge+=1)re+=ve(Pe[ge])+",";return re+"]"}for(var Ge=Object.keys(H).sort(),rt="{",fe=0;fe<Ge.length;fe++)rt+=JSON.stringify(Ge[fe])+":"+ve(H[Ge[fe]])+",";return rt+"}"}function j(H){for(var K="",re=0,ge=v.refProperties;re<ge.length;re+=1)K+="/"+ve(H[ge[re]]);return K}var ce=function(H){this.keyCache={},H&&this.replace(H)};ce.prototype.replace=function(H){this._layerConfigs={},this._layers={},this.update(H,[])},ce.prototype.update=function(H,K){for(var re=this,ge=0,Pe=H;ge<Pe.length;ge+=1){var Ge=Pe[ge];this._layerConfigs[Ge.id]=Ge;var rt=this._layers[Ge.id]=v.createStyleLayer(Ge);rt._featureFilter=v.featureFilter(rt.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var fe=0,Fe=K;fe<Fe.length;fe+=1){var mt=Fe[fe];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var vr=0,Ft=function(Hr,Xr){for(var ii={},Jr=0;Jr<Hr.length;Jr++){var Ti=Xr&&Xr[Hr[Jr].id]||j(Hr[Jr]);Xr&&(Xr[Hr[Jr].id]=Ti);var ra=ii[Ti];ra||(ra=ii[Ti]=[]),ra.push(Hr[Jr])}var Ei=[];for(var Ri in ii)Ei.push(ii[Ri]);return Ei}(v.values(this._layerConfigs),this.keyCache);vr<Ft.length;vr+=1){var Bt=Ft[vr].map(function(Hr){return re._layers[Hr.id]}),gr=Bt[0];if(gr.visibility!=="none"){var bn=gr.source||"",cn=this.familiesBySource[bn];cn||(cn=this.familiesBySource[bn]={});var wt=gr.sourceLayer||"_geojsonTileLayer",on=cn[wt];on||(on=cn[wt]=[]),on.push(Bt)}}};var se=function(H){var K={},re=[];for(var ge in H){var Pe=H[ge],Ge=K[ge]={};for(var rt in Pe){var fe=Pe[+rt];if(fe&&fe.bitmap.width!==0&&fe.bitmap.height!==0){var Fe={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};re.push(Fe),Ge[rt]={rect:Fe,metrics:fe.metrics}}}}var mt=v.potpack(re),vr=new v.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Ft in H){var Bt=H[Ft];for(var gr in Bt){var bn=Bt[+gr];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var cn=K[Ft][gr].rect;v.AlphaImage.copy(bn.bitmap,vr,{x:0,y:0},{x:cn.x+1,y:cn.y+1},bn.bitmap)}}}this.image=vr,this.positions=K};v.register("GlyphAtlas",se);var Ne=function(H){this.tileID=new v.OverscaledTileID(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId};function ae(H,K,re){for(var ge=new v.EvaluationParameters(K),Pe=0,Ge=H;Pe<Ge.length;Pe+=1)Ge[Pe].recalculate(ge,re)}function et(H,K){var re=v.getArrayBuffer(H.request,function(ge,Pe,Ge,rt){ge?K(ge):Pe&&K(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Pe)),rawData:Pe,cacheControl:Ge,expires:rt})});return function(){re.cancel(),K()}}Ne.prototype.parse=function(H,K,re,ge,Pe){var Ge=this;this.status="parsing",this.data=H,this.collisionBoxArray=new v.CollisionBoxArray;var rt=new v.DictionaryCoder(Object.keys(H.layers).sort()),fe=new v.FeatureIndex(this.tileID,this.promoteId);fe.bucketLayerIDs=[];var Fe,mt,vr,Ft,Bt={},gr={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},bn=K.familiesBySource[this.source];for(var cn in bn){var wt=H.layers[cn];if(wt){wt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+cn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var on=rt.encode(cn),Hr=[],Xr=0;Xr<wt.length;Xr++){var ii=wt.feature(Xr),Jr=fe.getId(ii,cn);Hr.push({feature:ii,id:Jr,index:Xr,sourceLayerIndex:on})}for(var Ti=0,ra=bn[cn];Ti<ra.length;Ti+=1){var Ei=ra[Ti],Ri=Ei[0];Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(ae(Ei,this.zoom,re),(Bt[Ri.id]=Ri.createBucket({index:fe.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:on,sourceID:this.source})).populate(Hr,gr,this.tileID.canonical),fe.bucketLayerIDs.push(Ei.map(function(sa){return sa.id})))}}}var Ci=v.mapObject(gr.glyphDependencies,function(sa){return Object.keys(sa).map(Number)});Object.keys(Ci).length?ge.send("getGlyphs",{uid:this.uid,stacks:Ci},function(sa,Li){Fe||(Fe=sa,mt=Li,Ba.call(Ge))}):mt={};var Jn=Object.keys(gr.iconDependencies);Jn.length?ge.send("getImages",{icons:Jn,source:this.source,tileID:this.tileID,type:"icons"},function(sa,Li){Fe||(Fe=sa,vr=Li,Ba.call(Ge))}):vr={};var Yi=Object.keys(gr.patternDependencies);function Ba(){if(Fe)return Pe(Fe);if(mt&&vr&&Ft){var sa=new se(mt),Li=new v.ImageAtlas(vr,Ft);for(var Hi in Bt){var Za=Bt[Hi];Za instanceof v.SymbolBucket?(ae(Za.layers,this.zoom,re),v.performSymbolLayout(Za,mt,sa.positions,vr,Li.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Za.hasPattern&&(Za instanceof v.LineBucket||Za instanceof v.FillBucket||Za instanceof v.FillExtrusionBucket)&&(ae(Za.layers,this.zoom,re),Za.addFeatures(gr,this.tileID.canonical,Li.patternPositions))}this.status="done",Pe(null,{buckets:v.values(Bt).filter(function(au){return!au.isEmpty()}),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sa.image,imageAtlas:Li,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?vr:null,glyphPositions:this.returnDependencies?sa.positions:null})}}Yi.length?ge.send("getImages",{icons:Yi,source:this.source,tileID:this.tileID,type:"patterns"},function(sa,Li){Fe||(Fe=sa,Ft=Li,Ba.call(Ge))}):Ft={},Ba.call(this)};var Le=function(H,K,re,ge){this.actor=H,this.layerIndex=K,this.availableImages=re,this.loadVectorData=ge||et,this.loading={},this.loaded={}};Le.prototype.loadTile=function(H,K){var re=this,ge=H.uid;this.loading||(this.loading={});var Pe=!!(H&&H.request&&H.request.collectResourceTiming)&&new v.RequestPerformance(H.request),Ge=this.loading[ge]=new Ne(H);Ge.abort=this.loadVectorData(H,function(rt,fe){if(delete re.loading[ge],rt||!fe)return Ge.status="done",re.loaded[ge]=Ge,K(rt);var Fe=fe.rawData,mt={};fe.expires&&(mt.expires=fe.expires),fe.cacheControl&&(mt.cacheControl=fe.cacheControl);var vr={};if(Pe){var Ft=Pe.finish();Ft&&(vr.resourceTiming=JSON.parse(JSON.stringify(Ft)))}Ge.vectorTile=fe.vectorTile,Ge.parse(fe.vectorTile,re.layerIndex,re.availableImages,re.actor,function(Bt,gr){if(Bt||!gr)return K(Bt);K(null,v.extend({rawTileData:Fe.slice(0)},gr,mt,vr))}),re.loaded=re.loaded||{},re.loaded[ge]=Ge})},Le.prototype.reloadTile=function(H,K){var re=this,ge=this.loaded,Pe=H.uid,Ge=this;if(ge&&ge[Pe]){var rt=ge[Pe];rt.showCollisionBoxes=H.showCollisionBoxes;var fe=function(Fe,mt){var vr=rt.reloadCallback;vr&&(delete rt.reloadCallback,rt.parse(rt.vectorTile,Ge.layerIndex,re.availableImages,Ge.actor,vr)),K(Fe,mt)};rt.status==="parsing"?rt.reloadCallback=fe:rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,fe):fe())}},Le.prototype.abortTile=function(H,K){var re=this.loading,ge=H.uid;re&&re[ge]&&re[ge].abort&&(re[ge].abort(),delete re[ge]),K()},Le.prototype.removeTile=function(H,K){var re=this.loaded,ge=H.uid;re&&re[ge]&&delete re[ge],K()};var it=v.window.ImageBitmap,Ht=function(){this.loaded={}};function sr(H,K){if(H.length!==0){Ct(H[0],K);for(var re=1;re<H.length;re++)Ct(H[re],!K)}}function Ct(H,K){for(var re=0,ge=0,Pe=H.length,Ge=Pe-1;ge<Pe;Ge=ge++)re+=(H[ge][0]-H[Ge][0])*(H[Ge][1]+H[ge][1]);re>=0!=!!K&&H.reverse()}Ht.prototype.loadTile=function(H,K){var re=H.uid,ge=H.encoding,Pe=H.rawImageData,Ge=it&&Pe instanceof it?this.getImageData(Pe):Pe,rt=new v.DEMData(re,Ge,ge);this.loaded=this.loaded||{},this.loaded[re]=rt,K(null,rt)},Ht.prototype.getImageData=function(H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);var K=this.offscreenCanvasContext.getImageData(-1,-1,H.width+2,H.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:K.width,height:K.height},K.data)},Ht.prototype.removeTile=function(H){var K=this.loaded,re=H.uid;K&&K[re]&&delete K[re]};var Jt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Mt=function(H){this._feature=H,this.extent=v.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))};Mt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var H=[],K=0,re=this._feature.geometry;K<re.length;K+=1){var ge=re[K];H.push([new v.Point$1(ge[0],ge[1])])}return H}for(var Pe=[],Ge=0,rt=this._feature.geometry;Ge<rt.length;Ge+=1){for(var fe=[],Fe=0,mt=rt[Ge];Fe<mt.length;Fe+=1){var vr=mt[Fe];fe.push(new v.Point$1(vr[0],vr[1]))}Pe.push(fe)}return Pe},Mt.prototype.toGeoJSON=function(H,K,re){return Jt.call(this,H,K,re)};var lt=function(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=H.length,this._features=H};lt.prototype.feature=function(H){return new Mt(this._features[H])};var dt=v.vectorTile.VectorTileFeature,er=Y;function Y(H,K){this.options=K||{},this.features=H,this.length=H.length}function $t(H,K){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=K||4096}Y.prototype.feature=function(H){return new $t(this.features[H],this.options.extent)},$t.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var K=0;K<H.length;K++){for(var re=H[K],ge=[],Pe=0;Pe<re.length;Pe++)ge.push(new v.Point$1(re[Pe][0],re[Pe][1]));this.geometry.push(ge)}return this.geometry},$t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,K=1/0,re=-1/0,ge=1/0,Pe=-1/0,Ge=0;Ge<H.length;Ge++)for(var rt=H[Ge],fe=0;fe<rt.length;fe++){var Fe=rt[fe];K=Math.min(K,Fe.x),re=Math.max(re,Fe.x),ge=Math.min(ge,Fe.y),Pe=Math.max(Pe,Fe.y)}return[K,ge,re,Pe]},$t.prototype.toGeoJSON=dt.prototype.toGeoJSON;var gt=xt,Qe=er;function xt(H){var K=new v.pbf;return function(re,ge){for(var Pe in re.layers)ge.writeMessage(3,$e,re.layers[Pe])}(H,K),K.finish()}function $e(H,K){var re;K.writeVarintField(15,H.version||1),K.writeStringField(1,H.name||""),K.writeVarintField(5,H.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<H.length;re++)ge.feature=H.feature(re),K.writeMessage(2,Kt,ge);var Pe=ge.keys;for(re=0;re<Pe.length;re++)K.writeStringField(3,Pe[re]);var Ge=ge.values;for(re=0;re<Ge.length;re++)K.writeMessage(4,Xe,Ge[re])}function Kt(H,K){var re=H.feature;re.id!==void 0&&K.writeVarintField(1,re.id),K.writeMessage(2,Sr,H),K.writeVarintField(3,re.type),K.writeMessage(4,we,re)}function Sr(H,K){var re=H.feature,ge=H.keys,Pe=H.values,Ge=H.keycache,rt=H.valuecache;for(var fe in re.properties){var Fe=Ge[fe];Fe===void 0&&(ge.push(fe),Ge[fe]=Fe=ge.length-1),K.writeVarint(Fe);var mt=re.properties[fe],vr=typeof mt;vr!=="string"&&vr!=="boolean"&&vr!=="number"&&(mt=JSON.stringify(mt));var Ft=vr+":"+mt,Bt=rt[Ft];Bt===void 0&&(Pe.push(mt),rt[Ft]=Bt=Pe.length-1),K.writeVarint(Bt)}}function kr(H,K){return(K<<3)+(7&H)}function Qr(H){return H<<1^H>>31}function we(H,K){for(var re=H.loadGeometry(),ge=H.type,Pe=0,Ge=0,rt=re.length,fe=0;fe<rt;fe++){var Fe=re[fe],mt=1;ge===1&&(mt=Fe.length),K.writeVarint(kr(1,mt));for(var vr=ge===3?Fe.length-1:Fe.length,Ft=0;Ft<vr;Ft++){Ft===1&&ge!==1&&K.writeVarint(kr(2,vr-1));var Bt=Fe[Ft].x-Pe,gr=Fe[Ft].y-Ge;K.writeVarint(Qr(Bt)),K.writeVarint(Qr(gr)),Pe+=Bt,Ge+=gr}ge===3&&K.writeVarint(kr(7,1))}}function Xe(H,K){var re=typeof H;re==="string"?K.writeStringField(1,H):re==="boolean"?K.writeBooleanField(7,H):re==="number"&&(H%1!=0?K.writeDoubleField(3,H):H<0?K.writeSVarintField(6,H):K.writeVarintField(5,H))}function De(H,K,re,ge){St(H,re,ge),St(K,2*re,2*ge),St(K,2*re+1,2*ge+1)}function St(H,K,re){var ge=H[K];H[K]=H[re],H[re]=ge}function vt(H,K,re,ge){var Pe=H-re,Ge=K-ge;return Pe*Pe+Ge*Ge}gt.fromVectorTileJs=xt,gt.fromGeojsonVt=function(H,K){K=K||{};var re={};for(var ge in H)re[ge]=new er(H[ge].features,K),re[ge].name=ge,re[ge].version=K.version,re[ge].extent=K.extent;return xt({layers:re})},gt.GeoJSONWrapper=Qe;var zt=function(H){return H[0]},qt=function(H){return H[1]},Cr=function(H,K,re,ge,Pe){K===void 0&&(K=zt),re===void 0&&(re=qt),ge===void 0&&(ge=64),Pe===void 0&&(Pe=Float64Array),this.nodeSize=ge,this.points=H;for(var Ge=H.length<65536?Uint16Array:Uint32Array,rt=this.ids=new Ge(H.length),fe=this.coords=new Pe(2*H.length),Fe=0;Fe<H.length;Fe++)rt[Fe]=Fe,fe[2*Fe]=K(H[Fe]),fe[2*Fe+1]=re(H[Fe]);(function mt(vr,Ft,Bt,gr,bn,cn){if(!(bn-gr<=Bt)){var wt=gr+bn>>1;(function on(Hr,Xr,ii,Jr,Ti,ra){for(;Ti>Jr;){if(Ti-Jr>600){var Ei=Ti-Jr+1,Ri=ii-Jr+1,Ci=Math.log(Ei),Jn=.5*Math.exp(2*Ci/3),Yi=.5*Math.sqrt(Ci*Jn*(Ei-Jn)/Ei)*(Ri-Ei/2<0?-1:1);on(Hr,Xr,ii,Math.max(Jr,Math.floor(ii-Ri*Jn/Ei+Yi)),Math.min(Ti,Math.floor(ii+(Ei-Ri)*Jn/Ei+Yi)),ra)}var Ba=Xr[2*ii+ra],sa=Jr,Li=Ti;for(De(Hr,Xr,Jr,ii),Xr[2*Ti+ra]>Ba&&De(Hr,Xr,Jr,Ti);sa<Li;){for(De(Hr,Xr,sa,Li),sa++,Li--;Xr[2*sa+ra]<Ba;)sa++;for(;Xr[2*Li+ra]>Ba;)Li--}Xr[2*Jr+ra]===Ba?De(Hr,Xr,Jr,Li):De(Hr,Xr,++Li,Ti),Li<=ii&&(Jr=Li+1),ii<=Li&&(Ti=Li-1)}})(vr,Ft,wt,gr,bn,cn%2),mt(vr,Ft,Bt,gr,wt-1,cn+1),mt(vr,Ft,Bt,wt+1,bn,cn+1)}})(rt,fe,ge,0,rt.length-1,0)};Cr.prototype.range=function(H,K,re,ge){return function(Pe,Ge,rt,fe,Fe,mt,vr){for(var Ft,Bt,gr=[0,Pe.length-1,0],bn=[];gr.length;){var cn=gr.pop(),wt=gr.pop(),on=gr.pop();if(wt-on<=vr)for(var Hr=on;Hr<=wt;Hr++)Bt=Ge[2*Hr+1],(Ft=Ge[2*Hr])>=rt&&Ft<=Fe&&Bt>=fe&&Bt<=mt&&bn.push(Pe[Hr]);else{var Xr=Math.floor((on+wt)/2);Bt=Ge[2*Xr+1],(Ft=Ge[2*Xr])>=rt&&Ft<=Fe&&Bt>=fe&&Bt<=mt&&bn.push(Pe[Xr]);var ii=(cn+1)%2;(cn===0?rt<=Ft:fe<=Bt)&&(gr.push(on),gr.push(Xr-1),gr.push(ii)),(cn===0?Fe>=Ft:mt>=Bt)&&(gr.push(Xr+1),gr.push(wt),gr.push(ii))}}return bn}(this.ids,this.coords,H,K,re,ge,this.nodeSize)},Cr.prototype.within=function(H,K,re){return function(ge,Pe,Ge,rt,fe,Fe){for(var mt=[0,ge.length-1,0],vr=[],Ft=fe*fe;mt.length;){var Bt=mt.pop(),gr=mt.pop(),bn=mt.pop();if(gr-bn<=Fe)for(var cn=bn;cn<=gr;cn++)vt(Pe[2*cn],Pe[2*cn+1],Ge,rt)<=Ft&&vr.push(ge[cn]);else{var wt=Math.floor((bn+gr)/2),on=Pe[2*wt],Hr=Pe[2*wt+1];vt(on,Hr,Ge,rt)<=Ft&&vr.push(ge[wt]);var Xr=(Bt+1)%2;(Bt===0?Ge-fe<=on:rt-fe<=Hr)&&(mt.push(bn),mt.push(wt-1),mt.push(Xr)),(Bt===0?Ge+fe>=on:rt+fe>=Hr)&&(mt.push(wt+1),mt.push(gr),mt.push(Xr))}}return vr}(this.ids,this.coords,H,K,re,this.nodeSize)};var Yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(H){return H}},vn=function(H){this.options=oa(Object.create(Yn),H),this.trees=new Array(this.options.maxZoom+1)};function Qi(H,K,re,ge,Pe){return{x:H,y:K,zoom:1/0,id:re,parentId:-1,numPoints:ge,properties:Pe}}function jn(H,K){var re=H.geometry.coordinates,ge=re[1];return{x:qn(re[0]),y:ui(ge),zoom:1/0,index:K,parentId:-1}}function Xn(H){return{type:"Feature",id:H.id,properties:gi(H),geometry:{type:"Point",coordinates:[(ge=H.x,360*(ge-.5)),(K=H.y,re=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(re))/Math.PI-90)]}};var K,re,ge}function gi(H){var K=H.numPoints,re=K>=1e4?Math.round(K/1e3)+"k":K>=1e3?Math.round(K/100)/10+"k":K;return oa(oa({},H.properties),{cluster:!0,cluster_id:H.id,point_count:K,point_count_abbreviated:re})}function qn(H){return H/360+.5}function ui(H){var K=Math.sin(H*Math.PI/180),re=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return re<0?0:re>1?1:re}function oa(H,K){for(var re in K)H[re]=K[re];return H}function Fi(H){return H.x}function Ai(H){return H.y}function Gi(H,K,re,ge,Pe,Ge){var rt=Pe-re,fe=Ge-ge;if(rt!==0||fe!==0){var Fe=((H-re)*rt+(K-ge)*fe)/(rt*rt+fe*fe);Fe>1?(re=Pe,ge=Ge):Fe>0&&(re+=rt*Fe,ge+=fe*Fe)}return(rt=H-re)*rt+(fe=K-ge)*fe}function la(H,K,re,ge){var Pe={id:H===void 0?null:H,type:K,geometry:re,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var rt=Ge.geometry,fe=Ge.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")wi(Ge,rt);else if(fe==="Polygon"||fe==="MultiLineString")for(var Fe=0;Fe<rt.length;Fe++)wi(Ge,rt[Fe]);else if(fe==="MultiPolygon")for(Fe=0;Fe<rt.length;Fe++)for(var mt=0;mt<rt[Fe].length;mt++)wi(Ge,rt[Fe][mt])}(Pe),Pe}function wi(H,K){for(var re=0;re<K.length;re+=3)H.minX=Math.min(H.minX,K[re]),H.minY=Math.min(H.minY,K[re+1]),H.maxX=Math.max(H.maxX,K[re]),H.maxY=Math.max(H.maxY,K[re+1])}function ba(H,K,re,ge){if(K.geometry){var Pe=K.geometry.coordinates,Ge=K.geometry.type,rt=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),fe=[],Fe=K.id;if(re.promoteId?Fe=K.properties[re.promoteId]:re.generateId&&(Fe=ge||0),Ge==="Point")Mn(Pe,fe);else if(Ge==="MultiPoint")for(var mt=0;mt<Pe.length;mt++)Mn(Pe[mt],fe);else if(Ge==="LineString")Si(Pe,fe,rt,!1);else if(Ge==="MultiLineString"){if(re.lineMetrics){for(mt=0;mt<Pe.length;mt++)Si(Pe[mt],fe=[],rt,!1),H.push(la(Fe,"LineString",fe,K.properties));return}Ui(Pe,fe,rt,!1)}else if(Ge==="Polygon")Ui(Pe,fe,rt,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(mt=0;mt<K.geometry.geometries.length;mt++)ba(H,{id:Fe,geometry:K.geometry.geometries[mt],properties:K.properties},re,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<Pe.length;mt++){var vr=[];Ui(Pe[mt],vr,rt,!0),fe.push(vr)}}H.push(la(Fe,Ge,fe,K.properties))}}function Mn(H,K){K.push(Ji(H[0])),K.push(Xa(H[1])),K.push(0)}function Si(H,K,re,ge){for(var Pe,Ge,rt=0,fe=0;fe<H.length;fe++){var Fe=Ji(H[fe][0]),mt=Xa(H[fe][1]);K.push(Fe),K.push(mt),K.push(0),fe>0&&(rt+=ge?(Pe*mt-Fe*Ge)/2:Math.sqrt(Math.pow(Fe-Pe,2)+Math.pow(mt-Ge,2))),Pe=Fe,Ge=mt}var vr=K.length-3;K[2]=1,function Ft(Bt,gr,bn,cn){for(var wt,on=cn,Hr=bn-gr>>1,Xr=bn-gr,ii=Bt[gr],Jr=Bt[gr+1],Ti=Bt[bn],ra=Bt[bn+1],Ei=gr+3;Ei<bn;Ei+=3){var Ri=Gi(Bt[Ei],Bt[Ei+1],ii,Jr,Ti,ra);if(Ri>on)wt=Ei,on=Ri;else if(Ri===on){var Ci=Math.abs(Ei-Hr);Ci<Xr&&(wt=Ei,Xr=Ci)}}on>cn&&(wt-gr>3&&Ft(Bt,gr,wt,cn),Bt[wt+2]=on,bn-wt>3&&Ft(Bt,wt,bn,cn))}(K,0,vr,re),K[vr+2]=1,K.size=Math.abs(rt),K.start=0,K.end=K.size}function Ui(H,K,re,ge){for(var Pe=0;Pe<H.length;Pe++){var Ge=[];Si(H[Pe],Ge,re,ge),K.push(Ge)}}function Ji(H){return H/360+.5}function Xa(H){var K=Math.sin(H*Math.PI/180),re=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return re<0?0:re>1?1:re}function he(H,K,re,ge,Pe,Ge,rt,fe){if(ge/=K,Ge>=(re/=K)&&rt<ge)return H;if(rt<re||Ge>=ge)return null;for(var Fe=[],mt=0;mt<H.length;mt++){var vr=H[mt],Ft=vr.geometry,Bt=vr.type,gr=Pe===0?vr.minX:vr.minY,bn=Pe===0?vr.maxX:vr.maxY;if(gr>=re&&bn<ge)Fe.push(vr);else if(!(bn<re||gr>=ge)){var cn=[];if(Bt==="Point"||Bt==="MultiPoint")Bn(Ft,cn,re,ge,Pe);else if(Bt==="LineString")Ya(Ft,cn,re,ge,Pe,!1,fe.lineMetrics);else if(Bt==="MultiLineString")jt(Ft,cn,re,ge,Pe,!1);else if(Bt==="Polygon")jt(Ft,cn,re,ge,Pe,!0);else if(Bt==="MultiPolygon")for(var wt=0;wt<Ft.length;wt++){var on=[];jt(Ft[wt],on,re,ge,Pe,!0),on.length&&cn.push(on)}if(cn.length){if(fe.lineMetrics&&Bt==="LineString"){for(wt=0;wt<cn.length;wt++)Fe.push(la(vr.id,Bt,cn[wt],vr.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||(cn.length===1?(Bt="LineString",cn=cn[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=cn.length===3?"Point":"MultiPoint"),Fe.push(la(vr.id,Bt,cn,vr.tags))}}}return Fe.length?Fe:null}function Bn(H,K,re,ge,Pe){for(var Ge=0;Ge<H.length;Ge+=3){var rt=H[Ge+Pe];rt>=re&&rt<=ge&&(K.push(H[Ge]),K.push(H[Ge+1]),K.push(H[Ge+2]))}}function Ya(H,K,re,ge,Pe,Ge,rt){for(var fe,Fe,mt=ps(H),vr=Pe===0?Mr:I,Ft=H.start,Bt=0;Bt<H.length-3;Bt+=3){var gr=H[Bt],bn=H[Bt+1],cn=H[Bt+2],wt=H[Bt+3],on=H[Bt+4],Hr=Pe===0?gr:bn,Xr=Pe===0?wt:on,ii=!1;rt&&(fe=Math.sqrt(Math.pow(gr-wt,2)+Math.pow(bn-on,2))),Hr<re?Xr>re&&(Fe=vr(mt,gr,bn,wt,on,re),rt&&(mt.start=Ft+fe*Fe)):Hr>ge?Xr<ge&&(Fe=vr(mt,gr,bn,wt,on,ge),rt&&(mt.start=Ft+fe*Fe)):ir(mt,gr,bn,cn),Xr<re&&Hr>=re&&(Fe=vr(mt,gr,bn,wt,on,re),ii=!0),Xr>ge&&Hr<=ge&&(Fe=vr(mt,gr,bn,wt,on,ge),ii=!0),!Ge&&ii&&(rt&&(mt.end=Ft+fe*Fe),K.push(mt),mt=ps(H)),rt&&(Ft+=fe)}var Jr=H.length-3;gr=H[Jr],bn=H[Jr+1],cn=H[Jr+2],(Hr=Pe===0?gr:bn)>=re&&Hr<=ge&&ir(mt,gr,bn,cn),Jr=mt.length-3,Ge&&Jr>=3&&(mt[Jr]!==mt[0]||mt[Jr+1]!==mt[1])&&ir(mt,mt[0],mt[1],mt[2]),mt.length&&K.push(mt)}function ps(H){var K=[];return K.size=H.size,K.start=H.start,K.end=H.end,K}function jt(H,K,re,ge,Pe,Ge){for(var rt=0;rt<H.length;rt++)Ya(H[rt],K,re,ge,Pe,Ge,!1)}function ir(H,K,re,ge){H.push(K),H.push(re),H.push(ge)}function Mr(H,K,re,ge,Pe,Ge){var rt=(Ge-K)/(ge-K);return H.push(Ge),H.push(re+(Pe-re)*rt),H.push(1),rt}function I(H,K,re,ge,Pe,Ge){var rt=(Ge-re)/(Pe-re);return H.push(K+(ge-K)*rt),H.push(Ge),H.push(1),rt}function ar(H,K){for(var re=[],ge=0;ge<H.length;ge++){var Pe,Ge=H[ge],rt=Ge.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Pe=Ln(Ge.geometry,K);else if(rt==="MultiLineString"||rt==="Polygon"){Pe=[];for(var fe=0;fe<Ge.geometry.length;fe++)Pe.push(Ln(Ge.geometry[fe],K))}else if(rt==="MultiPolygon")for(Pe=[],fe=0;fe<Ge.geometry.length;fe++){for(var Fe=[],mt=0;mt<Ge.geometry[fe].length;mt++)Fe.push(Ln(Ge.geometry[fe][mt],K));Pe.push(Fe)}re.push(la(Ge.id,rt,Pe,Ge.tags))}return re}function Ln(H,K){var re=[];re.size=H.size,H.start!==void 0&&(re.start=H.start,re.end=H.end);for(var ge=0;ge<H.length;ge+=3)re.push(H[ge]+K,H[ge+1],H[ge+2]);return re}function li(H,K){if(H.transformed)return H;var re,ge,Pe,Ge=1<<H.z,rt=H.x,fe=H.y;for(re=0;re<H.features.length;re++){var Fe=H.features[re],mt=Fe.geometry,vr=Fe.type;if(Fe.geometry=[],vr===1)for(ge=0;ge<mt.length;ge+=2)Fe.geometry.push(Vn(mt[ge],mt[ge+1],K,Ge,rt,fe));else for(ge=0;ge<mt.length;ge++){var Ft=[];for(Pe=0;Pe<mt[ge].length;Pe+=2)Ft.push(Vn(mt[ge][Pe],mt[ge][Pe+1],K,Ge,rt,fe));Fe.geometry.push(Ft)}}return H.transformed=!0,H}function Vn(H,K,re,ge,Pe,Ge){return[Math.round(re*(H*ge-Pe)),Math.round(re*(K*ge-Ge))]}function rn(H,K,re,ge,Pe){for(var Ge=K===Pe.maxZoom?0:Pe.tolerance/((1<<K)*Pe.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:ge,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<H.length;fe++){rt.numFeatures++,Ii(rt,H[fe],Ge,Pe);var Fe=H[fe].minX,mt=H[fe].minY,vr=H[fe].maxX,Ft=H[fe].maxY;Fe<rt.minX&&(rt.minX=Fe),mt<rt.minY&&(rt.minY=mt),vr>rt.maxX&&(rt.maxX=vr),Ft>rt.maxY&&(rt.maxY=Ft)}return rt}function Ii(H,K,re,ge){var Pe=K.geometry,Ge=K.type,rt=[];if(Ge==="Point"||Ge==="MultiPoint")for(var fe=0;fe<Pe.length;fe+=3)rt.push(Pe[fe]),rt.push(Pe[fe+1]),H.numPoints++,H.numSimplified++;else if(Ge==="LineString")Oi(rt,Pe,H,re,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(fe=0;fe<Pe.length;fe++)Oi(rt,Pe[fe],H,re,Ge==="Polygon",fe===0);else if(Ge==="MultiPolygon")for(var Fe=0;Fe<Pe.length;Fe++){var mt=Pe[Fe];for(fe=0;fe<mt.length;fe++)Oi(rt,mt[fe],H,re,!0,fe===0)}if(rt.length){var vr=K.tags||null;if(Ge==="LineString"&&ge.lineMetrics){for(var Ft in vr={},K.tags)vr[Ft]=K.tags[Ft];vr.mapbox_clip_start=Pe.start/Pe.size,vr.mapbox_clip_end=Pe.end/Pe.size}var Bt={geometry:rt,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:vr};K.id!==null&&(Bt.id=K.id),H.features.push(Bt)}}function Oi(H,K,re,ge,Pe,Ge){var rt=ge*ge;if(ge>0&&K.size<(Pe?rt:ge))re.numPoints+=K.length/3;else{for(var fe=[],Fe=0;Fe<K.length;Fe+=3)(ge===0||K[Fe+2]>rt)&&(re.numSimplified++,fe.push(K[Fe]),fe.push(K[Fe+1])),re.numPoints++;Pe&&function(mt,vr){for(var Ft=0,Bt=0,gr=mt.length,bn=gr-2;Bt<gr;bn=Bt,Bt+=2)Ft+=(mt[Bt]-mt[bn])*(mt[Bt+1]+mt[bn+1]);if(Ft>0===vr)for(Bt=0,gr=mt.length;Bt<gr/2;Bt+=2){var cn=mt[Bt],wt=mt[Bt+1];mt[Bt]=mt[gr-2-Bt],mt[Bt+1]=mt[gr-1-Bt],mt[gr-2-Bt]=cn,mt[gr-1-Bt]=wt}}(fe,Ge),H.push(fe)}}function eo(H,K){var re=(K=this.options=function(Pe,Ge){for(var rt in Ge)Pe[rt]=Ge[rt];return Pe}(Object.create(this.options),K)).debug;if(re&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Pe,Ge){var rt=[];if(Pe.type==="FeatureCollection")for(var fe=0;fe<Pe.features.length;fe++)ba(rt,Pe.features[fe],Ge,fe);else ba(rt,Pe.type==="Feature"?Pe:{geometry:Pe},Ge);return rt}(H,K);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Pe,Ge){var rt=Ge.buffer/Ge.extent,fe=Pe,Fe=he(Pe,1,-1-rt,rt,0,-1,2,Ge),mt=he(Pe,1,1-rt,2+rt,0,-1,2,Ge);return(Fe||mt)&&(fe=he(Pe,1,-rt,1+rt,0,-1,2,Ge)||[],Fe&&(fe=ar(Fe,1).concat(fe)),mt&&(fe=fe.concat(ar(mt,-1)))),fe}(ge,K)).length&&this.splitTile(ge,0,0,0),re&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(H,K,re){return 32*((1<<H)*re+K)+H}function ga(H,K){var re=H.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);var ge=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!ge)return K(null,null);var Pe=new lt(ge.features),Ge=gt(Pe);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),K(null,{vectorTile:Pe,rawData:Ge.buffer})}vn.prototype.load=function(H){var K=this.options,re=K.log,ge=K.minZoom,Pe=K.maxZoom,Ge=K.nodeSize;re&&console.time("total time");var rt="prepare "+H.length+" points";re&&console.time(rt),this.points=H;for(var fe=[],Fe=0;Fe<H.length;Fe++)H[Fe].geometry&&fe.push(jn(H[Fe],Fe));this.trees[Pe+1]=new Cr(fe,Fi,Ai,Ge,Float32Array),re&&console.timeEnd(rt);for(var mt=Pe;mt>=ge;mt--){var vr=+Date.now();fe=this._cluster(fe,mt),this.trees[mt]=new Cr(fe,Fi,Ai,Ge,Float32Array),re&&console.log("z%d: %d clusters in %dms",mt,fe.length,+Date.now()-vr)}return re&&console.timeEnd("total time"),this},vn.prototype.getClusters=function(H,K){var re=((H[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,H[1])),Pe=H[2]===180?180:((H[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)re=-180,Pe=180;else if(re>Pe){var rt=this.getClusters([re,ge,180,Ge],K),fe=this.getClusters([-180,ge,Pe,Ge],K);return rt.concat(fe)}for(var Fe=this.trees[this._limitZoom(K)],mt=[],vr=0,Ft=Fe.range(qn(re),ui(Ge),qn(Pe),ui(ge));vr<Ft.length;vr+=1){var Bt=Fe.points[Ft[vr]];mt.push(Bt.numPoints?Xn(Bt):this.points[Bt.index])}return mt},vn.prototype.getChildren=function(H){var K=this._getOriginId(H),re=this._getOriginZoom(H),ge="No cluster with the specified id.",Pe=this.trees[re];if(!Pe)throw new Error(ge);var Ge=Pe.points[K];if(!Ge)throw new Error(ge);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,re-1)),fe=[],Fe=0,mt=Pe.within(Ge.x,Ge.y,rt);Fe<mt.length;Fe+=1){var vr=Pe.points[mt[Fe]];vr.parentId===H&&fe.push(vr.numPoints?Xn(vr):this.points[vr.index])}if(fe.length===0)throw new Error(ge);return fe},vn.prototype.getLeaves=function(H,K,re){var ge=[];return this._appendLeaves(ge,H,K=K||10,re=re||0,0),ge},vn.prototype.getTile=function(H,K,re){var ge=this.trees[this._limitZoom(H)],Pe=Math.pow(2,H),Ge=this.options,rt=Ge.radius/Ge.extent,fe=(re-rt)/Pe,Fe=(re+1+rt)/Pe,mt={features:[]};return this._addTileFeatures(ge.range((K-rt)/Pe,fe,(K+1+rt)/Pe,Fe),ge.points,K,re,Pe,mt),K===0&&this._addTileFeatures(ge.range(1-rt/Pe,fe,1,Fe),ge.points,Pe,re,Pe,mt),K===Pe-1&&this._addTileFeatures(ge.range(0,fe,rt/Pe,Fe),ge.points,-1,re,Pe,mt),mt.features.length?mt:null},vn.prototype.getClusterExpansionZoom=function(H){for(var K=this._getOriginZoom(H)-1;K<=this.options.maxZoom;){var re=this.getChildren(H);if(K++,re.length!==1)break;H=re[0].properties.cluster_id}return K},vn.prototype._appendLeaves=function(H,K,re,ge,Pe){for(var Ge=0,rt=this.getChildren(K);Ge<rt.length;Ge+=1){var fe=rt[Ge],Fe=fe.properties;if(Fe&&Fe.cluster?Pe+Fe.point_count<=ge?Pe+=Fe.point_count:Pe=this._appendLeaves(H,Fe.cluster_id,re,ge,Pe):Pe<ge?Pe++:H.push(fe),H.length===re)break}return Pe},vn.prototype._addTileFeatures=function(H,K,re,ge,Pe,Ge){for(var rt=0,fe=H;rt<fe.length;rt+=1){var Fe=K[fe[rt]],mt=Fe.numPoints,vr={type:1,geometry:[[Math.round(this.options.extent*(Fe.x*Pe-re)),Math.round(this.options.extent*(Fe.y*Pe-ge))]],tags:mt?gi(Fe):this.points[Fe.index].properties},Ft=void 0;mt?Ft=Fe.id:this.options.generateId?Ft=Fe.index:this.points[Fe.index].id&&(Ft=this.points[Fe.index].id),Ft!==void 0&&(vr.id=Ft),Ge.features.push(vr)}},vn.prototype._limitZoom=function(H){return Math.max(this.options.minZoom,Math.min(+H,this.options.maxZoom+1))},vn.prototype._cluster=function(H,K){for(var re=[],ge=this.options,Pe=ge.reduce,Ge=ge.minPoints,rt=ge.radius/(ge.extent*Math.pow(2,K)),fe=0;fe<H.length;fe++){var Fe=H[fe];if(!(Fe.zoom<=K)){Fe.zoom=K;for(var mt=this.trees[K+1],vr=mt.within(Fe.x,Fe.y,rt),Ft=Fe.numPoints||1,Bt=Ft,gr=0,bn=vr;gr<bn.length;gr+=1){var cn=mt.points[bn[gr]];cn.zoom>K&&(Bt+=cn.numPoints||1)}if(Bt>=Ge){for(var wt=Fe.x*Ft,on=Fe.y*Ft,Hr=Pe&&Ft>1?this._map(Fe,!0):null,Xr=(fe<<5)+(K+1)+this.points.length,ii=0,Jr=vr;ii<Jr.length;ii+=1){var Ti=mt.points[Jr[ii]];if(!(Ti.zoom<=K)){Ti.zoom=K;var ra=Ti.numPoints||1;wt+=Ti.x*ra,on+=Ti.y*ra,Ti.parentId=Xr,Pe&&(Hr||(Hr=this._map(Fe,!0)),Pe(Hr,this._map(Ti)))}}Fe.parentId=Xr,re.push(Qi(wt/Bt,on/Bt,Xr,Bt,Hr))}else if(re.push(Fe),Bt>1)for(var Ei=0,Ri=vr;Ei<Ri.length;Ei+=1){var Ci=mt.points[Ri[Ei]];Ci.zoom<=K||(Ci.zoom=K,re.push(Ci))}}}return re},vn.prototype._getOriginId=function(H){return H-this.points.length>>5},vn.prototype._getOriginZoom=function(H){return(H-this.points.length)%32},vn.prototype._map=function(H,K){if(H.numPoints)return K?oa({},H.properties):H.properties;var re=this.points[H.index].properties,ge=this.options.map(re);return K&&ge===re?oa({},ge):ge},eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},eo.prototype.splitTile=function(H,K,re,ge,Pe,Ge,rt){for(var fe=[H,K,re,ge],Fe=this.options,mt=Fe.debug;fe.length;){ge=fe.pop(),re=fe.pop(),K=fe.pop(),H=fe.pop();var vr=1<<K,Ft=hs(K,re,ge),Bt=this.tiles[Ft];if(!Bt&&(mt>1&&console.time("creation"),Bt=this.tiles[Ft]=rn(H,K,re,ge,Fe),this.tileCoords.push({z:K,x:re,y:ge}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,re,ge,Bt.numFeatures,Bt.numPoints,Bt.numSimplified),console.timeEnd("creation"));var gr="z"+K;this.stats[gr]=(this.stats[gr]||0)+1,this.total++}if(Bt.source=H,Pe){if(K===Fe.maxZoom||K===Pe)continue;var bn=1<<Pe-K;if(re!==Math.floor(Ge/bn)||ge!==Math.floor(rt/bn))continue}else if(K===Fe.indexMaxZoom||Bt.numPoints<=Fe.indexMaxPoints)continue;if(Bt.source=null,H.length!==0){mt>1&&console.time("clipping");var cn,wt,on,Hr,Xr,ii,Jr=.5*Fe.buffer/Fe.extent,Ti=.5-Jr,ra=.5+Jr,Ei=1+Jr;cn=wt=on=Hr=null,Xr=he(H,vr,re-Jr,re+ra,0,Bt.minX,Bt.maxX,Fe),ii=he(H,vr,re+Ti,re+Ei,0,Bt.minX,Bt.maxX,Fe),H=null,Xr&&(cn=he(Xr,vr,ge-Jr,ge+ra,1,Bt.minY,Bt.maxY,Fe),wt=he(Xr,vr,ge+Ti,ge+Ei,1,Bt.minY,Bt.maxY,Fe),Xr=null),ii&&(on=he(ii,vr,ge-Jr,ge+ra,1,Bt.minY,Bt.maxY,Fe),Hr=he(ii,vr,ge+Ti,ge+Ei,1,Bt.minY,Bt.maxY,Fe),ii=null),mt>1&&console.timeEnd("clipping"),fe.push(cn||[],K+1,2*re,2*ge),fe.push(wt||[],K+1,2*re,2*ge+1),fe.push(on||[],K+1,2*re+1,2*ge),fe.push(Hr||[],K+1,2*re+1,2*ge+1)}}},eo.prototype.getTile=function(H,K,re){var ge=this.options,Pe=ge.extent,Ge=ge.debug;if(H<0||H>24)return null;var rt=1<<H,fe=hs(H,K=(K%rt+rt)%rt,re);if(this.tiles[fe])return li(this.tiles[fe],Pe);Ge>1&&console.log("drilling down to z%d-%d-%d",H,K,re);for(var Fe,mt=H,vr=K,Ft=re;!Fe&&mt>0;)mt--,vr=Math.floor(vr/2),Ft=Math.floor(Ft/2),Fe=this.tiles[hs(mt,vr,Ft)];return Fe&&Fe.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",mt,vr,Ft),Ge>1&&console.time("drilling down"),this.splitTile(Fe.source,mt,vr,Ft,H,K,re),Ge>1&&console.timeEnd("drilling down"),this.tiles[fe]?li(this.tiles[fe],Pe):null):null};var Fa=function(H){function K(re,ge,Pe,Ge){H.call(this,re,ge,Pe,ga),Ge&&(this.loadGeoJSON=Ge)}return H&&(K.__proto__=H),(K.prototype=Object.create(H&&H.prototype)).constructor=K,K.prototype.loadData=function(re,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=re,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},K.prototype._loadData=function(){var re=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Pe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Pe&&Pe.request&&Pe.request.collectResourceTiming)&&new v.RequestPerformance(Pe.request);this.loadGeoJSON(Pe,function(rt,fe){if(rt||!fe)return ge(rt);if(typeof fe!="object")return ge(new Error("Input data given to '"+Pe.source+"' is not a valid GeoJSON object."));(function Bt(gr,bn){var cn,wt=gr&&gr.type;if(wt==="FeatureCollection")for(cn=0;cn<gr.features.length;cn++)Bt(gr.features[cn],bn);else if(wt==="GeometryCollection")for(cn=0;cn<gr.geometries.length;cn++)Bt(gr.geometries[cn],bn);else if(wt==="Feature")Bt(gr.geometry,bn);else if(wt==="Polygon")sr(gr.coordinates,bn);else if(wt==="MultiPolygon")for(cn=0;cn<gr.coordinates.length;cn++)sr(gr.coordinates[cn],bn);return gr})(fe,!0);try{if(Pe.filter){var Fe=v.createExpression(Pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Fe.result==="error")throw new Error(Fe.value.map(function(Bt){return Bt.key+": "+Bt.message}).join(", "));var mt=fe.features.filter(function(Bt){return Fe.value.evaluate({zoom:0},Bt)});fe={type:"FeatureCollection",features:mt}}re._geoJSONIndex=Pe.cluster?new vn(function(Bt){var gr=Bt.superclusterOptions,bn=Bt.clusterProperties;if(!bn||!gr)return gr;for(var cn={},wt={},on={accumulated:null,zoom:0},Hr={properties:null},Xr=Object.keys(bn),ii=0,Jr=Xr;ii<Jr.length;ii+=1){var Ti=Jr[ii],ra=bn[Ti],Ei=ra[0],Ri=v.createExpression(ra[1]),Ci=v.createExpression(typeof Ei=="string"?[Ei,["accumulated"],["get",Ti]]:Ei);cn[Ti]=Ri.value,wt[Ti]=Ci.value}return gr.map=function(Jn){Hr.properties=Jn;for(var Yi={},Ba=0,sa=Xr;Ba<sa.length;Ba+=1){var Li=sa[Ba];Yi[Li]=cn[Li].evaluate(on,Hr)}return Yi},gr.reduce=function(Jn,Yi){Hr.properties=Yi;for(var Ba=0,sa=Xr;Ba<sa.length;Ba+=1){var Li=sa[Ba];on.accumulated=Jn[Li],Jn[Li]=wt[Li].evaluate(on,Hr)}},gr}(Pe)).load(fe.features):function(Bt,gr){return new eo(Bt,gr)}(fe,Pe.geojsonVtOptions)}catch(Bt){return ge(Bt)}re.loaded={};var vr={};if(Ge){var Ft=Ge.finish();Ft&&(vr.resourceTiming={},vr.resourceTiming[Pe.source]=JSON.parse(JSON.stringify(Ft)))}ge(null,vr)})}},K.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},K.prototype.reloadTile=function(re,ge){var Pe=this.loaded;return Pe&&Pe[re.uid]?H.prototype.reloadTile.call(this,re,ge):this.loadTile(re,ge)},K.prototype.loadGeoJSON=function(re,ge){if(re.request)v.getJSON(re.request,ge);else{if(typeof re.data!="string")return ge(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(re.data))}catch(Pe){return ge(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."))}}},K.prototype.removeSource=function(re,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},K.prototype.getClusterExpansionZoom=function(re,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Pe){ge(Pe)}},K.prototype.getClusterChildren=function(re,ge){try{ge(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Pe){ge(Pe)}},K.prototype.getClusterLeaves=function(re,ge){try{ge(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Pe){ge(Pe)}},K}(Le),Aa=function(H){var K=this;this.self=H,this.actor=new v.Actor(H,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Le,geojson:Fa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(re,ge){if(K.workerSourceTypes[re])throw new Error('Worker source with name "'+re+'" already registered.');K.workerSourceTypes[re]=ge},this.self.registerRTLTextPlugin=function(re){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=re.applyArabicShaping,v.plugin.processBidirectionalText=re.processBidirectionalText,v.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}};return Aa.prototype.setReferrer=function(H,K){this.referrer=K},Aa.prototype.setImages=function(H,K,re){for(var ge in this.availableImages[H]=K,this.workerSources[H]){var Pe=this.workerSources[H][ge];for(var Ge in Pe)Pe[Ge].availableImages=K}re()},Aa.prototype.setLayers=function(H,K,re){this.getLayerIndex(H).replace(K),re()},Aa.prototype.updateLayers=function(H,K,re){this.getLayerIndex(H).update(K.layers,K.removedIds),re()},Aa.prototype.loadTile=function(H,K,re){this.getWorkerSource(H,K.type,K.source).loadTile(K,re)},Aa.prototype.loadDEMTile=function(H,K,re){this.getDEMWorkerSource(H,K.source).loadTile(K,re)},Aa.prototype.reloadTile=function(H,K,re){this.getWorkerSource(H,K.type,K.source).reloadTile(K,re)},Aa.prototype.abortTile=function(H,K,re){this.getWorkerSource(H,K.type,K.source).abortTile(K,re)},Aa.prototype.removeTile=function(H,K,re){this.getWorkerSource(H,K.type,K.source).removeTile(K,re)},Aa.prototype.removeDEMTile=function(H,K){this.getDEMWorkerSource(H,K.source).removeTile(K)},Aa.prototype.removeSource=function(H,K,re){if(this.workerSources[H]&&this.workerSources[H][K.type]&&this.workerSources[H][K.type][K.source]){var ge=this.workerSources[H][K.type][K.source];delete this.workerSources[H][K.type][K.source],ge.removeSource!==void 0?ge.removeSource(K,re):re()}},Aa.prototype.loadWorkerSource=function(H,K,re){try{this.self.importScripts(K.url),re()}catch(ge){re(ge.toString())}},Aa.prototype.syncRTLPluginState=function(H,K,re){try{v.plugin.setState(K);var ge=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Pe=v.plugin.isParsed();re(Pe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Pe)}}catch(Ge){re(Ge.toString())}},Aa.prototype.getAvailableImages=function(H){var K=this.availableImages[H];return K||(K=[]),K},Aa.prototype.getLayerIndex=function(H){var K=this.layerIndexes[H];return K||(K=this.layerIndexes[H]=new ce),K},Aa.prototype.getWorkerSource=function(H,K,re){var ge=this;return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][K]||(this.workerSources[H][K]={}),this.workerSources[H][K][re]||(this.workerSources[H][K][re]=new this.workerSourceTypes[K]({send:function(Pe,Ge,rt){ge.actor.send(Pe,Ge,rt,H)}},this.getLayerIndex(H),this.getAvailableImages(H))),this.workerSources[H][K][re]},Aa.prototype.getDEMWorkerSource=function(H,K){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][K]||(this.demWorkerSources[H][K]=new Ht),this.demWorkerSources[H][K]},Aa.prototype.enforceCacheSizeLimit=function(H,K){v.enforceCacheSizeLimit(K)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Aa(self)),Aa}),ye(["./shared"],function(v){"use strict";var ve=v.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,L,U=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(U);try{L=new Worker(X),M=!0}catch(oe){M=!1}return L&&L.terminate(),URL.revokeObjectURL(X),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var L=M.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===M.width}()?(d[A=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[A]=function(M){var L=function(X){var oe=document.createElement("canvas"),ue=Object.create(f.webGLContextAttributes);return ue.failIfMajorPerformanceCaveat=X,oe.probablySupportsContext?oe.probablySupportsContext("webgl",ue)||oe.probablySupportsContext("experimental-webgl",ue):oe.supportsContext?oe.supportsContext("webgl",ue)||oe.supportsContext("experimental-webgl",ue):oe.getContext("webgl",ue)||oe.getContext("experimental-webgl",ue)}(M);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(A)),d[A]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),j={create:function(l,f,c){var d=v.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},ce=v.window.document&&v.window.document.documentElement.style;function se(l){if(!ce)return l[0];for(var f=0;f<l.length;f++)if(l[f]in ce)return l[f];return l[0]}var Ne,ae=se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);j.disableDrag=function(){ce&&ae&&(Ne=ce[ae],ce[ae]="none")},j.enableDrag=function(){ce&&ae&&(ce[ae]=Ne)};var et=se(["transform","WebkitTransform"]);j.setTransform=function(l,f){l.style[et]=f};var Le=!1;try{var it=Object.defineProperty({},"passive",{get:function(){Le=!0}});v.window.addEventListener("test",it,it),v.window.removeEventListener("test",it,it)}catch(l){Le=!1}j.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&Le?d:d.capture)},j.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&Le?d:d.capture)};var Ht=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",Ht,!0)};function sr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}j.suppressClick=function(){v.window.addEventListener("click",Ht,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",Ht,!0)},0)},j.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},j.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new v.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},j.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},j.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Ct=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var A=E[d];this._notify(A.ids,A.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,A=0,M=c;A<M.length;A+=1){var L=M[A];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var A=0,M=c;A<M.length;A+=1)this.images[M[A]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},A=0,M=c;A<M.length;A+=1){var L=M[A];this.images[L]||this.fire(new v.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:v.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var A={w:E.data.width+2,h:E.data.height+2,x:0,y:0},M=new v.ImagePosition(A,E);this.patterns[c]={bin:A,position:M}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=v.potpack(c),A=E.w,M=E.h,L=this.atlasImage;for(var U in L.resize({width:A||1,height:M||1}),this.patterns){var X=this.patterns[U].bin,oe=X.x+1,ue=X.y+1,pe=this.images[U].data,Oe=pe.width,Ie=pe.height;v.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe,y:ue},{width:Oe,height:Ie}),v.RGBAImage.copy(pe,L,{x:0,y:Ie-1},{x:oe,y:ue-1},{width:Oe,height:1}),v.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe,y:ue+Ie},{width:Oe,height:1}),v.RGBAImage.copy(pe,L,{x:Oe-1,y:0},{x:oe-1,y:ue},{width:1,height:Ie}),v.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe+Oe,y:ue},{width:1,height:Ie})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var A=E[d];if(!this.callbackDispatchedThisFrame[A]){this.callbackDispatchedThisFrame[A]=!0;var M=this.images[A];sr(M)&&this.updateImage(A,M)}}},f}(v.Evented),Jt=dt,Mt=dt,lt=1e20;function dt(l,f,c,d,E,A){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=A||"normal",this.radius=c||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function er(l,f,c,d,E,A,M){for(var L=0;L<f;L++){for(var U=0;U<c;U++)d[U]=l[U*f+L];for(Y(d,E,A,M,c),U=0;U<c;U++)l[U*f+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<f;L++)d[L]=l[U*f+L];for(Y(d,E,A,M,f),L=0;L<f;L++)l[U*f+L]=Math.sqrt(E[L])}}function Y(l,f,c,d,E){c[0]=0,d[0]=-lt,d[1]=+lt;for(var A=1,M=0;A<E;A++){for(var L=(l[A]+A*A-(l[c[M]]+c[M]*c[M]))/(2*A-2*c[M]);L<=d[M];)M--,L=(l[A]+A*A-(l[c[M]]+c[M]*c[M]))/(2*A-2*c[M]);c[++M]=A,d[M]=L,d[M+1]=+lt}for(A=0,M=0;A<E;A++){for(;d[M+1]<A;)M++;f[A]=(A-c[M])*(A-c[M])+l[c[M]]}}dt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?lt:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?lt:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(er(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),er(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Jt.default=Mt;var $t=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};$t.prototype.setURL=function(l){this.url=l},$t.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var A=0,M=l[E];A<M.length;A+=1)d.push({stack:E,id:M[A]});v.asyncAll(d,function(L,U){var X=L.stack,oe=L.id,ue=c.entries[X];ue||(ue=c.entries[X]={glyphs:{},requests:{},ranges:{}});var pe=ue.glyphs[oe];if(pe===void 0){if(pe=c._tinySDF(ue,X,oe))return ue.glyphs[oe]=pe,void U(null,{stack:X,id:oe,glyph:pe});var Oe=Math.floor(oe/256);if(256*Oe>65535)U(new Error("glyphs > 65535 not supported"));else if(ue.ranges[Oe])U(null,{stack:X,id:oe,glyph:pe});else{var Ie=ue.requests[Oe];Ie||(Ie=ue.requests[Oe]=[],$t.loadGlyphRange(X,Oe,c.url,c.requestManager,function(ke,Ae){if(Ae){for(var je in Ae)c._doesCharSupportLocalGlyph(+je)||(ue.glyphs[+je]=Ae[+je]);ue.ranges[Oe]=!0}for(var Je=0,yt=Ie;Je<yt.length;Je+=1)(0,yt[Je])(ke,Ae);delete ue.requests[Oe]})),Ie.push(function(ke,Ae){ke?U(ke):Ae&&U(null,{stack:X,id:oe,glyph:Ae[oe]||null})})}}else U(null,{stack:X,id:oe,glyph:pe})},function(L,U){if(L)f(L);else if(U){for(var X={},oe=0,ue=U;oe<ue.length;oe+=1){var pe=ue[oe],Oe=pe.stack,Ie=pe.id,ke=pe.glyph;(X[Oe]||(X[Oe]={}))[Ie]=ke&&{id:ke.id,bitmap:ke.bitmap.clone(),metrics:ke.metrics}}f(null,X)}})},$t.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},$t.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),E=l.tinySDF=new $t.TinySDF(24,3,8,.25,d,A)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},$t.loadGlyphRange=function(l,f,c,d,E){var A=256*f,M=A+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",A+"-"+M),v.ResourceType.Glyphs);v.getArrayBuffer(L,function(U,X){if(U)E(U);else if(X){for(var oe={},ue=0,pe=v.parseGlyphPBF(X);ue<pe.length;ue+=1){var Oe=pe[ue];oe[Oe.id]=Oe}E(null,oe)}})},$t.TinySDF=Jt;var gt=function(){this.specification=v.styleSpec.light.position};gt.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},gt.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var Qe=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new gt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),xt=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(Qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(v.validateLight,c,d))for(var E in c){var A=c[E];v.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),A):this._transitionable.setValue(E,A)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),$e=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,A=l[0]*c,M=!0;d.push({left:E,right:A,isDash:M,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var X=l[U];d.push({left:E=L*c,right:A=(L+=X)*c,isDash:M=!M,zeroLength:X===0})}return d},$e.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var A=this.width*(this.nextRow+c+E),M=0,L=l[M],U=0;U<this.width;U++){U/L.right>1&&(L=l[++M]);var X=Math.abs(U-L.left),oe=Math.abs(U-L.right),ue=Math.min(X,oe),pe=void 0,Oe=E/c*(d+1);if(L.isDash){var Ie=d-Math.abs(Oe);pe=Math.sqrt(ue*ue+Ie*Ie)}else pe=d-Math.sqrt(ue*ue+Oe*Oe);this.data[A+U]=Math.max(0,Math.min(255,pe+128))}},$e.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],A=l[l.length-1];E.isDash===A.isDash&&(E.left=A.left-this.width,A.right=E.right+this.width);for(var M=this.width*this.nextRow,L=0,U=l[L],X=0;X<this.width;X++){X/U.right>1&&(U=l[++L]);var oe=Math.abs(X-U.left),ue=Math.abs(X-U.right),pe=Math.min(oe,ue);this.data[M+X]=Math.max(0,Math.min(255,(U.isDash?pe:-pe)+128))}},$e.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var E=0,A=0;A<l.length;A++)E+=l[A];if(E!==0){var M=this.width/E,L=this.getDashRanges(l,this.width,M);f?this.addRoundDash(L,M,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},$e.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Kt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var A=new l.Actor(d[E],c,this.id);A.name="Worker "+E,this.actors.push(A)}};function Sr(l,f,c){var d=function(E,A){if(E)return c(E);if(A){var M=v.pick(v.extend(A,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(M.vectorLayers=A.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(L){return L.id})),M.tiles=f.canonicalizeTileset(M,l.url),c(null,M)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),d):v.browser.frame(function(){return d(null,l)})}Kt.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},Kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Kt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Kt.Actor=v.Actor;var kr=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};kr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},kr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),A=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<A};var Qr=function(l){function f(c,d,E,A){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(d,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):E&&(v.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),A={request:this.map._requestManager.transformRequest(E,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}A.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",A,M.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",A,M.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),we=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},d),v.extend(this,v.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):E&&(v.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(E.tiles),v.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,A=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(A,v.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,X=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new v.Texture(U,L,X.RGBA,{useMipmap:!0}),c.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Xe=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function A(M,L){M&&(c.state="errored",d(M)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=v.getImage(this.map._requestManager.transformRequest(E,v.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=v.window.ImageBitmap&&L instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?L:v.browser.getImageData(L,1),X={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",X,A.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),A=(d.x-1+E)%E,M=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,X={};return X[new v.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(X[new v.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y-1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(X[new v.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y+1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),X},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(we),De=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(A),this._data=d.data,this._options=v.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var M=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*M,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*M,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:v.EXTENT,radius:(d.clusterRadius||50)*M,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new v.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new v.ErrorEvent(E));else{var A={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(A.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new v.Event("data",A))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,A){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},A),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=v.extend({},this.workerOptions),A=this._data;typeof A=="string"?(E.request=this.map._requestManager.transformRequest(v.browser.resolveURL(A),v.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(A),this.actor.send(this.type+".loadData",E,function(M,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(M))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,A=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(A,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):M?d(M):(c.loadVectorData(L,E.map.painter,A==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),St=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),vt=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(A,M){E._loaded=!0,A?E.fire(new v.ErrorEvent(A)):M&&(E.image=M,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var L=1/0,U=1/0,X=-1/0,oe=-1/0,ue=0,pe=M;ue<pe.length;ue+=1){var Oe=pe[ue];L=Math.min(L,Oe.x),U=Math.min(U,Oe.y),X=Math.max(X,Oe.x),oe=Math.max(oe,Oe.y)}var Ie=Math.max(X-L,oe-U),ke=Math.max(0,Math.floor(-Math.log(Ie)/Math.LN2)),Ae=Math.pow(2,ke);return new v.CanonicalTileID(ke,Math.floor((L+X)/2*Ae),Math.floor((U+oe)/2*Ae))}(E),this.minzoom=this.maxzoom=this.tileID.z;var A=E.map(function(M){return d.tileID.getTilePoint(M)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(A[2].x,A[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),zt=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,A=d.urls;E<A.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(A[E],v.ResourceType.Source).url);v.getVideo(this.urls,function(M,L){c._loaded=!0,M?c.fire(new v.ErrorEvent(M)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(vt),qt=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(L){return typeof L!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[A];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(vt),Cr={vector:Qr,raster:we,"raster-dem":Xe,geojson:De,video:zt,image:vt,canvas:qt};function Yn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function vn(l,f,c,d,E,A){var M=function(ke,Ae,je){if(ke)for(var Je=0,yt=ke;Je<yt.length;Je+=1){var Wt=Ae[yt[Je]];if(Wt&&Wt.source===je&&Wt.type==="fill-extrusion")return!0}else for(var Vt in Ae){var Pt=Ae[Vt];if(Pt.source===je&&Pt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),L=A.maxPitchScaleFactor(),U=l.tilesIn(d,L,M);U.sort(Qi);for(var X=[],oe=0,ue=U;oe<ue.length;oe+=1){var pe=ue[oe];X.push({wrappedTileID:pe.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(f,c,l._state,pe.queryGeometry,pe.cameraQueryGeometry,pe.scale,E,A,L,Yn(l.transform,pe.tileID))})}var Oe=function(ke){for(var Ae={},je={},Je=0,yt=ke;Je<yt.length;Je+=1){var Wt=yt[Je],Vt=Wt.queryResults,Pt=Wt.wrappedTileID,pr=je[Pt]=je[Pt]||{};for(var Or in Vt)for(var Dr=Vt[Or],un=pr[Or]=pr[Or]||{},Fn=Ae[Or]=Ae[Or]||[],Nn=0,Un=Dr;Nn<Un.length;Nn+=1){var Di=Un[Nn];un[Di.featureIndex]||(un[Di.featureIndex]=!0,Fn.push(Di))}}return Ae}(X);for(var Ie in Oe)Oe[Ie].forEach(function(ke){var Ae=ke.feature,je=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=je});return Oe}function Qi(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var jn=function(l,f){this.max=l,this.onRemove=f,this.reset()};jn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},jn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var A={value:f,timeout:void 0};if(c!==void 0&&(A.timeout=setTimeout(function(){d.remove(l,A)},c)),this.data[E].push(A),this.order.push(E),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},jn.prototype.has=function(l){return l.wrapped().key in this.data},jn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},jn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},jn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},jn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},jn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},jn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},jn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var A=E[d];l(A.value)||f.push(A)}for(var M=0,L=f;M<L.length;M+=1){var U=L[M];this.remove(U.value.tileID,U)}};var Xn=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Xn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Xn.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var gi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};qn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},qn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},qn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],A=f.attributes[E.name];A!==void 0&&l.vertexAttribPointer(A,E.components,l[gi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},qn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ui=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ui.prototype.get=function(){return this.current},ui.prototype.set=function(l){},ui.prototype.getDefault=function(){return this.default},ui.prototype.setDefault=function(){this.set(this.default)};var oa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(ui),Fi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(ui),Ai=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(ui),Gi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(ui),la=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(ui),wi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(ui),ba=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(ui),Mn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(ui),Si=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(ui),Ui=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(ui),Ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(ui),Xa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(ui),he=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(ui),Bn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(ui),Ya=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(ui),ps=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(ui),jt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(ui),ir=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(ui),Mr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(ui),I=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(ui),ar=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(ui),Ln=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(ui),li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(ui),Vn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(ui),rn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(ui),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(ui),Oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(ui),eo=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(ui),hs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(ui),ga=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(ui),Fa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(ui),Aa=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(ui),H=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Aa),K=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Aa),re=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new H(l,E),d&&(this.depthAttachment=new K(l,E))};re.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,f,c){this.func=l,this.mask=f,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Pe=function(l,f,c,d,E,A){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=A};Pe.disabled=new Pe({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],v.Color.transparent,[!0,!0,!0,!0]);var rt=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};rt.disabled=new rt(!1,1029,2305),rt.backCCW=new rt(!0,1029,2305);var fe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new oa(this),this.clearDepth=new Fi(this),this.clearStencil=new Ai(this),this.colorMask=new Gi(this),this.depthMask=new la(this),this.stencilMask=new wi(this),this.stencilFunc=new ba(this),this.stencilOp=new Mn(this),this.stencilTest=new Si(this),this.depthRange=new Ui(this),this.depthTest=new Ji(this),this.depthFunc=new Xa(this),this.blend=new he(this),this.blendFunc=new Bn(this),this.blendColor=new Ya(this),this.blendEquation=new ps(this),this.cullFace=new jt(this),this.cullFaceSide=new ir(this),this.frontFace=new Mr(this),this.program=new I(this),this.activeTexture=new ar(this),this.viewport=new Ln(this),this.bindFramebuffer=new li(this),this.bindRenderbuffer=new Vn(this),this.bindTexture=new rn(this),this.bindVertexBuffer=new Ii(this),this.bindElementBuffer=new Oi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new eo(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new ga(this),this.pixelStoreUnpackFlipY=new Fa(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};fe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},fe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},fe.prototype.createIndexBuffer=function(l,f){return new Xn(this,l,f)},fe.prototype.createVertexBuffer=function(l,f,c){return new qn(this,l,f,c)},fe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},fe.prototype.createFramebuffer=function(l,f,c){return new re(this,l,f,c)},fe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},fe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},fe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},fe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},fe.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},fe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Fe=function(l){function f(c,d,E){var A=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(A._sourceLoaded=!0),A._sourceLoaded&&!A._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(A.reload(),A.transform&&A.update(A.transform))}),this.on("error",function(){A._sourceErrored=!0}),this._source=function(M,L,U,X){var oe=new Cr[L.type](M,L,U,X);if(oe.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+oe.id);return v.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(c,d,E,this),this._tiles={},this._cache=new jn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(mt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var A in this._tiles)this._isIdRenderable(A,c)&&E.push(this._tiles[A]);return c?E.sort(function(M,L){var U=M.tileID,X=L.tileID,oe=new v.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),ue=new v.Point(X.canonical.x,X.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-X.overscaledZ||ue.y-oe.y||ue.x-oe.x}).map(function(M){return M.tileID.key}):E.map(function(M){return M.tileID}).sort(mt).map(function(M){return M.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,A){if(A)return c.state="errored",void(A.status!==404?this._source.fire(new v.ErrorEvent(A,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var A=d[E];if(c.neighboringTiles&&c.neighboringTiles[A]){var M=this.getTileByID(A);L(c,M),L(M,c)}}function L(U,X){U.needsHillshadePrepare=!0;var oe=X.tileID.canonical.x-U.tileID.canonical.x,ue=X.tileID.canonical.y-U.tileID.canonical.y,pe=Math.pow(2,U.tileID.canonical.z),Oe=X.tileID.key;oe===0&&ue===0||Math.abs(ue)>1||(Math.abs(oe)>1&&(Math.abs(oe+pe)===1?oe+=pe:Math.abs(oe-pe)===1&&(oe-=pe)),X.dem&&U.dem&&(U.dem.backfillBorder(X.dem,oe,ue),U.neighboringTiles&&U.neighboringTiles[Oe]&&(U.neighboringTiles[Oe].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,A){for(var M in this._tiles){var L=this._tiles[M];if(!(A[M]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var X=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[X.key])&&L.hasData()&&(U=X)}for(var oe=U;oe.overscaledZ>d;)if(c[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){A[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var A=c.overscaledZ-1;A>=d;A--){var M=c.scaledTo(A),L=this._getLoadedTile(M);if(L)return L}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,A=Math.floor(d*E*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(M)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var A in this._tiles){var M=this._tiles[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pr){return new v.OverscaledTileID(pr.canonical.z,pr.wrap,pr.canonical.z,pr.canonical.x,pr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(pr){return d._source.hasTile(pr)}))):E=[];var A=c.coveringZoomLevel(this._source),M=Math.max(A-f.maxOverzooming,this._source.minzoom),L=Math.max(A+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,A);if(vr(this._source.type)){for(var X={},oe={},ue=0,pe=Object.keys(U);ue<pe.length;ue+=1){var Oe=pe[ue],Ie=U[Oe],ke=this._tiles[Oe];if(ke&&!(ke.fadeEndTime&&ke.fadeEndTime<=v.browser.now())){var Ae=this.findLoadedParent(Ie,M);Ae&&(this._addTile(Ae.tileID),X[Ae.tileID.key]=Ae.tileID),oe[Oe]=Ie}}for(var je in this._retainLoadedChildren(oe,A,L,U),X)U[je]||(this._coveredTiles[je]=!0,U[je]=X[je])}for(var Je in U)this._tiles[Je].clearFadeHold();for(var yt=0,Wt=v.keysDifference(this._tiles,U);yt<Wt.length;yt+=1){var Vt=Wt[yt],Pt=this._tiles[Vt];Pt.hasSymbolBuckets&&!Pt.holdingForFade()?Pt.setHoldDuration(this.map._fadeDuration):Pt.hasSymbolBuckets&&!Pt.symbolFadeFinished()||this._removeTile(Vt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},A={},M=Math.max(d-f.maxOverzooming,this._source.minzoom),L=Math.max(d+f.maxUnderzooming,this._source.minzoom),U={},X=0,oe=c;X<oe.length;X+=1){var ue=oe[X],pe=this._addTile(ue);E[ue.key]=ue,pe.hasData()||d<this._source.maxzoom&&(U[ue.key]=ue)}this._retainLoadedChildren(U,d,L,E);for(var Oe=0,Ie=c;Oe<Ie.length;Oe+=1){var ke=Ie[Oe],Ae=this._tiles[ke.key];if(!Ae.hasData()){if(d+1>this._source.maxzoom){var je=ke.children(this._source.maxzoom)[0],Je=this.getTile(je);if(Je&&Je.hasData()){E[je.key]=je;continue}}else{var yt=ke.children(this._source.maxzoom);if(E[yt[0].key]&&E[yt[1].key]&&E[yt[2].key]&&E[yt[3].key])continue}for(var Wt=Ae.wasRequested(),Vt=ke.overscaledZ-1;Vt>=M;--Vt){var Pt=ke.scaledTo(Vt);if(A[Pt.key]||(A[Pt.key]=!0,!(Ae=this.getTile(Pt))&&Wt&&(Ae=this._addTile(Pt)),Ae&&(E[Pt.key]=Pt,Wt=Ae.wasRequested(),Ae.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,A=this._tiles[c].tileID;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){E=this._loadedParentTiles[A.key];break}d.push(A.key);var M=A.scaledTo(A.overscaledZ-1);if(E=this._getLoadedTile(M))break;A=M}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new v.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var A=d.getExpiryTimeout();A&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},A))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var A=this,M=[],L=this.transform;if(!L)return M;for(var U=E?L.getCameraQueryGeometry(c):c,X=c.map(function(Vt){return L.pointCoordinate(Vt)}),oe=U.map(function(Vt){return L.pointCoordinate(Vt)}),ue=this.getIds(),pe=1/0,Oe=1/0,Ie=-1/0,ke=-1/0,Ae=0,je=oe;Ae<je.length;Ae+=1){var Je=je[Ae];pe=Math.min(pe,Je.x),Oe=Math.min(Oe,Je.y),Ie=Math.max(Ie,Je.x),ke=Math.max(ke,Je.y)}for(var yt=function(Vt){var Pt=A._tiles[ue[Vt]];if(!Pt.holdingForFade()){var pr=Pt.tileID,Or=Math.pow(2,L.zoom-Pt.tileID.overscaledZ),Dr=d*Pt.queryPadding*v.EXTENT/Pt.tileSize/Or,un=[pr.getTilePoint(new v.MercatorCoordinate(pe,Oe)),pr.getTilePoint(new v.MercatorCoordinate(Ie,ke))];if(un[0].x-Dr<v.EXTENT&&un[0].y-Dr<v.EXTENT&&un[1].x+Dr>=0&&un[1].y+Dr>=0){var Fn=X.map(function(Un){return pr.getTilePoint(Un)}),Nn=oe.map(function(Un){return pr.getTilePoint(Un)});M.push({tile:Pt,tileID:pr,queryGeometry:Fn,cameraQueryGeometry:Nn,scale:Or})}}},Wt=0;Wt<ue.length;Wt++)yt(Wt);return M},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),A=0,M=E;A<M.length;A+=1){var L=M[A];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(vr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var A=this._tiles[c];A&&A.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(A){return!A.hasDependency(c,d)})},f}(v.Evented);function mt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function vr(l){return l==="raster"||l==="image"||l==="video"}function Ft(){return new v.window.Worker(ic.workerUrl)}Fe.maxOverzooming=10,Fe.maxUnderzooming=3;var Bt="mapboxgl_preloaded_worker_pool",gr=function(){this.active={}};gr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<gr.workerCount;)this.workers.push(new Ft);return this.active[l]=!0,this.workers.slice()},gr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},gr.prototype.isPreloaded=function(){return!!this.active[Bt]},gr.prototype.numActive=function(){return Object.keys(this.active).length};var bn,cn=Math.floor(v.browser.hardwareConcurrency/2);function wt(){return bn||(bn=new gr),bn}function on(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return v.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Hr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=on(l[d],f[l[d].ref]));return l}gr.workerCount=Math.max(Math.min(cn,6),1);var Xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ii(l,f,c){c.push({command:Xr.addSource,args:[l,f[l]]})}function Jr(l,f,c){f.push({command:Xr.removeSource,args:[l]}),c[l]=!0}function Ti(l,f,c,d){Jr(l,c,d),ii(l,f,c)}function ra(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;return!0}function Ei(l,f,c,d,E,A){var M;for(M in f=f||{},l=l||{})l.hasOwnProperty(M)&&(v.deepEqual(l[M],f[M])||c.push({command:A,args:[d,M,f[M],E]}));for(M in f)f.hasOwnProperty(M)&&!l.hasOwnProperty(M)&&(v.deepEqual(l[M],f[M])||c.push({command:A,args:[d,M,f[M],E]}))}function Ri(l){return l.id}function Ci(l,f){return l[f.id]=f,l}var Jn=function(l,f){this.reset(l,f)};Jn.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Jn.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,A=this._distances[E],M=c-A,L=M>0?(d-A)/M:0;return this.points[E].mult(1-L).add(this.points[f].mult(L))};var Yi=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var A=0;A<this.xCellCount*this.yCellCount;A++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Ba(l,f,c,d,E){var A=v.create();return f?(v.scale(A,A,[1/E,1/E,1]),c||v.rotateZ(A,A,d.angle)):v.multiply(A,d.labelPlaneMatrix,l),A}function sa(l,f,c,d,E){if(f){var A=v.clone(l);return v.scale(A,A,[E,E,1]),c||v.rotateZ(A,A,-d.angle),A}return d.glCoordMatrix}function Li(l,f){var c=[l.x,l.y,0,1];ja(c,c,f);var d=c[3];return{point:new v.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Hi(l,f){return .5+l/f*.5}function Za(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function au(l,f,c,d,E,A,M,L){var U=d?l.textSizeData:l.iconSizeData,X=v.evaluateSizeForZoom(U,c.transform.zoom),oe=[256/c.width*2+1,256/c.height*2+1],ue=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ue.clear();for(var pe=l.lineVertexArray,Oe=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ie=c.transform.width/c.transform.height,ke=!1,Ae=0;Ae<Oe.length;Ae++){var je=Oe.get(Ae);if(je.hidden||je.writingMode===v.WritingMode.vertical&&!ke)So(je.numGlyphs,ue);else{ke=!1;var Je=[je.anchorX,je.anchorY,0,1];if(v.transformMat4(Je,Je,f),Za(Je,oe)){var yt=Hi(c.transform.cameraToCenterDistance,Je[3]),Wt=v.evaluateSizeForFeature(U,X,je),Vt=M?Wt/yt:Wt*yt,Pt=new v.Point(je.anchorX,je.anchorY),pr=Li(Pt,E).point,Or={},Dr=Ss(je,Vt,!1,L,f,E,A,l.glyphOffsetArray,pe,ue,pr,Pt,Or,Ie);ke=Dr.useVertical,(Dr.notEnoughRoom||ke||Dr.needsFlipping&&Ss(je,Vt,!0,L,f,E,A,l.glyphOffsetArray,pe,ue,pr,Pt,Or,Ie).notEnoughRoom)&&So(je.numGlyphs,ue)}else So(je.numGlyphs,ue)}}d?l.text.dynamicLayoutVertexBuffer.updateData(ue):l.icon.dynamicLayoutVertexBuffer.updateData(ue)}function wa(l,f,c,d,E,A,M,L,U,X,oe){var ue=L.glyphStartIndex+L.numGlyphs,pe=L.lineStartIndex,Oe=L.lineStartIndex+L.lineLength,Ie=f.getoffsetX(L.glyphStartIndex),ke=f.getoffsetX(ue-1),Ae=na(l*Ie,c,d,E,A,M,L.segment,pe,Oe,U,X,oe);if(!Ae)return null;var je=na(l*ke,c,d,E,A,M,L.segment,pe,Oe,U,X,oe);return je?{first:Ae,last:je}:null}function Ta(l,f,c,d){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function Ss(l,f,c,d,E,A,M,L,U,X,oe,ue,pe,Oe){var Ie,ke=f/24,Ae=l.lineOffsetX*ke,je=l.lineOffsetY*ke;if(l.numGlyphs>1){var Je=l.glyphStartIndex+l.numGlyphs,yt=l.lineStartIndex,Wt=l.lineStartIndex+l.lineLength,Vt=wa(ke,L,Ae,je,c,oe,ue,l,U,A,pe);if(!Vt)return{notEnoughRoom:!0};var Pt=Li(Vt.first.point,M).point,pr=Li(Vt.last.point,M).point;if(d&&!c){var Or=Ta(l.writingMode,Pt,pr,Oe);if(Or)return Or}Ie=[Vt.first];for(var Dr=l.glyphStartIndex+1;Dr<Je-1;Dr++)Ie.push(na(ke*L.getoffsetX(Dr),Ae,je,c,oe,ue,l.segment,yt,Wt,U,A,pe));Ie.push(Vt.last)}else{if(d&&!c){var un=Li(ue,E).point,Fn=l.lineStartIndex+l.segment+1,Nn=new v.Point(U.getx(Fn),U.gety(Fn)),Un=Li(Nn,E),Di=Un.signedDistanceFromCamera>0?Un.point:ds(ue,Nn,un,1,E),nn=Ta(l.writingMode,un,Di,Oe);if(nn)return nn}var ai=na(ke*L.getoffsetX(l.glyphStartIndex),Ae,je,c,oe,ue,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,A,pe);if(!ai)return{notEnoughRoom:!0};Ie=[ai]}for(var fi=0,ei=Ie;fi<ei.length;fi+=1){var Gn=ei[fi];v.addDynamicAttributes(X,Gn.point,Gn.angle)}return{}}function ds(l,f,c,d,E){var A=Li(l.add(l.sub(f)._unit()),E).point,M=c.sub(A);return c.add(M._mult(d/M.mag()))}function na(l,f,c,d,E,A,M,L,U,X,oe,ue){var pe=d?l-f:l+f,Oe=pe>0?1:-1,Ie=0;d&&(Oe*=-1,Ie=Math.PI),Oe<0&&(Ie+=Math.PI);for(var ke=Oe>0?L+M:L+M+1,Ae=E,je=E,Je=0,yt=0,Wt=Math.abs(pe),Vt=[];Je+yt<=Wt;){if((ke+=Oe)<L||ke>=U)return null;if(je=Ae,Vt.push(Ae),(Ae=ue[ke])===void 0){var Pt=new v.Point(X.getx(ke),X.gety(ke)),pr=Li(Pt,oe);if(pr.signedDistanceFromCamera>0)Ae=ue[ke]=pr.point;else{var Or=ke-Oe;Ae=ds(Je===0?A:new v.Point(X.getx(Or),X.gety(Or)),Pt,je,Wt-Je+1,oe)}}Je+=yt,yt=je.dist(Ae)}var Dr=(Wt-Je)/yt,un=Ae.sub(je),Fn=un.mult(Dr)._add(je);Fn._add(un._unit()._perp()._mult(c*Oe));var Nn=Ie+Math.atan2(Ae.y-je.y,Ae.x-je.x);return Vt.push(Fn),{point:Fn,angle:Nn,path:Vt}}Yi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Yi.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Yi.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Yi.prototype._insertBoxCell=function(l,f,c,d,E,A){this.boxCells[E].push(A)},Yi.prototype._insertCircleCell=function(l,f,c,d,E,A){this.circleCells[E].push(A)},Yi.prototype._query=function(l,f,c,d,E,A){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var M=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var X=this.circles[3*U],oe=this.circles[3*U+1],ue=this.circles[3*U+2];M.push({key:this.circleKeys[U],x1:X-ue,y1:oe-ue,x2:X+ue,y2:oe+ue})}return A?M.filter(A):M}return this._forEachCell(l,f,c,d,this._queryCell,M,{hitTest:E,seenUids:{box:{},circle:{}}},A),E?M.length>0:M},Yi.prototype._queryCircle=function(l,f,c,d,E){var A=l-c,M=l+c,L=f-c,U=f+c;if(M<0||A>this.width||U<0||L>this.height)return!d&&[];var X=[];return this._forEachCell(A,L,M,U,this._queryCellCircle,X,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?X.length>0:X},Yi.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},Yi.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},Yi.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Yi.prototype._queryCell=function(l,f,c,d,E,A,M,L){var U=M.seenUids,X=this.boxCells[E];if(X!==null)for(var oe=this.bboxes,ue=0,pe=X;ue<pe.length;ue+=1){var Oe=pe[ue];if(!U.box[Oe]){U.box[Oe]=!0;var Ie=4*Oe;if(l<=oe[Ie+2]&&f<=oe[Ie+3]&&c>=oe[Ie+0]&&d>=oe[Ie+1]&&(!L||L(this.boxKeys[Oe]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Oe],x1:oe[Ie],y1:oe[Ie+1],x2:oe[Ie+2],y2:oe[Ie+3]})}}}var ke=this.circleCells[E];if(ke!==null)for(var Ae=this.circles,je=0,Je=ke;je<Je.length;je+=1){var yt=Je[je];if(!U.circle[yt]){U.circle[yt]=!0;var Wt=3*yt;if(this._circleAndRectCollide(Ae[Wt],Ae[Wt+1],Ae[Wt+2],l,f,c,d)&&(!L||L(this.circleKeys[yt]))){if(M.hitTest)return A.push(!0),!0;var Vt=Ae[Wt],Pt=Ae[Wt+1],pr=Ae[Wt+2];A.push({key:this.circleKeys[yt],x1:Vt-pr,y1:Pt-pr,x2:Vt+pr,y2:Pt+pr})}}}},Yi.prototype._queryCellCircle=function(l,f,c,d,E,A,M,L){var U=M.circle,X=M.seenUids,oe=this.boxCells[E];if(oe!==null)for(var ue=this.bboxes,pe=0,Oe=oe;pe<Oe.length;pe+=1){var Ie=Oe[pe];if(!X.box[Ie]){X.box[Ie]=!0;var ke=4*Ie;if(this._circleAndRectCollide(U.x,U.y,U.radius,ue[ke+0],ue[ke+1],ue[ke+2],ue[ke+3])&&(!L||L(this.boxKeys[Ie])))return A.push(!0),!0}}var Ae=this.circleCells[E];if(Ae!==null)for(var je=this.circles,Je=0,yt=Ae;Je<yt.length;Je+=1){var Wt=yt[Je];if(!X.circle[Wt]){X.circle[Wt]=!0;var Vt=3*Wt;if(this._circlesCollide(je[Vt],je[Vt+1],je[Vt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Wt])))return A.push(!0),!0}}},Yi.prototype._forEachCell=function(l,f,c,d,E,A,M,L){for(var U=this._convertToXCellCoord(l),X=this._convertToYCellCoord(f),oe=this._convertToXCellCoord(c),ue=this._convertToYCellCoord(d),pe=U;pe<=oe;pe++)for(var Oe=X;Oe<=ue;Oe++)if(E.call(this,l,f,c,d,this.xCellCount*Oe+pe,A,M,L))return},Yi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Yi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Yi.prototype._circlesCollide=function(l,f,c,d,E,A){var M=d-l,L=E-f,U=c+A;return U*U>M*M+L*L},Yi.prototype._circleAndRectCollide=function(l,f,c,d,E,A,M){var L=(A-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var X=(M-E)/2,oe=Math.abs(f-(E+X));if(oe>X+c)return!1;if(U<=L||oe<=X)return!0;var ue=U-L,pe=oe-X;return ue*ue+pe*pe<=c*c};var Zu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function So(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(Zu,3*d)}}function ja(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var uo=function(l,f,c){f===void 0&&(f=new Yi(l.width+200,l.height+200,25)),c===void 0&&(c=new Yi(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ea(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}uo.prototype.placeCollisionBox=function(l,f,c,d,E){var A=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),M=c*A.perspectiveRatio,L=l.x1*M+A.point.x,U=l.y1*M+A.point.y,X=l.x2*M+A.point.x,oe=l.y2*M+A.point.y;return!this.isInsideGrid(L,U,X,oe)||!f&&this.grid.hitTest(L,U,X,oe,E)?{box:[],offscreen:!1}:{box:[L,U,X,oe],offscreen:this.isOffscreen(L,U,X,oe)}},uo.prototype.placeCollisionCircles=function(l,f,c,d,E,A,M,L,U,X,oe,ue,pe){var Oe=[],Ie=new v.Point(f.anchorX,f.anchorY),ke=Li(Ie,A),Ae=Hi(this.transform.cameraToCenterDistance,ke.signedDistanceFromCamera),je=(X?E/Ae:E*Ae)/v.ONE_EM,Je=Li(Ie,M).point,yt=wa(je,d,f.lineOffsetX*je,f.lineOffsetY*je,!1,Je,Ie,f,c,M,{}),Wt=!1,Vt=!1,Pt=!0;if(yt){for(var pr=.5*ue*Ae+pe,Or=new v.Point(-100,-100),Dr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),un=new Jn,Fn=yt.first,Nn=yt.last,Un=[],Di=Fn.path.length-1;Di>=1;Di--)Un.push(Fn.path[Di]);for(var nn=1;nn<Nn.path.length;nn++)Un.push(Nn.path[nn]);var ai=2.5*pr;if(L){var fi=Un.map(function(Ia){return Li(Ia,L)});Un=fi.some(function(Ia){return Ia.signedDistanceFromCamera<=0})?[]:fi.map(function(Ia){return Ia.point})}var ei=[];if(Un.length>0){for(var Gn=Un[0].clone(),yi=Un[0].clone(),Kn=1;Kn<Un.length;Kn++)Gn.x=Math.min(Gn.x,Un[Kn].x),Gn.y=Math.min(Gn.y,Un[Kn].y),yi.x=Math.max(yi.x,Un[Kn].x),yi.y=Math.max(yi.y,Un[Kn].y);ei=Gn.x>=Or.x&&yi.x<=Dr.x&&Gn.y>=Or.y&&yi.y<=Dr.y?[Un]:yi.x<Or.x||Gn.x>Dr.x||yi.y<Or.y||Gn.y>Dr.y?[]:v.clipLine([Un],Or.x,Or.y,Dr.x,Dr.y)}for(var Hn=0,Pa=ei;Hn<Pa.length;Hn+=1){var ro;un.reset(Pa[Hn],.25*pr),ro=un.length<=.5*pr?1:Math.ceil(un.paddedLength/ai)+1;for(var no=0;no<ro;no++){var Wo=no/Math.max(ro-1,1),Va=un.lerp(Wo),io=Va.x+100,Rs=Va.y+100;Oe.push(io,Rs,pr,0);var ys=io-pr,Fu=Rs-pr,_s=io+pr,ka=Rs+pr;if(Pt=Pt&&this.isOffscreen(ys,Fu,_s,ka),Vt=Vt||this.isInsideGrid(ys,Fu,_s,ka),!l&&this.grid.hitTestCircle(io,Rs,pr,oe)&&(Wt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Wt}}}}return{circles:!U&&Wt||!Vt?[]:Oe,offscreen:Pt,collisionDetected:Wt}},uo.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,A=-1/0,M=0,L=l;M<L.length;M+=1){var U=L[M],X=new v.Point(U.x+100,U.y+100);c=Math.min(c,X.x),d=Math.min(d,X.y),E=Math.max(E,X.x),A=Math.max(A,X.y),f.push(X)}for(var oe={},ue={},pe=0,Oe=this.grid.query(c,d,E,A).concat(this.ignoredGrid.query(c,d,E,A));pe<Oe.length;pe+=1){var Ie=Oe[pe],ke=Ie.key;if(oe[ke.bucketInstanceId]===void 0&&(oe[ke.bucketInstanceId]={}),!oe[ke.bucketInstanceId][ke.featureIndex]){var Ae=[new v.Point(Ie.x1,Ie.y1),new v.Point(Ie.x2,Ie.y1),new v.Point(Ie.x2,Ie.y2),new v.Point(Ie.x1,Ie.y2)];v.polygonIntersectsPolygon(f,Ae)&&(oe[ke.bucketInstanceId][ke.featureIndex]=!0,ue[ke.bucketInstanceId]===void 0&&(ue[ke.bucketInstanceId]=[]),ue[ke.bucketInstanceId].push(ke.featureIndex))}}return ue},uo.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},uo.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var A=f?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)A.insertCircle(M,l[L],l[L+1],l[L+2])},uo.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return ja(d,d,l),{point:new v.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},uo.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},uo.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},uo.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var $o=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};$o.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Qo=function(l,f,c,d,E){this.text=new $o(l?l.text:null,f,c,E),this.icon=new $o(l?l.icon:null,f,d,E)};Qo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ju=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},To=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Jo=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},ya=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Co(l,f,c,d,E){var A=v.getAnchorAlignment(l),M=-(A.horizontalAlign-.5)*f,L=-(A.verticalAlign-.5)*c,U=v.evaluateVariableOffset(l,d);return new v.Point(M+U[0]*E,L+U[1]*E)}function es(l,f,c,d,E,A){var M=l.x1,L=l.x2,U=l.y1,X=l.y2,oe=l.anchorPointX,ue=l.anchorPointY,pe=new v.Point(f,c);return d&&pe._rotate(E?A:-A),{x1:M+pe.x,y1:U+pe.y,x2:L+pe.x,y2:X+pe.y,anchorPointX:oe,anchorPointY:ue}}ya.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var lo=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new uo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ya(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function ou(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}lo.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),A=c.latestFeatureIndex;if(E&&A&&f.id===E.layerIds[0]){var M=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),X=c.tileSize/v.EXTENT,oe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),ue=L.get("text-pitch-alignment")==="map",pe=L.get("text-rotation-alignment")==="map",Oe=ea(c,1,this.transform.zoom),Ie=Ba(oe,ue,pe,this.transform,Oe),ke=null;if(ue){var Ae=sa(oe,ue,pe,this.transform,Oe);ke=v.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[E.bucketInstanceId]=new Jo(E.bucketInstanceId,A,E.sourceLayerIndex,E.index,c.tileID);var je={bucket:E,layout:L,posMatrix:oe,textLabelPlaneMatrix:Ie,labelToScreenMatrix:ke,scale:U,textPixelRatio:X,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var Je=0,yt=E.sortKeyRanges;Je<yt.length;Je+=1){var Wt=yt[Je];l.push({sortKey:Wt.sortKey,symbolInstanceStart:Wt.symbolInstanceStart,symbolInstanceEnd:Wt.symbolInstanceEnd,parameters:je})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:je})}},lo.prototype.attemptAnchorPlacement=function(l,f,c,d,E,A,M,L,U,X,oe,ue,pe,Oe,Ie){var ke,Ae=[ue.textOffset0,ue.textOffset1],je=Co(l,c,d,Ae,E),Je=this.collisionIndex.placeCollisionBox(es(f,je.x,je.y,A,M,this.transform.angle),oe,L,U,X.predicate);if(!Ie||this.collisionIndex.placeCollisionBox(es(Ie,je.x,je.y,A,M,this.transform.angle),oe,L,U,X.predicate).box.length!==0)return Je.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),this.variableOffsets[ue.crossTileID]={textOffset:Ae,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:ke},this.markUsedJustification(pe,l,ue,Oe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Oe,ue),this.placedOrientations[ue.crossTileID]=Oe),{shift:je,placedGlyphBoxes:Je}):void 0},lo.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,A=E.bucket,M=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,X=E.labelToScreenMatrix,oe=E.textPixelRatio,ue=E.holdingForFade,pe=E.collisionBoxArray,Oe=E.partiallyEvaluatedTextSize,Ie=E.collisionGroup,ke=M.get("text-optional"),Ae=M.get("icon-optional"),je=M.get("text-allow-overlap"),Je=M.get("icon-allow-overlap"),yt=M.get("text-rotation-alignment")==="map",Wt=M.get("text-pitch-alignment")==="map",Vt=M.get("icon-text-fit")!=="none",Pt=M.get("symbol-z-order")==="viewport-y",pr=je&&(Je||!A.hasIconData()||Ae),Or=Je&&(je||!A.hasTextData()||ke);!A.collisionArrays&&pe&&A.deserializeCollisionBoxes(pe);var Dr=function(nn,ai){if(!f[nn.crossTileID])if(ue)d.placements[nn.crossTileID]=new ju(!1,!1,!1);else{var fi,ei=!1,Gn=!1,yi=!0,Kn=null,Hn={box:null,offscreen:null},Pa={box:null,offscreen:null},ro=null,no=null,Wo=0,Va=0,io=0;ai.textFeatureIndex?Wo=ai.textFeatureIndex:nn.useRuntimeCollisionCircles&&(Wo=nn.featureIndex),ai.verticalTextFeatureIndex&&(Va=ai.verticalTextFeatureIndex);var Rs=ai.textBox;if(Rs){var ys=function(Xi){var As=v.WritingMode.horizontal;if(A.allowVerticalPlacement&&!Xi&&d.prevPlacement){var Xo=d.prevPlacement.placedOrientations[nn.crossTileID];Xo&&(d.placedOrientations[nn.crossTileID]=Xo,d.markUsedOrientation(A,As=Xo,nn))}return As},Fu=function(Xi,As){if(A.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&ai.verticalTextBox)for(var Xo=0,Bu=A.writingModes;Xo<Bu.length&&(Bu[Xo]===v.WritingMode.vertical?(Hn=As(),Pa=Hn):Hn=Xi(),!(Hn&&Hn.box&&Hn.box.length));Xo+=1);else Hn=Xi()};if(M.get("text-variable-anchor")){var _s=M.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[nn.crossTileID]){var ka=d.prevPlacement.variableOffsets[nn.crossTileID];_s.indexOf(ka.anchor)>0&&(_s=_s.filter(function(Xi){return Xi!==ka.anchor})).unshift(ka.anchor)}var Ia=function(Xi,As,Xo){for(var Bu=Xi.x2-Xi.x1,sc=Xi.y2-Xi.y1,bl=nn.textBoxScale,Fl=Vt&&!Je?As:null,Vs={box:[],offscreen:!1},Bl=je?2*_s.length:_s.length,Gs=0;Gs<Bl;++Gs){var rl=d.attemptAnchorPlacement(_s[Gs%_s.length],Xi,Bu,sc,bl,yt,Wt,oe,L,Ie,Gs>=_s.length,nn,A,Xo,Fl);if(rl&&(Vs=rl.placedGlyphBoxes)&&Vs.box&&Vs.box.length){ei=!0,Kn=rl.shift;break}}return Vs};Fu(function(){return Ia(Rs,ai.iconBox,v.WritingMode.horizontal)},function(){var Xi=ai.verticalTextBox;return A.allowVerticalPlacement&&!(Hn&&Hn.box&&Hn.box.length)&&nn.numVerticalGlyphVertices>0&&Xi?Ia(Xi,ai.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Hn&&(ei=Hn.box,yi=Hn.offscreen);var el=ys(Hn&&Hn.box);if(!ei&&d.prevPlacement){var yl=d.prevPlacement.variableOffsets[nn.crossTileID];yl&&(d.variableOffsets[nn.crossTileID]=yl,d.markUsedJustification(A,yl.anchor,nn,el))}}else{var Ls=function(Xi,As){var Xo=d.collisionIndex.placeCollisionBox(Xi,je,oe,L,Ie.predicate);return Xo&&Xo.box&&Xo.box.length&&(d.markUsedOrientation(A,As,nn),d.placedOrientations[nn.crossTileID]=As),Xo};Fu(function(){return Ls(Rs,v.WritingMode.horizontal)},function(){var Xi=ai.verticalTextBox;return A.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&Xi?Ls(Xi,v.WritingMode.vertical):{box:null,offscreen:null}}),ys(Hn&&Hn.box&&Hn.box.length)}}if(ei=(fi=Hn)&&fi.box&&fi.box.length>0,yi=fi&&fi.offscreen,nn.useRuntimeCollisionCircles){var ac=A.text.placedSymbolArray.get(nn.centerJustifiedTextSymbolIndex),Fc=v.evaluateSizeForFeature(A.textSizeData,Oe,ac),Su=M.get("text-padding");ro=d.collisionIndex.placeCollisionCircles(je,ac,A.lineVertexArray,A.glyphOffsetArray,Fc,L,U,X,c,Wt,Ie.predicate,nn.collisionCircleDiameter,Su),ei=je||ro.circles.length>0&&!ro.collisionDetected,yi=yi&&ro.offscreen}if(ai.iconFeatureIndex&&(io=ai.iconFeatureIndex),ai.iconBox){var oc=function(Xi){var As=Vt&&Kn?es(Xi,Kn.x,Kn.y,yt,Wt,d.transform.angle):Xi;return d.collisionIndex.placeCollisionBox(As,Je,oe,L,Ie.predicate)};Gn=Pa&&Pa.box&&Pa.box.length&&ai.verticalIconBox?(no=oc(ai.verticalIconBox)).box.length>0:(no=oc(ai.iconBox)).box.length>0,yi=yi&&no.offscreen}var fu=ke||nn.numHorizontalGlyphVertices===0&&nn.numVerticalGlyphVertices===0,Oa=Ae||nn.numIconVertices===0;if(fu||Oa?Oa?fu||(Gn=Gn&&ei):ei=Gn&&ei:Gn=ei=Gn&&ei,ei&&fi&&fi.box&&d.collisionIndex.insertCollisionBox(fi.box,M.get("text-ignore-placement"),A.bucketInstanceId,Pa&&Pa.box&&Va?Va:Wo,Ie.ID),Gn&&no&&d.collisionIndex.insertCollisionBox(no.box,M.get("icon-ignore-placement"),A.bucketInstanceId,io,Ie.ID),ro&&(ei&&d.collisionIndex.insertCollisionCircles(ro.circles,M.get("text-ignore-placement"),A.bucketInstanceId,Wo,Ie.ID),c)){var tl=A.bucketInstanceId,_l=d.collisionCircleArrays[tl];_l===void 0&&(_l=d.collisionCircleArrays[tl]=new To);for(var xl=0;xl<ro.circles.length;xl+=4)_l.circles.push(ro.circles[xl+0]),_l.circles.push(ro.circles[xl+1]),_l.circles.push(ro.circles[xl+2]),_l.circles.push(ro.collisionDetected?1:0)}d.placements[nn.crossTileID]=new ju(ei||pr,Gn||Or,yi||A.justReloaded),f[nn.crossTileID]=!0}};if(Pt)for(var un=A.getSortedSymbolIndexes(this.transform.angle),Fn=un.length-1;Fn>=0;--Fn){var Nn=un[Fn];Dr(A.symbolInstances.get(Nn),A.collisionArrays[Nn])}else for(var Un=l.symbolInstanceStart;Un<l.symbolInstanceEnd;Un++)Dr(A.symbolInstances.get(Un),A.collisionArrays[Un]);if(c&&A.bucketInstanceId in this.collisionCircleArrays){var Di=this.collisionCircleArrays[A.bucketInstanceId];v.invert(Di.invProjMatrix,L),Di.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1},lo.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var A=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];A<M.length;A+=1){var L=M[A];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},lo.prototype.markUsedOrientation=function(l,f,c){for(var d=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,E=f===v.WritingMode.vertical?f:0,A=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];A<M.length;A+=1)l.text.placedSymbolArray.get(M[A]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},lo.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},A=f?f.variableOffsets:{},M=f?f.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],X=E[L];X?(this.opacities[L]=new Qo(X,d,U.text,U.icon),c=c||U.text!==X.text.placed||U.icon!==X.icon.placed):(this.opacities[L]=new Qo(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var oe in E){var ue=E[oe];if(!this.opacities[oe]){var pe=new Qo(ue,d,!1,!1);pe.isHidden()||(this.opacities[oe]=pe,c=c||ue.text.placed||ue.icon.placed)}}for(var Oe in A)this.variableOffsets[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.variableOffsets[Oe]=A[Oe]);for(var Ie in M)this.placedOrientations[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.placedOrientations[Ie]=M[Ie]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},lo.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var A=E[d],M=A.getBucket(l);M&&A.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,c,A.collisionBoxArray)}},lo.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,A=new Qo(null,0,!1,!1,!0),M=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),X=E.get("text-rotation-alignment")==="map",oe=E.get("text-pitch-alignment")==="map",ue=E.get("icon-text-fit")!=="none",pe=new Qo(null,0,M&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(M||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Oe=function(je,Je,yt){for(var Wt=0;Wt<Je/4;Wt++)je.opacityVertexArray.emplaceBack(yt)},Ie=function(je){var Je=l.symbolInstances.get(je),yt=Je.numHorizontalGlyphVertices,Wt=Je.numVerticalGlyphVertices,Vt=Je.crossTileID,Pt=d.opacities[Vt];f[Vt]?Pt=A:Pt||(d.opacities[Vt]=Pt=pe),f[Vt]=!0;var pr=Je.numIconVertices>0,Or=d.placedOrientations[Je.crossTileID],Dr=Or===v.WritingMode.vertical,un=Or===v.WritingMode.horizontal||Or===v.WritingMode.horizontalOnly;if(yt>0||Wt>0){var Fn=ot(Pt.text);Oe(l.text,yt,Dr?Tt:Fn),Oe(l.text,Wt,un?Tt:Fn);var Nn=Pt.text.isHidden();[Je.rightJustifiedTextSymbolIndex,Je.centerJustifiedTextSymbolIndex,Je.leftJustifiedTextSymbolIndex].forEach(function(Hn){Hn>=0&&(l.text.placedSymbolArray.get(Hn).hidden=Nn||Dr?1:0)}),Je.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Je.verticalPlacedTextSymbolIndex).hidden=Nn||un?1:0);var Un=d.variableOffsets[Je.crossTileID];Un&&d.markUsedJustification(l,Un.anchor,Je,Or);var Di=d.placedOrientations[Je.crossTileID];Di&&(d.markUsedJustification(l,"left",Je,Di),d.markUsedOrientation(l,Di,Je))}if(pr){var nn=ot(Pt.icon),ai=!(ue&&Je.verticalPlacedIconSymbolIndex&&Dr);Je.placedIconSymbolIndex>=0&&(Oe(l.icon,Je.numIconVertices,ai?nn:Tt),l.icon.placedSymbolArray.get(Je.placedIconSymbolIndex).hidden=Pt.icon.isHidden()),Je.verticalPlacedIconSymbolIndex>=0&&(Oe(l.icon,Je.numVerticalIconVertices,ai?Tt:nn),l.icon.placedSymbolArray.get(Je.verticalPlacedIconSymbolIndex).hidden=Pt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var fi=l.collisionArrays[je];if(fi){var ei=new v.Point(0,0);if(fi.textBox||fi.verticalTextBox){var Gn=!0;if(U){var yi=d.variableOffsets[Vt];yi?(ei=Co(yi.anchor,yi.width,yi.height,yi.textOffset,yi.textBoxScale),X&&ei._rotate(oe?d.transform.angle:-d.transform.angle)):Gn=!1}fi.textBox&&ou(l.textCollisionBox.collisionVertexArray,Pt.text.placed,!Gn||Dr,ei.x,ei.y),fi.verticalTextBox&&ou(l.textCollisionBox.collisionVertexArray,Pt.text.placed,!Gn||un,ei.x,ei.y)}var Kn=Boolean(!un&&fi.verticalIconBox);fi.iconBox&&ou(l.iconCollisionBox.collisionVertexArray,Pt.icon.placed,Kn,ue?ei.x:0,ue?ei.y:0),fi.verticalIconBox&&ou(l.iconCollisionBox.collisionVertexArray,Pt.icon.placed,!Kn,ue?ei.x:0,ue?ei.y:0)}}},ke=0;ke<l.symbolInstances.length;ke++)Ie(ke);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},lo.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},lo.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},lo.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},lo.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},lo.prototype.setStale=function(){this.stale=!0};var Cc=Math.pow(2,25),ks=Math.pow(2,24),$=Math.pow(2,17),be=Math.pow(2,16),Ke=Math.pow(2,9),Rt=Math.pow(2,8),Rr=Math.pow(2,1);function ot(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Cc+f*ks+c*$+f*be+c*Ke+f*Rt+c*Rr+f}var Tt=0,co=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};co.prototype.continuePlacement=function(l,f,c,d,E){for(var A=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(A,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(function(M,L){return M.sortKey-L.sortKey}));this._currentPartIndex<A.length;)if(f.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var ta=function(l,f,c,d,E,A,M){this.placement=new lo(l,E,A,M),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};ta.prototype.isDone=function(){return this._done},ta.prototype.continuePlacement=function(l,f,c){for(var d=this,E=v.browser.now(),A=function(){var U=v.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var M=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=L)&&(!M.maxzoom||M.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new co(M)),this._inProgressLayer.continuePlacement(c[M.source],this.placement,this._showCollisionBoxes,M,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},ta.prototype.commit=function(l){return this.placement.commit(l),this.placement};var qa=512/v.EXTENT/2,ts=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),A=E.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};ts.prototype.getScaledCoordinates=function(l,f){var c=qa/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},ts.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var A=l.get(E);if(!A.crossTileID){var M=this.indexedSymbolInstances[A.key];if(M)for(var L=this.getScaledCoordinates(A,f),U=0,X=M;U<X.length;U+=1){var oe=X[U];if(Math.abs(oe.coord.x-L.x)<=d&&Math.abs(oe.coord.y-L.y)<=d&&!c[oe.crossTileID]){c[oe.crossTileID]=!0,A.crossTileID=oe.crossTileID;break}}}}};var sn=function(){this.maxCrossTileID=0};sn.prototype.generate=function(){return++this.maxCrossTileID};var en=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};en.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var A in d){var M=d[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+f),E[M.tileID.key]=M}this.indexes[c]=E}this.lng=l},en.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var A in this.indexes){var M=this.indexes[A];if(Number(A)>l.overscaledZ)for(var L in M){var U=M[L];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,E)}else{var X=M[l.scaledTo(Number(A)).key];X&&X.findMatches(f.symbolInstances,l,E)}}for(var oe=0;oe<f.symbolInstances.length;oe++){var ue=f.symbolInstances.get(oe);ue.crossTileID||(ue.crossTileID=c.generate(),E[ue.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new ts(l,f.symbolInstances,f.bucketInstanceId),!0},en.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},en.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var Nt=function(){this.layerIndexes={},this.crossTileIDs=new sn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Nt.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new en);var E=!1,A={};d.handleWrapJump(c);for(var M=0,L=f;M<L.length;M+=1){var U=L[M],X=U.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,X,this.crossTileIDs)&&(E=!0),A[X.bucketInstanceId]=!0)}return d.removeStaleBuckets(A)&&(E=!0),E},Nt.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var Vo=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},de=v.pick(Xr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ks=v.pick(Xr,["setCenter","setZoom","setBearing","setPitch"]),su=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var d,E=v.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),vs=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Kt(wt(),this),this.imageManager=new Ct,this.imageManager.setEventedParent(this),this.glyphManager=new $t(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new Nt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var A=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(M){A.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(L,U){if(v.triggerPluginCompletionEvent(L),U&&U.every(function(oe){return oe}))for(var X in A.sourceCaches)A.sourceCaches[X].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var L=E.sourceCaches[M.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var X in E._layers){var oe=E._layers[X];oe.source===U.id&&E._validateLayer(oe)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var A=typeof d.validate=="boolean"?d.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var M=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(M,function(L,U){E._request=null,L?E.fire(new v.ErrorEvent(L)):U&&E._load(U,A)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(su,!1)},f.prototype._load=function(c,d){if(!d||!Vo(this,v.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var A=Hr(this.stylesheet.layers);this._order=A.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var M=0,L=A;M<L.length;M+=1){var U=L[M];(U=v.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,A,M){var L,U,X,oe=v.browser.devicePixelRatio>1?"@2x":"",ue=v.getJSON(A.transformRequest(A.normalizeSpriteURL(E,oe,".json"),v.ResourceType.SpriteJSON),function(Ie,ke){ue=null,X||(X=Ie,L=ke,Oe())}),pe=v.getImage(A.transformRequest(A.normalizeSpriteURL(E,oe,".png"),v.ResourceType.SpriteImage),function(Ie,ke){pe=null,X||(X=Ie,U=ke,Oe())});function Oe(){if(X)M(X);else if(L&&U){var Ie=v.browser.getImageData(U),ke={};for(var Ae in L){var je=L[Ae],Je=je.width,yt=je.height,Wt=je.x,Vt=je.y,Pt=je.sdf,pr=je.pixelRatio,Or=je.stretchX,Dr=je.stretchY,un=je.content,Fn=new v.RGBAImage({width:Je,height:yt});v.RGBAImage.copy(Ie,Fn,{x:Wt,y:Vt},{x:0,y:0},{width:Je,height:yt}),ke[Ae]={data:Fn,pixelRatio:pr,sdf:Pt,stretchX:Or,stretchY:Dr,content:un}}M(null,ke)}}return{cancel:function(){ue&&(ue.cancel(),ue=null),pe&&(pe.cancel(),pe=null)}}}(c,this.map._requestManager,function(E,A){if(d._spriteRequest=null,E)d.fire(new v.ErrorEvent(E));else if(A)for(var M in A)d.imageManager.addImage(M,A[M]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var A=d.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(E)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+A.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,A=c;E<A.length;E+=1){var M=this._layers[A[E]];M.type!=="custom"&&d.push(M.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);for(var M in(E.length||A.length)&&this._updateWorkerLayers(E,A),this._updatedSources){var L=this._updatedSources[M];L==="reload"?this._reloadSource(M):L==="clear"&&this._clearSource(M)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var X={};for(var oe in this.sourceCaches){var ue=this.sourceCaches[oe];X[oe]=ue.used,ue.used=!1}for(var pe=0,Oe=this._order;pe<Oe.length;pe+=1){var Ie=this._layers[Oe[pe]];Ie.recalculate(c,this._availableImages),!Ie.isHidden(c.zoom)&&Ie.source&&(this.sourceCaches[Ie.source].used=!0)}for(var ke in X){var Ae=this.sourceCaches[ke];X[ke]!==Ae.used&&Ae.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ke}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),Vo(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Hr(c.layers);var E=function(M,L){if(!M)return[{command:Xr.setStyle,args:[L]}];var U=[];try{if(!v.deepEqual(M.version,L.version))return[{command:Xr.setStyle,args:[L]}];v.deepEqual(M.center,L.center)||U.push({command:Xr.setCenter,args:[L.center]}),v.deepEqual(M.zoom,L.zoom)||U.push({command:Xr.setZoom,args:[L.zoom]}),v.deepEqual(M.bearing,L.bearing)||U.push({command:Xr.setBearing,args:[L.bearing]}),v.deepEqual(M.pitch,L.pitch)||U.push({command:Xr.setPitch,args:[L.pitch]}),v.deepEqual(M.sprite,L.sprite)||U.push({command:Xr.setSprite,args:[L.sprite]}),v.deepEqual(M.glyphs,L.glyphs)||U.push({command:Xr.setGlyphs,args:[L.glyphs]}),v.deepEqual(M.transition,L.transition)||U.push({command:Xr.setTransition,args:[L.transition]}),v.deepEqual(M.light,L.light)||U.push({command:Xr.setLight,args:[L.light]});var X={},oe=[];(function(pe,Oe,Ie,ke){var Ae;for(Ae in Oe=Oe||{},pe=pe||{})pe.hasOwnProperty(Ae)&&(Oe.hasOwnProperty(Ae)||Jr(Ae,Ie,ke));for(Ae in Oe)Oe.hasOwnProperty(Ae)&&(pe.hasOwnProperty(Ae)?v.deepEqual(pe[Ae],Oe[Ae])||(pe[Ae].type==="geojson"&&Oe[Ae].type==="geojson"&&ra(pe,Oe,Ae)?Ie.push({command:Xr.setGeoJSONSourceData,args:[Ae,Oe[Ae].data]}):Ti(Ae,Oe,Ie,ke)):ii(Ae,Oe,Ie))})(M.sources,L.sources,oe,X);var ue=[];M.layers&&M.layers.forEach(function(pe){X[pe.source]?U.push({command:Xr.removeLayer,args:[pe.id]}):ue.push(pe)}),U=U.concat(oe),function(pe,Oe,Ie){Oe=Oe||[];var ke,Ae,je,Je,yt,Wt,Vt,Pt=(pe=pe||[]).map(Ri),pr=Oe.map(Ri),Or=pe.reduce(Ci,{}),Dr=Oe.reduce(Ci,{}),un=Pt.slice(),Fn=Object.create(null);for(ke=0,Ae=0;ke<Pt.length;ke++)Dr.hasOwnProperty(je=Pt[ke])?Ae++:(Ie.push({command:Xr.removeLayer,args:[je]}),un.splice(un.indexOf(je,Ae),1));for(ke=0,Ae=0;ke<pr.length;ke++)un[un.length-1-ke]!==(je=pr[pr.length-1-ke])&&(Or.hasOwnProperty(je)?(Ie.push({command:Xr.removeLayer,args:[je]}),un.splice(un.lastIndexOf(je,un.length-Ae),1)):Ae++,Ie.push({command:Xr.addLayer,args:[Dr[je],Wt=un[un.length-ke]]}),un.splice(un.length-ke,0,je),Fn[je]=!0);for(ke=0;ke<pr.length;ke++)if(Je=Or[je=pr[ke]],yt=Dr[je],!Fn[je]&&!v.deepEqual(Je,yt))if(v.deepEqual(Je.source,yt.source)&&v.deepEqual(Je["source-layer"],yt["source-layer"])&&v.deepEqual(Je.type,yt.type)){for(Vt in Ei(Je.layout,yt.layout,Ie,je,null,Xr.setLayoutProperty),Ei(Je.paint,yt.paint,Ie,je,null,Xr.setPaintProperty),v.deepEqual(Je.filter,yt.filter)||Ie.push({command:Xr.setFilter,args:[je,yt.filter]}),v.deepEqual(Je.minzoom,yt.minzoom)&&v.deepEqual(Je.maxzoom,yt.maxzoom)||Ie.push({command:Xr.setLayerZoomRange,args:[je,yt.minzoom,yt.maxzoom]}),Je)Je.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?Ei(Je[Vt],yt[Vt],Ie,je,Vt.slice(6),Xr.setPaintProperty):v.deepEqual(Je[Vt],yt[Vt])||Ie.push({command:Xr.setLayerProperty,args:[je,Vt,yt[Vt]]}));for(Vt in yt)yt.hasOwnProperty(Vt)&&!Je.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?Ei(Je[Vt],yt[Vt],Ie,je,Vt.slice(6),Xr.setPaintProperty):v.deepEqual(Je[Vt],yt[Vt])||Ie.push({command:Xr.setLayerProperty,args:[je,Vt,yt[Vt]]}))}else Ie.push({command:Xr.removeLayer,args:[je]}),Wt=un[un.lastIndexOf(je)+1],Ie.push({command:Xr.addLayer,args:[yt,Wt]})}(ue,L.layers,U)}catch(pe){console.warn("Unable to compute style diff:",pe),U=[{command:Xr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(M){return!(M.command in Ks)});if(E.length===0)return!1;var A=E.filter(function(M){return!(M.command in de)});if(A.length>0)throw new Error("Unimplemented: "+A.map(function(M){return M.command}).join(", ")+".");return E.forEach(function(M){M.command!=="setTransition"&&d[M.command].apply(d,M.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var A=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var M=this.sourceCaches[c]=new Fe(c,d,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:A.loaded(),source:M.serialize(),sourceId:c}}),M.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=c.id;if(this.getLayer(A))this.fire(new v.ErrorEvent(new Error('Layer with id "'+A+'" already exists on this map')));else{var M;if(c.type==="custom"){if(Vo(this,v.validateCustomStyleLayer(c)))return;M=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(A,c.source),c=v.clone$1(c),c=v.extend(c,{source:A})),this._validate(v.validateStyle.layer,"layers."+A,c,{arrayIndex:-1},E))return;M=v.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[M.id]=M.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,A),this._layerOrderChanged=!0,this._layers[A]=M,this._removedLayers[A]&&M.source&&M.type!=="custom"){var U=this._removedLayers[A];delete this._removedLayers[A],U.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var A=d?this._order.indexOf(d):this._order.length;d&&A===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(A,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var A=this.getLayer(c);A?A.minzoom===d&&A.maxzoom===E||(d!=null&&(A.minzoom=d),E!=null&&(A.maxzoom=E),this._updateLayer(A)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=this.getLayer(c);if(A){if(!v.deepEqual(A.filter,d))return d==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(v.validateStyle.filter,"layers."+A.id+".filter",d,null,E)||(A.filter=v.clone$1(d),this._updateLayer(A)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var M=this.getLayer(c);M?v.deepEqual(M.getLayoutProperty(d),E)||(M.setLayoutProperty(d,E,A),this._updateLayer(M)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var M=this.getLayer(c);M?v.deepEqual(M.getPaintProperty(d),E)||(M.setPaintProperty(d,E,A)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=c.sourceLayer,M=this.sourceCaches[E];if(M!==void 0){var L=M.getSource().type;L==="geojson"&&A?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||A?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(A,c.id,d)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=this.sourceCaches[E];if(A!==void 0){var M=A.getSource().type,L=M==="vector"?c.sourceLayer:void 0;M!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(L,c.id,d):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,A=this.sourceCaches[d];if(A!==void 0){if(A.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),A.getFeatureState(E,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Or){return d._layers[Or].type==="fill-extrusion"},A={},M=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){A[U]=L;for(var X=0,oe=c;X<oe.length;X+=1){var ue=oe[X][U];if(ue)for(var pe=0,Oe=ue;pe<Oe.length;pe+=1)M.push(Oe[pe])}}}M.sort(function(Or,Dr){return Dr.intersectionZ-Or.intersectionZ});for(var Ie=[],ke=this._order.length-1;ke>=0;ke--){var Ae=this._order[ke];if(E(Ae))for(var je=M.length-1;je>=0;je--){var Je=M[je].feature;if(A[Je.layer.id]<ke)break;Ie.push(Je),M.pop()}else for(var yt=0,Wt=c;yt<Wt.length;yt+=1){var Vt=Wt[yt][Ae];if(Vt)for(var Pt=0,pr=Vt;Pt<pr.length;Pt+=1)Ie.push(pr[Pt].feature)}}return Ie},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var A={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,L=d.layers;M<L.length;M+=1){var U=L[M],X=this._layers[U];if(!X)return this.fire(new v.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];A[X.source]=!0}}var oe=[];for(var ue in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!A[ue]||oe.push(vn(this.sourceCaches[ue],this._layers,this._serializedLayers,c,d,E));return this.placement&&oe.push(function(pe,Oe,Ie,ke,Ae,je,Je){for(var yt={},Wt=je.queryRenderedSymbols(ke),Vt=[],Pt=0,pr=Object.keys(Wt).map(Number);Pt<pr.length;Pt+=1)Vt.push(Je[pr[Pt]]);Vt.sort(Qi);for(var Or=function(){var Un=un[Dr],Di=Un.featureIndex.lookupSymbolFeatures(Wt[Un.bucketInstanceId],Oe,Un.bucketIndex,Un.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,pe);for(var nn in Di){var ai=yt[nn]=yt[nn]||[],fi=Di[nn];fi.sort(function(yi,Kn){var Hn=Un.featureSortOrder;if(Hn){var Pa=Hn.indexOf(yi.featureIndex);return Hn.indexOf(Kn.featureIndex)-Pa}return Kn.featureIndex-yi.featureIndex});for(var ei=0,Gn=fi;ei<Gn.length;ei+=1)ai.push(Gn[ei])}},Dr=0,un=Vt;Dr<un.length;Dr+=1)Or();var Fn=function(Un){yt[Un].forEach(function(Di){var nn=Di.feature,ai=Ie[pe[Un].source].getFeatureState(nn.layer["source-layer"],nn.id);nn.source=nn.layer.source,nn.layer["source-layer"]&&(nn.sourceLayer=nn.layer["source-layer"]),nn.state=ai})};for(var Nn in yt)Fn(Nn);return yt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(A,M){for(var L=A.getRenderableIds().map(function(Oe){return A.getTileByID(Oe)}),U=[],X={},oe=0;oe<L.length;oe++){var ue=L[oe],pe=ue.tileID.canonical.key;X[pe]||(X[pe]=!0,ue.querySourceFeatures(U,M))}return U}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),A=!1;for(var M in c)if(!v.deepEqual(c[M],E[M])){A=!0;break}if(A){var L={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},f.prototype._validate=function(c,d,E,A,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&Vo(this,c.call(v.validateStyle,v.extend({key:d,style:this.serialize(),value:E,styleSpec:v.styleSpec},A)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,A,M){M===void 0&&(M=!1);for(var L=!1,U=!1,X={},oe=0,ue=this._order;oe<ue.length;oe+=1){var pe=this._layers[ue[oe]];if(pe.type==="symbol"){if(!X[pe.source]){var Oe=this.sourceCaches[pe.source];X[pe.source]=Oe.getRenderableIds(!0).map(function(Je){return Oe.getTileByID(Je)}).sort(function(Je,yt){return yt.tileID.overscaledZ-Je.tileID.overscaledZ||(Je.tileID.isLessThan(yt.tileID)?-1:1)})}var Ie=this.crossTileSymbolIndex.addLayer(pe,X[pe.source],c.center.lng);L=L||Ie}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new ta(c,this._order,M,d,E,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var ke=0,Ae=this._order;ke<Ae.length;ke+=1){var je=this._layers[Ae[ke]];je.type==="symbol"&&this.placement.updateLayerOpacities(je,X[je.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var A=this.sourceCaches[d.source];A&&A.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return v.makeRequest(d,E)},f}(v.Evented);vs.getSourceType=function(l){return Cr[l]},vs.setSourceType=function(l,f){Cr[l]=f},vs.registerForPluginStateChange=v.registerForPluginStateChange;var ua=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ao=Wi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ql=Wi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ac=Wi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Vu=Wi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),wc=Wi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Tl=Wi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Gu=Wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),uu=Wi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Hu=Wi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Wi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Wi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Wi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),q=Wi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),xe=Wi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),We=Wi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ct=Wi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ht=Wi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cr=Wi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),xr=Wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),In=Wi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ci=Wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Qn=Wi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),qi=Wi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fa=Wi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),La=Wi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Wi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=A?A.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,X,oe,ue,pe){return L[pe]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
varying `+oe+" "+ue+" "+pe+`;
#else
uniform `+oe+" "+ue+" u_"+pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+ue+" "+pe+" = u_"+pe+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,X,oe,ue,pe){var Oe=ue==="float"?"vec2":"vec4",Ie=pe.match(/color/)?"color":Oe;return L[pe]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+oe+" "+Oe+" a_"+pe+`;
varying `+oe+" "+ue+" "+pe+`;
#else
uniform `+oe+" "+ue+" u_"+pe+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = a_"+pe+`;
#else
    `+oe+" "+ue+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = unpack_mix_"+Ie+"(a_"+pe+", u_"+pe+`_t);
#else
    `+oe+" "+ue+" "+pe+" = u_"+pe+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+oe+" "+Oe+" a_"+pe+`;
#else
uniform `+oe+" "+ue+" u_"+pe+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+ue+" "+pe+" = a_"+pe+`;
#else
    `+oe+" "+ue+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+ue+" "+pe+" = unpack_mix_"+Ie+"(a_"+pe+", u_"+pe+`_t);
#else
    `+oe+" "+ue+" "+pe+" = u_"+pe+`;
#endif
`}),staticAttributes:d,staticUniforms:M}}var Fo=Object.freeze({__proto__:null,prelude:Ao,background:ql,backgroundPattern:Ac,circle:Vu,clippingMask:wc,heatmap:Tl,heatmapTexture:Gu,collisionBox:uu,collisionCircle:Hu,debug:_,fill:T,fillOutline:F,fillOutlinePattern:O,fillPattern:q,fillExtrusion:xe,fillExtrusionPattern:We,hillshadePrepare:ct,hillshade:ht,line:cr,lineGradient:xr,linePattern:In,lineSDF:ci,raster:Qn,symbolIcon:qi,symbolSDF:fa,symbolTextAndIcon:La}),Cs=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function cl(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}Cs.prototype.bind=function(l,f,c,d,E,A,M,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,X=0;!U&&X<d.length;X++)this.boundPaintVertexBuffers[X]!==d[X]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(f,c,d,E,A,M,L)},Cs.prototype.freshBind=function(l,f,c,d,E,A,M){var L,U=l.numAttributes,X=this.context,oe=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=M;else{L=X.currentNumAttributes||0;for(var ue=U;ue<L;ue++)oe.disableVertexAttribArray(ue)}f.enableAttributes(oe,l);for(var pe=0,Oe=c;pe<Oe.length;pe+=1)Oe[pe].enableAttributes(oe,l);A&&A.enableAttributes(oe,l),M&&M.enableAttributes(oe,l),f.bind(),f.setVertexAttribPointers(oe,l,E);for(var Ie=0,ke=c;Ie<ke.length;Ie+=1){var Ae=ke[Ie];Ae.bind(),Ae.setVertexAttribPointers(oe,l,E)}A&&(A.bind(),A.setVertexAttribPointers(oe,l,E)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(oe,l,E)),X.currentNumAttributes=U},Cs.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var qc=function(l,f,c,d,E,A){var M=l.gl;this.program=M.createProgram();for(var L=cl(c.staticAttributes),U=d?d.getBinderAttributes():[],X=L.concat(U),oe=c.staticUniforms?cl(c.staticUniforms):[],ue=d?d.getBinderUniforms():[],pe=[],Oe=0,Ie=oe.concat(ue);Oe<Ie.length;Oe+=1){var ke=Ie[Oe];pe.indexOf(ke)<0&&pe.push(ke)}var Ae=d?d.defines():[];A&&Ae.push("#define OVERDRAW_INSPECTOR;");var je=Ae.concat(Ao.fragmentSource,c.fragmentSource).join(`
`),Je=Ae.concat(Ao.vertexSource,c.vertexSource).join(`
`),yt=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(yt,je),M.compileShader(yt),M.attachShader(this.program,yt);var Wt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Wt,Je),M.compileShader(Wt),M.attachShader(this.program,Wt),this.attributes={};var Vt={};this.numAttributes=X.length;for(var Pt=0;Pt<this.numAttributes;Pt++)X[Pt]&&(M.bindAttribLocation(this.program,Pt,X[Pt]),this.attributes[X[Pt]]=Pt);M.linkProgram(this.program),M.deleteShader(Wt),M.deleteShader(yt);for(var pr=0;pr<pe.length;pr++){var Or=pe[pr];if(Or&&!Vt[Or]){var Dr=M.getUniformLocation(this.program,Or);Dr&&(Vt[Or]=Dr)}}this.fixedUniforms=E(l,Vt),this.binderUniforms=d?d.getUniforms(l,Vt):[]}}};function Wu(l,f,c){var d=1/ea(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),A=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,M=A*(c.tileID.canonical.x+c.tileID.wrap*E),L=A*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[M>>16,L>>16],u_pixel_coord_lower:[65535&M,65535&L]}}qc.prototype.draw=function(l,f,c,d,E,A,M,L,U,X,oe,ue,pe,Oe,Ie,ke){var Ae,je=l.gl;if(!this.failedToCreate){for(var Je in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(A),this.fixedUniforms)this.fixedUniforms[Je].set(M[Je]);Oe&&Oe.setUniforms(l,this.binderUniforms,ue,{zoom:pe});for(var yt=(Ae={},Ae[je.LINES]=2,Ae[je.TRIANGLES]=3,Ae[je.LINE_STRIP]=1,Ae)[f],Wt=0,Vt=oe.get();Wt<Vt.length;Wt+=1){var Pt=Vt[Wt],pr=Pt.vaos||(Pt.vaos={});(pr[L]||(pr[L]=new Cs)).bind(l,this,U,Oe?Oe.getPaintVertexBuffers():[],X,Pt.vertexOffset,Ie,ke),je.drawElements(f,Pt.primitiveLength*yt,je.UNSIGNED_SHORT,Pt.primitiveOffset*yt*2)}}};var Tc=function(l,f,c,d){var E=f.style.light,A=E.properties.get("position"),M=[A.x,A.y,A.z],L=v.create$1();E.properties.get("anchor")==="viewport"&&v.fromRotation(L,-f.transform.angle),v.transformMat3(M,M,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:M,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Iu=function(l,f,c,d,E,A,M){return v.extend(Tc(l,f,c,d),Wu(A,f,M),{u_height_factor:-Math.pow(2,E.overscaledZ)/M.tileSize/8})},mu=function(l){return{u_matrix:l}},Mo=function(l,f,c,d){return v.extend(mu(l),Wu(c,f,d))},pa=function(l,f){return{u_matrix:l,u_world:f}},up=function(l,f,c,d,E){return v.extend(Mo(l,f,c,d),{u_world:E})},lp=function(l,f,c,d){var E,A,M=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=ea(c,1,M.zoom);E=!0,A=[L,L]}else E=!1,A=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:A}},go=function(l,f,c){var d=ea(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),A=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:A}},If=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},gu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Ds=function(l){return{u_matrix:l}},Mc=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:ea(f,1,c),u_intensity:d}},fl=function(l,f,c){var d=l.transform;return{u_matrix:Of(l,f,c),u_ratio:1/ea(f,1,d.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ea=function(l,f,c,d){return v.extend(fl(l,f,c),{u_image:0,u_image_height:d})},Ml=function(l,f,c,d){var E=l.transform,A=is(f,E);return{u_matrix:Of(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ea(f,1,E.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[A,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Kl=function(l,f,c,d,E){var A=l.lineAtlas,M=is(f,l.transform),L=c.layout.get("line-cap")==="round",U=A.getDash(d.from,L),X=A.getDash(d.to,L),oe=U.width*E.fromScale,ue=X.width*E.toScale;return v.extend(fl(l,f,c),{u_patternscale_a:[M/oe,-U.height/2],u_patternscale_b:[M/ue,-X.height/2],u_sdfgamma:A.width/(256*Math.min(oe,ue)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:X.y,u_mix:E.t})};function is(l,f){return 1/ea(l,1,f.tileZoom)}function Of(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var cp=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(M=E.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(A=E.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:fp(E.paint.get("raster-hue-rotate"))};var A,M};function fp(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Kc,pl=function(l,f,c,d,E,A,M,L,U,X){var oe=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:oe.width/oe.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:M,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:X,u_texture:0}},Go=function(l,f,c,d,E,A,M,L,U,X,oe){var ue=E.transform;return v.extend(pl(l,f,c,d,E,A,M,L,U,X),{u_gamma_scale:d?Math.cos(ue._pitch)*ue.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+oe})},Ou=function(l,f,c,d,E,A,M,L,U,X){return v.extend(Go(l,f,c,d,E,A,M,L,!0,U,!0),{u_texsize_icon:X,u_texture_icon:1})},Xu=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},Ho=function(l,f,c,d,E,A){return v.extend(function(M,L,U,X){var oe=U.imageManager.getPattern(M.from.toString()),ue=U.imageManager.getPattern(M.to.toString()),pe=U.imageManager.getPixelSize(),Oe=pe.width,Ie=pe.height,ke=Math.pow(2,X.tileID.overscaledZ),Ae=X.tileSize*Math.pow(2,U.transform.tileZoom)/ke,je=Ae*(X.tileID.canonical.x+X.tileID.wrap*ke),Je=Ae*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:ue.tl,u_pattern_br_b:ue.br,u_texsize:[Oe,Ie],u_mix:L.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:ue.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/ea(X,1,U.transform.tileZoom),u_pixel_coord_upper:[je>>16,Je>>16],u_pixel_coord_lower:[65535&je,65535&Je]}}(d,A,c,E),{u_matrix:l,u_opacity:f})},Pl={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Yu(l,f,c,d,E,A,M){for(var L=l.context,U=L.gl,X=l.useProgram("collisionBox"),oe=[],ue=0,pe=0,Oe=0;Oe<d.length;Oe++){var Ie=d[Oe],ke=f.getTile(Ie),Ae=ke.getBucket(c);if(Ae){var je=Ie.posMatrix;E[0]===0&&E[1]===0||(je=l.translatePosMatrix(Ie.posMatrix,ke,E,A));var Je=M?Ae.textCollisionBox:Ae.iconCollisionBox,yt=Ae.collisionCircleArray;if(yt.length>0){var Wt=v.create(),Vt=je;v.mul(Wt,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Wt,Wt,Ae.placementViewportMatrix),oe.push({circleArray:yt,circleOffset:pe,transform:Vt,invTransform:Wt}),pe=ue+=yt.length/4}Je&&X.draw(L,U.LINES,ge.disabled,Pe.disabled,l.colorModeForRenderPass(),rt.disabled,go(je,l.transform,ke),c.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,null,l.transform.zoom,null,null,Je.collisionVertexBuffer)}}if(M&&oe.length){var Pt=l.useProgram("collisionCircle"),pr=new v.StructArrayLayout2f1f2i16;pr.resize(4*ue),pr._trim();for(var Or=0,Dr=0,un=oe;Dr<un.length;Dr+=1)for(var Fn=un[Dr],Nn=0;Nn<Fn.circleArray.length/4;Nn++){var Un=4*Nn,Di=Fn.circleArray[Un+0],nn=Fn.circleArray[Un+1],ai=Fn.circleArray[Un+2],fi=Fn.circleArray[Un+3];pr.emplace(Or++,Di,nn,ai,fi,0),pr.emplace(Or++,Di,nn,ai,fi,1),pr.emplace(Or++,Di,nn,ai,fi,2),pr.emplace(Or++,Di,nn,ai,fi,3)}(!Kc||Kc.length<2*ue)&&(Kc=function(ro){var no=2*ro,Wo=new v.StructArrayLayout3ui6;Wo.resize(no),Wo._trim();for(var Va=0;Va<no;Va++){var io=6*Va;Wo.uint16[io+0]=4*Va+0,Wo.uint16[io+1]=4*Va+1,Wo.uint16[io+2]=4*Va+2,Wo.uint16[io+3]=4*Va+2,Wo.uint16[io+4]=4*Va+3,Wo.uint16[io+5]=4*Va+0}return Wo}(ue));for(var ei=L.createIndexBuffer(Kc,!0),Gn=L.createVertexBuffer(pr,v.collisionCircleLayout.members,!0),yi=0,Kn=oe;yi<Kn.length;yi+=1){var Hn=Kn[yi],Pa=If(Hn.transform,Hn.invTransform,l.transform);Pt.draw(L,U.TRIANGLES,ge.disabled,Pe.disabled,l.colorModeForRenderPass(),rt.disabled,Pa,c.id,Gn,ei,v.SegmentVector.simpleSegment(0,2*Hn.circleOffset,Hn.circleArray.length,Hn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Gn.destroy(),ei.destroy()}}var $s=v.identity(new Float32Array(16));function $c(l,f,c,d,E,A){var M=v.getAnchorAlignment(l),L=-(M.horizontalAlign-.5)*f,U=-(M.verticalAlign-.5)*c,X=v.evaluateVariableOffset(l,d);return new v.Point((L/E+X[0])*A,(U/E+X[1])*A)}function Qc(l,f,c,d,E,A,M,L,U,X,oe){var ue=l.text.placedSymbolArray,pe=l.text.dynamicLayoutVertexArray,Oe=l.icon.dynamicLayoutVertexArray,Ie={};pe.clear();for(var ke=0;ke<ue.length;ke++){var Ae=ue.get(ke),je=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:d[Ae.crossTileID];if(je){var Je=new v.Point(Ae.anchorX,Ae.anchorY),yt=Li(Je,c?L:M),Wt=Hi(A.cameraToCenterDistance,yt.signedDistanceFromCamera),Vt=E.evaluateSizeForFeature(l.textSizeData,X,Ae)*Wt/v.ONE_EM;c&&(Vt*=l.tilePixelRatio/U);for(var Pt=$c(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale,Vt),pr=c?Li(Je.add(Pt),M).point:yt.point.add(f?Pt.rotate(-A.angle):Pt),Or=l.allowVerticalPlacement&&Ae.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Dr=0;Dr<Ae.numGlyphs;Dr++)v.addDynamicAttributes(pe,pr,Or);oe&&Ae.associatedIconIndex>=0&&(Ie[Ae.associatedIconIndex]={shiftedAnchor:pr,angle:Or})}else So(Ae.numGlyphs,pe)}if(oe){Oe.clear();for(var un=l.icon.placedSymbolArray,Fn=0;Fn<un.length;Fn++){var Nn=un.get(Fn);if(Nn.hidden)So(Nn.numGlyphs,Oe);else{var Un=Ie[Fn];if(Un)for(var Di=0;Di<Nn.numGlyphs;Di++)v.addDynamicAttributes(Oe,Un.shiftedAnchor,Un.angle);else So(Nn.numGlyphs,Oe)}}l.icon.dynamicLayoutVertexBuffer.updateData(Oe)}l.text.dynamicLayoutVertexBuffer.updateData(pe)}function Jc(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function qu(l,f,c,d,E,A,M,L,U,X,oe,ue){for(var pe=l.context,Oe=pe.gl,Ie=l.transform,ke=L==="map",Ae=U==="map",je=ke&&c.layout.get("symbol-placement")!=="point",Je=ke&&!Ae&&!je,yt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Wt=!1,Vt=l.depthModeForSublayer(0,ge.ReadOnly),Pt=c.layout.get("text-variable-anchor"),pr=[],Or=0,Dr=d;Or<Dr.length;Or+=1){var un=Dr[Or],Fn=f.getTile(un),Nn=Fn.getBucket(c);if(Nn){var Un=E?Nn.text:Nn.icon;if(Un&&Un.segments.get().length){var Di=Un.programConfigurations.get(c.id),nn=E||Nn.sdfIcons,ai=E?Nn.textSizeData:Nn.iconSizeData,fi=Ae||Ie.pitch!==0,ei=l.useProgram(Jc(nn,E,Nn),Di),Gn=v.evaluateSizeForZoom(ai,Ie.zoom),yi=void 0,Kn=[0,0],Hn=void 0,Pa=void 0,ro=null,no=void 0;if(E)Hn=Fn.glyphAtlasTexture,Pa=Oe.LINEAR,yi=Fn.glyphAtlasTexture.size,Nn.iconsInText&&(Kn=Fn.imageAtlasTexture.size,ro=Fn.imageAtlasTexture,no=fi||l.options.rotating||l.options.zooming||ai.kind==="composite"||ai.kind==="camera"?Oe.LINEAR:Oe.NEAREST);else{var Wo=c.layout.get("icon-size").constantOr(0)!==1||Nn.iconsNeedLinear;Hn=Fn.imageAtlasTexture,Pa=nn||l.options.rotating||l.options.zooming||Wo||fi?Oe.LINEAR:Oe.NEAREST,yi=Fn.imageAtlasTexture.size}var Va=ea(Fn,1,l.transform.zoom),io=Ba(un.posMatrix,Ae,ke,l.transform,Va),Rs=sa(un.posMatrix,Ae,ke,l.transform,Va),ys=Pt&&Nn.hasTextData(),Fu=c.layout.get("icon-text-fit")!=="none"&&ys&&Nn.hasIconData();je&&au(Nn,un.posMatrix,l,E,io,Rs,Ae,X);var _s=l.translatePosMatrix(un.posMatrix,Fn,A,M),ka=je||E&&Pt||Fu?$s:io,Ia=l.translatePosMatrix(Rs,Fn,A,M,!0),el=nn&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,yl={program:ei,buffers:Un,uniformValues:nn?Nn.iconsInText?Ou(ai.kind,Gn,Je,Ae,l,_s,ka,Ia,yi,Kn):Go(ai.kind,Gn,Je,Ae,l,_s,ka,Ia,E,yi,!0):pl(ai.kind,Gn,Je,Ae,l,_s,ka,Ia,E,yi),atlasTexture:Hn,atlasTextureIcon:ro,atlasInterpolation:Pa,atlasInterpolationIcon:no,isSDF:nn,hasHalo:el};if(yt&&Nn.canOverlap){Wt=!0;for(var Ls=0,ac=Un.segments.get();Ls<ac.length;Ls+=1){var Fc=ac[Ls];pr.push({segments:new v.SegmentVector([Fc]),sortKey:Fc.sortKey,state:yl})}}else pr.push({segments:Un.segments,sortKey:0,state:yl})}}}Wt&&pr.sort(function(_l,xl){return _l.sortKey-xl.sortKey});for(var Su=0,oc=pr;Su<oc.length;Su+=1){var fu=oc[Su],Oa=fu.state;if(pe.activeTexture.set(Oe.TEXTURE0),Oa.atlasTexture.bind(Oa.atlasInterpolation,Oe.CLAMP_TO_EDGE),Oa.atlasTextureIcon&&(pe.activeTexture.set(Oe.TEXTURE1),Oa.atlasTextureIcon&&Oa.atlasTextureIcon.bind(Oa.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE)),Oa.isSDF){var tl=Oa.uniformValues;Oa.hasHalo&&(tl.u_is_halo=1,$l(Oa.buffers,fu.segments,c,l,Oa.program,Vt,oe,ue,tl)),tl.u_is_halo=0}$l(Oa.buffers,fu.segments,c,l,Oa.program,Vt,oe,ue,Oa.uniformValues)}}function $l(l,f,c,d,E,A,M,L,U){var X=d.context;E.draw(X,X.gl.TRIANGLES,A,M,L,rt.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Pc(l,f,c,d,E,A,M){var L,U,X,oe,ue,pe=l.context.gl,Oe=c.paint.get("fill-pattern"),Ie=Oe&&Oe.constantOr(1),ke=c.getCrossfadeParameters();M?(U=Ie&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=pe.LINES):(U=Ie?"fillPattern":"fill",L=pe.TRIANGLES);for(var Ae=0,je=d;Ae<je.length;Ae+=1){var Je=je[Ae],yt=f.getTile(Je);if(!Ie||yt.patternsLoaded()){var Wt=yt.getBucket(c);if(Wt){var Vt=Wt.programConfigurations.get(c.id),Pt=l.useProgram(U,Vt);Ie&&(l.context.activeTexture.set(pe.TEXTURE0),yt.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Vt.updatePaintBuffers(ke));var pr=Oe.constantOr(null);if(pr&&yt.imageAtlas){var Or=yt.imageAtlas,Dr=Or.patternPositions[pr.to.toString()],un=Or.patternPositions[pr.from.toString()];Dr&&un&&Vt.setConstantPatternPositions(Dr,un)}var Fn=l.translatePosMatrix(Je.posMatrix,yt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){oe=Wt.indexBuffer2,ue=Wt.segments2;var Nn=[pe.drawingBufferWidth,pe.drawingBufferHeight];X=U==="fillOutlinePattern"&&Ie?up(Fn,l,ke,yt,Nn):pa(Fn,Nn)}else oe=Wt.indexBuffer,ue=Wt.segments,X=Ie?Mo(Fn,l,ke,yt):mu(Fn);Pt.draw(l.context,L,E,l.stencilModeForClipping(Je),A,rt.disabled,X,c.id,Wt.layoutVertexBuffer,oe,ue,c.paint,l.transform.zoom,Vt)}}}}function ef(l,f,c,d,E,A,M){for(var L=l.context,U=L.gl,X=c.paint.get("fill-extrusion-pattern"),oe=X.constantOr(1),ue=c.getCrossfadeParameters(),pe=c.paint.get("fill-extrusion-opacity"),Oe=0,Ie=d;Oe<Ie.length;Oe+=1){var ke=Ie[Oe],Ae=f.getTile(ke),je=Ae.getBucket(c);if(je){var Je=je.programConfigurations.get(c.id),yt=l.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",Je);oe&&(l.context.activeTexture.set(U.TEXTURE0),Ae.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Je.updatePaintBuffers(ue));var Wt=X.constantOr(null);if(Wt&&Ae.imageAtlas){var Vt=Ae.imageAtlas,Pt=Vt.patternPositions[Wt.to.toString()],pr=Vt.patternPositions[Wt.from.toString()];Pt&&pr&&Je.setConstantPatternPositions(Pt,pr)}var Or=l.translatePosMatrix(ke.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Dr=c.paint.get("fill-extrusion-vertical-gradient"),un=oe?Iu(Or,l,Dr,pe,ke,ue,Ae):Tc(Or,l,Dr,pe);yt.draw(L,L.gl.TRIANGLES,E,A,M,rt.backCCW,un,c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,c.paint,l.transform.zoom,Je)}}}function Ic(l,f,c,d,E,A){var M=l.context,L=M.gl,U=f.fbo;if(U){var X=l.useProgram("hillshade");M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var oe=function(ue,pe,Oe){var Ie=Oe.paint.get("hillshade-shadow-color"),ke=Oe.paint.get("hillshade-highlight-color"),Ae=Oe.paint.get("hillshade-accent-color"),je=Oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Oe.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=ue.transform.angle);var Je,yt,Wt,Vt=!ue.options.moving;return{u_matrix:ue.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Vt),u_image:0,u_latrange:(Je=pe.tileID,yt=Math.pow(2,Je.canonical.z),Wt=Je.canonical.y,[new v.MercatorCoordinate(0,Wt/yt).toLngLat().lat,new v.MercatorCoordinate(0,(Wt+1)/yt).toLngLat().lat]),u_light:[Oe.paint.get("hillshade-exaggeration"),je],u_shadow:Ie,u_highlight:ke,u_accent:Ae}}(l,f,c);X.draw(M,L.TRIANGLES,d,E,A,rt.disabled,oe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function pp(l,f,c,d,E,A){var M=l.context,L=M.gl,U=f.dem;if(U&&U.data){var X=U.dim,oe=U.stride,ue=U.getPixels();if(M.activeTexture.set(L.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(oe),f.demTexture){var pe=f.demTexture;pe.update(ue,{premultiply:!1}),pe.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(M,ue,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);M.activeTexture.set(L.TEXTURE0);var Oe=f.fbo;if(!Oe){var Ie=new v.Texture(M,{width:X,height:X,data:null},L.RGBA);Ie.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Oe=f.fbo=M.createFramebuffer(X,X,!0)).colorAttachment.set(Ie.texture)}M.bindFramebuffer.set(Oe.framebuffer),M.viewport.set([0,0,X,X]),l.useProgram("hillshadePrepare").draw(M,L.TRIANGLES,d,E,A,rt.disabled,function(ke,Ae){var je=Ae.stride,Je=v.create();return v.ortho(Je,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Je,Je,[0,-v.EXTENT,0]),{u_matrix:Je,u_image:1,u_dimension:[je,je],u_zoom:ke.overscaledZ,u_unpack:Ae.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Oc(l,f,c,d,E){var A=d.paint.get("raster-fade-duration");if(A>0){var M=v.browser.now(),L=(M-l.timeAdded)/A,U=f?(M-f.timeAdded)/A:-1,X=c.getSource(),oe=E.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),ue=!f||Math.abs(f.tileID.overscaledZ-oe)>Math.abs(l.tileID.overscaledZ-oe),pe=ue&&l.refreshedUponExpiration?1:v.clamp(ue?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}var hl=new v.Color(1,0,0,1),tf=new v.Color(0,1,0,1),rf=new v.Color(0,0,1,1),Ru=new v.Color(1,0,1,1),nf=new v.Color(0,1,1,1);function Rf(l,f,c,d){Il(l,0,f+c/2,l.transform.width,c,d)}function hp(l,f,c,d){Il(l,f-c/2,0,c,l.transform.height,d)}function Il(l,f,c,d,E,A){var M=l.context,L=M.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,d*v.browser.devicePixelRatio,E*v.browser.devicePixelRatio),M.clear({color:A}),L.disable(L.SCISSOR_TEST)}function Kp(l,f,c){var d=l.context,E=d.gl,A=c.posMatrix,M=l.useProgram("debug"),L=ge.disabled,U=Pe.disabled,X=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M.draw(d,E.LINE_STRIP,L,U,X,rt.disabled,gu(A,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var oe=f.getTileByID(c.key).latestRawTileData,ue=Math.floor((oe&&oe.byteLength||0)/1024),pe=f.getTile(c).tileSize,Oe=512/Math.min(pe,512)*(c.overscaledZ/l.transform.zoom)*.5,Ie=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ie+=" => "+c.overscaledZ),function(ke,Ae){ke.initDebugOverlayCanvas();var je=ke.debugOverlayCanvas,Je=ke.context.gl,yt=ke.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,je.width,je.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(Ae,5,5),yt.strokeText(Ae,5,5),ke.debugOverlayTexture.update(je),ke.debugOverlayTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)}(l,Ie+" "+ue+"kb"),M.draw(d,E.TRIANGLES,L,U,Ge.alphaBlended,rt.disabled,gu(A,v.Color.transparent,Oe),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var as={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var A=Pe.disabled,M=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,X,oe,ue,pe,Oe){for(var Ie=U.transform,ke=ue==="map",Ae=pe==="map",je=0,Je=L;je<Je.length;je+=1){var yt=Je[je],Wt=oe.getTile(yt),Vt=Wt.getBucket(X);if(Vt&&Vt.text&&Vt.text.segments.get().length){var Pt=v.evaluateSizeForZoom(Vt.textSizeData,Ie.zoom),pr=ea(Wt,1,U.transform.zoom),Or=Ba(yt.posMatrix,Ae,ke,U.transform,pr),Dr=X.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(Pt){var un=Math.pow(2,Ie.zoom-Wt.tileID.overscaledZ);Qc(Vt,ke,Ae,Oe,v.symbolSize,Ie,Or,yt.posMatrix,un,Pt,Dr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&qu(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),A,M),c.paint.get("text-opacity").constantOr(1)!==0&&qu(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),A,M),f.map.showCollisionBoxes&&(Yu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Yu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),A=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||A.constantOr(1)!==0&&M.constantOr(1)!==0){for(var U=l.context,X=U.gl,oe=l.depthModeForSublayer(0,ge.ReadOnly),ue=Pe.disabled,pe=l.colorModeForRenderPass(),Oe=[],Ie=0;Ie<d.length;Ie++){var ke=d[Ie],Ae=f.getTile(ke),je=Ae.getBucket(c);if(je){var Je=je.programConfigurations.get(c.id),yt={programConfiguration:Je,program:l.useProgram("circle",Je),layoutVertexBuffer:je.layoutVertexBuffer,indexBuffer:je.indexBuffer,uniformValues:lp(l,ke,Ae,c)};if(L)for(var Wt=0,Vt=je.segments.get();Wt<Vt.length;Wt+=1){var Pt=Vt[Wt];Oe.push({segments:new v.SegmentVector([Pt]),sortKey:Pt.sortKey,state:yt})}else Oe.push({segments:je.segments,sortKey:0,state:yt})}}L&&Oe.sort(function(Fn,Nn){return Fn.sortKey-Nn.sortKey});for(var pr=0,Or=Oe;pr<Or.length;pr+=1){var Dr=Or[pr],un=Dr.state;un.program.draw(U,X.TRIANGLES,oe,ue,pe,rt.disabled,un.uniformValues,c.id,un.layoutVertexBuffer,un.indexBuffer,Dr.segments,c.paint,l.transform.zoom,un.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,A=E.gl,M=Pe.disabled,L=new Ge([A.ONE,A.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Oe,Ie,ke){var Ae=Oe.gl;Oe.activeTexture.set(Ae.TEXTURE1),Oe.viewport.set([0,0,Ie.width/4,Ie.height/4]);var je=ke.heatmapFbo;if(je)Ae.bindTexture(Ae.TEXTURE_2D,je.colorAttachment.get()),Oe.bindFramebuffer.set(je.framebuffer);else{var Je=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,Je),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),je=ke.heatmapFbo=Oe.createFramebuffer(Ie.width/4,Ie.height/4,!1),function(yt,Wt,Vt,Pt){var pr=yt.gl;pr.texImage2D(pr.TEXTURE_2D,0,pr.RGBA,Wt.width/4,Wt.height/4,0,pr.RGBA,yt.extRenderToTextureHalfFloat?yt.extTextureHalfFloat.HALF_FLOAT_OES:pr.UNSIGNED_BYTE,null),Pt.colorAttachment.set(Vt)}(Oe,Ie,Je,je)}})(E,l,c),E.clear({color:v.Color.transparent});for(var U=0;U<d.length;U++){var X=d[U];if(!f.hasRenderableParent(X)){var oe=f.getTile(X),ue=oe.getBucket(c);if(ue){var pe=ue.programConfigurations.get(c.id);l.useProgram("heatmap",pe).draw(E,A.TRIANGLES,ge.disabled,M,L,rt.disabled,Mc(X.posMatrix,oe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,c.paint,l.transform.zoom,pe)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Oe,Ie){var ke=Oe.context,Ae=ke.gl,je=Ie.heatmapFbo;if(je){ke.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,je.colorAttachment.get()),ke.activeTexture.set(Ae.TEXTURE1);var Je=Ie.colorRampTexture;Je||(Je=Ie.colorRampTexture=new v.Texture(ke,Ie.colorRamp,Ae.RGBA)),Je.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Oe.useProgram("heatmapTexture").draw(ke,Ae.TRIANGLES,ge.disabled,Pe.disabled,Oe.colorModeForRenderPass(),rt.disabled,function(yt,Wt,Vt,Pt){var pr=v.create();v.ortho(pr,0,yt.width,yt.height,0,0,1);var Or=yt.context.gl;return{u_matrix:pr,u_world:[Or.drawingBufferWidth,Or.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Wt.paint.get("heatmap-opacity")}}(Oe,Ie),Ie.id,Oe.viewportBuffer,Oe.quadTriangleIndexBuffer,Oe.viewportSegments,Ie.paint,Oe.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),A=c.paint.get("line-width");if(E.constantOr(1)!==0&&A.constantOr(1)!==0)for(var M=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),X=c.paint.get("line-pattern"),oe=X.constantOr(1),ue=c.paint.get("line-gradient"),pe=c.getCrossfadeParameters(),Oe=oe?"linePattern":U?"lineSDF":ue?"lineGradient":"line",Ie=l.context,ke=Ie.gl,Ae=!0,je=0,Je=d;je<Je.length;je+=1){var yt=Je[je],Wt=f.getTile(yt);if(!oe||Wt.patternsLoaded()){var Vt=Wt.getBucket(c);if(Vt){var Pt=Vt.programConfigurations.get(c.id),pr=l.context.program.get(),Or=l.useProgram(Oe,Pt),Dr=Ae||Or.program!==pr,un=X.constantOr(null);if(un&&Wt.imageAtlas){var Fn=Wt.imageAtlas,Nn=Fn.patternPositions[un.to.toString()],Un=Fn.patternPositions[un.from.toString()];Nn&&Un&&Pt.setConstantPatternPositions(Nn,Un)}var Di=oe?Ml(l,Wt,c,pe):U?Kl(l,Wt,c,U,pe):ue?Ea(l,Wt,c,Vt.lineClipsArray.length):fl(l,Wt,c);if(oe)Ie.activeTexture.set(ke.TEXTURE0),Wt.imageAtlasTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),Pt.updatePaintBuffers(pe);else if(U&&(Dr||l.lineAtlas.dirty))Ie.activeTexture.set(ke.TEXTURE0),l.lineAtlas.bind(Ie);else if(ue){var nn=Vt.gradients[c.id],ai=nn.texture;if(c.gradientVersion!==nn.version){var fi=256;if(c.stepInterpolant){var ei=f.getSource().maxzoom,Gn=yt.canonical.z===ei?Math.ceil(1<<l.transform.maxZoom-yt.canonical.z):1;fi=v.clamp(v.nextPowerOfTwo(Vt.maxLineLength/v.EXTENT*1024*Gn),256,Ie.maxTextureSize)}nn.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:nn.gradient||void 0,clips:Vt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new v.Texture(Ie,nn.gradient,ke.RGBA),nn.version=c.gradientVersion,ai=nn.texture}Ie.activeTexture.set(ke.TEXTURE0),ai.bind(c.stepInterpolant?ke.NEAREST:ke.LINEAR,ke.CLAMP_TO_EDGE)}Or.draw(Ie,ke.TRIANGLES,M,l.stencilModeForClipping(yt),L,rt.disabled,Di,c.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,c.paint,l.transform.zoom,Pt,Vt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),A=c.paint.get("fill-opacity");if(A.constantOr(1)!==0){var M=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(v.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var X=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Pc(l,f,c,d,X,M,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var oe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Pc(l,f,c,d,oe,M,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var A=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))ef(l,f,c,d,A,Pe.disabled,Ge.disabled),ef(l,f,c,d,A,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var M=l.colorModeForRenderPass();ef(l,f,c,d,A,Pe.disabled,M)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,A=l.depthModeForSublayer(0,ge.ReadOnly),M=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],X=0,oe=L[1];X<oe.length;X+=1){var ue=oe[X],pe=f.getTile(ue);pe.needsHillshadePrepare&&l.renderPass==="offscreen"?pp(l,pe,c,A,Pe.disabled,M):l.renderPass==="translucent"&&Ic(l,pe,c,A,U[ue.overscaledZ],M)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,A=E.gl,M=f.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),X=M instanceof vt?[{},d]:l.stencilConfigForOverlap(d),oe=X[0],ue=X[1],pe=ue[ue.length-1].overscaledZ,Oe=!l.options.moving,Ie=0,ke=ue;Ie<ke.length;Ie+=1){var Ae=ke[Ie],je=l.depthModeForSublayer(Ae.overscaledZ-pe,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,A.LESS),Je=f.getTile(Ae),yt=l.transform.calculatePosMatrix(Ae.toUnwrapped(),Oe);Je.registerFadeDuration(c.paint.get("raster-fade-duration"));var Wt=f.findLoadedParent(Ae,0),Vt=Oc(Je,Wt,f,c,l.transform),Pt=void 0,pr=void 0,Or=c.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;E.activeTexture.set(A.TEXTURE0),Je.texture.bind(Or,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(A.TEXTURE1),Wt?(Wt.texture.bind(Or,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Pt=Math.pow(2,Wt.tileID.overscaledZ-Je.tileID.overscaledZ),pr=[Je.tileID.canonical.x*Pt%1,Je.tileID.canonical.y*Pt%1]):Je.texture.bind(Or,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);var Dr=cp(yt,pr||[0,0],Pt||1,Vt,c);M instanceof vt?L.draw(E,A.TRIANGLES,je,Pe.disabled,U,rt.disabled,Dr,c.id,M.boundsBuffer,l.quadTriangleIndexBuffer,M.boundsSegments):L.draw(E,A.TRIANGLES,je,oe[Ae.overscaledZ],U,rt.disabled,Dr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var A=l.context,M=A.gl,L=l.transform,U=L.tileSize,X=c.paint.get("background-pattern");if(!l.isPatternMissing(X)){var oe=!X&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===oe){var ue=Pe.disabled,pe=l.depthModeForSublayer(0,oe==="opaque"?ge.ReadWrite:ge.ReadOnly),Oe=l.colorModeForRenderPass(),Ie=l.useProgram(X?"backgroundPattern":"background"),ke=L.coveringTiles({tileSize:U});X&&(A.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),je=0,Je=ke;je<Je.length;je+=1){var yt=Je[je],Wt=l.transform.calculatePosMatrix(yt.toUnwrapped()),Vt=X?Ho(Wt,E,l,X,{tileID:yt,tileSize:U},Ae):Xu(Wt,E,d);Ie.draw(A,M.TRIANGLES,pe,ue,Oe,rt.disabled,Vt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Kp(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var A=E.prerender;A&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),A.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Pe.disabled);var M=E.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);d.setDepthMode(M),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ka=function(l,f){this.context=new fe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Fe.maxUnderzooming+Fe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Nt,this.gpuTimers={}};Ka.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Ka.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,ua.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ua.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var d=new v.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(v.EXTENT,0,v.EXTENT,0),d.emplaceBack(0,v.EXTENT,0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,St.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var E=new v.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ua.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var A=new v.StructArrayLayout1ui2;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(A);var M=new v.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Pe({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Ka.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ge.disabled,this.stencilClearMode,Ge.disabled,rt.disabled,Ds(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ka.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(ge.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var A=0,M=f;A<M.length;A+=1){var L=M[A],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ge.disabled,new Pe({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,rt.disabled,Ds(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ka.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Pe({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Ka.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Pe({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Ka.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(U,X){return X.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,A=d[0].overscaledZ-E+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();for(var M={},L=0;L<A;L++)M[L+E]=new Pe({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=A,[M,d]}return[(f={},f[E]=Pe.disabled,f),d]},Ka.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},Ka.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,f,[d,d])},Ka.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ka.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var A in E){var M=E[A];M.used&&M.prepare(this.context)}var L,U,X={},oe={},ue={};for(var pe in E){var Oe=E[pe];X[pe]=Oe.getVisibleCoordinates(),oe[pe]=X[pe].slice().reverse(),ue[pe]=Oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ie=0;Ie<d.length;Ie++)if(this.style._layers[d[Ie]].is3D()){this.opaquePassCutoff=Ie;break}this.renderPass="offscreen";for(var ke=0,Ae=d;ke<Ae.length;ke+=1){var je=this.style._layers[Ae[ke]];if(je.hasOffscreenPass()&&!je.isHidden(this.transform.zoom)){var Je=oe[je.source];(je.type==="custom"||Je.length)&&this.renderLayer(this,E[je.source],je,Je)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var yt=this.style._layers[d[this.currentLayer]],Wt=E[yt.source],Vt=X[yt.source];this._renderTileClippingMasks(yt,Vt),this.renderLayer(this,Wt,yt,Vt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Pt=this.style._layers[d[this.currentLayer]],pr=E[Pt.source],Or=(Pt.type==="symbol"?ue:oe)[Pt.source];this._renderTileClippingMasks(Pt,X[Pt.source]),this.renderLayer(this,pr,Pt,Or)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Dr){Dr.source&&!Dr.isHidden(c.transform.zoom)&&(Dr.source!==(U&&U.id)&&(U=c.style.sourceCaches[Dr.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&as.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Dr){var un=Dr.transform.padding;Rf(Dr,Dr.transform.height-(un.top||0),3,hl),Rf(Dr,un.bottom||0,3,tf),hp(Dr,un.left||0,3,rf),hp(Dr,Dr.transform.width-(un.right||0),3,Ru);var Fn=Dr.transform.centerPoint;(function(Nn,Un,Di,nn){Il(Nn,Un-1,Di-10,2,20,nn),Il(Nn,Un-10,Di-1,20,2,nn)})(Dr,Fn.x,Dr.transform.height-Fn.y,nf)}(this),this.context.setDefault()},Ka.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),as[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ka.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Ka.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ka.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ka.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,A=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=A}return f},Ka.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var A=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(A){var M=Math.sin(A),L=Math.cos(A);c=[c[0]*L-c[1]*M,c[0]*M+c[1]*L]}var U=[E?c[0]:ea(f,c[0],this.transform.zoom),E?c[1]:ea(f,c[1],this.transform.zoom),0],X=new Float32Array(16);return v.translate(X,l,U),X},Ka.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Ka.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Ka.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Ka.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new qc(this.context,l,Fo[l],f,Pl[l],this._showOverdrawInspector)),this.cache[c]},Ka.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ka.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ka.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ka.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ql=function(l,f){this.points=l,this.planes=f};Ql.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return v.transformMat4([],M,l)}).map(function(M){return v.scale$1([],M,1/M[3]/f*d)}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var L=v.sub([],E[M[0]],E[M[1]]),U=v.sub([],E[M[2]],E[M[1]]),X=v.normalize([],v.cross([],L,U)),oe=-v.dot(X,E[M[1]]);return X.concat(oe)});return new Ql(E,A)};var Ol=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Ol.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),d=v.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new Ol(c,d)},Ol.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Ol.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Ol.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],A=0,M=0;M<f.length;M++)A+=v.dot$1(E,f[M])>=0;if(A===0)return 0;A!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,X=-Number.MAX_VALUE,oe=0;oe<l.points.length;oe++){var ue=l.points[oe][L]-this.min[L];U=Math.min(U,ue),X=Math.max(X,ue)}if(X<0||U>this.max[L]-this.min[L])return 0}return 1};var lu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};lu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},lu.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),d=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,d)},lu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},lu.prototype.clone=function(){return new lu(this.top,this.bottom,this.left,this.right)},lu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Bi=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new lu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Na={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Bi.prototype.clone=function(){var l=new Bi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Na.minZoom.get=function(){return this._minZoom},Na.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Na.maxZoom.get=function(){return this._maxZoom},Na.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Na.minPitch.get=function(){return this._minPitch},Na.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Na.maxPitch.get=function(){return this._maxPitch},Na.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Na.renderWorldCopies.get=function(){return this._renderWorldCopies},Na.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Na.worldSize.get=function(){return this.tileSize*this.scale},Na.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Na.size.get=function(){return new v.Point(this.width,this.height)},Na.bearing.get=function(){return-this.angle/Math.PI*180},Na.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Na.pitch.get=function(){return this._pitch/Math.PI*180},Na.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Na.fov.get=function(){return this._fov/Math.PI*180},Na.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Na.zoom.get=function(){return this._zoom},Na.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Na.center.get=function(){return this._center},Na.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Na.padding.get=function(){return this._edgeInsets.toJSON()},Na.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Na.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Bi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Bi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Bi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Bi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),d=this.pointCoordinate(new v.Point(this.width,0)),E=this.pointCoordinate(new v.Point(this.width,this.height)),A=this.pointCoordinate(new v.Point(0,this.height)),M=Math.floor(Math.min(c.x,d.x,E.x,A.x)),L=Math.floor(Math.max(c.x,d.x,E.x,A.x)),U=M-1;U<=L+1;U++)U!==0&&f.push(new v.UnwrappedTileID(U,l));return f},Bi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=v.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),A=[E*d.x,E*d.y,0],M=Ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var U=function(Dr){return{aabb:new Ol([Dr*E,0,0],[(Dr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Dr,fullyVisible:!1}},X=[],oe=[],ue=f,pe=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Oe=1;Oe<=3;Oe++)X.push(U(-Oe)),X.push(U(Oe));for(X.push(U(0));X.length>0;){var Ie=X.pop(),ke=Ie.x,Ae=Ie.y,je=Ie.fullyVisible;if(!je){var Je=Ie.aabb.intersects(M);if(Je===0)continue;je=Je===2}var yt=Ie.aabb.distanceX(A),Wt=Ie.aabb.distanceY(A),Vt=Math.max(Math.abs(yt),Math.abs(Wt));if(Ie.zoom===ue||Vt>3+(1<<ue-Ie.zoom)-2&&Ie.zoom>=L)oe.push({tileID:new v.OverscaledTileID(Ie.zoom===ue?pe:Ie.zoom,Ie.wrap,Ie.zoom,ke,Ae),distanceSq:v.sqrLen([A[0]-.5-ke,A[1]-.5-Ae])});else for(var Pt=0;Pt<4;Pt++){var pr=(ke<<1)+Pt%2,Or=(Ae<<1)+(Pt>>1);X.push({aabb:Ie.aabb.quadrant(Pt),zoom:Ie.zoom+1,x:pr,y:Or,wrap:Ie.wrap,fullyVisible:je})}}return oe.sort(function(Dr,un){return Dr.distanceSq-un.distanceSq}).map(function(Dr){return Dr.tileID})},Bi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Na.unmodified.get=function(){return this._unmodified},Bi.prototype.zoomScale=function(l){return Math.pow(2,l)},Bi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Bi.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Bi.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Na.point.get=function(){return this.project(this.center)},Bi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),A=new v.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())},Bi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Bi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Bi.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Bi.prototype.coordinateLocation=function(l){return l.toLngLat()},Bi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],A=f[1]/d,M=c[1]/E,L=f[2]/d,U=c[2]/E,X=L===U?0:(0-L)/(U-L);return new v.MercatorCoordinate(v.number(f[0]/d,c[0]/E,X)/this.worldSize,v.number(A,M,X)/this.worldSize)},Bi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Bi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Bi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Bi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Bi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,A=this.worldSize/this.zoomScale(E.z),M=E.x+Math.pow(2,E.z)*l.wrap,L=v.identity(new Float64Array(16));return v.translate(L,L,[M*A,E.y*A,0]),v.scale(L,L,[A/v.EXTENT,A/v.EXTENT,1]),v.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Bi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Bi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,A=90,M=-180,L=180,U=this.size,X=this._unmodified;if(this.latRange){var oe=this.latRange;E=v.mercatorYfromLat(oe[1])*this.worldSize,l=(A=v.mercatorYfromLat(oe[0])*this.worldSize)-E<U.y?U.y/(A-E):0}if(this.lngRange){var ue=this.lngRange;M=v.mercatorXfromLng(ue[0])*this.worldSize,f=(L=v.mercatorXfromLng(ue[1])*this.worldSize)-M<U.x?U.x/(L-M):0}var pe=this.point,Oe=Math.max(f||0,l||0);if(Oe)return this.center=this.unproject(new v.Point(f?(L+M)/2:pe.x,l?(A+E)/2:pe.y)),this.zoom+=this.scaleZoom(Oe),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var Ie=pe.y,ke=U.y/2;Ie-ke<E&&(d=E+ke),Ie+ke>A&&(d=A-ke)}if(this.lngRange){var Ae=pe.x,je=U.x/2;Ae-je<M&&(c=M+je),Ae+je>L&&(c=L-je)}c===void 0&&d===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:pe.x,d!==void 0?d:pe.y))),this._unmodified=X,this._constraining=!1}},Bi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,A=E.x,M=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,X=new Float64Array(16);v.perspective(X,this._fov,this.width/this.height,U,L),X[8]=2*-l.x/this.width,X[9]=2*l.y/this.height,v.scale(X,X,[1,-1,1]),v.translate(X,X,[0,0,-this.cameraToCenterDistance]),v.rotateX(X,X,this._pitch),v.rotateZ(X,X,this.angle),v.translate(X,X,[-A,-M,0]),this.mercatorMatrix=v.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),v.scale(X,X,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=v.invert([],this.projMatrix);var oe=this.width%2/2,ue=this.height%2/2,pe=Math.cos(this.angle),Oe=Math.sin(this.angle),Ie=A-Math.round(A)+pe*oe+Oe*ue,ke=M-Math.round(M)+pe*ue+Oe*oe,Ae=new Float64Array(X);if(v.translate(Ae,Ae,[Ie>.5?Ie-1:Ie,ke>.5?ke-1:ke,0]),this.alignedProjMatrix=Ae,X=v.create(),v.scale(X,X,[this.width/2,-this.height/2,1]),v.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=v.create(),v.scale(X,X,[1,-1,1]),v.translate(X,X,[-1,-1,0]),v.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Bi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Bi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Bi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,A=f.y,M=0,L=l;M<L.length;M+=1){var U=L[M];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),A=Math.max(A,U.y)}return[new v.Point(c,d),new v.Point(E,d),new v.Point(E,A),new v.Point(c,A),new v.Point(c,d)]},Object.defineProperties(Bi.prototype,Na);var Fs=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Fs.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Fs.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Fs.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),A=Math.round(f.lng*E)/E,M=Math.round(f.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),X="";if(X+=l?"/"+A+"/"+M+"/"+c:c+"/"+M+"/"+A,(L||U)&&(X+="/"+Math.round(10*L)/10),U&&(X+="/"+Math.round(U)),this._hashName){var oe=this._hashName,ue=!1,pe=v.window.location.hash.slice(1).split("&").map(function(Oe){var Ie=Oe.split("=")[0];return Ie===oe?(ue=!0,Ie+"="+X):Oe}).filter(function(Oe){return Oe});return ue||pe.push(oe+"="+X),"#"+pe.join("&")}return"#"+X},Fs.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Fs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},Fs.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var af={linearity:.3,easing:v.bezier(0,0,.3,1)},dl=v.extend({deceleration:2500,maxSpeed:1400},af),of=v.extend({deceleration:20,maxSpeed:1400},af),$p=v.extend({deceleration:1e3,maxSpeed:360},af),Qp=v.extend({deceleration:1e3,maxSpeed:90},af),Rc=function(l){this._map=l,this.clear()};function Jl(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Ku(l,f,c){var d=c.maxSpeed,E=c.linearity,A=c.deceleration,M=v.clamp(l*E/(f/1e3),-d,d),L=Math.abs(M)/(A*E);return{easing:c.easing,duration:1e3*L,amount:M*(L/2)}}Rc.prototype.clear=function(){this._inertiaBuffer=[]},Rc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},Rc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Rc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(f.pan.mag()){var L=Ku(f.pan.mag(),A,v.extend({},dl,l||{}));M.offset=f.pan.mult(L.amount/f.pan.mag()),M.center=this._map.transform.center,Jl(M,L)}if(f.zoom){var U=Ku(f.zoom,A,of);M.zoom=this._map.transform.zoom+U.amount,Jl(M,U)}if(f.bearing){var X=Ku(f.bearing,A,$p);M.bearing=this._map.transform.bearing+v.clamp(X.amount,-179,179),Jl(M,X)}if(f.pitch){var oe=Ku(f.pitch,A,Qp);M.pitch=this._map.transform.pitch+oe.amount,Jl(M,oe)}if(M.zoom||M.bearing){var ue=f.pinchAround===void 0?f.around:f.pinchAround;M.around=ue?this._map.unproject(ue):this._map.getCenter()}return this.clear(),v.extend(M,{noMoveStart:!0})}};var Bo=function(l){function f(d,E,A,M){M===void 0&&(M={});var L=j.mousePos(E.getCanvasContainer(),A),U=E.unproject(L);l.call(this,d,v.extend({point:L,lngLat:U,originalEvent:A},M)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),ec=function(l){function f(d,E,A){var M=d==="touchend"?A.changedTouches:A.touches,L=j.touchPos(E.getCanvasContainer(),M),U=L.map(function(ue){return E.unproject(ue)}),X=L.reduce(function(ue,pe,Oe,Ie){return ue.add(pe.div(Ie.length))},new v.Point(0,0)),oe=E.unproject(X);l.call(this,d,{points:L,point:X,lngLats:U,lngLat:oe,originalEvent:A}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),tc=function(l){function f(d,E,A){l.call(this,d,{originalEvent:A}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),to=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};to.prototype.reset=function(){delete this._mousedownPos},to.prototype.wheel=function(l){return this._firePreventable(new tc(l.type,this._map,l))},to.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new Bo(l.type,this._map,l))},to.prototype.mouseup=function(l){this._map.fire(new Bo(l.type,this._map,l))},to.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Bo(l.type,this._map,l))},to.prototype.dblclick=function(l){return this._firePreventable(new Bo(l.type,this._map,l))},to.prototype.mouseover=function(l){this._map.fire(new Bo(l.type,this._map,l))},to.prototype.mouseout=function(l){this._map.fire(new Bo(l.type,this._map,l))},to.prototype.touchstart=function(l){return this._firePreventable(new ec(l.type,this._map,l))},to.prototype.touchmove=function(l){this._map.fire(new ec(l.type,this._map,l))},to.prototype.touchend=function(l){this._map.fire(new ec(l.type,this._map,l))},to.prototype.touchcancel=function(l){this._map.fire(new ec(l.type,this._map,l))},to.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},to.prototype.isEnabled=function(){return!0},to.prototype.isActive=function(){return!1},to.prototype.enable=function(){},to.prototype.disable=function(){};var gn=function(l){this._map=l};gn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},gn.prototype.mousemove=function(l){this._map.fire(new Bo(l.type,this._map,l))},gn.prototype.mousedown=function(){this._delayContextMenu=!0},gn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},gn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Bo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},gn.prototype.isEnabled=function(){return!0},gn.prototype.isActive=function(){return!1},gn.prototype.enable=function(){},gn.prototype.disable=function(){};var fo=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function $u(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}fo.prototype.isEnabled=function(){return!!this._enabled},fo.prototype.isActive=function(){return!!this._active},fo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},fo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},fo.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(j.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},fo.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=j.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),A=Math.max(d.x,c.x),M=Math.min(d.y,c.y),L=Math.max(d.y,c.y);j.setTransform(this._box,"translate("+E+"px,"+M+"px)"),this._box.style.width=A-E+"px",this._box.style.height=L-M+"px"}}},fo.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),j.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(A){return A.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},fo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},fo.prototype.blur=function(){this.reset()},fo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(j.remove(this._box),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos},fo.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var Qu=function(l){this.reset(),this.numTouches=l.numTouches};Qu.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Qu.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new v.Point(0,0),A=0,M=d;A<M.length;A+=1)E._add(M[A]);return E.div(d.length)}(f),this.touches=$u(c,f)))},Qu.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=$u(c,f);for(var E in this.touches){var A=d[E];(!A||A.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Qu.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var yu=function(l){this.singleTap=new Qu(l),this.numTaps=l.numTaps,this.reset()};yu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},yu.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},yu.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},yu.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(d)<30;if(E&&A||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Bs=function(){this._zoomIn=new yu({numTouches:1,numTaps:2}),this._zoomOut=new yu({numTouches:2,numTaps:1}),this.reset()};Bs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Bs.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Bs.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Bs.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),A=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:l})}}):A?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(A)},{originalEvent:l})}}):void 0},Bs.prototype.touchcancel=function(){this.reset()},Bs.prototype.enable=function(){this._enabled=!0},Bs.prototype.disable=function(){this._enabled=!1,this.reset()},Bs.prototype.isEnabled=function(){return this._enabled},Bs.prototype.isActive=function(){return this._active};var Lf={0:1,2:2},qr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};qr.prototype.blur=function(){this.reset()},qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(l,f){return!1},qr.prototype._move=function(l,f){return{}},qr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=j.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},qr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var A=Lf[E];return d.buttons===void 0||(d.buttons&A)!==A}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},qr.prototype.mouseupWindow=function(l){this._lastPoint&&j.mouseButton(l)===this._eventButton&&(this._moved&&j.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var sf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(qr),kf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(qr),Lu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(qr),Wa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Wa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},Wa.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Wa.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Wa.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Wa.prototype.touchcancel=function(){this.reset()},Wa.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=$u(c,f),E=new v.Point(0,0),A=new v.Point(0,0),M=0;for(var L in d){var U=d[L],X=this._touches[L];X&&(E._add(U),A._add(U.sub(X)),M++,d[L]=U)}if(this._touches=d,!(M<this._minTouches)&&A.mag()){var oe=A.div(M);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:E.div(M),panDelta:oe}}},Wa.prototype.enable=function(){this._enabled=!0},Wa.prototype.disable=function(){this._enabled=!1,this.reset()},Wa.prototype.isEnabled=function(){return this._enabled},Wa.prototype.isActive=function(){return this._active};var Ns=function(){this.reset()};function uf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function ku(l,f){return Math.log(l/f)/Math.LN2}Ns.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ns.prototype._start=function(l){},Ns.prototype._move=function(l,f,c){return{}},Ns.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Ns.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],A=uf(c,f,d[0]),M=uf(c,f,E);if(A&&M){var L=this._aroundCenter?null:A.add(M).div(2);return this._move([A,M],L,l)}}},Ns.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],A=uf(c,f,d[0]),M=uf(c,f,E);A&&M||(this._active&&j.suppressClick(),this.reset())}},Ns.prototype.touchcancel=function(){this.reset()},Ns.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Ns.prototype.disable=function(){this._enabled=!1,this.reset()},Ns.prototype.isEnabled=function(){return this._enabled},Ns.prototype.isActive=function(){return this._active};var Is=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(ku(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ku(this._distance,E),pinchAround:d}},f}(Ns);function Po(l,f){return 180*l.angleWith(f)/Math.PI}var dp=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Po(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Po(c,this._startVector);return Math.abs(E)<d},f}(Ns);function _a(l){return Math.abs(l.y)>Math.abs(l.x)}var Df=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,_a(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var A=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(A,M,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(A.y+M.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var A=c.mag()>=2,M=d.mag()>=2;if(A||M){if(!A||!M)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return _a(c)&&_a(d)&&L}},f}(Ns),vp={panStep:100,bearingStep:15,pitchStep:10},Qs=function(){var l=vp;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Os(l){return l*(2-l)}Qs.prototype.blur=function(){this.reset()},Qs.prototype.reset=function(){this._active=!1},Qs.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,A=0,M=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),M=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*f._bearingStep,pitch:L.getPitch()+E*f._pitchStep,offset:[-A*f._panStep,-M*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},Qs.prototype.enable=function(){this._enabled=!0},Qs.prototype.disable=function(){this._enabled=!1,this.reset()},Qs.prototype.isEnabled=function(){return this._enabled},Qs.prototype.isActive=function(){return this._active},Qs.prototype.disableRotation=function(){this._rotationDisabled=!0},Qs.prototype.enableRotation=function(){this._rotationDisabled=!1};var ki=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};ki.prototype.setZoomRate=function(l){this._defaultZoomRate=l},ki.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},ki.prototype.isEnabled=function(){return!!this._enabled},ki.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ki.prototype.isZooming=function(){return!!this._zooming},ki.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},ki.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ki.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},ki.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},ki.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=j.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ki.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var A,M=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,U=this._easing,X=!1;if(this._type==="wheel"&&L&&U){var oe=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),ue=U(oe);A=v.number(L,M,ue),oe<1?this._frameId||(this._frameId=!0):X=!0}else A=M,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:A-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ki.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,d=(v.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),A=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-A*A);f=v.bezier(A,M,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},ki.prototype.blur=function(){this.reset()},ki.prototype.reset=function(){this._active=!1};var _u=function(l,f){this._clickZoom=l,this._tapZoom=f};_u.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},_u.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},_u.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},_u.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ha=function(){this.reset()};ha.prototype.reset=function(){this._active=!1},ha.prototype.blur=function(){this.reset()},ha.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},ha.prototype.enable=function(){this._enabled=!0},ha.prototype.disable=function(){this._enabled=!1,this.reset()},ha.prototype.isEnabled=function(){return this._enabled},ha.prototype.isActive=function(){return this._active};var yo=function(){this._tap=new yu({numTouches:1,numTaps:1}),this.reset()};yo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},yo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},yo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},yo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},yo.prototype.touchcancel=function(){this.reset()},yo.prototype.enable=function(){this._enabled=!0},yo.prototype.disable=function(){this._enabled=!1,this.reset()},yo.prototype.isEnabled=function(){return this._enabled},yo.prototype.isActive=function(){return this._active};var zs=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};zs.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},zs.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},zs.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},zs.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var cu=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};cu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},cu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},cu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},cu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Us=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Us.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Us.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Us.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Us.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Us.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Us.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ms=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Zs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function On(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var wn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rc(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var A=E[d],M=A[0];j.addEventListener(M,A[1],M===v.window.document?this.handleWindowEvent:this.handleEvent,A[2])}};wn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];j.removeEventListener(d,c[1],d===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},wn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new to(f,l));var d=f.boxZoom=new fo(f,l);this._add("boxZoom",d);var E=new Bs,A=new ha;f.doubleClickZoom=new _u(A,E),this._add("tapZoom",E),this._add("clickZoom",A);var M=new yo;this._add("tapDragZoom",M);var L=f.touchPitch=new Df;this._add("touchPitch",L);var U=new kf(l),X=new Lu(l);f.dragRotate=new cu(l,U,X),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var oe=new sf(l),ue=new Wa(l);f.dragPan=new zs(c,oe,ue),this._add("mousePan",oe),this._add("touchPan",ue,["touchZoom","touchRotate"]);var pe=new dp,Oe=new Is;f.touchZoomRotate=new Us(c,Oe,pe,M),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",Oe,["touchPan","touchRotate"]);var Ie=f.scrollZoom=new ki(f,this);this._add("scrollZoom",Ie,["mousePan"]);var ke=f.keyboard=new Qs;this._add("keyboard",ke),this._add("blockableMapEvent",new gn(f));for(var Ae=0,je=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<je.length;Ae+=1){var Je=je[Ae];l.interactive&&l[Je]&&f[Je].enable(l[Je])}},wn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},wn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},wn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},wn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},wn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},wn.prototype.isMoving=function(){return Boolean(ms(this._eventsInProgress))||this.isZooming()},wn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},wn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},wn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},wn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},A={},M=l.touches?this._getMapTouches(l.touches):void 0,L=M?j.touchPos(this._el,M):j.mousePos(this._el,l),U=0,X=this._handlers;U<X.length;U+=1){var oe=X[U],ue=oe.handlerName,pe=oe.handler,Oe=oe.allowed;if(pe.isEnabled()){var Ie=void 0;this._blockedByActive(A,Oe,ue)?pe.reset():pe[f||l.type]&&(Ie=pe[f||l.type](l,L,M),this.mergeHandlerResult(d,E,Ie,ue,c),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||pe.isActive())&&(A[ue]=pe)}}var ke={};for(var Ae in this._previousActiveHandlers)A[Ae]||(ke[Ae]=c);this._previousActiveHandlers=A,(Object.keys(ke).length||On(d))&&(this._changes.push([d,E,ke]),this._triggerRenderFrame()),(Object.keys(A).length||On(d))&&this._map._stop(!0),this._updatingCamera=!1;var je=d.cameraAnimation;je&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],je(this._map))},wn.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){v.extend(l,c);var A={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=A),c.panDelta!==void 0&&(f.drag=A),c.pitchDelta!==void 0&&(f.pitch=A),c.bearingDelta!==void 0&&(f.rotate=A)}},wn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var A=E[d],M=A[0],L=A[1],U=A[2];M.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(l.around=M.around),M.pinchAround!==void 0&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),v.extend(f,L),v.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},wn.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!On(l))return this._fireEvents(f,c,!0);var A=l.panDelta,M=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,X=l.around,oe=l.pinchAround;oe!==void 0&&(X=oe),d._stop(!0),X=X||d.transform.centerPoint;var ue=E.pointLocation(A?X.sub(A):X);L&&(E.bearing+=L),U&&(E.pitch+=U),M&&(E.zoom+=M),E.setLocationAtPoint(ue,X),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},wn.prototype._fireEvents=function(l,f,c){var d=this,E=ms(this._eventsInProgress),A=ms(l),M={};for(var L in l)this._eventsInProgress[L]||(M[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&A&&this._fireEvent("movestart",A.originalEvent),M)this._fireEvent(U,M[U]);for(var X in A&&this._fireEvent("move",A.originalEvent),l)this._fireEvent(X,l[X].originalEvent);var oe,ue={};for(var pe in this._eventsInProgress){var Oe=this._eventsInProgress[pe],Ie=Oe.handlerName,ke=Oe.originalEvent;this._handlersById[Ie].isActive()||(delete this._eventsInProgress[pe],ue[pe+"end"]=oe=f[Ie]||ke)}for(var Ae in ue)this._fireEvent(Ae,ue[Ae]);var je=ms(this._eventsInProgress);if(c&&(E||A)&&!je){this._updatingCamera=!0;var Je=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),yt=function(Wt){return Wt!==0&&-d._bearingSnap<Wt&&Wt<d._bearingSnap};Je?(yt(Je.bearing||this._map.getBearing())&&(Je.bearing=0),this._map.easeTo(Je,{originalEvent:oe})):(this._map.fire(new v.Event("moveend",{originalEvent:oe})),yt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},wn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},wn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new Zs("renderFrame",{timeStamp:f})),l._applyChanges()})},wn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var rc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(v.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(v.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(v.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,v.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=v.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,A){var M={top:0,bottom:0,right:0,left:0};if(typeof(A=v.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){var L=A.padding;A.padding={top:L,bottom:L,right:L,left:L}}A.padding=v.extend(M,A.padding);var U=this.transform,X=U.padding,oe=U.project(v.LngLat.convert(c)),ue=U.project(v.LngLat.convert(d)),pe=oe.rotate(-E*Math.PI/180),Oe=ue.rotate(-E*Math.PI/180),Ie=new v.Point(Math.max(pe.x,Oe.x),Math.max(pe.y,Oe.y)),ke=new v.Point(Math.min(pe.x,Oe.x),Math.min(pe.y,Oe.y)),Ae=Ie.sub(ke),je=(U.width-(X.left+X.right+A.padding.left+A.padding.right))/Ae.x,Je=(U.height-(X.top+X.bottom+A.padding.top+A.padding.bottom))/Ae.y;if(!(Je<0||je<0)){var yt=Math.min(U.scaleZoom(U.scale*Math.min(je,Je)),A.maxZoom),Wt=typeof A.offset.x=="number"?new v.Point(A.offset.x,A.offset.y):v.Point.convert(A.offset),Vt=new v.Point((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(E*Math.PI/180),Pt=Wt.add(Vt).mult(U.scale/U.zoomScale(yt));return{center:U.unproject(oe.add(ue).div(2).sub(Pt)),zoom:yt,bearing:E}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,A,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(d)),E,A),A,M)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=v.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,A=!1,M=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(A=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=v.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(M=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),A&&this.fire(new v.Event("zoomstart",d)).fire(new v.Event("zoom",d)).fire(new v.Event("zoomend",d)),M&&this.fire(new v.Event("rotatestart",d)).fire(new v.Event("rotate",d)).fire(new v.Event("rotateend",d)),L&&this.fire(new v.Event("pitchstart",d)).fire(new v.Event("pitch",d)).fire(new v.Event("pitchend",d)),this.fire(new v.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var A=this.transform,M=this.getZoom(),L=this.getBearing(),U=this.getPitch(),X=this.getPadding(),oe="zoom"in c?+c.zoom:M,ue="bearing"in c?this._normalizeBearing(c.bearing,L):L,pe="pitch"in c?+c.pitch:U,Oe="padding"in c?c.padding:A.padding,Ie=v.Point.convert(c.offset),ke=A.centerPoint.add(Ie),Ae=A.pointLocation(ke),je=v.LngLat.convert(c.center||Ae);this._normalizeCenter(je);var Je,yt,Wt=A.project(Ae),Vt=A.project(je).sub(Wt),Pt=A.zoomScale(oe-M);c.around&&(Je=v.LngLat.convert(c.around),yt=A.locationPoint(Je));var pr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==M,this._rotating=this._rotating||L!==ue,this._pitching=this._pitching||pe!==U,this._padding=!A.isPaddingEqual(Oe),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,pr),this._ease(function(Or){if(E._zooming&&(A.zoom=v.number(M,oe,Or)),E._rotating&&(A.bearing=v.number(L,ue,Or)),E._pitching&&(A.pitch=v.number(U,pe,Or)),E._padding&&(A.interpolatePadding(X,Oe,Or),ke=A.centerPoint.add(Ie)),Je)A.setLocationAtPoint(Je,yt);else{var Dr=A.zoomScale(A.zoom-M),un=oe>M?Math.min(2,Pt):Math.max(.5,Pt),Fn=Math.pow(un,1-Or),Nn=A.unproject(Wt.add(Vt.mult(Or*Fn)).mult(Dr));A.setLocationAtPoint(A.renderWorldCopies?Nn.wrap():Nn,ke)}E._fireMoveEvents(d)},function(Or){E._afterEase(d,Or)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,A=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new v.Event("zoomend",c)),A&&this.fire(new v.Event("rotateend",c)),M&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&v.browser.prefersReducedMotion){var A=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(A,d)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var M=this.transform,L=this.getZoom(),U=this.getBearing(),X=this.getPitch(),oe=this.getPadding(),ue="zoom"in c?v.clamp(+c.zoom,M.minZoom,M.maxZoom):L,pe="bearing"in c?this._normalizeBearing(c.bearing,U):U,Oe="pitch"in c?+c.pitch:X,Ie="padding"in c?c.padding:M.padding,ke=M.zoomScale(ue-L),Ae=v.Point.convert(c.offset),je=M.centerPoint.add(Ae),Je=M.pointLocation(je),yt=v.LngLat.convert(c.center||Je);this._normalizeCenter(yt);var Wt=M.project(Je),Vt=M.project(yt).sub(Wt),Pt=c.curve,pr=Math.max(M.width,M.height),Or=pr/ke,Dr=Vt.mag();if("minZoom"in c){var un=v.clamp(Math.min(c.minZoom,L,ue),M.minZoom,M.maxZoom),Fn=pr/M.zoomScale(un-L);Pt=Math.sqrt(Fn/Dr*2)}var Nn=Pt*Pt;function Un(Kn){var Hn=(Or*Or-pr*pr+(Kn?-1:1)*Nn*Nn*Dr*Dr)/(2*(Kn?Or:pr)*Nn*Dr);return Math.log(Math.sqrt(Hn*Hn+1)-Hn)}function Di(Kn){return(Math.exp(Kn)-Math.exp(-Kn))/2}function nn(Kn){return(Math.exp(Kn)+Math.exp(-Kn))/2}var ai=Un(0),fi=function(Kn){return nn(ai)/nn(ai+Pt*Kn)},ei=function(Kn){return pr*((nn(ai)*(Di(Hn=ai+Pt*Kn)/nn(Hn))-Di(ai))/Nn)/Dr;var Hn},Gn=(Un(1)-ai)/Pt;if(Math.abs(Dr)<1e-6||!isFinite(Gn)){if(Math.abs(pr-Or)<1e-6)return this.easeTo(c,d);var yi=Or<pr?-1:1;Gn=Math.abs(Math.log(Or/pr))/Pt,ei=function(){return 0},fi=function(Kn){return Math.exp(yi*Pt*Kn)}}return c.duration="duration"in c?+c.duration:1e3*Gn/("screenSpeed"in c?+c.screenSpeed/Pt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==pe,this._pitching=Oe!==X,this._padding=!M.isPaddingEqual(Ie),this._prepareEase(d,!1),this._ease(function(Kn){var Hn=Kn*Gn,Pa=1/fi(Hn);M.zoom=Kn===1?ue:L+M.scaleZoom(Pa),E._rotating&&(M.bearing=v.number(U,pe,Kn)),E._pitching&&(M.pitch=v.number(X,Oe,Kn)),E._padding&&(M.interpolatePadding(oe,Ie,Kn),je=M.centerPoint.add(Ae));var ro=Kn===1?yt:M.unproject(Wt.add(Vt.mult(ei(Hn))).mult(Pa));M.setLocationAtPoint(M.renderWorldCopies?ro.wrap():ro,je),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var A=this.handlers;A&&A.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=v.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=v.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(v.Evented),gs=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};gs.prototype.getDefaultPosition=function(){return"bottom-right"},gs.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},gs.prototype.onRemove=function(){j.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},gs.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},gs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},gs.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,A){return E.value&&(d+=E.key+"="+E.value+(A<f.length-1?"&":"")),d},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},gs.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},gs.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var A=E.getSource();A.attribution&&l.indexOf(A.attribution)<0&&l.push(A.attribution)}}l.sort(function(L,U){return L.length-U.length});var M=(l=l.filter(function(L,U){for(var X=U+1;X<l.length;X++)if(l[X].indexOf(L)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,l.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},gs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xu=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};xu.prototype.onAdd=function(l){this._map=l,this._container=j.create("div","mapboxgl-ctrl");var f=j.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xu.prototype.onRemove=function(){j.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xu.prototype.getDefaultPosition=function(){return"bottom-left"},xu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},xu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},xu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var rs=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};rs.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},rs.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},rs.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},rs.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Sa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Lc=v.window.HTMLImageElement,kc=v.window.HTMLElement,da=v.window.ImageBitmap,Ma={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Dc=function(l){function f(d){var E=this;if((d=v.extend({},Ma,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var A=new Bi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,A,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new rs,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Sa,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new v.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=v.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof kc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new wn(this,d),this._hash=d.hash&&new Fs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,v.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new gs({customAttribution:d.customAttribution})),this.addControl(new xu,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(M){E._update(M.dataType==="style"),E.fire(new v.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){E.fire(new v.Event(M.dataType+"dataloading",M))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var A=d.onAdd(this);this._controls.push(d);var M=this._controlPositions[E];return E.indexOf("bottom")!==-1?M.insertBefore(A,M.firstChild):M.appendChild(A),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),A=E[0],M=E[1];if(A===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(A,M),this.transform.resize(A,M),this.painter.resize(A,M);var L=!this._moving;return L&&this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),this.fire(new v.Event("resize",d)),L&&this.fire(new v.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(v.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(v.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(v.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,A){var M,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:A,delegates:{mousemove:function(oe){var ue=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];ue.length?U||(U=!0,A.call(L,new Bo(d,L,oe.originalEvent,{features:ue}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var X=!1;return{layer:E,listener:A,delegates:{mousemove:function(oe){(L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[]).length?X=!0:X&&(X=!1,A.call(L,new Bo(d,L,oe.originalEvent)))},mouseout:function(oe){X&&(X=!1,A.call(L,new Bo(d,L,oe.originalEvent)))}}}}return{layer:E,listener:A,delegates:(M={},M[d]=function(oe){var ue=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];ue.length&&(oe.features=ue,A.call(L,oe),delete oe.features)},M)}},f.prototype.on=function(d,E,A){if(A===void 0)return l.prototype.on.call(this,d,E);var M=this._createDelegatedListener(d,E,A);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(M),M.delegates)this.on(L,M.delegates[L]);return this},f.prototype.once=function(d,E,A){if(A===void 0)return l.prototype.once.call(this,d,E);var M=this._createDelegatedListener(d,E,A);for(var L in M.delegates)this.once(L,M.delegates[L]);return this},f.prototype.off=function(d,E,A){var M=this;return A===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],X=0;X<U.length;X++){var oe=U[X];if(oe.layer===E&&oe.listener===A){for(var ue in oe.delegates)M.off(ue,oe.delegates[ue]);return U.splice(X,1),M}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var A;if(E!==void 0||d===void 0||d instanceof v.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof d[0]=="number")A=[v.Point.convert(d)];else{var M=v.Point.convert(d[0]),L=v.Point.convert(d[1]);A=[M,new v.Point(L.x,M.y),L,new v.Point(M.x,L.y),M]}return this.style.queryRenderedFeatures(A,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new vs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var A=this;if(typeof d=="string"){var M=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(M,v.ResourceType.Style);v.getJSON(L,function(U,X){U?A.fire(new v.ErrorEvent(U)):X&&A._updateDiff(X,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(A){v.warnOnce("Unable to perform style diff: "+(A.message||A.error||A)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var A=d[E]._tiles;for(var M in A){var L=A[M];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,A)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,A){A===void 0&&(A={});var M=A.pixelRatio;M===void 0&&(M=1);var L=A.sdf;L===void 0&&(L=!1);var U=A.stretchX,X=A.stretchY,oe=A.content;if(this._lazyInitEmptyStyle(),E instanceof Lc||da&&E instanceof da){var ue=v.browser.getImageData(E);this.style.addImage(d,{data:new v.RGBAImage({width:ue.width,height:ue.height},ue.data),pixelRatio:M,stretchX:U,stretchY:X,content:oe,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var pe=E;this.style.addImage(d,{data:new v.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:M,stretchX:U,stretchY:X,content:oe,sdf:L,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var A=this.style.getImage(d);if(!A)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=E instanceof Lc||da&&E instanceof da?v.browser.getImageData(E):E,L=M.width,U=M.height,X=M.data;return L===void 0||U===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==A.data.width||U!==A.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(A.data.replace(X,!(E instanceof Lc||da&&E instanceof da)),void this.style.updateImage(d,A))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){v.getImage(this._requestManager.transformRequest(d,v.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,A){return this.style.setLayerZoomRange(d,E,A),this._update(!0)},f.prototype.setFilter=function(d,E,A){return A===void 0&&(A={}),this.style.setFilter(d,E,A),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,A,M){return M===void 0&&(M={}),this.style.setPaintProperty(d,E,A,M),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,A,M){return M===void 0&&(M={}),this.style.setLayoutProperty(d,E,A,M),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=j.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=j.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=j.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var A=this._containerDimensions();this._resizeCanvas(A[0],A[1]);var M=this._controlContainer=j.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=j.create("div","mapboxgl-ctrl-"+U,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var A=v.browser.devicePixelRatio||1;this._canvas.width=A*d,this._canvas.height=A*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=v.extend({},ve.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Ka(E,this.transform),v.webpSupported.testSupport(E)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,A=this,M=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),M=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,oe=v.browser.now();this.style.zoomHistory.update(X,oe);var ue=new v.EvaluationParameters(X,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=ue.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(U=!0,this._crossFadingFactor=pe),this.style.update(ue)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Oe=v.browser.now()-M;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ae=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),A.fire(new v.Event("gpu-timing-frame",{cpuTime:Oe,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Ie=this.painter.collectGpuTimers();setTimeout(function(){var Ae=A.painter.queryGpuTimers(Ie);A.fire(new v.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var ke=this._sourcesDirty||this._styleDirty||this._placementDirty;return ke||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||ke||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),Rl(this._canvasContainer),Rl(this._controlContainer),Rl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){v.setCacheLimits(d,E)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(rc);function Rl(l){l.parentNode&&l.parentNode.removeChild(l)}var bu={showCompass:!0,showZoom:!0,visualizePitch:!1},Js=function(l){var f=this;this.options=v.extend({},bu,l),this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),j.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),j.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=j.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Js.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Js.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Js.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new No(this._map,this._compass,this.options.visualizePitch)),this._container},Js.prototype.onRemove=function(){j.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Js.prototype._createButton=function(l,f){var c=j.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Js.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var No=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new kf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new Lu({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),j.addEventListener(f,"mousedown",this.mousedown),j.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),j.addEventListener(f,"touchmove",this.touchmove),j.addEventListener(f,"touchend",this.touchend),j.addEventListener(f,"touchcancel",this.reset)};function vl(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var d=new v.LngLat(l.lng-360,l.lat),E=new v.LngLat(l.lng+360,l.lat),A=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<A?l=d:c.locationPoint(E).distSqr(f)<A&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var M=c.locationPoint(l);if(M.x>=0&&M.y>=0&&M.x<=c.width&&M.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}No.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),j.disableDrag()},No.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},No.prototype.off=function(){var l=this.element;j.removeEventListener(l,"mousedown",this.mousedown),j.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),j.removeEventListener(l,"touchmove",this.touchmove),j.removeEventListener(l,"touchend",this.touchend),j.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},No.prototype.offTemp=function(){j.enableDrag(),j.removeEventListener(v.window,"mousemove",this.mousemove),j.removeEventListener(v.window,"mouseup",this.mouseup)},No.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),j.mousePos(this.element,l)),j.addEventListener(v.window,"mousemove",this.mousemove),j.addEventListener(v.window,"mouseup",this.mouseup)},No.prototype.mousemove=function(l){this.move(l,j.mousePos(this.element,l))},No.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},No.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},No.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},No.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},No.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function lf(l,f,c){var d=l.classList;for(var E in Eu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var Ll,kl=function(l){function f(c,d){if(l.call(this),(c instanceof v.window.HTMLElement||d)&&(c=v.extend({element:c},d)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div"),this._element.setAttribute("aria-label","Map marker");var E=j.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var A=j.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");var M=j.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var L=j.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<X.length;U+=1){var oe=X[U],ue=j.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",oe.rx),ue.setAttributeNS(null,"ry",oe.ry),L.appendChild(ue)}var pe=j.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"fill",this._color);var Oe=j.createNS("http://www.w3.org/2000/svg","path");Oe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pe.appendChild(Oe);var Ie=j.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"fill","#000000");var ke=j.createNS("http://www.w3.org/2000/svg","path");ke.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ie.appendChild(ke);var Ae=j.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var je=j.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Je=j.createNS("http://www.w3.org/2000/svg","circle");Je.setAttributeNS(null,"fill","#000000"),Je.setAttributeNS(null,"opacity","0.25"),Je.setAttributeNS(null,"cx","5.5"),Je.setAttributeNS(null,"cy","5.5"),Je.setAttributeNS(null,"r","5.4999962");var yt=j.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#FFFFFF"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962"),je.appendChild(Je),je.appendChild(yt),M.appendChild(L),M.appendChild(pe),M.appendChild(Ie),M.appendChild(Ae),M.appendChild(je),E.appendChild(M),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Wt){Wt.preventDefault()}),this._element.addEventListener("mousedown",function(Wt){Wt.preventDefault()}),lf(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),j.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=vl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),j.setTransform(this._element,Eu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),Dl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},nc=0,ml=!1,mp=function(l){function f(c){l.call(this),this.options=v.extend({},Dl,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Ll!==void 0?d(Ll):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Ll=E.state!=="denied")}):d(Ll=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),j.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,nc=0,ml=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,A=this._map.getBearing(),M=v.extend({bearing:A},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),M,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),A=d.distanceTo(E),M=Math.ceil(2*this._accuracy/A);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&ml)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=j.create("button","mapboxgl-ctrl-geolocate",this._container),j.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var A=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new kl(this._dotElement),this._circleElement=j.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||d._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":nc--,ml=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++nc>1?(c={maximumAge:6e5,timeout:0},ml=!0):(c=this.options.positionOptions,ml=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),Ju={maxWidth:100,unit:"metric"},Du=function(l){this.options=v.extend({},Ju,l),v.bindAll(["_onMove","setUnit"],this)};function Ff(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,A=l.unproject([0,E]),M=l.unproject([d,E]),L=A.distanceTo(M);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?gl(f,d,U/5280,l._getUIString("ScaleControl.Miles")):gl(f,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?gl(f,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?gl(f,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):gl(f,d,L,l._getUIString("ScaleControl.Meters"))}function gl(l,f,c,d){var E,A,M,L=(E=c,(A=Math.pow(10,(""+Math.floor(E)).length-1))*(M=(M=E/A)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(U){var X=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*X)/X}(M)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Du.prototype.getDefaultPosition=function(){return"bottom-left"},Du.prototype._onMove=function(){Ff(this._map,this._container,this.options)},Du.prototype.onAdd=function(l){return this._map=l,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Du.prototype.onRemove=function(){j.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Du.prototype.setUnit=function(l){this.options.unit=l,Ff(this._map,this._container,this.options)};var eu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};eu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},eu.prototype.onRemove=function(){j.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},eu.prototype._setupUI=function(){var l=this._fullscreenButton=j.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},eu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},eu.prototype._isFullscreen=function(){return this._fullscreen},eu.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},eu.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var cf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},js=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),gp=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(cf),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&j.remove(this._content),this._container&&(j.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=v.window.document.createDocumentFragment(),A=v.window.document.createElement("body");for(A.innerHTML=c;d=A.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=j.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=j.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=j.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ue){return d._container.classList.add(ue)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),A=this.options.anchor,M=function ue(pe){if(pe){if(typeof pe=="number"){var Oe=Math.round(Math.sqrt(.5*Math.pow(pe,2)));return{center:new v.Point(0,0),top:new v.Point(0,pe),"top-left":new v.Point(Oe,Oe),"top-right":new v.Point(-Oe,Oe),bottom:new v.Point(0,-pe),"bottom-left":new v.Point(Oe,-Oe),"bottom-right":new v.Point(-Oe,-Oe),left:new v.Point(pe,0),right:new v.Point(-pe,0)}}if(pe instanceof v.Point||Array.isArray(pe)){var Ie=v.Point.convert(pe);return{center:Ie,top:Ie,"top-left":Ie,"top-right":Ie,bottom:Ie,"bottom-left":Ie,"bottom-right":Ie,left:Ie,right:Ie}}return{center:v.Point.convert(pe.center||[0,0]),top:v.Point.convert(pe.top||[0,0]),"top-left":v.Point.convert(pe["top-left"]||[0,0]),"top-right":v.Point.convert(pe["top-right"]||[0,0]),bottom:v.Point.convert(pe.bottom||[0,0]),"bottom-left":v.Point.convert(pe["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(pe["bottom-right"]||[0,0]),left:v.Point.convert(pe.left||[0,0]),right:v.Point.convert(pe.right||[0,0])}}return ue(new v.Point(0,0))}(this.options.offset);if(!A){var L,U=this._container.offsetWidth,X=this._container.offsetHeight;L=E.y+M.bottom.y<X?["top"]:E.y>this._map.transform.height-X?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),A=L.length===0?"bottom":L.join("-")}var oe=E.add(M[A]).round();j.setTransform(this._container,Eu[A]+" translate("+oe.x+"px,"+oe.y+"px)"),lf(this._container,A,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(js);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),ic={version:v.version,supported:ve,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Dc,NavigationControl:Js,GeolocateControl:mp,AttributionControl:gs,ScaleControl:Du,FullscreenControl:eu,Popup:gp,Marker:kl,Style:vs,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){wt().acquire(Bt)},clearPrewarmedResources:function(){var l=bn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Bt),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return gr.workerCount},set workerCount(l){gr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return ic}),le})},28660:function(At,Q,N){var le=N(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ye;(function(v){(function(ve){var j=typeof N.g=="object"?N.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=se(v);typeof j.Reflect=="undefined"?j.Reflect=v:ce=se(j.Reflect,ce),ve(ce);function se(Ne,ae){return function(et,Le){typeof Ne[et]!="function"&&Object.defineProperty(Ne,et,{configurable:!0,writable:!0,value:Le}),ae&&ae(et,Le)}}})(function(ve){var j=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",se=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ne=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ae=typeof Object.create=="function",et={__proto__:[]}instanceof Array,Le=!ae&&!et,it={create:ae?function(){return ps(Object.create(null))}:et?function(){return ps({__proto__:null})}:function(){return ps({})},has:Le?function(jt,ir){return j.call(jt,ir)}:function(jt,ir){return ir in jt},get:Le?function(jt,ir){return j.call(jt,ir)?jt[ir]:void 0}:function(jt,ir){return jt[ir]}},Ht=Object.getPrototypeOf(Function),sr=typeof le=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ct=!sr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:he(),Jt=!sr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Bn(),Mt=!sr&&typeof WeakMap=="function"?WeakMap:Ya(),lt=new Mt;function dt(jt,ir,Mr,I){if(vn(Mr)){if(!Ai(jt))throw new TypeError;if(!la(ir))throw new TypeError;return kr(jt,ir)}else{if(!Ai(jt))throw new TypeError;if(!Xn(ir))throw new TypeError;if(!Xn(I)&&!vn(I)&&!Qi(I))throw new TypeError;return Qi(I)&&(I=void 0),Mr=Fi(Mr),Qr(jt,ir,Mr,I)}}ve("decorate",dt);function er(jt,ir){function Mr(I,ar){if(!Xn(I))throw new TypeError;if(!vn(ar)&&!wi(ar))throw new TypeError;zt(jt,ir,I,ar)}return Mr}ve("metadata",er);function Y(jt,ir,Mr,I){if(!Xn(Mr))throw new TypeError;return vn(I)||(I=Fi(I)),zt(jt,ir,Mr,I)}ve("defineMetadata",Y);function $t(jt,ir,Mr){if(!Xn(ir))throw new TypeError;return vn(Mr)||(Mr=Fi(Mr)),Xe(jt,ir,Mr)}ve("hasMetadata",$t);function gt(jt,ir,Mr){if(!Xn(ir))throw new TypeError;return vn(Mr)||(Mr=Fi(Mr)),De(jt,ir,Mr)}ve("hasOwnMetadata",gt);function Qe(jt,ir,Mr){if(!Xn(ir))throw new TypeError;return vn(Mr)||(Mr=Fi(Mr)),St(jt,ir,Mr)}ve("getMetadata",Qe);function xt(jt,ir,Mr){if(!Xn(ir))throw new TypeError;return vn(Mr)||(Mr=Fi(Mr)),vt(jt,ir,Mr)}ve("getOwnMetadata",xt);function $e(jt,ir){if(!Xn(jt))throw new TypeError;return vn(ir)||(ir=Fi(ir)),qt(jt,ir)}ve("getMetadataKeys",$e);function Kt(jt,ir){if(!Xn(jt))throw new TypeError;return vn(ir)||(ir=Fi(ir)),Cr(jt,ir)}ve("getOwnMetadataKeys",Kt);function Sr(jt,ir,Mr){if(!Xn(ir))throw new TypeError;vn(Mr)||(Mr=Fi(Mr));var I=we(ir,Mr,!1);if(vn(I)||!I.delete(jt))return!1;if(I.size>0)return!0;var ar=lt.get(ir);return ar.delete(Mr),ar.size>0||lt.delete(ir),!0}ve("deleteMetadata",Sr);function kr(jt,ir){for(var Mr=jt.length-1;Mr>=0;--Mr){var I=jt[Mr],ar=I(ir);if(!vn(ar)&&!Qi(ar)){if(!la(ar))throw new TypeError;ir=ar}}return ir}function Qr(jt,ir,Mr,I){for(var ar=jt.length-1;ar>=0;--ar){var Ln=jt[ar],li=Ln(ir,Mr,I);if(!vn(li)&&!Qi(li)){if(!Xn(li))throw new TypeError;I=li}}return I}function we(jt,ir,Mr){var I=lt.get(jt);if(vn(I)){if(!Mr)return;I=new Ct,lt.set(jt,I)}var ar=I.get(ir);if(vn(ar)){if(!Mr)return;ar=new Ct,I.set(ir,ar)}return ar}function Xe(jt,ir,Mr){var I=De(jt,ir,Mr);if(I)return!0;var ar=Xa(ir);return Qi(ar)?!1:Xe(jt,ar,Mr)}function De(jt,ir,Mr){var I=we(ir,Mr,!1);return vn(I)?!1:ui(I.has(jt))}function St(jt,ir,Mr){var I=De(jt,ir,Mr);if(I)return vt(jt,ir,Mr);var ar=Xa(ir);if(!Qi(ar))return St(jt,ar,Mr)}function vt(jt,ir,Mr){var I=we(ir,Mr,!1);if(!vn(I))return I.get(jt)}function zt(jt,ir,Mr,I){var ar=we(Mr,I,!0);ar.set(jt,ir)}function qt(jt,ir){var Mr=Cr(jt,ir),I=Xa(jt);if(I===null)return Mr;var ar=qt(I,ir);if(ar.length<=0)return Mr;if(Mr.length<=0)return ar;for(var Ln=new Jt,li=[],Vn=0,rn=Mr;Vn<rn.length;Vn++){var Ii=rn[Vn],Oi=Ln.has(Ii);Oi||(Ln.add(Ii),li.push(Ii))}for(var eo=0,hs=ar;eo<hs.length;eo++){var Ii=hs[eo],Oi=Ln.has(Ii);Oi||(Ln.add(Ii),li.push(Ii))}return li}function Cr(jt,ir){var Mr=[],I=we(jt,ir,!1);if(vn(I))return Mr;for(var ar=I.keys(),Ln=Mn(ar),li=0;;){var Vn=Ui(Ln);if(!Vn)return Mr.length=li,Mr;var rn=Si(Vn);try{Mr[li]=rn}catch(Ii){try{Ji(Ln)}finally{throw Ii}}li++}}function Yn(jt){if(jt===null)return 1;switch(typeof jt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return jt===null?1:6;default:return 6}}function vn(jt){return jt===void 0}function Qi(jt){return jt===null}function jn(jt){return typeof jt=="symbol"}function Xn(jt){return typeof jt=="object"?jt!==null:typeof jt=="function"}function gi(jt,ir){switch(Yn(jt)){case 0:return jt;case 1:return jt;case 2:return jt;case 3:return jt;case 4:return jt;case 5:return jt}var Mr=ir===3?"string":ir===5?"number":"default",I=ba(jt,se);if(I!==void 0){var ar=I.call(jt,Mr);if(Xn(ar))throw new TypeError;return ar}return qn(jt,Mr==="default"?"number":Mr)}function qn(jt,ir){if(ir==="string"){var Mr=jt.toString;if(Gi(Mr)){var I=Mr.call(jt);if(!Xn(I))return I}var ar=jt.valueOf;if(Gi(ar)){var I=ar.call(jt);if(!Xn(I))return I}}else{var ar=jt.valueOf;if(Gi(ar)){var I=ar.call(jt);if(!Xn(I))return I}var Ln=jt.toString;if(Gi(Ln)){var I=Ln.call(jt);if(!Xn(I))return I}}throw new TypeError}function ui(jt){return!!jt}function oa(jt){return""+jt}function Fi(jt){var ir=gi(jt,3);return jn(ir)?ir:oa(ir)}function Ai(jt){return Array.isArray?Array.isArray(jt):jt instanceof Object?jt instanceof Array:Object.prototype.toString.call(jt)==="[object Array]"}function Gi(jt){return typeof jt=="function"}function la(jt){return typeof jt=="function"}function wi(jt){switch(Yn(jt)){case 3:return!0;case 4:return!0;default:return!1}}function ba(jt,ir){var Mr=jt[ir];if(Mr!=null){if(!Gi(Mr))throw new TypeError;return Mr}}function Mn(jt){var ir=ba(jt,Ne);if(!Gi(ir))throw new TypeError;var Mr=ir.call(jt);if(!Xn(Mr))throw new TypeError;return Mr}function Si(jt){return jt.value}function Ui(jt){var ir=jt.next();return ir.done?!1:ir}function Ji(jt){var ir=jt.return;ir&&ir.call(jt)}function Xa(jt){var ir=Object.getPrototypeOf(jt);if(typeof jt!="function"||jt===Ht||ir!==Ht)return ir;var Mr=jt.prototype,I=Mr&&Object.getPrototypeOf(Mr);if(I==null||I===Object.prototype)return ir;var ar=I.constructor;return typeof ar!="function"||ar===jt?ir:ar}function he(){var jt={},ir=[],Mr=function(){function li(Vn,rn,Ii){this._index=0,this._keys=Vn,this._values=rn,this._selector=Ii}return li.prototype["@@iterator"]=function(){return this},li.prototype[Ne]=function(){return this},li.prototype.next=function(){var Vn=this._index;if(Vn>=0&&Vn<this._keys.length){var rn=this._selector(this._keys[Vn],this._values[Vn]);return Vn+1>=this._keys.length?(this._index=-1,this._keys=ir,this._values=ir):this._index++,{value:rn,done:!1}}return{value:void 0,done:!0}},li.prototype.throw=function(Vn){throw this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),Vn},li.prototype.return=function(Vn){return this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),{value:Vn,done:!0}},li}();return function(){function li(){this._keys=[],this._values=[],this._cacheKey=jt,this._cacheIndex=-2}return Object.defineProperty(li.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),li.prototype.has=function(Vn){return this._find(Vn,!1)>=0},li.prototype.get=function(Vn){var rn=this._find(Vn,!1);return rn>=0?this._values[rn]:void 0},li.prototype.set=function(Vn,rn){var Ii=this._find(Vn,!0);return this._values[Ii]=rn,this},li.prototype.delete=function(Vn){var rn=this._find(Vn,!1);if(rn>=0){for(var Ii=this._keys.length,Oi=rn+1;Oi<Ii;Oi++)this._keys[Oi-1]=this._keys[Oi],this._values[Oi-1]=this._values[Oi];return this._keys.length--,this._values.length--,Vn===this._cacheKey&&(this._cacheKey=jt,this._cacheIndex=-2),!0}return!1},li.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=jt,this._cacheIndex=-2},li.prototype.keys=function(){return new Mr(this._keys,this._values,I)},li.prototype.values=function(){return new Mr(this._keys,this._values,ar)},li.prototype.entries=function(){return new Mr(this._keys,this._values,Ln)},li.prototype["@@iterator"]=function(){return this.entries()},li.prototype[Ne]=function(){return this.entries()},li.prototype._find=function(Vn,rn){return this._cacheKey!==Vn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Vn)),this._cacheIndex<0&&rn&&(this._cacheIndex=this._keys.length,this._keys.push(Vn),this._values.push(void 0)),this._cacheIndex},li}();function I(li,Vn){return li}function ar(li,Vn){return Vn}function Ln(li,Vn){return[li,Vn]}}function Bn(){return function(){function jt(){this._map=new Ct}return Object.defineProperty(jt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),jt.prototype.has=function(ir){return this._map.has(ir)},jt.prototype.add=function(ir){return this._map.set(ir,ir),this},jt.prototype.delete=function(ir){return this._map.delete(ir)},jt.prototype.clear=function(){this._map.clear()},jt.prototype.keys=function(){return this._map.keys()},jt.prototype.values=function(){return this._map.values()},jt.prototype.entries=function(){return this._map.entries()},jt.prototype["@@iterator"]=function(){return this.keys()},jt.prototype[Ne]=function(){return this.keys()},jt}()}function Ya(){var jt=16,ir=it.create(),Mr=I();return function(){function rn(){this._key=I()}return rn.prototype.has=function(Ii){var Oi=ar(Ii,!1);return Oi!==void 0?it.has(Oi,this._key):!1},rn.prototype.get=function(Ii){var Oi=ar(Ii,!1);return Oi!==void 0?it.get(Oi,this._key):void 0},rn.prototype.set=function(Ii,Oi){var eo=ar(Ii,!0);return eo[this._key]=Oi,this},rn.prototype.delete=function(Ii){var Oi=ar(Ii,!1);return Oi!==void 0?delete Oi[this._key]:!1},rn.prototype.clear=function(){this._key=I()},rn}();function I(){var rn;do rn="@@WeakMap@@"+Vn();while(it.has(ir,rn));return ir[rn]=!0,rn}function ar(rn,Ii){if(!j.call(rn,Mr)){if(!Ii)return;Object.defineProperty(rn,Mr,{value:it.create()})}return rn[Mr]}function Ln(rn,Ii){for(var Oi=0;Oi<Ii;++Oi)rn[Oi]=Math.random()*255|0;return rn}function li(rn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(rn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(rn)):Ln(new Uint8Array(rn),rn):Ln(new Array(rn),rn)}function Vn(){var rn=li(jt);rn[6]=rn[6]&79|64,rn[8]=rn[8]&191|128;for(var Ii="",Oi=0;Oi<jt;++Oi){var eo=rn[Oi];(Oi===4||Oi===6||Oi===8)&&(Ii+="-"),eo<16&&(Ii+="0"),Ii+=eo.toString(16).toLowerCase()}return Ii}}function ps(jt){return jt.__=void 0,delete jt.__,jt}})})(ye||(ye={}))},69848:function(At){(function(Q,N){At.exports=N()})(this,function(){"use strict";function Q(gt,Qe,xt,$e,Kt,Sr){if(!(Kt-$e<=xt)){var kr=$e+Kt>>1;N(gt,Qe,kr,$e,Kt,Sr%2),Q(gt,Qe,xt,$e,kr-1,Sr+1),Q(gt,Qe,xt,kr+1,Kt,Sr+1)}}function N(gt,Qe,xt,$e,Kt,Sr){for(;Kt>$e;){if(Kt-$e>600){var kr=Kt-$e+1,Qr=xt-$e+1,we=Math.log(kr),Xe=.5*Math.exp(2*we/3),De=.5*Math.sqrt(we*Xe*(kr-Xe)/kr)*(Qr-kr/2<0?-1:1),St=Math.max($e,Math.floor(xt-Qr*Xe/kr+De)),vt=Math.min(Kt,Math.floor(xt+(kr-Qr)*Xe/kr+De));N(gt,Qe,xt,St,vt,Sr)}var zt=Qe[2*xt+Sr],qt=$e,Cr=Kt;for(le(gt,Qe,$e,xt),Qe[2*Kt+Sr]>zt&&le(gt,Qe,$e,Kt);qt<Cr;){for(le(gt,Qe,qt,Cr),qt++,Cr--;Qe[2*qt+Sr]<zt;)qt++;for(;Qe[2*Cr+Sr]>zt;)Cr--}Qe[2*$e+Sr]===zt?le(gt,Qe,$e,Cr):(Cr++,le(gt,Qe,Cr,Kt)),Cr<=xt&&($e=Cr+1),xt<=Cr&&(Kt=Cr-1)}}function le(gt,Qe,xt,$e){ye(gt,xt,$e),ye(Qe,2*xt,2*$e),ye(Qe,2*xt+1,2*$e+1)}function ye(gt,Qe,xt){var $e=gt[Qe];gt[Qe]=gt[xt],gt[xt]=$e}function v(gt,Qe,xt,$e,Kt,Sr,kr){for(var Qr=[0,gt.length-1,0],we=[],Xe,De;Qr.length;){var St=Qr.pop(),vt=Qr.pop(),zt=Qr.pop();if(vt-zt<=kr){for(var qt=zt;qt<=vt;qt++)Xe=Qe[2*qt],De=Qe[2*qt+1],Xe>=xt&&Xe<=Kt&&De>=$e&&De<=Sr&&we.push(gt[qt]);continue}var Cr=Math.floor((zt+vt)/2);Xe=Qe[2*Cr],De=Qe[2*Cr+1],Xe>=xt&&Xe<=Kt&&De>=$e&&De<=Sr&&we.push(gt[Cr]);var Yn=(St+1)%2;(St===0?xt<=Xe:$e<=De)&&(Qr.push(zt),Qr.push(Cr-1),Qr.push(Yn)),(St===0?Kt>=Xe:Sr>=De)&&(Qr.push(Cr+1),Qr.push(vt),Qr.push(Yn))}return we}function ve(gt,Qe,xt,$e,Kt,Sr){for(var kr=[0,gt.length-1,0],Qr=[],we=Kt*Kt;kr.length;){var Xe=kr.pop(),De=kr.pop(),St=kr.pop();if(De-St<=Sr){for(var vt=St;vt<=De;vt++)j(Qe[2*vt],Qe[2*vt+1],xt,$e)<=we&&Qr.push(gt[vt]);continue}var zt=Math.floor((St+De)/2),qt=Qe[2*zt],Cr=Qe[2*zt+1];j(qt,Cr,xt,$e)<=we&&Qr.push(gt[zt]);var Yn=(Xe+1)%2;(Xe===0?xt-Kt<=qt:$e-Kt<=Cr)&&(kr.push(St),kr.push(zt-1),kr.push(Yn)),(Xe===0?xt+Kt>=qt:$e+Kt>=Cr)&&(kr.push(zt+1),kr.push(De),kr.push(Yn))}return Qr}function j(gt,Qe,xt,$e){var Kt=gt-xt,Sr=Qe-$e;return Kt*Kt+Sr*Sr}var ce=function(gt){return gt[0]},se=function(gt){return gt[1]},Ne=function(Qe,xt,$e,Kt,Sr){xt===void 0&&(xt=ce),$e===void 0&&($e=se),Kt===void 0&&(Kt=64),Sr===void 0&&(Sr=Float64Array),this.nodeSize=Kt,this.points=Qe;for(var kr=Qe.length<65536?Uint16Array:Uint32Array,Qr=this.ids=new kr(Qe.length),we=this.coords=new Sr(Qe.length*2),Xe=0;Xe<Qe.length;Xe++)Qr[Xe]=Xe,we[2*Xe]=xt(Qe[Xe]),we[2*Xe+1]=$e(Qe[Xe]);Q(Qr,we,Kt,0,Qr.length-1,0)};Ne.prototype.range=function(Qe,xt,$e,Kt){return v(this.ids,this.coords,Qe,xt,$e,Kt,this.nodeSize)},Ne.prototype.within=function(Qe,xt,$e){return ve(this.ids,this.coords,Qe,xt,$e,this.nodeSize)};var ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(gt){return gt}},et=Math.fround||function(gt){return function(Qe){return gt[0]=+Qe,gt[0]}}(new Float32Array(1)),Le=function(Qe){this.options=er(Object.create(ae),Qe),this.trees=new Array(this.options.maxZoom+1)};Le.prototype.load=function(Qe){var xt=this.options,$e=xt.log,Kt=xt.minZoom,Sr=xt.maxZoom,kr=xt.nodeSize;$e&&console.time("total time");var Qr="prepare "+Qe.length+" points";$e&&console.time(Qr),this.points=Qe;for(var we=[],Xe=0;Xe<Qe.length;Xe++)!Qe[Xe].geometry||we.push(Ht(Qe[Xe],Xe));this.trees[Sr+1]=new Ne(we,Y,$t,kr,Float32Array),$e&&console.timeEnd(Qr);for(var De=Sr;De>=Kt;De--){var St=+Date.now();we=this._cluster(we,De),this.trees[De]=new Ne(we,Y,$t,kr,Float32Array),$e&&console.log("z%d: %d clusters in %dms",De,we.length,+Date.now()-St)}return $e&&console.timeEnd("total time"),this},Le.prototype.getClusters=function(Qe,xt){var $e=((Qe[0]+180)%360+360)%360-180,Kt=Math.max(-90,Math.min(90,Qe[1])),Sr=Qe[2]===180?180:((Qe[2]+180)%360+360)%360-180,kr=Math.max(-90,Math.min(90,Qe[3]));if(Qe[2]-Qe[0]>=360)$e=-180,Sr=180;else if($e>Sr){var Qr=this.getClusters([$e,Kt,180,kr],xt),we=this.getClusters([-180,Kt,Sr,kr],xt);return Qr.concat(we)}for(var Xe=this.trees[this._limitZoom(xt)],De=Xe.range(Jt($e),Mt(kr),Jt(Sr),Mt(Kt)),St=[],vt=0,zt=De;vt<zt.length;vt+=1){var qt=zt[vt],Cr=Xe.points[qt];St.push(Cr.numPoints?sr(Cr):this.points[Cr.index])}return St},Le.prototype.getChildren=function(Qe){var xt=this._getOriginId(Qe),$e=this._getOriginZoom(Qe),Kt="No cluster with the specified id.",Sr=this.trees[$e];if(!Sr)throw new Error(Kt);var kr=Sr.points[xt];if(!kr)throw new Error(Kt);for(var Qr=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),we=Sr.within(kr.x,kr.y,Qr),Xe=[],De=0,St=we;De<St.length;De+=1){var vt=St[De],zt=Sr.points[vt];zt.parentId===Qe&&Xe.push(zt.numPoints?sr(zt):this.points[zt.index])}if(Xe.length===0)throw new Error(Kt);return Xe},Le.prototype.getLeaves=function(Qe,xt,$e){xt=xt||10,$e=$e||0;var Kt=[];return this._appendLeaves(Kt,Qe,xt,$e,0),Kt},Le.prototype.getTile=function(Qe,xt,$e){var Kt=this.trees[this._limitZoom(Qe)],Sr=Math.pow(2,Qe),kr=this.options,Qr=kr.extent,we=kr.radius,Xe=we/Qr,De=($e-Xe)/Sr,St=($e+1+Xe)/Sr,vt={features:[]};return this._addTileFeatures(Kt.range((xt-Xe)/Sr,De,(xt+1+Xe)/Sr,St),Kt.points,xt,$e,Sr,vt),xt===0&&this._addTileFeatures(Kt.range(1-Xe/Sr,De,1,St),Kt.points,Sr,$e,Sr,vt),xt===Sr-1&&this._addTileFeatures(Kt.range(0,De,Xe/Sr,St),Kt.points,-1,$e,Sr,vt),vt.features.length?vt:null},Le.prototype.getClusterExpansionZoom=function(Qe){for(var xt=this._getOriginZoom(Qe)-1;xt<=this.options.maxZoom;){var $e=this.getChildren(Qe);if(xt++,$e.length!==1)break;Qe=$e[0].properties.cluster_id}return xt},Le.prototype._appendLeaves=function(Qe,xt,$e,Kt,Sr){for(var kr=this.getChildren(xt),Qr=0,we=kr;Qr<we.length;Qr+=1){var Xe=we[Qr],De=Xe.properties;if(De&&De.cluster?Sr+De.point_count<=Kt?Sr+=De.point_count:Sr=this._appendLeaves(Qe,De.cluster_id,$e,Kt,Sr):Sr<Kt?Sr++:Qe.push(Xe),Qe.length===$e)break}return Sr},Le.prototype._addTileFeatures=function(Qe,xt,$e,Kt,Sr,kr){for(var Qr=0,we=Qe;Qr<we.length;Qr+=1){var Xe=we[Qr],De=xt[Xe],St=De.numPoints,vt=void 0,zt=void 0,qt=void 0;if(St)vt=Ct(De),zt=De.x,qt=De.y;else{var Cr=this.points[De.index];vt=Cr.properties,zt=Jt(Cr.geometry.coordinates[0]),qt=Mt(Cr.geometry.coordinates[1])}var Yn={type:1,geometry:[[Math.round(this.options.extent*(zt*Sr-$e)),Math.round(this.options.extent*(qt*Sr-Kt))]],tags:vt},vn=void 0;St?vn=De.id:this.options.generateId?vn=De.index:this.points[De.index].id&&(vn=this.points[De.index].id),vn!==void 0&&(Yn.id=vn),kr.features.push(Yn)}},Le.prototype._limitZoom=function(Qe){return Math.max(this.options.minZoom,Math.min(Math.floor(+Qe),this.options.maxZoom+1))},Le.prototype._cluster=function(Qe,xt){for(var $e=[],Kt=this.options,Sr=Kt.radius,kr=Kt.extent,Qr=Kt.reduce,we=Kt.minPoints,Xe=Sr/(kr*Math.pow(2,xt)),De=0;De<Qe.length;De++){var St=Qe[De];if(!(St.zoom<=xt)){St.zoom=xt;for(var vt=this.trees[xt+1],zt=vt.within(St.x,St.y,Xe),qt=St.numPoints||1,Cr=qt,Yn=0,vn=zt;Yn<vn.length;Yn+=1){var Qi=vn[Yn],jn=vt.points[Qi];jn.zoom>xt&&(Cr+=jn.numPoints||1)}if(Cr>qt&&Cr>=we){for(var Xn=St.x*qt,gi=St.y*qt,qn=Qr&&qt>1?this._map(St,!0):null,ui=(De<<5)+(xt+1)+this.points.length,oa=0,Fi=zt;oa<Fi.length;oa+=1){var Ai=Fi[oa],Gi=vt.points[Ai];if(!(Gi.zoom<=xt)){Gi.zoom=xt;var la=Gi.numPoints||1;Xn+=Gi.x*la,gi+=Gi.y*la,Gi.parentId=ui,Qr&&(qn||(qn=this._map(St,!0)),Qr(qn,this._map(Gi)))}}St.parentId=ui,$e.push(it(Xn/Cr,gi/Cr,ui,Cr,qn))}else if($e.push(St),Cr>1)for(var wi=0,ba=zt;wi<ba.length;wi+=1){var Mn=ba[wi],Si=vt.points[Mn];Si.zoom<=xt||(Si.zoom=xt,$e.push(Si))}}}return $e},Le.prototype._getOriginId=function(Qe){return Qe-this.points.length>>5},Le.prototype._getOriginZoom=function(Qe){return(Qe-this.points.length)%32},Le.prototype._map=function(Qe,xt){if(Qe.numPoints)return xt?er({},Qe.properties):Qe.properties;var $e=this.points[Qe.index].properties,Kt=this.options.map($e);return xt&&Kt===$e?er({},Kt):Kt};function it(gt,Qe,xt,$e,Kt){return{x:et(gt),y:et(Qe),zoom:Infinity,id:xt,parentId:-1,numPoints:$e,properties:Kt}}function Ht(gt,Qe){var xt=gt.geometry.coordinates,$e=xt[0],Kt=xt[1];return{x:et(Jt($e)),y:et(Mt(Kt)),zoom:Infinity,index:Qe,parentId:-1}}function sr(gt){return{type:"Feature",id:gt.id,properties:Ct(gt),geometry:{type:"Point",coordinates:[lt(gt.x),dt(gt.y)]}}}function Ct(gt){var Qe=gt.numPoints,xt=Qe>=1e4?Math.round(Qe/1e3)+"k":Qe>=1e3?Math.round(Qe/100)/10+"k":Qe;return er(er({},gt.properties),{cluster:!0,cluster_id:gt.id,point_count:Qe,point_count_abbreviated:xt})}function Jt(gt){return gt/360+.5}function Mt(gt){var Qe=Math.sin(gt*Math.PI/180),xt=.5-.25*Math.log((1+Qe)/(1-Qe))/Math.PI;return xt<0?0:xt>1?1:xt}function lt(gt){return(gt-.5)*360}function dt(gt){var Qe=(180-gt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Qe))/Math.PI-90}function er(gt,Qe){for(var xt in Qe)gt[xt]=Qe[xt];return gt}function Y(gt){return gt.x}function $t(gt){return gt.y}return Le})},75752:function(At){At.exports.RADIUS=6378137,At.exports.FLATTENING=1/298.257223563,At.exports.POLAR_RADIUS=63567523142e-4}}]);
